<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
<script type="text/javascript" id="globalevalfunction">
//<!--

var globaleval = function(script) {
  window.MouseClick=function (x,y) {};
  window.MouseMove=function (x,y) {};
  window.Keypressed=function (x) {};
  window.Keydown=function (x) {};
  window.Keyup=function (x) {};
  if (window.execScript) {
    return window.execScript(script);
  } else if (navigator.userAgent.indexOf('KHTML') != -1) { //safari, konqueror..
    var s = document.createElement('script');
    s.type = 'text/javascript';
    MonInnerHTML(s, script);
    document.getElementsByTagName('head')[0].appendChild(s);
  } else {
    builtin_nbprompt=0; return window.eval(script);
  }
}

function getQuerystring(key, default_)
{
  if (default_==null) default_="";
  key = key.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regex = new RegExp("[\\?&]"+key+"=([^&#]*)");
  var qs = regex.exec(window.location.href+'&dropbox=off');
  if(qs == null)
    return default_;
  else
    return qs[1];
}


function ZoomSession(id) {
  if (! document.getElementById("VisioDiv")) {
	var myzoom = document.createElement('div');

    myzoom.id = 'VisioDiv';
    myzoom.width = 1000;
    myzoom.height = 800;

    var style = '-ms-transition: -ms-transform 1s ease; -moz-transition: -moz-transform 1s ease;-webkit-transition: -webkit-transform 1s ease;-o-transition: -o-transform 1s ease;transition: transform 1s ease;transform-origin: bottom right;-ms-transform-origin: bottom right;-moz-transform-origin: bottom right;-webkit-transform-origin: bottom right;-o-transform-origin: bottom right;';
    style += 'position: absolute;border: 1px solid;border-color: black;top: 30px;left: 0px;width: ' + window.innerWidth + 'px;height: ' + (window.innerHeight-32) + 'px;background-color: white;overflow: hidden;';
    style += 'visibility: hidden; z-index: 10000';
    myzoom.style.cssText = style;
    document.body.appendChild(myzoom);

    var leselect = document.getElementById('titre_onglet');
    leselect.options[leselect.options.length] = new Option('Visioconference', 'VisioDiv');
	window.addEventListener("resize",function () {TailleBoite(GEBID('VisioDiv'), window.innerWidth,window.innerHeight-32); GEBID('VisioFrame').width=window.innerWidth; GEBID('VisioFrame').height=window.innerHeight-32;});

  }
  id=id.replace(" ","");
  document.getElementById("VisioDiv").innerHTML = '<iframe id="VisioFrame" src="https://meet.jit.si/algoscriptinfovisio_'+id+'" allow="camera;microphone;display-capture" width="'+window.innerWidth+'" height="'+(window.innerHeight-32)+'"></iframe>';
}

var togetherjsid=getQuerystring("togetherjs", "public_channel");
var whichhub=getQuerystring("hub", "private");
// document.title = document.title+'('+whichhub+')';
// window.document.body.addEventListener("load",function () {if (togetherjsid != 'public_channel') document.getElementById('icoVisioP').style.visibility='hidden';});

/*

// Tentative (succès) d'authentification

(function(window){
  window.utils = {
    parseQueryString: function(str) {
      var ret = Object.create(null);

      if (typeof str !== 'string') {
        return ret;
      }

      str = str.trim().replace(/^(\?|#|&)/, '');

      if (!str) {
        return ret;
      }

      str.split('&').forEach(function (param) {
        var parts = param.replace(/\+/g, ' ').split('=');
        // Firefox (pre 40) decodes `%3D` to `=`
        // https://github.com/sindresorhus/query-string/pull/37
        var key = parts.shift();
        var val = parts.length > 0 ? parts.join('=') : undefined;

        key = decodeURIComponent(key);
        val = val === undefined ? null : decodeURIComponent(val);

        if (ret[key] === undefined) {
          ret[key] = val;
        } else if (Array.isArray(ret[key])) {
          ret[key].push(val);
        } else {
          ret[key] = [ret[key], val];
        }
      });

      return ret;
    }
  };
})(window);


var CLIENT_ID = '9i1w6khg9467g15';

// Parses the url and gets the access token if it is in the urls hash


function getAccessTokenFromUrl() {
  return utils.parseQueryString(window.location.hash).access_token;
}

// If the user was just redirected from authenticating, the urls hash will
// contain the access token.


function isAuthenticated() {
  return !!getAccessTokenFromUrl();
}

// Render a list of items to #files


function renderItems(items) {
  items.forEach(function(item) {
    Ecrire(item.name);
  });
}

// This example keeps both the authenticate and non-authenticated setions
// in the DOM and uses this function to show/hide the correct section.


if (isAuthenticated()) {
  // Create an instance of Dropbox with the access token and use it to
  // fetch and render the files in the users root directory.
  var dbx = new Dropbox({
    accessToken: getAccessTokenFromUrl()
  });
  dbx.filesListFolder({
    path: ''
  }).then(function(response) {
    renderItems(response.entries);
  }).catch (function(error) {
    console.log(error);
  });
} else {

  // Set the login anchors href using dbx.getAuthenticationUrl()
  var dbx = new Dropbox({
    clientId: CLIENT_ID
  });
  var authUrl = dbx.getAuthenticationUrl(window.location);
  window.location = authUrl;
}
*/



var mybaseurl='https://algoscript.info/';
var mybaseurl='';


var defaultEnvironmentLanguage = 'french';
var defaultDropbox = 'off';
var DropboxAppID=getQuerystring('dropboxid', '9i1w6khg9467g15');
var evalligne=17;
var builtin_nbprompt=0;

var ConfigurationFile,MustCreateAlgoScriptConfigflag=false;
if (typeof(window.localStorage['AlgoScript.config']) != 'undefined')
   ConfigurationFile = window.localStorage['AlgoScript.config'];
else {
   ConfigurationFile = '';
   MustCreateAlgoScriptConfigflag=true;
}
if (getQuerystring('noext', 'no') == 'yes') ConfigurationFile = '';
var ConfigTable = ConfigurationFile.split('\n');
var AllExtensions = [];
var nbextensions = -1;

function InitExtension() {
//AfficherTableau(ConfigTable);

for (var i = 0; i < (ConfigTable.length); i++) {
  if (ConfigTable[i].search(/^\[.*\]/) == 0) {
    nbextensions++;
    AllExtensions[nbextensions] = [];
    AllExtensions[nbextensions]['NAME'] = ConfigTable[i].substr(1, ConfigTable[i].length - 2);
  } else {
  	if (ConfigTable[i][0] != '%') {
    var n = ConfigTable[i].search('=');
    if (n > 0) {
      var cle = ConfigTable[i].substr(0, n);
      if (typeof(AllExtensions[nbextensions][cle]) == 'undefined') AllExtensions[nbextensions][cle] = [];
      AllExtensions[nbextensions][cle].push(ConfigTable[i].substr(n + 1));
    }
  	}
  }

}

//Ecrire('Bonjour');
//Ecrire(Taille(AllExtensions));

for (var i = 0; i < (AllExtensions.length); i++) {
  //for (var p in AllExtensions[i]) Ecrire(p + '=' + AllExtensions[i][p]);
  var enabled = (AllExtensions[i]['ENABLED'][0].search(/yes/i) >= 0);
  if ((AllExtensions[i]['NAME'] == 'Jappix tool') && (getQuerystring('chat') == 'on')) {
  enabled = true;
}
if ((AllExtensions[i]['NAME'] == 'Python extension') && (getQuerystring('python') == 'on')) {
enabled = true;
}
  if (AllExtensions[i]['ENABLED'][0].search(/ask/i) >= 0) enabled = confirm('Do you want to enable\n' + AllExtensions[i]['TITLE'][0] + ' ?');
  if (enabled) {
    if (typeof(AllExtensions[i]['JSURL']) != 'undefined') {
      //for (var j = 0; j < AllExtensions[i]['JSURL'].length; j++) Ecrire('Load ' + AllExtensions[i]['JSURL'][j]);
      for(var j=0; j<AllExtensions[i]['JSURL'].length;j++) document.write('<script src="'+AllExtensions[i]['JSURL'][j]+'"></script>');
    }
    if (typeof(AllExtensions[i]['CSSURL']) != 'undefined') {
      //for (var j = 0; j < AllExtensions[i]['CSSURL'].length; j++) Ecrire('Load ' + AllExtensions[i]['CSSURL'][j]);
      for(var j=0; j<AllExtensions[i]['CSSURL'].length;j++) document.write('<link rel="stylesheet" href="'+AllExtensions[i]['CSSURL'][j]+'" />');
    }
  }
}
}

InitExtension();

function MustCreateAlgoScriptConfig() {
	var initialcontent='';
initialcontent+='% [extension name]\n';
initialcontent+='% TITLE=Extension description\n';
initialcontent+='% ENABLED=yes or no or ask : Extension is enabled\n';
initialcontent+='% JSURL= url of the javascript code of the extension (0, 1 or several JSURL possible)\n';
initialcontent+='% CSSURL=url of the CSS code of the extension (0, 1 or several JSURL possible)\n';
initialcontent+='\n';
initialcontent+='[Openstreetmap extension]\n';
initialcontent+='TITLE=Extension pour OpenStreetMap (leaflet.js)\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://algoscript.info/leaflet.js\n';
initialcontent+='CSSURL=https://algoscript.info/leaflet.css\n';
initialcontent+='\n';
initialcontent+='[WebGL extension]\n';
initialcontent+='TITLE=Extension pour WebGL (three.js)\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://algoscript.info/three.min.js\n';
initialcontent+='\n';
initialcontent+='[Protovis extension]\n';
initialcontent+='TITLE=Extension Protovis pour la visualisation de données http://mbostock.github.io/protovis/\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://algoscript.info/protovis.min.js\n';
initialcontent+='\n';
initialcontent+='[Sylvester extension]\n';
initialcontent+='TITLE=Extension Sylvester pour le calcul algébrique http://sylvester.jcoglan.com\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://algoscript.info/sylvester.js\n';
initialcontent+='\n';
initialcontent+='[RSA extension]\n';
initialcontent+='TITLE=Extension Calcul de RSA par Dave Shapiro http://www.ohdave.com/\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://algoscript.info/BigInt.js\n';
initialcontent+='JSURL=https://algoscript.info/Barrett.js\n';
initialcontent+='JSURL=https://algoscript.info/RSA.js\n';
initialcontent+='\n';
initialcontent+='[Arbor extension]\n';
initialcontent+='TITLE=Extension pour la visualisation de graphes (arbor.js)\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://algoscript.info/jquery-2.0.3.min.js\n';
initialcontent+='JSURL=https://algoscript.info/arbor.js\n';
initialcontent+='JSURL=https://algoscript.info/arbor-tween.js\n';
initialcontent+='\n';
initialcontent+='[Processing extension]\n';
initialcontent+='TITLE=Extension Processing 1.4.1 (processing.js)\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://algoscript.info/processing-1.4.1.min.js\n';
initialcontent+='JSURL=https://algoscript.info/Processing_post.js\n';
initialcontent+='\n';
initialcontent+='[Dracula extension]\n';
initialcontent+='TITLE=Extension Dracula for drawing graphs\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://algoscript.info/Dracula/raphael-min.js\n';
initialcontent+='JSURL=https://algoscript.info/Dracula/dracula_graffle.js\n';
initialcontent+='JSURL=https://algoscript.info/Dracula/jquery-1.4.2.min.js\n';
initialcontent+='JSURL=https://algoscript.info/Dracula/dracula_graph.js\n';
initialcontent+='JSURL=https://algoscript.info/Dracula/dracula_algorithms.js\n';
initialcontent+='\n';

initialcontent+='[Common Lisp extension]\n';
initialcontent+='TITLE=Extension Common Lisp (Javasthcript.js)\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://algoscript.info/javathcript.js\n';
initialcontent+='JSURL=https://algoscript.info/javathcript_post.js\n';
initialcontent+='\n';

initialcontent+='[Python extension]\n';
initialcontent+='TITLE=Extension Python (skulpt.js)\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js\n';
initialcontent+='JSURL=https://algoscript.info/skulpt.js\n';
initialcontent+='JSURL=https://algoscript.info/skulpt.min.js\n';
initialcontent+='JSURL=https://algoscript.info/skulpt-stdlib.js\n';
initialcontent+='JSURL=https://algoscript.info/skulpt_post.js\n';
initialcontent+='\n';

initialcontent+='[Parallel extension]\n';
initialcontent+='TITLE=Extension Parallel pour le calcul parallèle multi-coeurs\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://algoscript.info/parallel.js\n';
initialcontent+='\n';

initialcontent+='[PeerJS extension]\n';
initialcontent+='TITLE=Extension PeerJS pour les communications pair à pair (nécessite une clé)\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://algoscript.info/peer.min.js\n';
initialcontent+='\n';

initialcontent+='[Audiolet extension]\n';
initialcontent+='TITLE=Extension Audiolet pour la synthèse audio\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://algoscript.info/Audiolet.min.js\n';
initialcontent+='\n';

initialcontent+='[Music Partition extension]\n';
initialcontent+='TITLE=Extension VexFlow for drawing music partitions\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://algoscript.info/vexflow-min.js\n';
initialcontent+='JSURL=https://algoscript.info/raphael-min.js\n';
initialcontent+='JSURL=https://algoscript.info/Dracula/jquery-1.4.2.min.js\n';
initialcontent+='\n';

initialcontent+='[Speech synthesis extension]\n';
initialcontent+='TITLE=Extension mespeak\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://algoscript.info/mespeak.js\n';
initialcontent+='JSURL=https://algoscript.info/mespeak_post.js\n';
initialcontent+='\n';

initialcontent+='[POS Tagging Library]\n';
initialcontent+='TITLE=Extension jspos for POS tagging of english texts\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://algoscript.info/JSLIB/jspos/lexer.js\n';
initialcontent+='JSURL=https://algoscript.info/JSLIB/jspos/lexicon.js_\n';
initialcontent+='JSURL=https://algoscript.info/JSLIB/jspos/POSTagger.js\n';
initialcontent+='\n';

initialcontent+='[Pedagogic Library]\n';
initialcontent+='TITLE=Extension for adding pedagogic tools to the environment\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://algoscript.info/Pedagogic-tools.js\n';
initialcontent+='JSURL=https://algoscript.info/rasterizeHTML.js\n';
initialcontent+='\n';

initialcontent+='[RecordRTC Library]\n';
initialcontent+='TITLE=Extension for allowing screen recording\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://algoscript.info/WebRTC-screenshot.js\n';
initialcontent+='JSURL=https://algoscript.info/WebRTC-RecordRTC.js\n';
initialcontent+='\n';


initialcontent+='[ChemDoodleWeb]\n';
initialcontent+='TITLE=Extension for Molecular Biology\n';
initialcontent+='ENABLED=no\n';
initialcontent+='CSSURL=https://algoscript.info/ChemDoodleWeb.css\n';
initialcontent+='JSURL=https://algoscript.info/ChemDoodleWeb.js\n';
initialcontent+='\n';

initialcontent+='[Blockly]\n';
initialcontent+='TITLE=Extension for Visual code edition\n';
initialcontent+='ENABLED=yes\n';
initialcontent+='JSURL=https://algoscript.info/blockly.js\n';
initialcontent+='JSURL=https://algoscript.info/blockly_post.js\n';
initialcontent+='\n';

initialcontent+='[Clingo]\n';
initialcontent+='TITLE=Extension for Answer Set Programming\n';
initialcontent+='ENABLED=no\n';
initialcontent+='JSURL=https://algoscript.info/clingo_post.js\n';
initialcontent+='JSURL=https://algoscript.info/clingo.js\n';
initialcontent+='\n';


	writeFile('AlgoScript.config',initialcontent);
	alert('Creating AlgoScript.config');
}

// Begin Dropbox
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Dropbox=t():e.Dropbox=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var s=r[n]={exports:{},id:n,loaded:!1};return e[n].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){var n=r(13);e.exports=n},function(e,t,r){(function(t,n){/*!
	 * @overview es6-promise - a tiny implementation of Promises/A+.
	 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
	 * @license   Licensed under MIT license
	 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
	 * @version   3.3.1
	 */
!function(t,r){e.exports=r()}(this,function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function s(e){return"function"==typeof e}function i(e){Y=e}function o(e){K=e}function u(){return function(){return t.nextTick(l)}}function a(){return function(){W(l)}}function c(){var e=0,t=new Z(l),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}function p(){var e=new MessageChannel;return e.port1.onmessage=l,function(){return e.port2.postMessage(0)}}function h(){var e=setTimeout;return function(){return e(l,1)}}function l(){for(var e=0;e<$;e+=2){var t=re[e],r=re[e+1];t(r),re[e]=void 0,re[e+1]=void 0}$=0}function f(){try{var e=r(19);return W=e.runOnLoop||e.runOnContext,a()}catch(e){return h()}}function d(e,t){var r=arguments,n=this,s=new this.constructor(m);void 0===s[se]&&M(s);var i=n._state;return i?!function(){var e=r[i-1];K(function(){return F(i,s,e,n._result)})}():C(n,s,e,t),s}function _(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var r=new t(m);return k(r,e),r}function m(){}function y(){return new TypeError("You cannot resolve a promise with itself")}function g(){return new TypeError("A promises callback cannot return that same promise.")}function v(e){try{return e.then}catch(e){return ae.error=e,ae}}function b(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}function q(e,t,r){K(function(e){var n=!1,s=b(r,t,function(r){n||(n=!0,t!==r?k(e,r):A(e,r))},function(t){n||(n=!0,L(e,t))},"Settle: "+(e._label||" unknown promise"));!n&&s&&(n=!0,L(e,s))},e)}function w(e,t){t._state===oe?A(e,t._result):t._state===ue?L(e,t._result):C(t,void 0,function(t){return k(e,t)},function(t){return L(e,t)})}function x(e,t,r){t.constructor===e.constructor&&r===d&&t.constructor.resolve===_?w(e,t):r===ae?L(e,ae.error):void 0===r?A(e,t):s(r)?q(e,t,r):A(e,t)}function k(t,r){t===r?L(t,y()):e(r)?x(t,r,v(r)):A(t,r)}function T(e){e._onerror&&e._onerror(e._result),S(e)}function A(e,t){e._state===ie&&(e._result=t,e._state=oe,0!==e._subscribers.length&&K(S,e))}function L(e,t){e._state===ie&&(e._state=ue,e._result=t,K(T,e))}function C(e,t,r,n){var s=e._subscribers,i=s.length;e._onerror=null,s[i]=t,s[i+oe]=r,s[i+ue]=n,0===i&&e._state&&K(S,e)}function S(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,s=void 0,i=e._result,o=0;o<t.length;o+=3)n=t[o],s=t[o+r],n?F(r,n,s,i):s(i);e._subscribers.length=0}}function R(){this.error=null}function D(e,t){try{return e(t)}catch(e){return ce.error=e,ce}}function F(e,t,r,n){var i=s(r),o=void 0,u=void 0,a=void 0,c=void 0;if(i){if(o=D(r,n),o===ce?(c=!0,u=o.error,o=null):a=!0,t===o)return void L(t,g())}else o=n,a=!0;t._state!==ie||(i&&a?k(t,o):c?L(t,u):e===oe?A(t,o):e===ue&&L(t,o))}function E(e,t){try{t(function(t){k(e,t)},function(t){L(e,t)})}catch(t){L(e,t)}}function j(){return pe++}function M(e){e[se]=pe++,e._state=void 0,e._result=void 0,e._subscribers=[]}function U(e,t){this._instanceConstructor=e,this.promise=new e(m),this.promise[se]||M(this.promise),N(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?A(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&A(this.promise,this._result))):L(this.promise,P())}function P(){return new Error("Array Methods must be provided an Array")}function O(e){return new U(this,e).promise}function G(e){var t=this;return new t(N(e)?function(r,n){for(var s=e.length,i=0;i<s;i++)t.resolve(e[i]).then(r,n)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function B(e){var t=this,r=new t(m);return L(r,e),r}function H(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function I(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function z(e){this[se]=j(),this._result=this._state=void 0,this._subscribers=[],m!==e&&("function"!=typeof e&&H(),this instanceof z?E(this,e):I())}function X(){var e=void 0;if("undefined"!=typeof n)e=n;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=z}var J=void 0;J=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var N=J,$=0,W=void 0,Y=void 0,K=function(e,t){re[$]=e,re[$+1]=t,$+=2,2===$&&(Y?Y(l):ne())},V="undefined"!=typeof window?window:void 0,Q=V||{},Z=Q.MutationObserver||Q.WebKitMutationObserver,ee="undefined"==typeof self&&"undefined"!=typeof t&&"[object process]"==={}.toString.call(t),te="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,re=new Array(1e3),ne=void 0;ne=ee?u():Z?c():te?p():void 0===V?f():h();var se=Math.random().toString(36).substring(16),ie=void 0,oe=1,ue=2,ae=new R,ce=new R,pe=0;return U.prototype._enumerate=function(){for(var e=this.length,t=this._input,r=0;this._state===ie&&r<e;r++)this._eachEntry(t[r],r)},U.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===_){var s=v(e);if(s===d&&e._state!==ie)this._settledAt(e._state,t,e._result);else if("function"!=typeof s)this._remaining--,this._result[t]=e;else if(r===z){var i=new r(m);x(i,e,s),this._willSettleAt(i,t)}else this._willSettleAt(new r(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},U.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===ie&&(this._remaining--,e===ue?L(n,r):this._result[t]=r),0===this._remaining&&A(n,this._result)},U.prototype._willSettleAt=function(e,t){var r=this;C(e,void 0,function(e){return r._settledAt(oe,t,e)},function(e){return r._settledAt(ue,t,e)})},z.all=O,z.race=G,z.resolve=_,z.reject=B,z._setScheduler=i,z._setAsap=o,z._asap=K,z.prototype={constructor:z,then:d,catch:function(e){return this.then(null,e)}},X(),z.polyfill=X,z.Promise=z,z})}).call(t,r(8),function(){return this}())},function(e,t,r){function n(){}function s(e){var t={}.toString.call(e);switch(t){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}}function i(e){if(!v(e))return e;var t=[];for(var r in e)null!=e[r]&&o(t,r,e[r]);return t.join("&")}function o(e,t,r){return Array.isArray(r)?r.forEach(function(r){o(e,t,r)}):void e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}function u(e){for(var t,r,n={},s=e.split("&"),i=0,o=s.length;i<o;++i)r=s[i],t=r.split("="),n[decodeURIComponent(t[0])]=decodeURIComponent(t[1]);return n}function a(e){var t,r,n,s,i=e.split(/\r?\n/),o={};i.pop();for(var u=0,a=i.length;u<a;++u)r=i[u],t=r.indexOf(":"),n=r.slice(0,t).toLowerCase(),s=q(r.slice(t+1)),o[n]=s;return o}function c(e){return/[\/+]json\b/.test(e)}function p(e){return e.split(/ *; */).shift()}function h(e){return y(e.split(/ *; */),function(e,t){var r=t.split(/ *= */),n=r.shift(),s=r.shift();return n&&s&&(e[n]=s),e},{})}function l(e,t){t=t||{},this.req=e,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"==typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText,this.setStatusProperties(this.xhr.status),this.header=this.headers=a(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this.setHeaderProperties(this.header),this.body="HEAD"!=this.req.method?this.parseBody(this.text?this.text:this.xhr.response):null}function f(e,t){var r=this;this._query=this._query||[],this.method=e,this.url=t,this.header={},this._header={},this.on("end",function(){var e=null,t=null;try{t=new l(r)}catch(t){return e=new Error("Parser is unable to parse the response"),e.parse=!0,e.original=t,e.rawResponse=r.xhr&&r.xhr.responseText?r.xhr.responseText:null,e.statusCode=r.xhr&&r.xhr.status?r.xhr.status:null,r.callback(e)}if(r.emit("response",t),e)return r.callback(e,t);if(t.status>=200&&t.status<300)return r.callback(e,t);var n=new Error(t.statusText||"Unsuccessful HTTP response");n.original=e,n.response=t,n.status=t.status,r.callback(n,t)})}function d(e,t){var r=b("DELETE",e);return t&&r.end(t),r}var _,m=r(7),y=r(9),g=r(10),v=r(4);_="undefined"!=typeof window?window:"undefined"!=typeof self?self:this;var b=e.exports=r(11).bind(null,f);b.getXHR=function(){if(!(!_.XMLHttpRequest||_.location&&"file:"==_.location.protocol&&_.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}return!1};var q="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};b.serializeObject=i,b.parseString=u,b.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},b.serialize={"application/x-www-form-urlencoded":i,"application/json":JSON.stringify},b.parse={"application/x-www-form-urlencoded":u,"application/json":JSON.parse},l.prototype.get=function(e){return this.header[e.toLowerCase()]},l.prototype.setHeaderProperties=function(e){var t=this.header["content-type"]||"";this.type=p(t);var r=h(t);for(var n in r)this[n]=r[n]},l.prototype.parseBody=function(e){var t=b.parse[this.type];return!t&&c(this.type)&&(t=b.parse["application/json"]),t&&e&&(e.length||e instanceof Object)?t(e):null},l.prototype.setStatusProperties=function(e){1223===e&&(e=204);var t=e/100|0;this.status=this.statusCode=e,this.statusType=t,this.info=1==t,this.ok=2==t,this.clientError=4==t,this.serverError=5==t,this.error=(4==t||5==t)&&this.toError(),this.accepted=202==e,this.noContent=204==e,this.badRequest=400==e,this.unauthorized=401==e,this.notAcceptable=406==e,this.notFound=404==e,this.forbidden=403==e},l.prototype.toError=function(){var e=this.req,t=e.method,r=e.url,n="cannot "+t+" "+r+" ("+this.status+")",s=new Error(n);return s.status=this.status,s.method=t,s.url=r,s},b.Response=l,m(f.prototype);for(var w in g)f.prototype[w]=g[w];f.prototype.abort=function(){if(!this.aborted)return this.aborted=!0,this.xhr&&this.xhr.abort(),this.clearTimeout(),this.emit("abort"),this},f.prototype.type=function(e){return this.set("Content-Type",b.types[e]||e),this},f.prototype.responseType=function(e){return this._responseType=e,this},f.prototype.accept=function(e){return this.set("Accept",b.types[e]||e),this},f.prototype.auth=function(e,t,r){switch(r||(r={type:"basic"}),r.type){case"basic":var n=btoa(e+":"+t);this.set("Authorization","Basic "+n);break;case"auto":this.username=e,this.password=t}return this},f.prototype.query=function(e){return"string"!=typeof e&&(e=i(e)),e&&this._query.push(e),this},f.prototype.attach=function(e,t,r){return this._getFormData().append(e,t,r||t.name),this},f.prototype._getFormData=function(){return this._formData||(this._formData=new _.FormData),this._formData},f.prototype.send=function(e){var t=v(e),r=this._header["content-type"];if(t&&v(this._data))for(var n in e)this._data[n]=e[n];else"string"==typeof e?(r||this.type("form"),r=this._header["content-type"],"application/x-www-form-urlencoded"==r?this._data=this._data?this._data+"&"+e:e:this._data=(this._data||"")+e):this._data=e;return!t||s(e)?this:(r||this.type("json"),this)},l.prototype.parse=function(e){return _.console&&console.warn("Client-side parse() method has been renamed to serialize(). This method is not compatible with superagent v2.0"),this.serialize(e),this},l.prototype.serialize=function(e){return this._parser=e,this},f.prototype.callback=function(e,t){var r=this._callback;this.clearTimeout(),r(e,t)},f.prototype.crossDomainError=function(){var e=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");e.crossDomain=!0,e.status=this.status,e.method=this.method,e.url=this.url,this.callback(e)},f.prototype.timeoutError=function(){var e=this._timeout,t=new Error("timeout of "+e+"ms exceeded");t.timeout=e,this.callback(t)},f.prototype.withCredentials=function(){return this._withCredentials=!0,this},f.prototype.end=function(e){var t=this,r=this.xhr=b.getXHR(),i=this._query.join("&"),o=this._timeout,u=this._formData||this._data;this._callback=e||n,r.onreadystatechange=function(){if(4==r.readyState){var e;try{e=r.status}catch(t){e=0}if(0==e){if(t.timedout)return t.timeoutError();if(t.aborted)return;return t.crossDomainError()}t.emit("end")}};var a=function(e){e.total>0&&(e.percent=e.loaded/e.total*100),e.direction="download",t.emit("progress",e)};this.hasListeners("progress")&&(r.onprogress=a);try{r.upload&&this.hasListeners("progress")&&(r.upload.onprogress=a)}catch(e){}if(o&&!this._timer&&(this._timer=setTimeout(function(){t.timedout=!0,t.abort()},o)),i&&(i=b.serializeObject(i),this.url+=~this.url.indexOf("?")?"&"+i:"?"+i),this.username&&this.password?r.open(this.method,this.url,!0,this.username,this.password):r.open(this.method,this.url,!0),this._withCredentials&&(r.withCredentials=!0),"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof u&&!s(u)){var p=this._header["content-type"],h=this._parser||b.serialize[p?p.split(";")[0]:""];!h&&c(p)&&(h=b.serialize["application/json"]),h&&(u=h(u))}for(var l in this.header)null!=this.header[l]&&r.setRequestHeader(l,this.header[l]);return this._responseType&&(r.responseType=this._responseType),this.emit("request",this),r.send("undefined"!=typeof u?u:null),this},b.Request=f,b.get=function(e,t,r){var n=b("GET",e);return"function"==typeof t&&(r=t,t=null),t&&n.query(t),r&&n.end(r),n},b.head=function(e,t,r){var n=b("HEAD",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},b.del=d,b.delete=d,b.patch=function(e,t,r){var n=b("PATCH",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},b.post=function(e,t,r){var n=b("POST",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},b.put=function(e,t,r){var n=b("PUT",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n}},function(e,t){function r(e){return"https://"+e+".dropboxapi.com/2/"}e.exports=r},function(e,t){function r(e){return null!=e&&"object"==typeof e}e.exports=r},function(e,t){function r(e){return JSON.stringify(e).replace(n,function(e){return"\\u"+("000"+e.charCodeAt(0).toString(16)).slice(-4)})}var n=/[\u007f-\uffff]/g;e.exports=r},function(e,t,r){var n,s=r(15);r(14),n=function(e){e=e||{},this.accessToken=e.accessToken,this.clientId=e.clientId,this.selectUser=e.selectUser},n.prototype.setAccessToken=function(e){this.accessToken=e},n.prototype.getAccessToken=function(){return this.accessToken},n.prototype.setClientId=function(e){this.clientId=e},n.prototype.getClientId=function(){return this.clientId},n.prototype.getAuthenticationUrl=function(e,t){var r,n="https://www.dropbox.com/oauth2/authorize",s=this.getClientId();if(!s)throw new Error("A client id is required. You can set the client id using .setClientId().");if(!e)throw new Error("A redirect uri is required.");return r=n+"?response_type=token&client_id="+s,e&&(r=r+"&redirect_uri="+e),t&&(r=r+"&state="+t),r},n.prototype.request=function(e,t,r,n,i){var o=null;switch(i){case s.RPC:o=this.getRpcRequest();break;case s.DOWNLOAD:o=this.getDownloadRequest();break;case s.UPLOAD:o=this.getUploadRequest();break;default:throw new Error("Invalid request style: "+i)}return o(e,t,r,n,this.getAccessToken(),this.selectUser)},n.prototype.setRpcRequest=function(e){n.prototype.rpcRequest=e},n.prototype.getRpcRequest=function(){return void 0===n.prototype.rpcRequest&&(n.prototype.rpcRequest=r(17)),n.prototype.rpcRequest},n.prototype.setDownloadRequest=function(e){n.prototype.downloadRequest=e},n.prototype.getDownloadRequest=function(){return void 0===n.prototype.downloadRequest&&(n.prototype.downloadRequest=r(12)),n.prototype.downloadRequest},n.prototype.setUploadRequest=function(e){n.prototype.uploadRequest=e},n.prototype.getUploadRequest=function(){return void 0===n.prototype.uploadRequest&&(n.prototype.uploadRequest=r(18)),n.prototype.uploadRequest},e.exports=n},function(e,t,r){function n(e){if(e)return s(e)}function s(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var n,s=0;s<r.length;s++)if(n=r[s],n===t||n.fn===t){r.splice(s,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r){r=r.slice(0);for(var n=0,s=r.length;n<s;++n)r[n].apply(this,t)}return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function s(e){if(p===setTimeout)return setTimeout(e,0);if((p===r||!p)&&setTimeout)return p=setTimeout,setTimeout(e,0);try{return p(e,0)}catch(t){try{return p.call(null,e,0)}catch(t){return p.call(this,e,0)}}}function i(e){if(h===clearTimeout)return clearTimeout(e);if((h===n||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function o(){_&&f&&(_=!1,f.length?d=f.concat(d):m=-1,d.length&&u())}function u(){if(!_){var e=s(o);_=!0;for(var t=d.length;t;){for(f=d,d=[];++m<t;)f&&f[m].run();m=-1,t=d.length}f=null,_=!1,i(e)}}function a(e,t){this.fun=e,this.array=t}function c(){}var p,h,l=e.exports={};!function(){try{p="function"==typeof setTimeout?setTimeout:r}catch(e){p=r}try{h="function"==typeof clearTimeout?clearTimeout:n}catch(e){h=n}}();var f,d=[],_=!1,m=-1;l.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new a(e,t)),1!==d.length||_||s(u)},a.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=c,l.addListener=c,l.once=c,l.off=c,l.removeListener=c,l.removeAllListeners=c,l.emit=c,l.binding=function(e){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(e){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},function(e,t){e.exports=function(e,t,r){for(var n=0,s=e.length,i=3==arguments.length?r:e[n++];n<s;)i=t.call(null,i,e[n],++n,e);return i}},function(e,t,r){var n=r(4);t.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},t.parse=function(e){return this._parser=e,this},t.timeout=function(e){return this._timeout=e,this},t.then=function(e,t){return this.end(function(r,n){r?t(r):e(n)})},t.use=function(e){return e(this),this},t.get=function(e){return this._header[e.toLowerCase()]},t.getHeader=t.get,t.set=function(e,t){if(n(e)){for(var r in e)this.set(r,e[r]);return this}return this._header[e.toLowerCase()]=t,this.header[e]=t,this},t.unset=function(e){return delete this._header[e.toLowerCase()],delete this.header[e],this},t.field=function(e,t){return this._getFormData().append(e,t),this}},function(e,t){function r(e,t,r){return"function"==typeof r?new e("GET",t).end(r):2==arguments.length?new e("GET",t):new e(t,r)}e.exports=r},function(e,t,r){var n,s,i,o=r(2),u=r(1).Promise,a=r(3),c=r(5);o.parse["application/octect-stream"]=function(e){return e},n=function(e,t){return{status:e.status,error:(t?t.text:null)||e.toString(),response:t}},i=function(e,t){e.text="",e.setEncoding("binary"),e.on("data",function(t){e.text+=t}),e.on("end",function(){t()})},s=function(e,t,r,s,p,h){if("user"!==r)throw new Error("Unexpected auth type: "+r);var l=function(r,u){function l(e){r&&r(e)}function f(e){u&&u(e)}function d(e,t){var r;e?f(n(e,t)):(r=JSON.parse(t.headers["dropbox-api-result"]),t.xhr?r.fileBlob=t.xhr.response:r.fileBinary=t.res.text,l(r))}var _;_=o.post(a(s)+e).set("Authorization","Bearer "+p).set("Dropbox-API-Arg",c(t)).on("request",function(){this.xhr&&(this.xhr.responseType="blob")}),h&&(_=_.set("Dropbox-API-Select-User",h)),"undefined"==typeof window?_.buffer(!0).parse(i).end(d):_.end(d)};return new u(l)},e.exports=s},function(e,t,r){var n,s=r(6),i=r(16);n=function(e){s.call(this,e)},n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype=Object.assign(n.prototype,i),n.prototype.filesGetSharedLinkFile=function(e){return this.request("sharing/get_shared_link_file",e,"api","download")},e.exports=n},function(e,t){"function"!=typeof Object.assign&&!function(){Object.assign=function(e){"use strict";var t,r,n,s;if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(t=Object(e),r=1;r<arguments.length;r++)if(n=arguments[r],void 0!==n&&null!==n)for(s in n)n.hasOwnProperty(s)&&(t[s]=n[s]);return t}}()},function(e,t){var r={RPC:"rpc",DOWNLOAD:"download",UPLOAD:"upload"};e.exports=r},function(e,t){var r={};r.authTokenFromOauth1=function(e){return this.request("auth/token/from_oauth1",e,"app","api","rpc")},r.authTokenRevoke=function(e){return this.request("auth/token/revoke",e,"user","api","rpc")},r.filesAlphaGetMetadata=function(e){return this.request("files/alpha/get_metadata",e,"user","api","rpc")},r.filesAlphaUpload=function(e){return this.request("files/alpha/upload",e,"user","content","upload")},r.filesCopy=function(e){return this.request("files/copy",e,"user","api","rpc")},r.filesCopyBatch=function(e){return this.request("files/copy_batch",e,"user","api","rpc")},r.filesCopyBatchCheck=function(e){return this.request("files/copy_batch/check",e,"user","api","rpc")},r.filesCopyReferenceGet=function(e){return this.request("files/copy_reference/get",e,"user","api","rpc")},r.filesCopyReferenceSave=function(e){return this.request("files/copy_reference/save",e,"user","api","rpc")},r.filesCreateFolder=function(e){return this.request("files/create_folder",e,"user","api","rpc")},r.filesDelete=function(e){return this.request("files/delete",e,"user","api","rpc")},r.filesDeleteBatch=function(e){return this.request("files/delete_batch",e,"user","api","rpc")},r.filesDeleteBatchCheck=function(e){return this.request("files/delete_batch/check",e,"user","api","rpc")},r.filesDownload=function(e){return this.request("files/download",e,"user","content","download")},r.filesGetMetadata=function(e){return this.request("files/get_metadata",e,"user","api","rpc")},r.filesGetPreview=function(e){return this.request("files/get_preview",e,"user","content","download")},r.filesGetTemporaryLink=function(e){return this.request("files/get_temporary_link",e,"user","api","rpc")},r.filesGetThumbnail=function(e){return this.request("files/get_thumbnail",e,"user","content","download")},r.filesListFolder=function(e){return this.request("files/list_folder",e,"user","api","rpc")},r.filesListFolderContinue=function(e){return this.request("files/list_folder/continue",e,"user","api","rpc")},r.filesListFolderGetLatestCursor=function(e){return this.request("files/list_folder/get_latest_cursor",e,"user","api","rpc")},r.filesListFolderLongpoll=function(e){return this.request("files/list_folder/longpoll",e,"noauth","notify","rpc")},r.filesListRevisions=function(e){return this.request("files/list_revisions",e,"user","api","rpc")},r.filesMove=function(e){return this.request("files/move",e,"user","api","rpc")},r.filesMoveBatch=function(e){return this.request("files/move_batch",e,"user","api","rpc")},r.filesMoveBatchCheck=function(e){return this.request("files/move_batch/check",e,"user","api","rpc")},r.filesPermanentlyDelete=function(e){return this.request("files/permanently_delete",e,"user","api","rpc")},r.filesPropertiesAdd=function(e){return this.request("files/properties/add",e,"user","api","rpc")},r.filesPropertiesOverwrite=function(e){return this.request("files/properties/overwrite",e,"user","api","rpc")},r.filesPropertiesRemove=function(e){return this.request("files/properties/remove",e,"user","api","rpc")},r.filesPropertiesTemplateGet=function(e){return this.request("files/properties/template/get",e,"user","api","rpc")},r.filesPropertiesTemplateList=function(e){return this.request("files/properties/template/list",e,"user","api","rpc")},r.filesPropertiesUpdate=function(e){return this.request("files/properties/update",e,"user","api","rpc")},r.filesRestore=function(e){return this.request("files/restore",e,"user","api","rpc")},r.filesSaveUrl=function(e){return this.request("files/save_url",e,"user","api","rpc")},r.filesSaveUrlCheckJobStatus=function(e){return this.request("files/save_url/check_job_status",e,"user","api","rpc")},r.filesSearch=function(e){return this.request("files/search",e,"user","api","rpc")},r.filesUpload=function(e){return this.request("files/upload",e,"user","content","upload")},r.filesUploadSessionAppend=function(e){return this.request("files/upload_session/append",e,"user","content","upload")},r.filesUploadSessionAppendV2=function(e){return this.request("files/upload_session/append_v2",e,"user","content","upload")},r.filesUploadSessionFinish=function(e){return this.request("files/upload_session/finish",e,"user","content","upload")},r.filesUploadSessionFinishBatch=function(e){return this.request("files/upload_session/finish_batch",e,"user","api","rpc")},r.filesUploadSessionFinishBatchCheck=function(e){return this.request("files/upload_session/finish_batch/check",e,"user","api","rpc")},r.filesUploadSessionStart=function(e){return this.request("files/upload_session/start",e,"user","content","upload")},r.paperDocsArchive=function(e){return this.request("paper/docs/archive",e,"user","api","rpc")},r.paperDocsDownload=function(e){return this.request("paper/docs/download",e,"user","api","download")},r.paperDocsFolderUsersList=function(e){return this.request("paper/docs/folder_users/list",e,"user","api","rpc")},r.paperDocsFolderUsersListContinue=function(e){return this.request("paper/docs/folder_users/list/continue",e,"user","api","rpc")},r.paperDocsGetFolderInfo=function(e){return this.request("paper/docs/get_folder_info",e,"user","api","rpc")},r.paperDocsList=function(e){return this.request("paper/docs/list",e,"user","api","rpc")},r.paperDocsListContinue=function(e){return this.request("paper/docs/list/continue",e,"user","api","rpc")},r.paperDocsPermanentlyDelete=function(e){return this.request("paper/docs/permanently_delete",e,"user","api","rpc")},r.paperDocsSharingPolicyGet=function(e){return this.request("paper/docs/sharing_policy/get",e,"user","api","rpc")},r.paperDocsSharingPolicySet=function(e){return this.request("paper/docs/sharing_policy/set",e,"user","api","rpc")},r.paperDocsUsersAdd=function(e){return this.request("paper/docs/users/add",e,"user","api","rpc")},r.paperDocsUsersList=function(e){return this.request("paper/docs/users/list",e,"user","api","rpc")},r.paperDocsUsersListContinue=function(e){return this.request("paper/docs/users/list/continue",e,"user","api","rpc")},r.paperDocsUsersRemove=function(e){return this.request("paper/docs/users/remove",e,"user","api","rpc")},r.sharingAddFileMember=function(e){return this.request("sharing/add_file_member",e,"user","api","rpc")},r.sharingAddFolderMember=function(e){return this.request("sharing/add_folder_member",e,"user","api","rpc")},r.sharingChangeFileMemberAccess=function(e){return this.request("sharing/change_file_member_access",e,"user","api","rpc")},r.sharingCheckJobStatus=function(e){return this.request("sharing/check_job_status",e,"user","api","rpc")},r.sharingCheckRemoveMemberJobStatus=function(e){return this.request("sharing/check_remove_member_job_status",e,"user","api","rpc")},r.sharingCheckShareJobStatus=function(e){return this.request("sharing/check_share_job_status",e,"user","api","rpc")},r.sharingCreateSharedLink=function(e){return this.request("sharing/create_shared_link",e,"user","api","rpc")},r.sharingCreateSharedLinkWithSettings=function(e){return this.request("sharing/create_shared_link_with_settings",e,"user","api","rpc")},r.sharingGetFileMetadata=function(e){return this.request("sharing/get_file_metadata",e,"user","api","rpc")},r.sharingGetFileMetadataBatch=function(e){return this.request("sharing/get_file_metadata/batch",e,"user","api","rpc")},r.sharingGetFolderMetadata=function(e){return this.request("sharing/get_folder_metadata",e,"user","api","rpc")},r.sharingGetSharedLinkFile=function(e){return this.request("sharing/get_shared_link_file",e,"user","content","download")},r.sharingGetSharedLinkMetadata=function(e){return this.request("sharing/get_shared_link_metadata",e,"user","api","rpc")},r.sharingGetSharedLinks=function(e){return this.request("sharing/get_shared_links",e,"user","api","rpc")},r.sharingListFileMembers=function(e){return this.request("sharing/list_file_members",e,"user","api","rpc")},r.sharingListFileMembersBatch=function(e){return this.request("sharing/list_file_members/batch",e,"user","api","rpc")},r.sharingListFileMembersContinue=function(e){return this.request("sharing/list_file_members/continue",e,"user","api","rpc")},r.sharingListFolderMembers=function(e){return this.request("sharing/list_folder_members",e,"user","api","rpc")},r.sharingListFolderMembersContinue=function(e){return this.request("sharing/list_folder_members/continue",e,"user","api","rpc")},r.sharingListFolders=function(e){return this.request("sharing/list_folders",e,"user","api","rpc")},r.sharingListFoldersContinue=function(e){return this.request("sharing/list_folders/continue",e,"user","api","rpc")},r.sharingListMountableFolders=function(e){return this.request("sharing/list_mountable_folders",e,"user","api","rpc")},r.sharingListMountableFoldersContinue=function(e){return this.request("sharing/list_mountable_folders/continue",e,"user","api","rpc")},r.sharingListReceivedFiles=function(e){return this.request("sharing/list_received_files",e,"user","api","rpc")},r.sharingListReceivedFilesContinue=function(e){return this.request("sharing/list_received_files/continue",e,"user","api","rpc")},r.sharingListSharedLinks=function(e){return this.request("sharing/list_shared_links",e,"user","api","rpc")},r.sharingModifySharedLinkSettings=function(e){return this.request("sharing/modify_shared_link_settings",e,"user","api","rpc")},r.sharingMountFolder=function(e){return this.request("sharing/mount_folder",e,"user","api","rpc")},r.sharingRelinquishFileMembership=function(e){return this.request("sharing/relinquish_file_membership",e,"user","api","rpc")},r.sharingRelinquishFolderMembership=function(e){return this.request("sharing/relinquish_folder_membership",e,"user","api","rpc")},r.sharingRemoveFileMember=function(e){return this.request("sharing/remove_file_member",e,"user","api","rpc")},r.sharingRemoveFileMember2=function(e){return this.request("sharing/remove_file_member_2",e,"user","api","rpc")},r.sharingRemoveFolderMember=function(e){return this.request("sharing/remove_folder_member",e,"user","api","rpc")},r.sharingRevokeSharedLink=function(e){return this.request("sharing/revoke_shared_link",e,"user","api","rpc")},r.sharingShareFolder=function(e){return this.request("sharing/share_folder",e,"user","api","rpc")},r.sharingTransferFolder=function(e){
return this.request("sharing/transfer_folder",e,"user","api","rpc")},r.sharingUnmountFolder=function(e){return this.request("sharing/unmount_folder",e,"user","api","rpc")},r.sharingUnshareFile=function(e){return this.request("sharing/unshare_file",e,"user","api","rpc")},r.sharingUnshareFolder=function(e){return this.request("sharing/unshare_folder",e,"user","api","rpc")},r.sharingUpdateFileMember=function(e){return this.request("sharing/update_file_member",e,"user","api","rpc")},r.sharingUpdateFolderMember=function(e){return this.request("sharing/update_folder_member",e,"user","api","rpc")},r.sharingUpdateFolderPolicy=function(e){return this.request("sharing/update_folder_policy",e,"user","api","rpc")},r.usersGetAccount=function(e){return this.request("users/get_account",e,"user","api","rpc")},r.usersGetAccountBatch=function(e){return this.request("users/get_account_batch",e,"user","api","rpc")},r.usersGetCurrentAccount=function(e){return this.request("users/get_current_account",e,"user","api","rpc")},r.usersGetSpaceUsage=function(e){return this.request("users/get_space_usage",e,"user","api","rpc")},e.exports=r},function(e,t,r){var n=r(2),s=r(1).Promise,i=r(3),o=function(e,t){return{status:e.status,error:(t?JSON.parse(t.text):null)||e,response:t}},u=function(e,t,r,u,a,c){var p=function(s,p){function h(e){s&&s(e)}function l(e){p&&p(e)}function f(e,t){e?l(o(e,t)):h(t.body)}var d;switch(t||(t=null),d=n.post(i(u)+e).type("application/json"),r){case"team":case"user":d.set("Authorization","Bearer "+a);break;case"noauth":break;default:throw new Error("Unhandled auth type: "+r)}c&&(d=d.set("Dropbox-API-Select-User",c)),d.send(t).end(f)};return new s(p)};e.exports=u},function(e,t,r){var n=r(2),s=r(1).Promise,i=r(3),o=r(5),u=function(e,t){return{status:e.status,error:(t?t.text:null)||e.toString(),response:t}},a=function(e,t,r,a,c,p){if("user"!==r)throw new Error("Unexpected auth type: "+r);var h=function(r,s){function h(e){r&&r(e)}function l(e){s&&s(e)}function f(e,t){e?l(u(e,t)):h(t.body)}var d,_=t.contents;delete t.contents,d=n.post(i(a)+e).type("application/octet-stream").set("Authorization","Bearer "+c).set("Dropbox-API-Arg",o(t)),p&&(d=d.set("Dropbox-API-Select-User",p)),d.send(_).end(f)};return new s(h)};e.exports=a},function(e,t){}])});

//end Dropbox

if (getQuerystring('dropbox','off') != 'off' && window.location.toString().substr(0,mybaseurl.length) == mybaseurl) {
	//document.write('<script src="https://www.dropbox.com/static/api/dropbox-datastores-1.0-latest.js" type="text/javascript" id="dropbox library"></script>');
  defaultDropbox = true;
} else {
	defaultDropbox = false;
}

function ChangeNewStyle_old() {

document.getElementById('icoExec').src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAYCAYAAAALQIb7AAAACXBIWXMAAAsSAAALEgHS3X78AAAHDElEQVRIiXWWf2yV1RnHv88573t/9we3LbSlt5RfVootRSY4VgU00U1wYYuTxV8hbiyL7o/hYjKzaKZb9hfRODTbH1PQmGwZmGWZCwMkTujWAdJQikAtBUZ/UVra3vbe3ve+7znPsz9uL4E6n+Qk54/znM/7/Pqel0QE/88YVitoCwBfmI+bOtN/f+T0yMebRtJXF2eCqfC8SFW2uryh554Fmw+sLtlysE6tGZzrN9doLkwgAKAIxOeDQ81/Gfj1z493H9vqTlbG5lMjkm4dIk4cns1g3PTjGn0OXZkdfbDlsfe+XfWLXbW6eeSrgHNgAgAOQGbfxIvP7f3PrjciV2tCG2qfwbLqZo5F4yAlJBAQlDCLZDLTdHagQ3164x0k76Kh51rfeqYtvuOIiNVEtwNvwgQCEdZCYvcM/+i1Dz7Z8/LXzKPy0KonrBPSjpefATMXnAgofqPWDqLhuExO3rD7T//WGas7yy/c9/rjD5Xt/JDFanUL8CasGPqHY7/c/ubhV/es5++YB1Z9V8/4GVKuIBIPQYcFoi0UEUQANoDxBPkZA81hiBW7/+Tb6vqiLu83G/52392xLaduBZKIgMUqRVouz5yo2fnJ+p7K0dbY5pZnwaGcKkmGkQkPI0AO85waRFQprPgopJIAAsQCuWmDIK0xnZ6x+7pf17Utkc5d6zrXxnWFAGACQeFmYiB/vvTaS7kRnVi75GHWyawqqbPQiTxIgPXx7RCjcC13AYY9QBiB9WCMBwsPkTKL6MIZlNeG9b2pzeZCb//dh4d//30CMYt1AECJMClSdiS4nDh++fD37kiskZrFJSpc4UEQwEoexvqoCa3AwxU/w8roFkx4I5gI+qE0Q8jAIg9jPYAswpVZNDYupWrUyZEr728PEECRZkCgGKwA4PTIwfXTaX/BXctXSTTpK2t8MPJgeBCx8HkGALCy5EFsqXwFldKEa5k+5DEOrQVMPiw8GOuhvIZUc8MaujTUe2//9JmaQnSiFAACgCujZ1pL3TgW1iXZcA6gAEI+hHywNYDoYiMh5pRiQ9UPsKnsBZhsDNezlwGdh6PU7IkZWrq4nsWnRP/kucZCtzOpYlsai4pkWQWiMYLlPEABgKAAFTM7goCCmh0UxsL4ndha+yqa9OMYHLuK/nwH8jQKa32UloUlEYuJsUgWO18VLzEBm3BYQ2kDwAeouPIQnisGhd4SMAQGq6u+iacXvo/g+kJcyn6KHIYQdhVCIUU2sKbo5RQ3IY4NpPMjMEhDKQ2QBQRQSgBhzJVQEQEIUORgaiaNf11/F1R6FcloElkehCOk8r4HF9Hhomqooka1zL+/Yzqd4wlzSRsah1AOQh6YMjCcReFowVgsiAjECqcGD+JPg09hIL4X5fMMojqGsNYymrtIlIsNNlWtO18YLsWOUtoCoFX1G8+o9qrzQ2PDTcuqtc0FRivSAHwYjgFCEGEQERRpDI5fQfv13ZgqOYbKugQcqYNhAyZGIhKz3X19TrXbcmRBeUNGhLUiZRWBwGJVIlzOm1JP7v7nqc/JcUIScyJwSCHihKDhgMWASMHzDI707sE/xnfATX2GRfNrEUYCmgiuclASiotnfDre+V/euvInb81msPCUFMqtWETUU+tefNcOJc8c6DrhhBzXlLgJuMqBAxdhVYLzgyexr28HxpN7sXRJCcrd+SAmuEojpFyUuQmQhtl/7Kherr/x3gNNj50sRKX5diEu6CN39Bxo2vnXR/799W9Vl92/uNWk4knn4hcMmmoCatqxoCYClxIIjIFSgCYFTRrMgiF/NPjoVIc7fCJ0eu+zn22onteQERFRpOQ2GABYtlorbQ91/nHjKwef2L+oTVXcc8edtoorUBmNq1R5LVkhAAwQYKxF1uRkxLvBvdmr1HHqogrOVXTtfvLwo411q/tZWClSfHNgrLW3vFMEEdaO49qOs4ca3zjy0z+kq8+3NbQmUBqNI66iHNURcZWDgAPkrEeTwbSaTOcweNrDktzGD17a+rvnG2oap4wN1Gx5AABa6y//FgBA3s8TB5CJ6VG8vf9X2z46986P69eG18bqOeYmAFICNkCQJkz10dhwJx/94caX33x6y/NHHe0iFHYQCoW/dC9duHABXV1dqru7W/X29uqhoSFndHRUX7s2HAq5YWV8zo6nx2LReaopUUtrYhWUciIU9TOSnRmTvukhPuFnpC9ZVmnJkZhlG1QvqDZVVVWmtrbWLFu2zLa0tHBraytTW1ubam9vDwH4qhWZVRoDwKIg3LpQOAgAFwQNgQ/AA+ADCADkZ/c+gPy2bdsCstaip6eHOjs7qbu7W01MTOj+/n49MDDgEJHu6enR+Xxek4IzC6VbMsMAGWGx5eXltr6+3jKzSaVSNpVK2fr6ertixQpubm7m5cuX438OjJ4wjt73CAAAAABJRU5ErkJggg==';
document.getElementById('icoIndent').src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAYAAACN1PRVAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAActpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx4bXA6Q3JlYXRvclRvb2w+d3d3Lmlua3NjYXBlLm9yZzwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGMtVWAAABUVJREFUSA3dVl1sFFUUPndmpzP7113aAiIChRDATdCYEjUxCH1QE0kwPgAPpmCIgWgMxjd9YgkqmvCkJFjCg9FglTU+iI1GTajBqmCRhKYbLNI/2dLd7e922d3uzsz1O3e3f9gACfFBz8ydc+8595x7zz0/d4j+ryBuMUxEZVQcrBBjsYiI74iDEnWjUdIikdOYH7tFZIHhjh0gxmgnxVwSJBeYAfK/AXJWr2eOfkn7yKATFFS0jdjRk6TReirRAcrQy7SIjlMNeC5oREvRQmjhCraAuZloASwQJvfF+vqhj0RfARQ2RCprzsqznkbRaL/zxZvPPvXwtmOhYAgruTmhi7pEvvdS48rnth/87MBbjZFtrwe8wbQtHV0IiGoVNQLbZ00aPkK6Ht0wkvkB+nRw595PNtOZ5o59xv5NJ0rKsq20VS26PLyqZtPaJ1ZDbAZ8k4ENGHhW161fsmXj0wb6988wb9O5SQ9Sy5CynRoaGtRM3tsM5KayoiBzalySUwpnimM6OjKbn2CMM7TxFBXm/mwrqX6JynKT7ihHhjJCKcJHWXaIDjlMuJz8pf3Ed5lX/QGvIEOWdEv3ZmXyBliFc32tLQMtf6ZNy8y6wtU0SGq8VWBRwYqma66mkycvM66U5gXC4u/FfnBZv1osghDnQV3VMv+62oZV/kAA6pyibmiBdOk680TQCNcuCy2vt0wrIzX4mhs4UKy0sLsIfU2HqEf3ZNwRt3diyg8qcSbMJIyUkn1BJ7891oT+PLg2Fh8Ay9v8zdGP5zHuMBiVQ7KpnZpYb4dsVvqVz+LxuLIMO1VjnjANiDo1UdeUDdPkO2KLvAjM+frKxxiJKJ+lbia6z3e3f1ntD3JSFDRDhAZzPd3QXLw2HD9/puPzdQEzMG6Toyl/YYuCj1GlAYc/TlZD6HsMT7KQQMBQD+/q67YbqoqoxcQh7AFwNnGkvy11pMUIkjAtss0gWYaX0mA5rf0nLx3pP+nDXvNIfaGSFzZ7ocEPbAKbVZAzyMUGPHWQf8AbhgvGibZGVYDwGjjTDnVUx1rf3TmQ6pWZ/Lg7lhuZLMm8vJw634kp5vtfHf5wbGpYjk2OTqUnkjaao1oGeLpNJp3hbKo4nh+TXcO/y90/0S7W39xR9pmyrIHKSec3QuaKxfXMZx8GuLPIW8dFSQv7arzhqlqiKjy3B+V3y1rHBUXNreR0OfQvXryoxCcKI7mriXghVB2WjuvkPIZeO5QdSIHp3JhIZHuGrxDZesFGCmqqNFVW5a2pEJNwm3DgM2PwZr9wXOK6SBX15SmVqVyIffQrSuwS0NfCv2uQOUshsIcS9AqtoE5aibJs02LwqyHlndN8lb6JwmHBszXkvLCy5sqpx0czoHBOSnWMfIfhkW9s2XvfYy81PuPz+YTUZcljkHfETgztotdi+x95fsND2x/dbBm+nNRtJAlOi18NvmctGAuBGNbJNXRdH3dT8kLmbUQHZaIE7RQt32vITxUgx1uPNuVlVqVrEcHB0JXuuA4B64Mzh0/x2JUOnhKw/Y8mQbPlFE9DSvfJPedoN2TpdFdU+U5ZxgQGnxmQFqkKg+jmy4mo2qwtAolq3yJVYTnvF8h9NZc/OtcsgF/iohOk8ndNZNlsnrVRmxokxvtHf7v6c18oGESyuDld12oH871/QNbuSXenf+z8vuS3/MMOuZqoBIhE+iNY1H0scYw4TUfXPVXJwl+wHJcuYDoAVQwxQcG93tScJAxzb+rG2Zu6zCx/5y88l3MvfWXzwgvcxd8VC/KFwX9QCwF4d/F3tZDkf5f2N1EEfhR9vnUDAAAAAElFTkSuQmCC';
document.getElementById('icoSave').src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAYAAACN1PRVAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAABnBJREFUSA2dVmlMVFcUPu+9mYFhZmSHYbFRkYo4VIiQJkrBVsAtJATRGhsarNH2D7/0h7X+UBJia2uiIWkapSExIC5pmpJU0jY2GtHGEgSxYo2CFIeyKPs687Z+58GQAbRNvcmZd++5957v7HcEev0hbty4UYyMjNRZxJUrV9TXF/Xqm8KBAwfMC7cBbAJPWMh/3bVw7NgxFug/cvLy8kp37twZ7Md8JeArN/wui5cvXxZ27drl76bMgwcPfhIVFVV4t6nJ2tvb2xhksx2tr6//efYeyzXc6yeHRP/FgjmDSOBpfkDvlJaWXiwvL/8lJibmgxSXy5qalqb+3dOTIXu9dTk5OZksAy7le4vGIiZcxQpInZ2dKoLu0y7ryJEjXwLoxLZt296SJMl0584dRRAEbcWKFWJLS4tncnIy0GQyWXDve5DGcq5fv+67bwD7gxmBP3XqlMqHebewsPDdkpKSk4cPH/68oKDAFR8fL2mapni9Xh2ukx49eiStWrVKCAkJoZqaGjEuLm55QkJCPe73zipsyDGQmDE7MXzc1NRkbO7fvz8HKX1y2bJlJw4dOuRKTk4WZVlWRkdH9bGxMb4jTk9PCw0NDXpoaCgBQPrj/n0ZPGuA2Tz9zO3+aVbheTnBF33BlBCbvLVr134FXllwcLCrp6dHSEtLk6Ojo4Xh4WEDYGpqiryyTNbAQCMD+vv7qRfnEDd9eGREFERxeWpq6nft7e3DyFKpra1tzpUiGL4kEcxm82fQtEBVVZOqKN5ut1utq6szDw0NCYgHKYpCoigS9mhkdJRgCcEiqjhzRkeCSHabTYXl0QMDA8XsMb+Y85IMZC5ImK0kJSWZITAfLtM8Xq9ot9uley0tOjKOYB2Nj49Td3c33bp1iy7W1hLcSEgSCo+MpAcPHggvXrzQHHa7qKjqG5s2baqFVRP+1hkxy8jIENhcuOqh0+ncDu1joLWKrwB3UHhYGHFsbt++TefOnqXq6mpaEhwsLHE46F5rKz1//px2794txMXG0t3mZgqyWsOg8DOE4XfIZYx5icK1YXSH/Pz8UmSevnXrVm1zXp6anZ2to340XvOl1UlJWmZmpjHnNc5qly5d0jo6OrSbNxu0NWvWyODrKSkpTcXFxTbMia3jr/HDE591S5cubceyQNf1CI/Ho+qaJrL74CJCVhLiQa2wJjc3l44fP0579+6lxMREI35RUZGCzWbT0UlExI+98xBub4V1bIjmSw6ja7MG165dG0CCVHESIH4CYqeLkkQoZLpx4wZxTVVWVlJFRQVt2bLF4Pf19ZEse+G+AD07K1Ny2IOVjqdPCYX+IRuCIbPsObAZ3swvBFejcJ8BVIJlKiwTEHQ6c/o01Vy4wMVOSB5CYZPXK1N8nJNsIbF080mQEBy1kk6UHzXSfWJiIjc9Pb2IpSIzhXlgYHAsBLjBjXo5D1eSBkKmUVlZGX20bx+Fh4cT1xbXG2eoM8ZJJpMZTVYRRj2CpkoO+b1NOcYT1Nc/yKXimjGBlHlgYOpIFCOOQUFB52FZPyxjfysWiwX4IkFbioiIIGQtQEw0NTkpTExM0RKbRS5MF4X4ENnc5e5j+b8lr058f8OGDV/wAmNeN5lhoRX5Jm9nZJxet24du0QuKirifqghjtrg4KDGc7fbrSFxZE4kpLr+58M2vbLyXCPOl4ACQL7xUiBjEwCGG2BlKp6R4ZUJCQbg1atXdQbr6urSkBQK1yIas/748WOAVN4zRyR8DAEOHwK+LGdOeT/+vOmcJuiV36J2GEzZs2ePhsJXEEvDEoDqVVVVnSibT7Hv9EmYfQfnZPj4L/vyIRM6Bj/1IgTlw7LpsNBQBvTW1tbqcJ+OLtLncrm+AW8zKHHHjh1JWVlZKZi/CXLi1bDjO1fHmC8KGm+yrwPDwsKCEBsLBAoIytd9/f1540gOuHEA+z+CfgD9BVdbkTT2xsZGVtJjtVqncQYPgzyJ9QhoEDQFWgTGPg6cJYvD4bCji4+h9WxHrZUHBgb+CrrQ3Nz8ZP369RZkqx0PqAjXashMjV9u3OX/KgrAvPiOg4ZAYyB9oV8NF2KDQS1oPQHQWoqNjXXgP0cs3Nc5MjKi4bEMQa0JaMDsWh1loaMJzAGB5wGxNWwdz40/SwvBwJ8bnEUS/gqYAMLnuMGi5dksUIAF82A+z32kYO4jBmBl/v+Y7dz/ptx/Cv0HWDY5qj5euoEAAAAASUVORK5CYII=';
document.getElementById('icoLoad').src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAYAAACN1PRVAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAActpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx4bXA6Q3JlYXRvclRvb2w+d3d3Lmlua3NjYXBlLm9yZzwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGMtVWAAABiBJREFUSA11Vs1PVFcUP/d9zAcDwwBDB2FErFZACBvttmmNKYlp0kallYQFqYSkiyZddK1sXbvQpP0DWl01Ma666aK0iRqt+BGaNNoBBZmJDON8vc/b37lv3nPMlJM83p177zu/c37nd89F0P4msCT3Xya6e/euub6+3l2p2L3F4vZAvV4brFbf9GezA13pdHpY0zQ6duzotTNnzhRv3LihG/s4i4CklMbVqz8OlculnG1bI41G7ZDj2IcbTTt//foPmLMHLcvqxzuT7k3Hu7u7qVKpULFUIk2QPTMz/TMwiru7u1oH2MrKiobHn5ub04eH898tL39ztlavDdm2k3MdJ+W4LtmWTU3LIgBQvd6gwcEsjY7mCYHR9ta2fLm17fyx+ntsfv7C6/ZkOsCwqOHxp6amBp49K3z/b2FjaGdnh4QQ5DgOloSn65pvGIbkOTAtxsYOCctqirW1x8JxXBGLmWJicooMQzcRkMK4d+8edYAdP348rJPWtJqVYrE4BI91OIibpsn+NSSgM06zaRGypWajQVvbr6harctcLis8zxe75T3O3Gg0Gia+V9YBFi7EYjEH0XvJZIJq1Zrpuq7u+4CBAUi9y7uvyXEdRV8ykaBEMk6u65H0ffI8F2uuiVp1hT73BUsmkx7AXP7QdhwJ6sjHOABDWpKEC4eaJjAi8nyPfM9XdPMux3bIA1ij4cRDMK7P/9rIyIibiMdsToNrxUkxmHrg1Pc96IHt7edMLRsCFBAUuZ6nS+nsX7NgO0Fhgy6AHCkDSuAc1HgqcvbJGD5+a8hYWUCwotTHNxaUisw0fKMHG6hTIOFCT0+PZ1uOFWbDQAwomLNWCh4yFTi4PCeDMiow3ttsNhUL8Bex11GzmzdvKrwTJ054oM9ingKggEJeDACRGdeQeWzRx2/ez/PSa6gx5KtWWfoRqkJo+4M9XGeLWw4fXhYKC4AdKTGgLggC6mB9hGhBAB4UqQzTEFnk9e0omno7AJCjwNAtQpAwKwQjfaiRZCxkVRWSqeaHjb/V9ahk+9cshGSBQPoKjAXBnjkPrhXXTKmxVcNATG1gmMd5jdiLBqFztKlIzIheheg6diszJfkAOFJn8CXXStVLCSk4j1xrNOmog3SAXb58WYEtLy+jO5nJIHSAIEPOjOvGNZM+hAAa+WBjHzq8Ro1GUwFyLTkEdB20sGqqlYhsr1kcd1AKnSONRbNSqX62U9z5+PGTp9TfnzUQoVJeSBuDpnszVNkrU6lUpHx+mDZfvMD1sodaBe65daE3hu1K8jQ/w3gOp1Kpwzgf3HhzBw/mv5ycmOgGggMgXE1QMzLjOnGGuNMEurrK4PatWyiloANDOdooPCc9QMN+XEe29067YoKZugyAktPT0wmMuyYnJ/xz58/RB0ePilrtDSHjoG0p6bMwAsNeSuHCVGdOuQlqh2kVHLpmxF442MJiFs8oRw+LIVJDQ7QuujpbqDShcuTfoAR1YmOgqG2pvZIz5mh4uUUqRTTy5DYW4zjAPRjzjWxwgXE38RocthoxCwQBcRAtIQgEIpR4AArD+Q/OWSvwEEyds8Ab0ftY7G1Fk8AFrE4jeFdRcvQAF5yZgX9dcJlK0zTYq7QsW2BNY5XChKbrnBLK62s4Z1HNQhp5U01K0e37yrkOxg1BLHX1m8UgISB24NdqVXbGwaiAOAAOBsHyvNwoFJj72MzMzMb4+PhtjAn/0wgGU5Hj/SgeF+/VHPMTjGXdi4tis48ckeIPtc3NIuiwFAC3oLGxMeofGID092poSy8Nw+xGjQ9grw2XscXFxX/m5+e/mJ2dfYQ5HQ1eKYWjYV79U6c+/e2XX+/kMP7w1U6pv+Zv0YvnTxUNU9PjlO7pkplMXwHn8Ukmk3mQy+XurK2t7T18+HAUDXdht1xmsNjS0sXHyOTs6dOn/8ZvTghNNMiK32wqwxUA45m5cP7z2cFs78mtUn06kUg8yGazd/r6+v46cuTI+sLCwiZ/0GYHFr+++FOpWPwoPzL859LSt1+dPDlVwDVl4moJ5Ny2ORwyYGQQi7h//34mmnh3wHtj/P8lT1+6dGnuypUr11ZXV0f4NwPxu93+Ayqaov8OMkH0AAAAAElFTkSuQmCC';

document.getElementById('icoLoad').onclick=function () {MontreFenetre(8-fenetre_courante);};
document.getElementById('icoLock').src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAYAAACN1PRVAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAABwtJREFUSA19Vn1sU9cVv+89J7ZxPhwTO7ETJ5BSIKGBho9qaiDjnwoilUqscwSo05CmwbRqLGzSWNkfZJkmWDsaVNRqZSobdCudU9iiFo3PJBJCCJBQcBOcZImXxnVC/J3Y+bD9/N5+5+FnOQR2pON737nnnt/5uPdcc+wZJMsyz3GcREtnz541W63W7cODg402q3XMsWfPKXUL9PKuXLlS09zc/F/IkiTP3avqqaNGnahjW1tbFujWrVs/MJvNRwMB/9poNMpi8Tg7efLkZrvdfqSlpcUHKqqtrf2V2+02BgKBj5qamm6Sk/8PUMUhrzj1w+Vy/XpyclJ+2NcnH279eQjyztq1az/7zdGjHyIak6p3586d2nt3784CWB4aGvqlKien1fkzR4AJtDAwMPCG1+uVu7u75bZjxy5AtO7pDU6nU9GFvKjj/ff/ev3aNdnjGZVdfX0HSZeiy3V+0f4cTzT37927ffmrr+RtjY1/W6SU+VCN5Oxh0H3nxPHj8qWLFyMfvPvuC6Sa45CyMzdUZd7x3ntb+vv7X/30/Pnwrdu320jr8OHDegy0ToyycDJGBjA6RMo+6B7/6PRpp8v10BiMx9+i9UePHpFetjSKIi2oFIhE1sVxEFDlHshGKIqOjo4FzMkwsQKEUSXJ4XCQM6yquuZT/5SfxWOxnfRNzoCfDwZ0g06nZXmafC9t6GxpIYeeBqClLHk8HpE+fKNj4ylRTIOq8VlCMtT/+WAz8fg8KekNeuXEOZxO8k4pdqboSwpfU1OjGBR0fBpbU/BNi+uhREu2VFqSxlgsOpVMpliBwbACSkp96urqlBE/Uobl3OJv27ZNAVtmMHA8zzO6qCa9PhvRc8GGh90jM9PTdHYroKQ4gwtMHhMJiFJHE5KpgIcOHUqQzOV2T8/OzrLZufn0w+HhWZLlUhYdRRY6OzvJaNXv2tsfSLK0rLjA+JOGzQ0JSRTrC4qKbHq9fqVWqzUmEolrfX19v+/q6kq1trbuT6VSZqTYNz4+vioWi/0CgQlTU1M/bG9v/zsdMJBScxWMRkVw4sSJjo0bN7YaDAYWDAZZYWEhW758OaNvnU7HKE3k/fT0tEuSpCNwoBSn9zzWuFAoxCoqKtJIp9DT3X1j//79r2UiU+xna0Ye0ILFYrECjK1Zs0a02WzUCWR4K8KQGA6HUzMzMwvJZJJVVlaux/yD+vr6CxjrsDZWUmJipaWl6TKLhVVVVS1Jowom9/b2Ku0HIbvIGEhAFEqtEIEm4wyPCHU42t6RkZFjfr9/N/TSO3bsGNRoNP9Kp0WGFHNIK4MNNWtkS6Fs1x8eHlYW0Xx98JRSx8EoByDKuYQTJhQhpUjZtari4j3G9esj/3G7tz948OAcDDfMz89XYU1OiyLPyc++llmw1atXKxphv/8bbJLKysp4QaOhTiInAagRBBaMRi8Xv/zym0aOS3jGxz8UZPmnJtQR9WNJUWQLqZScQk3TeXlMhv7TlAXDe6SA/fHUqYndDkdUTqdNqURCjoXDrBDeijx/4Tt797719iuvbPrnxx9/4hscrJ9EW1tYWEghBZw+leJLBIGbQwnmA0E25/U+P42ZpknOBC5++WWw8P590/WeHhbu6uLoSFUz1uTZt++z19ZvMLK3f2b3iMnI14wtu8SY1oOeCa/l36IJbIHuKjCQloDlCmiuRPcjxnoam767vcvtFrsCfg2z2SScff5NMc1eiERYpSBEywoLpSJEEZ/waUfRT6+bzexmcbH0PY1GfqesXBgJBS/v7e9/HTaJFNvZND6RPfnd0NDgdYz72EuixHbAgdDEBD/EmPhvRHCRsXxoGVkoyL6Pk/iq3iCtWP2i78f9A/rdgYDpL+iN+2w2wYI659qk+SKwNrQnsPTngYGxpLGEFUSCPBS4VStWytXWcqHRauVDFouYsFjk5bhLJpOJt5jNeQlR/JOhufmScfOWq0dKjJW+devYXbtdxoNGGFnKBZPrnE4eTY81Hjw4Vr1zJzMZjeL01BRDm+dNSCM6A4+OwqNJ032ia8Ai9Edobq7nDVkev3HjRv5LVitrwuWu6/9a/PzcuSwQTXLBsgv28nJvrd3OrDZb/kPU5Vufj83Mz7PUxAQTcWNxr2LhSCQ06fPNhUOhO84vvrg9ffr0H6pWrrSEcUd1cObx48cFWYOZySIwNGJFfPXq1W8RwSj6noyG+83Y6GhgbnZ2csLnmxryePxQCoLpH9cEeGy7w1HQ3dsrsZs3/1Fus0UrKisL0OLuYS3/wIED8pkzZ+jgqS8Hpk9OTB5G7datW0twyTdg/iK4HGwEG8BacB6eGQ0x5gzNVoduQ89RKZh0loHJTv6uXbtoTnvohi85MMKmTZtIcVHE1BdhnKf3i54immc200j6SrsgvUwPhWgp/Q8IEGBEVqTNrQAAAABJRU5ErkJggg==';
var iconeLock='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAYAAACN1PRVAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAABfJJREFUSA2NVl1MVFcQnnv3h91ll7W6gIsRgdQ2An2wKIT4U0CbVtqa2gSqjdqnSuKT0b5oG12SPpimL41NqtbYpJqmkdKa2BhFGrQPVNv4A/pQlG0BAUsToOwP+3fvPf3muJfswqqdZHbOnTNnvpk5c85ZhZ5BQgiLoig6m504ccK7fPnyioGBAW95eXnM6/UONzY2/s1zsFNhJ3jI37nImktp6jKAFvX19e3Ny8vbPjI8XP3v9LRCZWVUVFQ0cvfu3Z8ePHjwOYDuwx5CUbD+iYCm7yzZ09MjA+nq6lo5NDTUOz09JX67cUN8eOCAvnbNmkfv7dgR+qGzU/wzMSGCweCj/v7+LeyAM4RgwP9HnBFbBgKBxX8Gg9dHRobF6VOnpvbv2xeAug5cAa7cuvWNnV+dPPnrrZs3xb1790K9vb210JMZKI+fSlwK0+Dy5cuBX65dE7t37XoI3UZTP096m7ds+e7smTPi/Pkfr2BOVuTcuXMy4Hm22Z+m0VK3u/CLY8eChw4e5PpvZysOZM+ePTYMrQ0NDVZkbmc9qPjVpqa/AkeOiMOHDm1ihemHxyY9sUHeb2t7UQijYmZm5g6Mz/MC7D3bp3h89epVZpWdtra2Ttjs9rPxePzjZCLRiOmfodM5ONBcs/BmZpLS0tIiJy1Wa4nT6WKAPhjE00byCGQsMDo6OuRnSteDwjAomUq9YM63t7fPbQnr5oOZdpTStALuYEPXk6YSgcjFHLHJVVVVUocN0qDjWrtM+/lyARiikTaKxYK1wmxlqWPH0PEaBpDs9/slmGqzKaqKKRxtaZzjZwFYZWWlNJ6enozOzs7S5OSkWUI+ChrKamRyW1ub3MOLFy9GZ2OzFIlE5ioxHy+rQeBM4Y1dt25dSVXVS+8ULy2mjQ0NL+/cvXuvx+OxWSwW1eVyGZCKpmmUSCQomUwqhmFEg4ODG2w2G0Wj0WqHw7n6+PHjt58KZmZVV1e3oba2tgUlMsbHx+tjsVi92+2m/Px8yU6nk0HYseRwOEyrKitp2bJlGvTPxxOJNwF0O+2PKyWbLiszNIAMpqSkJLFkyRLy+XwqFusAJAASMqBUKkVoceLMWGeOCwsLCWtUXdeptLQ0lpHVXOtngVG6jeFAlomjh0Muk2K1WiVYumnkmMGZGYBBEQi63+BxzibJBktnhj3h8yUdMSAD8GoLuo2bjcc8j/YjtuUuTMEOx0QmJLsyIzVzmA1maiFtyMTKoHBk4DsF5+yY0AQWO24pfGsoqYZ5AU7iOwUpbdguB2WBmbfB5MwMDY+NEW/8w+Eh0kNhxWO1iaRFpRCCiMFpWNcVgX3DJokCZORFADFNE1YEExkdfXYZTbDPjh5V/ujvpxFE2H/hAm1GN72CSEvB+eAp8HXoTkMyvQ7mx8wDLgdjXoK1tLbONQfUj58DHjBxL/JNt9nvp48mp2gSWXxSXEzdiLwbwG9brLQeWa2EzbuGoCZ09B1DpzN5eXQJtoc9BbTN4yHbo3GFBgf5QXzMsGfKKqPZjd2YOHjjOvGNuh88jkhvIZNvMObrvxG8AbpVkA3Q10AOgD8FX9qEFyYcljdTO75BnOXCc9bB3Yj2r6+uFt9v20Z+7Jmvr4/8KU28Fo3QamT7O+S3WN0DB2vdHnqr0EerXPm0Bnv1ZXkZjZaXU8+iRQZ1dsJK0lwpszLD2yRburW5WTQhQldBgY6/BUY8FFIdKJMfpayB/ABS4wOO8uKql03idDhofWmpwJ8iS0Vvr9YNsKfeIGaDTExM2OK4hB12uyUWDltmIhFy4bpyIXq3y0UeXFd8rqLQp2AXAifQmTOQTuwh1js4p/TbmDMzFWB8QPSxsbGRritXvsbtIe4PDNBsJKLiFlZVq1XFi6zg+VFwawgceHS/ZvC7g3vTWLFihb7Y53OMjo7y607Nzc38F0Jjn/ydSbyptvr6eickR8bAeWDudjyk9BzYBy4CF6clfy8Ge8FuMK/jrcmrqanhR9QOzn3CMbGAELR8lQOBgIrxAmZ9ek7aLXCQofgPB9zTXwJABqEAAAAASUVORK5CYII=';
var iconeUnLock=document.getElementById('icoLock').src;
document.getElementById('icoLock').onclick=function () {if (builtin_verrou>=0) {RetailleFenetre(builtin_verrou,'hidden',-1,1,1); builtin_verrou=-1; this.src=iconeUnLock;  MontreFenetre(0);} else {if (fenetre_courante>0) {builtin_verrou=fenetre_courante; this.src=iconeLock;}}};
document.getElementById('icoLock').style.backgroundColor='transparent';
document.getElementById('icoFS').src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAYAAACN1PRVAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAActpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx4bXA6Q3JlYXRvclRvb2w+d3d3Lmlua3NjYXBlLm9yZzwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGMtVWAAABcZJREFUSA3dVltsVFUUXee+ZqbTlrbUPigVaBUSUfDLKIW0UCAxMTYxhgRj4oOAj4gBfgzBjybGYIkavxDkSz78MPxAQhTUWC0SQwzQqJQEJIHa2tKH05nOTOe+jmvf2xZ+CH40fniSkzn3nnP22nvttfdc4P861Fxg3d3dRnt7uzH3vFC/Y2Njetu2bcG8Pa31POj8ywVczNm3ZMGhabvs8OHPH6qurjKVMsJiUFSe68WQsz/3xbfjE2ZoajiA78H8ua9/kPbHZMeaBbK+PHHqWP0Di1+wLDPr+6GZSNhIpVLQdEMZ9wtc8VwIiMscGgwAhl8o5Msbahf9umxl3XPd+/fesGTzzX0HGisryztT5ZWYGJ+odGy66IYwbF6jgTDwYlBiztrD3fByxjRNQJwKeU8Z8HwXAbNTU7N4bXNjw6OEicGW1NRgfLJQqKoCljQvKbkaQohWHvPKSwlGSAbEr3sO3y1BGwZ0MkE8jWTK0X7RNW8OjqhikZ5zRJH5vq2DAMaDK5Yi8fslQ1/qN+x0Wuc9T6GjHY2PrJKzEtQ9ETOjIzp/5gwqZmYQuJ4KG+vDcEOHGp3IYWrKiwiJpM48KYc0KCeBYGgY1Xv3onLXLswMXNVWU7Mc1L4fgFP7QUDHwrtmEO079Q0okonUa6+jevdu4MIFaMeBY5mw7TjpEViqmkKgRYNUmWseR4lriXtp/2X4J05g/M8h8q9JT8j8hQhIQ8C1/JIxZDNTmDp9Gk3fnAUzB5dTbWiHnSpD6Plwyir4ZpbGaGE7UDRgVtdgcM8+mGvXoGnnDtXY16eH29ariePHde3y5QhdmqIAGJoyLQu56bzOfnAQy3t6IoODR44if+MGahsaqH6yzjwmEuLCLFgSKZhUoHhhVJTDfHUHalatxNjSZl21pRNmV5e2F9ci4L6WUFSUbx0yMpviSaxbjxx6kDv6GSpeehl6aAhGugza82CYFhKc82DEgngpFFlOGepaWmEyFca6Noz2nUfFihVIpcsRMPmUJf0V0hX8kGDMc2rjRoz+eA41q1cjRcN2QyMs28J0dhoW7bJo74CliEaRRAaivFAMoTBAuhqffAqa1HmFItljipk7qSsZUg5eqQTbMNHU1gZd4rliMXIl5J4cMyi8qAZlLZdkmLOhRm0yMkq7/M1lMnB9H4qXpH4EKJ4iGD7QKHeRncwwUj7L3Sh26SqxXYt3ZcRg5F1esCeC0kaBUYBKyo1PIN9zEPnLlxGIM7wdcsZgfBRwy0ZheBjT77+HzMAAizqJGTJRYpGLIwbBHSumMQIjFl8SjCJxsznc/u5b3L7+B4yjn6rWDw8hsfMVlRkcjPZF63RYyoCWTJXPTaN05DBaP/kYiw7sx9hvV/DXT+eQv3mT7c6Jysm6W41AkjQSl967UxnUH+qBUV+HurNf63xLKwrvvKsdqRkKSFpsrA9DMNnJDZQ2bcHf16+h+tRJKtpD2fffIfzqLLyWhyPG5lIUadJxEtoxLR0y5PDWLTT0XxQ7auStPcjvegOVLS2wpIiZO6FG0ESTUtQ22ajctBnZx9Yi29GJZfvelrsYvXYN7hNtVKUD04gdi2gMAt+w2FpcKiu8OhAUgICM+/mxET+0TD+plK/CwKeqfF7kNH2qjNNi4cF3wtA3HccvZDN+PmrdTH3/Rd/NZUO+Z/SWeBg3YqDEfwOVSltJTHU+nbz9y+ZI5pY0VTb+kssubViRIKLA5GZEouiOfyes8TBfRGrrM5h89nm2Nu4zLalkGr78zyH+KogQ+aR6z1/5KOEkXjQce1pLAkVytKxIneRB7s8d5vLOiFmFweKFY8fXuKu0DthByl3XvTg5Mrajq2v9MN/Nfxbg2Bcn62uChBFksxpl6dgg2w7SsiZB82N2b/6Zizz380yAjALXvB8kbWP79q3ySeDNfYfQm//og0ccke8QAezt7Y1LXV4u0Piho4OdK+7cC2Ty35n5Bx2xpxGwALgzAAAAAElFTkSuQmCC';
document.getElementById('icoFS').onclick=function () {if (isInFullScreenMode) {exitFullscreen();this.src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAYAAACN1PRVAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAActpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx4bXA6Q3JlYXRvclRvb2w+d3d3Lmlua3NjYXBlLm9yZzwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGMtVWAAABcZJREFUSA3dVltsVFUUXee+ZqbTlrbUPigVaBUSUfDLKIW0UCAxMTYxhgRj4oOAj4gBfgzBjybGYIkavxDkSz78MPxAQhTUWC0SQwzQqJQEJIHa2tKH05nOTOe+jmvf2xZ+CH40fniSkzn3nnP22nvttfdc4P861Fxg3d3dRnt7uzH3vFC/Y2Njetu2bcG8Pa31POj8ywVczNm3ZMGhabvs8OHPH6qurjKVMsJiUFSe68WQsz/3xbfjE2ZoajiA78H8ua9/kPbHZMeaBbK+PHHqWP0Di1+wLDPr+6GZSNhIpVLQdEMZ9wtc8VwIiMscGgwAhl8o5Msbahf9umxl3XPd+/fesGTzzX0HGisryztT5ZWYGJ+odGy66IYwbF6jgTDwYlBiztrD3fByxjRNQJwKeU8Z8HwXAbNTU7N4bXNjw6OEicGW1NRgfLJQqKoCljQvKbkaQohWHvPKSwlGSAbEr3sO3y1BGwZ0MkE8jWTK0X7RNW8OjqhikZ5zRJH5vq2DAMaDK5Yi8fslQ1/qN+x0Wuc9T6GjHY2PrJKzEtQ9ETOjIzp/5gwqZmYQuJ4KG+vDcEOHGp3IYWrKiwiJpM48KYc0KCeBYGgY1Xv3onLXLswMXNVWU7Mc1L4fgFP7QUDHwrtmEO079Q0okonUa6+jevdu4MIFaMeBY5mw7TjpEViqmkKgRYNUmWseR4lriXtp/2X4J05g/M8h8q9JT8j8hQhIQ8C1/JIxZDNTmDp9Gk3fnAUzB5dTbWiHnSpD6Plwyir4ZpbGaGE7UDRgVtdgcM8+mGvXoGnnDtXY16eH29ariePHde3y5QhdmqIAGJoyLQu56bzOfnAQy3t6IoODR44if+MGahsaqH6yzjwmEuLCLFgSKZhUoHhhVJTDfHUHalatxNjSZl21pRNmV5e2F9ci4L6WUFSUbx0yMpviSaxbjxx6kDv6GSpeehl6aAhGugza82CYFhKc82DEgngpFFlOGepaWmEyFca6Noz2nUfFihVIpcsRMPmUJf0V0hX8kGDMc2rjRoz+eA41q1cjRcN2QyMs28J0dhoW7bJo74CliEaRRAaivFAMoTBAuhqffAqa1HmFItljipk7qSsZUg5eqQTbMNHU1gZd4rliMXIl5J4cMyi8qAZlLZdkmLOhRm0yMkq7/M1lMnB9H4qXpH4EKJ4iGD7QKHeRncwwUj7L3Sh26SqxXYt3ZcRg5F1esCeC0kaBUYBKyo1PIN9zEPnLlxGIM7wdcsZgfBRwy0ZheBjT77+HzMAAizqJGTJRYpGLIwbBHSumMQIjFl8SjCJxsznc/u5b3L7+B4yjn6rWDw8hsfMVlRkcjPZF63RYyoCWTJXPTaN05DBaP/kYiw7sx9hvV/DXT+eQv3mT7c6Jysm6W41AkjQSl967UxnUH+qBUV+HurNf63xLKwrvvKsdqRkKSFpsrA9DMNnJDZQ2bcHf16+h+tRJKtpD2fffIfzqLLyWhyPG5lIUadJxEtoxLR0y5PDWLTT0XxQ7auStPcjvegOVLS2wpIiZO6FG0ESTUtQ22ajctBnZx9Yi29GJZfvelrsYvXYN7hNtVKUD04gdi2gMAt+w2FpcKiu8OhAUgICM+/mxET+0TD+plK/CwKeqfF7kNH2qjNNi4cF3wtA3HccvZDN+PmrdTH3/Rd/NZUO+Z/SWeBg3YqDEfwOVSltJTHU+nbz9y+ZI5pY0VTb+kssubViRIKLA5GZEouiOfyes8TBfRGrrM5h89nm2Nu4zLalkGr78zyH+KogQ+aR6z1/5KOEkXjQce1pLAkVytKxIneRB7s8d5vLOiFmFweKFY8fXuKu0DthByl3XvTg5Mrajq2v9MN/Nfxbg2Bcn62uChBFksxpl6dgg2w7SsiZB82N2b/6Zizz380yAjALXvB8kbWP79q3ySeDNfYfQm//og0ccke8QAezt7Y1LXV4u0Piho4OdK+7cC2Ty35n5Bx2xpxGwALgzAAAAAElFTkSuQmCC';} else {enterFullscreen(); this.src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAYAAACN1PRVAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAActpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx4bXA6Q3JlYXRvclRvb2w+d3d3Lmlua3NjYXBlLm9yZzwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGMtVWAAABbNJREFUSA3dVktsVFUY/u65j3nRmelMS2lrg0KBgAgICmoorQGNiY8aEmswREiIGxIh6MIYF1YM7jCmVaJh5cZEYFPcuJAEIzFulLQkWDUI2CdtZ+hrOo879xy/c6ZtIOhCwY2nnTP3/vec//u/7//Pfwf4vw5rgVhnZ6dobW0VC/f36nt8fFx1dHQEi/6UUougi8Z7eLHg39EXHIq+oydOfN5cXZ20y1Ygy0HZ8nP+v4K0bVvBA8o+7B++6x2g/3HtyJkHck6dOXuyrjb9ius60+VA2p7nIRqNgMH8Y0BNQAhRnp2dXbKsJnFp+eqluzvfPvK7oz0dfOOd+ni8amckFsfY2FjccxxGJaFg80Mw/lvzQi9A36r7YjzaKLmLi0tBmdsspFLpjU31y9bzSQWsIZXCRDY3l0jW4IHlTUXpui4fKpUvQtKB4OYFENrvGBrDACoJEfIghY2YX1K5uaL9x+Colc+XpN5kmLnxuCqWpGhe0YSadEKMXrwoPNpSG9bcRoDrb73X+28dJp781BSyfX1WY0uLLJR8a2h4HHlfmGem1H2/ZIVdB8pxke3vR3TzZmD/fkwMDatM9qYa+rlfBZQn4FQuB0p/Vz6BdqIyg4PqxsAAZvIFzBz/EIkdO5A99w2KgUQ4FILQ0nAYZvpCK+cHAQrXryPJ+9SFC7h57BgmamrgNTSg1NysqwmSa5h9o5v2IG0bfv8vmDl7FqquDsveP4oi7ZO//gZn0xbYJiM0cBiwSDgCcJNdDpDeuQsTly6j+FUPkl1dVvXoiMq8fsgqzOVVLBYz1anIUkmpKw7lslT24CBWdXeZvE4fOozpjpeRfvQRlApFsz4ajRowI2MYETiUUDLLgo4S69Yi09qGSQKZiLq7VJ4OpWbG51KyUvWZEELlJychT58yzgqcR7Y9hqpt2xAio4DBC5II2RUBKzOJaSPYSAL6yE1koIaH4Xd9jNFIhBEWWJGCOQtMpOYo0LEGZhKRf6kDo+0vwuK9XWTeBgYRabpPnwLYrEzbDplgKjIaZgRj5Ew8wpS14bkXIFk02nGEybFLPmSRHaWSayOZ9H1E40mEX90HXds6hzEdAOUL/LIB0CTsEH1zLDKz56nqg1gsFuEPDcHhQsm8KJ4fN55AiDnjjdmoJ10omnVhZIS7qCptOgArkURVddIs1cy0Hz1Mzhi7MWggkBkcD5neXuCJrUjubodYvRIz167R7urCMPLoIqH2mJudhX/kMOJbt8BdswqZnh74ZG8xKC2zIAnPqchowJgy2GxRplOwJ0ouiNbWsjfGrMilPkTanrS8pXUGaIEYi8lit7bcqgTCGzYims0iwRYVqa+H5XoIGLCuVv1x5mWsMCOapqoY6dSVKyh9+gnu39WGcDGvsgwk19Km3GQ1eLIpFgXTSlrsCgzdDofhP7QBGZoKD2/Gin17Id57F5MXf4RPFdjY2WEr2TIzO7xybVcpRpTr68XKt97kAljXuz/DTCoNe2oSdcKpVB+BdCGwDPhHRTRIQyMyZ3oQTafR+OR21Hd/hKvV1bAOHiYJgvGIcFkF0nNdzReCZVz91DPB8NEPRJBOq9izz6OK5V6cm4MjdAkQRlejRqtMEGRbtXYd4g+uZxEtwdjX5yBOf4nY/gO6VzlZOSVYWGZHhV9BBJawIp4b4jkTYeu1gwgxh54SZCOhXz1lWXmzM/XmOGg4PbSwXogdQmubLyP2eAty6zfBSSRYmQH3VuHm9LRZaxB5ZZ3//vJxzwvttWQwKzRTbtaH2DDhNV+yZsMdkzYTx+jEWR9+XWxBqcS4xRKe258GRq4e2NP+9DArdPFnAU5+0VOXSjWK6ZEb7IN0EqvllLvDPx/8hW3elOP63BywtJbtqiT2tG/XPwl8jWNWLF78vYu7erLg3+RM/w7RhvPnz1eO+l25vn3zt21t7N+WeVPf/uQ/vvsTjdB+5uLYns4AAAAASUVORK5CYII=';
                                                                                                                                        } AdapterTaille(window.innerWidth,window.innerHeight);};
if (document.getElementById('icoSlides') != null) {
  document.getElementById('icoSlides').src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAKlBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKE86IAAAADXRSTlMAQNCwgCBw7+C/r38QwipBTAAAAFJJREFUKM9jYJC6iwQuMTCw3EUBDAyy1wIYEAAoYOvAgCpwNwBd4AC6QAK6QDWaoch23kQXuDsqgCaghC7AgEXAFl1AFl2ABSXuQUAYIdAI5AIAJNA763ktS2sAAAAASUVORK5CYII=';
  document.getElementById('icoWB').src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAM1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACjBUbJAAAAEHRSTlMA0PAQMGAgn1DgwI9Ar6Bw3kocvwAAAK5JREFUOMu1kdsOAyEIRAVxdS9tz/9/bYvb9AndpMnOgyTOgQwhpSRMJNeAC1Io//8byCJzYGMOVHQJgXyWAhZmEDUvB5QwZKVPNmUPtyiwITkLz3BNU8rH3ByKgLNxUdCcIuBxNpp60AB4eT7X4iUAoM1v0drlsW4FlIHWL3CsA/+Yje26AyhQZv4OsI/9Slcd2PmBNmhKzaEvqHlIUyQihNX6Fp2IAMn97cN+wBsAjRAhRifO6gAAAABJRU5ErkJggg==';
}
}

function ChangeNewStyle() {

document.getElementById('icoExec').src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAANlBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC3dmhyAAAAEXRSTlMAgFCQ8MAw0BCg4N/PsEAgcOyQFq4AAAC2SURBVDjLrZPbEsMgCES9a9Qm3f//2TpppgwExz7kvCEbhI2YZ0k+dqBHn7RssQE/gr3lXQOjOZ73uMGKbFDY5PfzGg4T3NV/w4T2FVg6SeWlXELzg8uBYAY7iLOjACKJEc6KR6YDP+IoBaaQLXGEWQoGb1z0EYAJpDVrgbxCWJP1JsmtqI2ZOh8zLYySVnthNXd/P6Lys0rFhLp8MDS2iv370eo1rFicKvpzRiJXT1/eDGS2vB+cASeW0QgsuwAAAABJRU5ErkJggg==';
document.getElementById('icoIndent').src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAElBMVEUAAAAAAAAAAAAAAAAAAAAAAADgKxmiAAAABXRSTlMA0OBA8AAZ0pEAAAA3SURBVCjPY2AwCkUCygwMDKrIAkFAgVAGJBBKiYAo0MRA3AKU2wIxEWooQmDUFlwCrqiRjZEcAGMaNWN2V+9gAAAAAElFTkSuQmCC';
document.getElementById('icoSave').src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAHlBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC3KG9qAAAACXRSTlMAIJ/gQMC/8BBsYRobAAAAV0lEQVQoz2NwnokEFBgYGCyRBSYBBUA0A4QGYgV0gUloAkAl6AKT0AVmkivQwAAGjHCBRIiAGFQAASgQCGSAAlGogABMgBEqwAAHQ1ygEtX3kxmcUQVMAMfSt59nRWTcAAAAAElFTkSuQmCC';
//document.getElementById('icoLoad').src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAJ1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADdEvm1AAAADHRSTlMA4PCgQBDf0DCwYCBjdHcqAAAAQUlEQVQoz2OgMwg+AwIpCIE5YIFjcD73mQYQdQYu0H6YASKw6AwUlEIFdKB84QCoAELTqABxAjpnUMBBBkdUAREAzwZRv/HPSxsAAAAASUVORK5CYII=';

document.getElementById('icoLoad').onclick=function () {MontreFenetre(8-fenetre_courante);};
document.getElementById('icoLock').src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAABlBMVEUAAAAAAAClZ7nPAAAAAXRSTlMAQObYZgAAAE1JREFUCNd1zLENgDAMAMGPUqTMCB4lo5HRGMUjpHRhYSwoA81Vr4emgFhyXElE4gPK6pOibVK1Qj3ZkAhjRPg3PhKTZPUdkzf5HTz7GxZdRmtH6afSAAAAAElFTkSuQmCC';
var iconeLock='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAM1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACjBUbJAAAAEHRSTlMAUN8Q4EAg8J8w0MBwkIBfYr4MTgAAAKVJREFUOMvNklsSgyAMRSEEAvjK/lfbpDIjqJl2+lPP3+UeYxx0PVuuzDVv7h4P3AB/12fuyFZvGzMrS3GuLKzMYx9IzmrZQ6kSKFwGkPTNoMsIfWY94ipxGgQW0hGT5mEFydQfnIV4HjnJQfxaiMAGsDvIJtAWsvmDgD4lj7aAQXNAU/Dt3zOF0K7qo/D7K2BfEkyBQT+z6/kxd0F2j28hotlH517X9CZd050tNAAAAABJRU5ErkJggg==';
var iconeUnLock=document.getElementById('icoLock').src;
document.getElementById('icoLock').onclick=function () {if (builtin_verrou>=0) {RetailleFenetre(builtin_verrou,'hidden',-1,1,1); builtin_verrou=-1; this.src=iconeUnLock;  MontreFenetre(0);} else {if (fenetre_courante>0) {builtin_verrou=fenetre_courante; this.src=iconeLock;}}};
document.getElementById('icoLock').style.backgroundColor='transparent';
document.getElementById('icoFS').src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABWNxwqAAAAB3RSTlMAMPDvQODfr75drwAAAHxJREFUKM+d0MEJgDAQRNEJWICiDXiyBK960AoEG7CCgG77ErMwTA6CLrnk8QNJsJrMgV3hghXzAjWAUAL0SKwL6EMGBm0GBmMGBpaBgcLUmsI8mjUOnL/QmMWO8Ky+EkiXFEiXFPCA4AHBA4IHBACB4P//5S2D7k8sCtsNuKvQI/Z6BpUAAAAASUVORK5CYII=';
document.getElementById('icoFS').onclick=function () {if (isInFullScreenMode) {exitFullscreen();this.src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABWNxwqAAAAB3RSTlMAMPDvQODfr75drwAAAHxJREFUKM+d0MEJgDAQRNEJWICiDXiyBK960AoEG7CCgG77ErMwTA6CLrnk8QNJsJrMgV3hghXzAjWAUAL0SKwL6EMGBm0GBmMGBpaBgcLUmsI8mjUOnL/QmMWO8Ky+EkiXFEiXFPCA4AHBA4IHBACB4P//5S2D7k8sCtsNuKvQI/Z6BpUAAAAASUVORK5CYII=';} else {enterFullscreen(); this.src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABWNxwqAAAAB3RSTlMAMPDvQODfr75drwAAAHdJREFUKM+dz7EJhUAURNEn/AJW/A0YWYKpBlqBYANWsKDTvmMgeA0EnWg5zD6YGIUsMRO20C0PUEr5fwW/6h8hp4pQFy3gKABcILhAcIHgFFdIJyAf4bxGCH7JieCZBM8keCbABQFcIHSVCH0rlW+2NELWGAjTDkxj0CPexFNFAAAAAElFTkSuQmCC';
                                                                                                                                        } AdapterTaille(window.innerWidth,window.innerHeight);};
if (document.getElementById('icoSlides') != null) {
  document.getElementById('icoSlides').src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAKlBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKE86IAAAADXRSTlMAQNCwgCBw7+C/r38QwipBTAAAAFJJREFUKM9jYJC6iwQuMTCw3EUBDAyy1wIYEAAoYOvAgCpwNwBd4AC6QAK6QDWaoch23kQXuDsqgCaghC7AgEXAFl1AFl2ABSXuQUAYIdAI5AIAJNA763ktS2sAAAAASUVORK5CYII=';
  document.getElementById('icoWB').src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAM1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACjBUbJAAAAEHRSTlMA0PAQMGAgn1DgwI9Ar6Bw3kocvwAAAK5JREFUOMu1kdsOAyEIRAVxdS9tz/9/bYvb9AndpMnOgyTOgQwhpSRMJNeAC1Io//8byCJzYGMOVHQJgXyWAhZmEDUvB5QwZKVPNmUPtyiwITkLz3BNU8rH3ByKgLNxUdCcIuBxNpp60AB4eT7X4iUAoM1v0drlsW4FlIHWL3CsA/+Yje26AyhQZv4OsI/9Slcd2PmBNmhKzaEvqHlIUyQihNX6Fp2IAMn97cN+wBsAjRAhRifO6gAAAABJRU5ErkJggg==';
}

}

// Création d'applications

function DownloadHTMLFile(filename, elHtml, mimeType) {
        var link = document.createElement('a');
        mimeType = mimeType || 'text/plain';
        link.setAttribute('download', filename);
        link.setAttribute('href', 'data:' + mimeType  +  ';charset=utf-8,' + encodeURIComponent(elHtml));
        link.click();
}

function createStandaloneApp(ch,title,style,files,encryption) {
	GEBID('AllScripts').innerHTML=(jsmin(GEBID('AllScripts').innerHTML));
	var res='';
	res+='<!doctype html>\n<html lang="fr">\n<head>\n  <meta charset="utf-8">\n<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1"/>\n';

for (var i = 0; i < (AllExtensions.length); i++) {
  var enabled = (AllExtensions[i]['ENABLED'][0].search(/yes/i) >= 0);
  if (AllExtensions[i]['ENABLED'][0].search(/ask/i) >= 0) enabled = true; //confirm('Do you want to enable\n' + AllExtensions[i]['TITLE'][0] + ' ?');
  if (enabled) {
    if (typeof(AllExtensions[i]['JSURL']) != 'undefined') {
      for(var j=0; j<AllExtensions[i]['JSURL'].length;j++) res+='<script src="'+AllExtensions[i]['JSURL'][j]+'"></script>\n';
    }
    if (typeof(AllExtensions[i]['CSSURL']) != 'undefined') {
      for(var j=0; j<AllExtensions[i]['CSSURL'].length;j++) res+='<link rel="stylesheet" href="'+AllExtensions[i]['CSSURL'][j]+'" />\n';
    }
  }
}
	var UnMaskCodeF='UnMaskCode';
	if (encryption == false) {UnMaskCodeF='';}

	switch (style) {
	case 1:
	res+='<title>'+title+'</title>'+GEBID("AllScripts").outerHTML+GEBID("AllStyles").outerHTML+'</head><body onload=" Init(); InitGraphic(); AdapterTaille2(window.innerWidth,window.innerHeight); window.onresize=function () {AdapterTaille2(window.innerWidth,window.innerHeight);};GEBID(\'Libraries\').value='+UnMaskCodeF+'(GEBID(\'Libraries\').value); readAllFS(GEBID(\'Libraries\').value); GEBID(\'SourceCode\').value='+UnMaskCodeF+'(GEBID(\'SourceCode\').value); Viewport(0,0,window.innerWidth,window.innerHeight,1); setTimeout(function() {window.eval(GEBID(\'SourceCode\').value);}, 10);">';
	res+='<div id="weboutput" style="visibility: hidden; top:0px; left: 0px; width:100%; height: 100%"></div><textarea style="visibility: visible; border:0; top:0px; left: 0px; width: 100%; height: 100%" id="sortie"></textarea><canvas style="visibility: hidden; top:0px; left: 0%; width: 100%; height: 100%" id="mycanvas" width="480" height="300"></canvas>';
	break;
	case 2:
	res+='<title>'+title+'</title>'+GEBID("AllScripts").outerHTML+GEBID("AllStyles").outerHTML+'</head><body onload="Init(); InitGraphic(); AdapterTaille2(Math.floor(window.innerWidth/2),window.innerHeight); window.onresize=function () {AdapterTaille(Math.floor(window.innerWidth/2),window.innerHeight);};GEBID(\'Libraries\').value='+UnMaskCodeF+'(GEBID(\'Libraries\').value); readAllFS(GEBID(\'Libraries\').value); GEBID(\'SourceCode\').value='+UnMaskCodeF+'(GEBID(\'SourceCode\').value); Viewport(0,0,window.innerWidth,window.innerHeight,1); setTimeout(function() {window.eval(GEBID(\'SourceCode\').value);}, 10);">';
	res+='<div id="weboutput" style="visibility: hidden; top:0px; left: 0px; width:100%; height: 100%"></div><textarea style="visibility: visible; border:0; top:0px; left: 0px; width: 50%; height: 100%" id="sortie"></textarea><canvas style="visibility: visible; top:0px; left: 50%; width: 50%; height: 100%" id="mycanvas" width="480" height="300"></canvas>';
	break;
	case 3:
	res+='<title>'+title+'</title>'+GEBID("AllScripts").outerHTML+GEBID("AllStyles").outerHTML+'</head><body onload="Init(); InitGraphic(); AdapterTaille2(window.innerWidth,window.innerHeight); window.onresize=function () {AdapterTaille2(window.innerWidth,window.innerHeight);}; GEBID(\'Libraries\').value='+UnMaskCodeF+'(GEBID(\'Libraries\').value); readAllFS(GEBID(\'Libraries\').value); GEBID(\'SourceCode\').value='+UnMaskCodeF+'(GEBID(\'SourceCode\').value); Viewport(0,0,window.innerWidth,window.innerHeight,1); setTimeout(function() {window.eval(GEBID(\'SourceCode\').value);}, 10);">';
	res+='<div id="weboutput" style="visibility: hidden; top:0px; left: 0px; width:100%; height: 100%"></div><canvas style="visibility: visible; top:0px; left: 0px; width: 100%; height: 100%" id="mycanvas" width="480" height="300"></canvas><textarea style="visibility: hidden; border:0; top:0px; left: 0px; width: 100%; height: 100%" id="sortie"></textarea>';
	break;
	case 4:
	res+='<title>'+title+'</title>'+GEBID("AllScripts").outerHTML+GEBID("AllStyles").outerHTML+'</head><body onload="Init(); InitGraphic(); AdapterTaille2(window.innerWidth,window.innerHeight); window.onresize=function () {AdapterTaille2(window.innerWidth,window.innerHeight);}; GEBID(\'Libraries\').value='+UnMaskCodeF+'(GEBID(\'Libraries\').value); readAllFS(GEBID(\'Libraries\').value); GEBID(\'SourceCode\').value='+UnMaskCodeF+'(GEBID(\'SourceCode\').value); Viewport(0,0,window.innerWidth,window.innerHeight,1);  setTimeout(function() {window.eval(GEBID(\'SourceCode\').value);}, 10);">\n';
	res+='<div id="weboutput" style="visibility: visible; position: absolute; background-color: white; top:0px; left: 0px; width:100%; height: 100%"></div><canvas style="visibility: hidden; top:0px; left: 0%; width: 100%; height: 100%" id="mycanvas" width="480" height="300"></canvas><textarea style="visibility: hidden; border:0; top:0px; left: 0px; width: 100%; height: 100%" id="sortie"></textarea>';
	break;
	}

	res+='<textarea id="Libraries" style="display: none">\n';
	var code='';
	flag=false;
	for(var i=0; i<Taille(files);i++) {
		if (flag) code+='--------------------\n';
		flag=true;
		code+=files[i]+'\n';
		code+='--------------------\n';
		if (encryption == false) code+=readFile(files[i])+'\n'; else code+=(readFile(files[i]))+'\n';

	}
	if (encryption == false) res+=code; else res+=MaskCode(code);
	res+='</textarea>';
	ch="\n\nwindow.document.getElementsByTagName('div')[0].id= 'weboutput';\n"+ch;
	if (encryption == false)
		res+='<textarea id="SourceCode" style="display: none">'+(ch)+'</textarea></body></html>';
	else
		res+='<textarea id="SourceCode" style="display: none">'+MaskCode(jsmin(ch))+'</textarea></body></html>';
	return res;
}

function createLibraryApp(ch,title,style,files) {
	var res='';
	flag=false;
	for(var i=0; i<Taille(files);i++) {
		if (flag) res+='--------------------\n';
		flag=true;
		res+=files[i]+'\n';
		res+='--------------------\n';
		res+=readFile(files[i])+'\n';
	}

	if (flag) res+='--------------------\n';
	res+='Executable.js\n';
	res+='--------------------\n';
	res+=ch+'\n';
	return res;
}







/*!
jsmin.js - 2010-01-15
Author: NanaLich (http://www.cnblogs.com/NanaLich)
Another patched version for jsmin.js patched by Billy Hoffman,
this version will try to keep CR LF pairs inside the important comments
away from being changed into double LF pairs.

jsmin.js - 2009-11-05
Author: Billy Hoffman
This is a patched version of jsmin.js created by Franck Marcia which
supports important comments denoted with /*! ...
Permission is hereby granted to use the Javascript version under the same
conditions as the jsmin.js on which it is based.

jsmin.js - 2006-08-31
Author: Franck Marcia
This work is an adaptation of jsminc.c published by Douglas Crockford.
Permission is hereby granted to use the Javascript version under the same
conditions as the jsmin.c on which it is based.

jsmin.c
2006-05-04

Copyright (c) 2002 Douglas Crockford  (www.crockford.com)

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
of the Software, and to permit persons to whom the Software is furnished to do
so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

The Software shall be used for Good, not Evil.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

Update:
add level:
1: minimal, keep linefeeds if single
2: normal, the standard algorithm
3: agressive, remove any linefeed and doesn't take care of potential
missing semicolons (can be regressive)
store stats
jsmin.oldSize
jsmin.newSize
*/

String.prototype.has = function(c) {
  return this.indexOf(c) > -1;
};

function jsmin(comment, input, level) {

  if(input === undefined) {
    input = comment;
    comment = '';
    level = 2;
  } else if(level === undefined || level < 1 || level > 3) {
    level = 2;
  }

  if(comment.length > 0) {
    comment += '\n';
  }

  var a = '',
		b = '',
		EOF = -1,
		LETTERS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz',
		DIGITS = '0123456789',
		ALNUM = LETTERS + DIGITS + '_$\\',
		theLookahead = EOF;


  /* isAlphanum -- return true if the character is a letter, digit, underscore,
  dollar sign, or non-ASCII character.
  */

  function isAlphanum(c) {
    return c != EOF && (ALNUM.has(c) || c.charCodeAt(0) > 126);
  }


  /* getc(IC) -- return the next character. Watch out for lookahead. If the
  character is a control character, translate it to a space or
  linefeed.
  */

  var iChar = 0, lInput = input.length;
  function getc() {

    var c = theLookahead;
    if(iChar == lInput) {
      return EOF;
    }
    theLookahead = EOF;
    if(c == EOF) {
      c = input.charAt(iChar);
      ++iChar;
    }
    if(c >= ' ' || c == '\n') {
      return c;
    }
    if(c == '\r') {
      return '\n';
    }
    return ' ';
  }
  function getcIC() {
    var c = theLookahead;
    if(iChar == lInput) {
      return EOF;
    }
    theLookahead = EOF;
    if(c == EOF) {
      c = input.charAt(iChar);
      ++iChar;
    }
    if(c >= ' ' || c == '\n' || c == '\r') {
      return c;
    }
    return ' ';
  }


  /* peek -- get the next character without getting it.
  */

  function peek() {
    theLookahead = getc();
    return theLookahead;
  }


  /* next -- get the next character, excluding comments. peek() is used to see
  if a '/' is followed by a '/' or '*'.
  */

  function next() {

    var c = getc();
    if(c == '/') {
      switch(peek()) {
        case '/':
          for(; ; ) {
            c = getc();
            if(c <= '\n') {
              return c;
            }
          }
          break;
        case '*':
          //this is a comment. What kind?
          getc();
          if(peek() == '!') {
            // kill the extra one
            getc();
            //important comment
            var d = '/*!';
            for(; ; ) {
              c = getcIC(); // let it know it's inside an important comment
              switch(c) {
                case '*':
                  if(peek() == '/') {
                    getc();
                    return d + '*/';
                  }
                  break;
                case EOF:
                  throw 'Error: Unterminated comment.';
                default:
                  //modern JS engines handle string concats much better than the
                  //array+push+join hack.
                  d += c;
              }
            }
          } else {
            //unimportant comment
            for(; ; ) {
              switch(getc()) {
                case '*':
                  if(peek() == '/') {
                    getc();
                    return ' ';
                  }
                  break;
                case EOF:
                  throw 'Error: Unterminated comment.';
              }
            }
          }
          break;
        default:
          return c;
      }
    }
    return c;
  }


  /* action -- do something! What you do is determined by the argument:
  1   Output A. Copy B to A. Get the next B.
  2   Copy B to A. Get the next B. (Delete A).
  3   Get the next B. (Delete B).
  action treats a string as a single character. Wow!
  action recognizes a regular expression if it is preceded by ( or , or =.
  */

  function action(d) {

    var r = [];

    if(d == 1) {
      r.push(a);
    }

    if(d < 3) {
      a = b;
      if(a == '\'' || a == '"') {
        for(; ; ) {
          r.push(a);
          a = getc();
          if(a == b) {
            break;
          }
          if(a <= '\n') {
            throw 'Error: unterminated string literal: ' + a;
          }
          if(a == '\\') {
            r.push(a);
            a = getc();
          }
        }
      }
    }

    b = next();

    if(b == '/' && '(,=:[!&|'.has(a)) {
      r.push(a);
      r.push(b);
      for(; ; ) {
        a = getc();
        if(a == '/') {
          break;
        } else if(a == '\\') {
          r.push(a);
          a = getc();
        } else if(a <= '\n') {
          throw 'Error: unterminated Regular Expression literal';
        }
        r.push(a);
      }
      b = next();
    }

    return r.join('');
  }


  /* m -- Copy the input to the output, deleting the characters which are
  insignificant to JavaScript. Comments will be removed. Tabs will be
  replaced with spaces. Carriage returns will be replaced with
  linefeeds.
  Most spaces and linefeeds will be removed.
  */

  function m() {

    var r = [];
    a = '\n';

    r.push(action(3));

    while(a != EOF) {
      switch(a) {
        case ' ':
          if(isAlphanum(b)) {
            r.push(action(1));
          } else {
            r.push(action(2));
          }
          break;
        case '\n':
          switch(b) {
            case '{':
            case '[':
            case '(':
            case '+':
            case '-':
              r.push(action(1));
              break;
            case ' ':
              r.push(action(3));
              break;
            default:
              if(isAlphanum(b)) {
                r.push(action(1));
              } else {
                if(level == 1 && b != '\n') {
                  r.push(action(1));
                } else {
                  r.push(action(2));
                }
              }
          }
          break;
        default:
          switch(b) {
            case ' ':
              if(isAlphanum(a)) {
                r.push(action(1));
                break;
              }
              r.push(action(3));
              break;
            case '\n':
              if(level == 1 && a != '\n') {
                r.push(action(1));
              } else {
                switch(a) {
                  case '}':
                  case ']':
                  case ')':
                  case '+':
                  case '-':
                  case '"':
                  case '\'':
                    if(level == 3) {
                      r.push(action(3));
                    } else {
                      r.push(action(1));
                    }
                    break;
                  default:
                    if(isAlphanum(a)) {
                      r.push(action(1));
                    } else {
                      r.push(action(3));
                    }
                }
              }
              break;
            default:
              r.push(action(1));
              break;
          }
      }
    }

    return r.join('');
  }

  jsmin.oldSize = input.length;
  ret = m(input);
  jsmin.newSize = ret.length;

  return comment + ret;

}




//-->
</script>
<script type="text/javascript">
function Whichhub() {
  var xhttp = new XMLHttpRequest();
  xhttp.onload = function() {
    TogetherJSConfig_hubBase = xhttp.responseText;
    console.log('TogetherJS Hub is : '+ TogetherJSConfig_hubBase);
  };
  xhttp.open("GET", "getTJSHub.php", true);
  xhttp.send();
}

    TogetherJSConfig_hubBase ='https://jeremiebourdon.freeboxos.fr/tjs/';
    if (whichhub == 'public') TogetherJSConfig_hubBase ='https://togetherjs-hub.glitch.me/';
    if (getQuerystring("hub", "") == "") Whichhub();
setTimeout(function () {if (TogetherJSConfig_hubBase == 'https://togetherjs-hub.glitch.me/') document.getElementById('boutons').style.backgroundColor='rgb(30,30,118)';},2000);
    TogetherJSConfig_suppressJoinConfirmation = true;
    TogetherJSConfig_disableWebRTC = true;
</script>
<script src="togetherjs-min.js"></script>
<script type="text/javascript">
//<!--
function Collaborate() {
  try {
    TogetherJS(this); return false;
  } catch(error) {console.log(error);}
}

//-->
</script>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />

	<title>Make javascript developments simpler</title>
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1"/>
<link rel="icon" type="image/x-icon" href="favicon.ico" />

    <style type="text/css">
/* BASICS */

.CodeMirror {
  /* Set height, width, borders, and global font properties here */
  font-family: monospace;
  height: 300px;
}

/* PADDING */

.CodeMirror-lines {
  padding: 4px 0; /* Vertical padding around content */
}
.CodeMirror pre {
  padding: 0 4px; /* Horizontal padding of content */
}

.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {
  background-color: white; /* The little square between H and V scrollbars */
}

/* GUTTER */

.CodeMirror-gutters {
  border-right: 1px solid #ddd;
  background-color: #f7f7f7;
  white-space: nowrap;
}
.CodeMirror-linenumbers {}
.CodeMirror-linenumber {
  padding: 0 3px 0 5px;
  min-width: 20px;
  text-align: right;
  color: #999;
  -moz-box-sizing: content-box;
  box-sizing: content-box;
}

.CodeMirror-guttermarker { color: black; }
.CodeMirror-guttermarker-subtle { color: #999; }

/* CURSOR */

.CodeMirror div.CodeMirror-cursor {
  border-left: 1px solid black;
}
/* Shown when moving in bi-directional text */
.CodeMirror div.CodeMirror-secondarycursor {
  border-left: 1px solid silver;
}
.CodeMirror.cm-fat-cursor div.CodeMirror-cursor {
  width: auto;
  border: 0;
  background: #7e7;
}
.CodeMirror.cm-fat-cursor div.CodeMirror-cursors {
  z-index: 1;
}

.cm-animate-fat-cursor {
  width: auto;
  border: 0;
  -webkit-animation: blink 1.06s steps(1) infinite;
  -moz-animation: blink 1.06s steps(1) infinite;
  animation: blink 1.06s steps(1) infinite;
}
@-moz-keyframes blink {
  0% { background: #7e7; }
  50% { background: none; }
  100% { background: #7e7; }
}
@-webkit-keyframes blink {
  0% { background: #7e7; }
  50% { background: none; }
  100% { background: #7e7; }
}
@keyframes blink {
  0% { background: #7e7; }
  50% { background: none; }
  100% { background: #7e7; }
}

/* Can style cursor different in overwrite (non-insert) mode */
div.CodeMirror-overwrite div.CodeMirror-cursor {}

.cm-tab { display: inline-block; text-decoration: inherit; }

.CodeMirror-ruler {
  border-left: 1px solid #ccc;
  position: absolute;
}

/* DEFAULT THEME */

.cm-s-default .cm-keyword {color: #708;}
.cm-s-default .cm-atom {color: #219;}
.cm-s-default .cm-number {color: #164;}
.cm-s-default .cm-def {color: #00f;}
.cm-s-default .cm-variable,
.cm-s-default .cm-punctuation,
.cm-s-default .cm-property,
.cm-s-default .cm-operator {}
.cm-s-default .cm-variable-2 {color: #05a;}
.cm-s-default .cm-variable-3 {color: #085;}
.cm-s-default .cm-comment {color: #a50;}
.cm-s-default .cm-string {color: #a11;}
.cm-s-default .cm-string-2 {color: #f50;}
.cm-s-default .cm-meta {color: #555;}
.cm-s-default .cm-qualifier {color: #555;}
.cm-s-default .cm-builtin {color: #30a;}
.cm-s-default .cm-bracket {color: #997;}
.cm-s-default .cm-tag {color: #170;}
.cm-s-default .cm-attribute {color: #00c;}
.cm-s-default .cm-header {color: blue;}
.cm-s-default .cm-quote {color: #090;}
.cm-s-default .cm-hr {color: #999;}
.cm-s-default .cm-link {color: #00c;}

.cm-negative {color: #d44;}
.cm-positive {color: #292;}
.cm-header, .cm-strong {font-weight: bold;}
.cm-em {font-style: italic;}
.cm-link {text-decoration: underline;}
.cm-strikethrough {text-decoration: line-through;}

.cm-s-default .cm-error {color: #f00;}
.cm-invalidchar {color: #f00;}

/* Default styles for common addons */

div.CodeMirror span.CodeMirror-matchingbracket {color: #0f0;}
div.CodeMirror span.CodeMirror-nonmatchingbracket {color: #f22;}
.CodeMirror-matchingtag { background: rgba(255, 150, 0, .3); }
.CodeMirror-activeline-background {background: #e8f2ff;}

.CodeMirror-foldmarker {
  color: blue;
  text-shadow: #b9f 1px 1px 2px, #b9f -1px -1px 2px, #b9f 1px -1px 2px, #b9f -1px 1px 2px;
  font-family: arial;
  line-height: .3;
  cursor: pointer;
}
.CodeMirror-foldgutter {
  width: .7em;
}
.CodeMirror-foldgutter-open,
.CodeMirror-foldgutter-folded {
  cursor: pointer;
}
.CodeMirror-foldgutter-open:after {
  content: "\25BE";
}
.CodeMirror-foldgutter-folded:after {
  content: "\25B8";
}


/* The lint marker gutter */
.CodeMirror-lint-markers {
  width: 16px;
}

.CodeMirror-lint-tooltip {
  background-color: infobackground;
  border: 1px solid black;
  border-radius: 4px 4px 4px 4px;
  color: infotext;
  font-family: monospace;
  font-size: 10pt;
  overflow: hidden;
  padding: 2px 5px;
  position: fixed;
  white-space: pre;
  white-space: pre-wrap;
  z-index: 100;
  max-width: 600px;
  opacity: 0;
  transition: opacity .4s;
  -moz-transition: opacity .4s;
  -webkit-transition: opacity .4s;
  -o-transition: opacity .4s;
  -ms-transition: opacity .4s;
}

.CodeMirror-lint-mark-error, .CodeMirror-lint-mark-warning {
  background-position: left bottom;
  background-repeat: repeat-x;
}

.CodeMirror-lint-mark-error {
  background-image:
  url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAYAAAC09K7GAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sJDw4cOCW1/KIAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAHElEQVQI12NggIL/DAz/GdA5/xkY/qPKMDAwAADLZwf5rvm+LQAAAABJRU5ErkJggg==")
  ;
}

.CodeMirror-lint-mark-warning {
  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAYAAAC09K7GAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sJFhQXEbhTg7YAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAMklEQVQI12NkgIIvJ3QXMjAwdDN+OaEbysDA4MPAwNDNwMCwiOHLCd1zX07o6kBVGQEAKBANtobskNMAAAAASUVORK5CYII=");
}

.CodeMirror-lint-marker-error, .CodeMirror-lint-marker-warning {
  background-position: center center;
  background-repeat: no-repeat;
  cursor: pointer;
  display: inline-block;
  height: 16px;
  width: 16px;
  vertical-align: middle;
  position: relative;
}

.CodeMirror-lint-message-error, .CodeMirror-lint-message-warning {
  padding-left: 18px;
  background-position: top left;
  background-repeat: no-repeat;
}

.CodeMirror-lint-marker-error, .CodeMirror-lint-message-error {
  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAHlBMVEW7AAC7AACxAAC7AAC7AAAAAAC4AAC5AAD///+7AAAUdclpAAAABnRSTlMXnORSiwCK0ZKSAAAATUlEQVR42mWPOQ7AQAgDuQLx/z8csYRmPRIFIwRGnosRrpamvkKi0FTIiMASR3hhKW+hAN6/tIWhu9PDWiTGNEkTtIOucA5Oyr9ckPgAWm0GPBog6v4AAAAASUVORK5CYII=");
}

.CodeMirror-lint-marker-warning, .CodeMirror-lint-message-warning {
  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAANlBMVEX/uwDvrwD/uwD/uwD/uwD/uwD/uwD/uwD/uwD6twD/uwAAAADurwD2tQD7uAD+ugAAAAD/uwDhmeTRAAAADHRSTlMJ8mN1EYcbmiixgACm7WbuAAAAVklEQVR42n3PUQqAIBBFUU1LLc3u/jdbOJoW1P08DA9Gba8+YWJ6gNJoNYIBzAA2chBth5kLmG9YUoG0NHAUwFXwO9LuBQL1giCQb8gC9Oro2vp5rncCIY8L8uEx5ZkAAAAASUVORK5CYII=");
}

.CodeMirror-lint-marker-multiple {
  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAMAAADzjKfhAAAACVBMVEUAAAAAAAC/v7914kyHAAAAAXRSTlMAQObYZgAAACNJREFUeNo1ioEJAAAIwmz/H90iFFSGJgFMe3gaLZ0od+9/AQZ0ADosbYraAAAAAElFTkSuQmCC");
  background-repeat: no-repeat;
  background-position: right bottom;
  width: 100%; height: 100%;
}


/* STOP */

/* The rest of this file contains styles related to the mechanics of
   the editor. You probably shouldn't touch them. */

.CodeMirror {
  line-height: 1;
  position: relative;
  overflow: hidden;
  background: white;
  color: black;
}

.CodeMirror-scroll {
  overflow: scroll !important; /* Things will break if this is overridden */
  /* 30px is the magic margin used to hide the element's real scrollbars */
  /* See overflow: hidden in .CodeMirror */
  margin-bottom: -30px; margin-right: -30px;
  padding-bottom: 30px;
  height: 100%;
  outline: none; /* Prevent dragging from highlighting the element */
  position: relative;
  -moz-box-sizing: content-box;
  box-sizing: content-box;
}
.CodeMirror-sizer {
  position: relative;
  border-right: 30px solid transparent;
  -moz-box-sizing: content-box;
  box-sizing: content-box;
}

/* The fake, visible scrollbars. Used to force redraw during scrolling
   before actuall scrolling happens, thus preventing shaking and
   flickering artifacts. */
.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {
  position: absolute;
  z-index: 6;
  display: none;
}
.CodeMirror-vscrollbar {
  right: 0; top: 0;
  overflow-x: hidden;
  overflow-y: scroll;
}
.CodeMirror-hscrollbar {
  bottom: 0; left: 0;
  overflow-y: hidden;
  overflow-x: scroll;
}
.CodeMirror-scrollbar-filler {
  right: 0; bottom: 0;
}
.CodeMirror-gutter-filler {
  left: 0; bottom: 0;
}

.CodeMirror-gutters {
  position: absolute; left: 0; top: 0;
  z-index: 3;
}
.CodeMirror-gutter {
  white-space: normal;
  height: 100%;
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  display: inline-block;
  margin-bottom: -30px;
  /* Hack to make IE7 behave */
  *zoom:1;
  *display:inline;
}
.CodeMirror-gutter-wrapper {
  position: absolute;
  z-index: 4;
  height: 100%;
}
.CodeMirror-gutter-elt {
  position: absolute;
  cursor: default;
  z-index: 4;
}

.CodeMirror-lines {
  cursor: text;
  min-height: 1px; /* prevents collapsing before first draw */
}
.CodeMirror pre {
  /* Reset some styles that the rest of the page might have set */
  -moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0;
  border-width: 0;
  background: transparent;
  font-family: inherit;
  font-size: inherit;
  margin: 0;
  white-space: pre;
  word-wrap: normal;
  line-height: inherit;
  color: inherit;
  z-index: 2;
  position: relative;
  overflow: visible;
}
.CodeMirror-wrap pre {
  word-wrap: break-word;
  white-space: pre-wrap;
  word-break: normal;
}

.CodeMirror-linebackground {
  position: absolute;
  left: 0; right: 0; top: 0; bottom: 0;
  z-index: 0;
}

.CodeMirror-linewidget {
  position: relative;
  z-index: 2;
  overflow: auto;
}

.CodeMirror-widget {}

.CodeMirror-measure {
  position: absolute;
  width: 100%;
  height: 0;
  overflow: hidden;
  visibility: hidden;
}
.CodeMirror-measure pre { position: static; }

.CodeMirror div.CodeMirror-cursor {
  position: absolute;
  border-right: none;
  width: 0;
}

div.CodeMirror-cursors {
  visibility: hidden;
  position: relative;
  z-index: 3;
}
.CodeMirror-focused div.CodeMirror-cursors {
  visibility: visible;
}

.CodeMirror-selected { background: #d9d9d9; }
.CodeMirror-focused .CodeMirror-selected { background: #d7d4f0; }
.CodeMirror-crosshair { cursor: crosshair; }

.cm-searching {
  background: #ffa;
  background: rgba(255, 255, 0, .4);
}

/* IE7 hack to prevent it from returning funny offsetTops on the spans */
.CodeMirror span { *vertical-align: text-bottom; }

/* Used to force a border model for a node */
.cm-force-border { padding-right: .1px; }

@media print {
  /* Hide the cursor when printing */
  .CodeMirror div.CodeMirror-cursors {
    visibility: hidden;
  }
}

/* See issue #2901 */
.cm-tab-wrap-hack:after { content: ''; }

/* Help users use markselection to safely style text background */
span.CodeMirror-selectedtext { background: none; }


/* erlang-dark theme */
.cm-s-erlang-dark.CodeMirror { background: #002240; color: white; }
.cm-s-erlang-dark .CodeMirror { background: #002240; color: white; }
.cm-s-erlang-dark div.CodeMirror-selected { background: #b36539 !important; }
.cm-s-erlang-dark .CodeMirror-gutters { background: #002240; border-right: 1px solid #aaa; }
.cm-s-erlang-dark .CodeMirror-guttermarker { color: white; }
.cm-s-erlang-dark .CodeMirror-guttermarker-subtle { color: #d0d0d0; }
.cm-s-erlang-dark .CodeMirror-linenumber { color: #d0d0d0; }
.cm-s-erlang-dark .CodeMirror-cursor { border-left: 1px solid white !important; }

.cm-s-erlang-dark span.cm-atom       { color: #f133f1; }
.cm-s-erlang-dark span.cm-attribute  { color: #ff80e1; }
.cm-s-erlang-dark span.cm-bracket    { color: #ff9d00; }
.cm-s-erlang-dark span.cm-builtin    { color: #eaa; }
.cm-s-erlang-dark span.cm-comment    { color: #77f; }
.cm-s-erlang-dark span.cm-def        { color: #e7a; }
.cm-s-erlang-dark span.cm-keyword    { color: #ffee80; }
.cm-s-erlang-dark span.cm-meta       { color: #50fefe; }
.cm-s-erlang-dark span.cm-number     { color: #ffd0d0; }
.cm-s-erlang-dark span.cm-operator   { color: #d55; }
.cm-s-erlang-dark span.cm-property   { color: #ccc; }
.cm-s-erlang-dark span.cm-qualifier  { color: #ccc; }
.cm-s-erlang-dark span.cm-quote      { color: #ccc; }
.cm-s-erlang-dark span.cm-special    { color: #ffbbbb; }
.cm-s-erlang-dark span.cm-string     { color: #3ad900; }
.cm-s-erlang-dark span.cm-string-2   { color: #ccc; }
.cm-s-erlang-dark span.cm-tag        { color: #9effff; }
.cm-s-erlang-dark span.cm-variable   { color: #50fe50; }
.cm-s-erlang-dark span.cm-variable-2 { color: #e0e; }
.cm-s-erlang-dark span.cm-variable-3 { color: #ccc; }
.cm-s-erlang-dark span.cm-error      { color: #9d1e15; }

.cm-s-erlang-dark .CodeMirror-activeline-background {background: #013461 !important;}
.cm-s-erlang-dark .CodeMirror-matchingbracket {outline:1px solid grey; color:white !important;}
    </style>

    <script type="text/javascript">

// JSHINT
/*!
 * JSHint, by JSHint Community.
 *
 * Licensed under the same slightly modified MIT license that JSLint is.
 * It stops evil-doers everywhere.
 *
 * JSHint is a derivative work of JSLint:
 *
 *   Copyright (c) 2002 Douglas Crockford  (www.JSLint.com)
 *
 *   Permission is hereby granted, free of charge, to any person obtaining
 *   a copy of this software and associated documentation files (the "Software"),
 *   to deal in the Software without restriction, including without limitation
 *   the rights to use, copy, modify, merge, publish, distribute, sublicense,
 *   and/or sell copies of the Software, and to permit persons to whom
 *   the Software is furnished to do so, subject to the following conditions:
 *
 *   The above copyright notice and this permission notice shall be included
 *   in all copies or substantial portions of the Software.
 *
 *   The Software shall be used for Good, not Evil.
 *
 *   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 *   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 *   FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
 *   DEALINGS IN THE SOFTWARE.
 *
 * JSHint was forked from 2010-12-16 edition of JSLint.
 *
 */

/*
 JSHINT is a global function. It takes two parameters.

     var myResult = JSHINT(source, option);

 The first parameter is either a string or an array of strings. If it is a
 string, it will be split on '\n' or '\r'. If it is an array of strings, it
 is assumed that each string represents one line. The source can be a
 JavaScript text or a JSON text.

 The second parameter is an optional object of options which control the
 operation of JSHINT. Most of the options are booleans: They are all
 optional and have a default value of false. One of the options, predef,
 can be an array of names, which will be used to declare global variables,
 or an object whose keys are used as global names, with a boolean value
 that determines if they are assignable.

 If it checks out, JSHINT returns true. Otherwise, it returns false.

 If false, you can inspect JSHINT.errors to find out the problems.
 JSHINT.errors is an array of objects containing these members:

 {
     line      : The line (relative to 0) at which the lint was found
     character : The character (relative to 0) at which the lint was found
     reason    : The problem
     evidence  : The text line in which the problem occurred
     raw       : The raw message before the details were inserted
     a         : The first detail
     b         : The second detail
     c         : The third detail
     d         : The fourth detail
 }

 If a fatal error was found, a null will be the last element of the
 JSHINT.errors array.

 You can request a Function Report, which shows all of the functions
 and the parameters and vars that they use. This can be used to find
 implied global variables and other problems. The report is in HTML and
 can be inserted in an HTML <body>.

     var myReport = JSHINT.report(limited);

 If limited is true, then the report will be limited to only errors.

 You can request a data structure which contains JSHint's results.

     var myData = JSHINT.data();

 It returns a structure with this form:

 {
     errors: [
         {
             line: NUMBER,
             character: NUMBER,
             reason: STRING,
             evidence: STRING
         }
     ],
     functions: [
         name: STRING,
         line: NUMBER,
         last: NUMBER,
         param: [
             STRING
         ],
         closure: [
             STRING
         ],
         var: [
             STRING
         ],
         exception: [
             STRING
         ],
         outer: [
             STRING
         ],
         unused: [
             STRING
         ],
         global: [
             STRING
         ],
         label: [
             STRING
         ]
     ],
     globals: [
         STRING
     ],
     member: {
         STRING: NUMBER
     },
     unused: [
         {
             name: STRING,
             line: NUMBER
         }
     ],
     implieds: [
         {
             name: STRING,
             line: NUMBER
         }
     ],
     urls: [
         STRING
     ],
     json: BOOLEAN
 }

 Empty arrays will not be included.

*/

/*jshint
 evil: true, nomen: false, onevar: false, regexp: false, strict: true, boss: true,
 undef: true, maxlen: 100, indent:4
*/

/*members "\b", "\t", "\n", "\f", "\r", "!=", "!==", "\"", "%", "(begin)",
 "(breakage)", "(context)", "(error)", "(global)", "(identifier)", "(last)",
 "(line)", "(loopage)", "(name)", "(onevar)", "(params)", "(scope)",
 "(statement)", "(verb)", "*", "+", "++", "-", "--", "\/", "<", "<=", "==",
 "===", ">", ">=", $, $$, $A, $F, $H, $R, $break, $continue, $w, Abstract, Ajax,
 __filename, __dirname, ActiveXObject, Array, ArrayBuffer, ArrayBufferView, Audio,
 Autocompleter, Assets, Boolean, Builder, Buffer, Browser, COM, CScript, Canvas,
 CustomAnimation, Class, Control, Chain, Color, Cookie, Core, DataView, Date,
 Debug, Draggable, Draggables, Droppables, Document, DomReady, DOMReady, DOMParser, Drag,
 E, Enumerator, Enumerable, Element, Elements, Error, Effect, EvalError, Event,
 Events, FadeAnimation, Field, Flash, Float32Array, Float64Array, Form,
 FormField, Frame, FormData, Function, Fx, GetObject, Group, Hash, HotKey,
 HTMLElement, HTMLAnchorElement, HTMLBaseElement, HTMLBlockquoteElement,
 HTMLBodyElement, HTMLBRElement, HTMLButtonElement, HTMLCanvasElement, HTMLDirectoryElement,
 HTMLDivElement, HTMLDListElement, HTMLFieldSetElement,
 HTMLFontElement, HTMLFormElement, HTMLFrameElement, HTMLFrameSetElement,
 HTMLHeadElement, HTMLHeadingElement, HTMLHRElement, HTMLHtmlElement,
 HTMLIFrameElement, HTMLImageElement, HTMLInputElement, HTMLIsIndexElement,
 HTMLLabelElement, HTMLLayerElement, HTMLLegendElement, HTMLLIElement,
 HTMLLinkElement, HTMLMapElement, HTMLMenuElement, HTMLMetaElement,
 HTMLModElement, HTMLObjectElement, HTMLOListElement, HTMLOptGroupElement,
 HTMLOptionElement, HTMLParagraphElement, HTMLParamElement, HTMLPreElement,
 HTMLQuoteElement, HTMLScriptElement, HTMLSelectElement, HTMLStyleElement,
 HtmlTable, HTMLTableCaptionElement, HTMLTableCellElement, HTMLTableColElement,
 HTMLTableElement, HTMLTableRowElement, HTMLTableSectionElement,
 HTMLTextAreaElement, HTMLTitleElement, HTMLUListElement, HTMLVideoElement,
 Iframe, IframeShim, Image, Int16Array, Int32Array, Int8Array,
 Insertion, InputValidator, JSON, Keyboard, Locale, LN10, LN2, LOG10E, LOG2E,
 MAX_VALUE, MIN_VALUE, Mask, Math, MenuItem, MessageChannel, MessageEvent, MessagePort,
 MoveAnimation, MooTools, Native, NEGATIVE_INFINITY, Number, Object, ObjectRange, Option,
 Options, OverText, PI, POSITIVE_INFINITY, PeriodicalExecuter, Point, Position, Prototype,
 RangeError, Rectangle, ReferenceError, RegExp, ResizeAnimation, Request, RotateAnimation,
 SQRT1_2, SQRT2, ScrollBar, ScriptEngine, ScriptEngineBuildVersion,
 ScriptEngineMajorVersion, ScriptEngineMinorVersion, Scriptaculous, Scroller,
 Slick, Slider, Selector, SharedWorker, String, Style, SyntaxError, Sortable, Sortables,
 SortableObserver, Sound, Spinner, System, Swiff, Text, TextArea, Template,
 Timer, Tips, Type, TypeError, Toggle, Try, "use strict", unescape, URI, URIError, URL,
 VBArray, WSH, WScript, XDomainRequest, Web, Window, XMLDOM, XMLHttpRequest, XMLSerializer,
 XPathEvaluator, XPathException, XPathExpression, XPathNamespace, XPathNSResolver, XPathResult,
 "\\", a, addEventListener, address, alert, apply, applicationCache, arguments, arity, asi, atob,
 b, basic, basicToken, bitwise, block, blur, boolOptions, boss, browser, btoa, c, call, callee,
 caller, cases, charAt, charCodeAt, character, clearInterval, clearTimeout,
 close, closed, closure, comment, condition, confirm, console, constructor,
 content, couch, create, css, curly, d, data, datalist, dd, debug, decodeURI,
 decodeURIComponent, defaultStatus, defineClass, deserialize, devel, document,
 dojo, dijit, dojox, define, else, emit, encodeURI, encodeURIComponent,
 entityify, eqeq, eqeqeq, eqnull, errors, es5, escape, esnext, eval, event, evidence, evil,
 ex, exception, exec, exps, expr, exports, FileReader, first, floor, focus,
 forin, fragment, frames, from, fromCharCode, fud, funcscope, funct, function, functions,
 g, gc, getComputedStyle, getRow, getter, getterToken, GLOBAL, global, globals, globalstrict,
 hasOwnProperty, help, history, i, id, identifier, immed, implieds, importPackage, include,
 indent, indexOf, init, ins, instanceOf, isAlpha, isApplicationRunning, isArray,
 isDigit, isFinite, isNaN, iterator, java, join, jshint,
 JSHINT, json, jquery, jQuery, keys, label, labelled, last, lastsemic, laxbreak, laxcomma,
 latedef, lbp, led, left, length, line, load, loadClass, localStorage, location,
 log, loopfunc, m, match, maxerr, maxlen, member,message, meta, module, moveBy,
 moveTo, mootools, multistr, name, navigator, new, newcap, noarg, node, noempty, nomen,
 nonew, nonstandard, nud, onbeforeunload, onblur, onerror, onevar, onecase, onfocus,
 onload, onresize, onunload, open, openDatabase, openURL, opener, opera, options, outer, param,
 parent, parseFloat, parseInt, passfail, plusplus, predef, print, process, prompt,
 proto, prototype, prototypejs, provides, push, quit, range, raw, reach, reason, regexp,
 readFile, readUrl, regexdash, removeEventListener, replace, report, require,
 reserved, resizeBy, resizeTo, resolvePath, resumeUpdates, respond, rhino, right,
 runCommand, scroll, screen, scripturl, scrollBy, scrollTo, scrollbar, search, seal,
 send, serialize, sessionStorage, setInterval, setTimeout, setter, setterToken, shift, slice,
 smarttabs, sort, spawn, split, stack, status, start, strict, sub, substr, supernew, shadow,
 supplant, sum, sync, test, toLowerCase, toString, toUpperCase, toint32, token, top, trailing,
 type, typeOf, Uint16Array, Uint32Array, Uint8Array, undef, undefs, unused, urls, validthis,
 value, valueOf, var, vars, version, WebSocket, withstmt, white, window, windows, Worker, wsh*/

/*global exports: false */

// We build the application inside a function so that we produce only a single
// global variable. That function will be invoked immediately, and its return
// value is the JSHINT function itself.

var JSHINT = (function () {
    "use strict";

    var anonname,       // The guessed name for anonymous functions.

// These are operators that should not be used with the ! operator.

        bang = {
            '<'  : true,
            '<=' : true,
            '==' : true,
            '===': true,
            '!==': true,
            '!=' : true,
            '>'  : true,
            '>=' : true,
            '+'  : true,
            '-'  : true,
            '*'  : true,
            '/'  : true,
            '%'  : true
        },

        // These are the JSHint boolean options.
        boolOptions = {
            asi         : true, // if automatic semicolon insertion should be tolerated
            bitwise     : true, // if bitwise operators should not be allowed
            boss        : true, // if advanced usage of assignments should be allowed
            browser     : true, // if the standard browser globals should be predefined
            couch       : true, // if CouchDB globals should be predefined
            curly       : true, // if curly braces around all blocks should be required
            debug       : true, // if debugger statements should be allowed
            devel       : true, // if logging globals should be predefined (console,
                                // alert, etc.)
            dojo        : true, // if Dojo Toolkit globals should be predefined
            eqeqeq      : true, // if === should be required
            eqnull      : true, // if == null comparisons should be tolerated
            es5         : true, // if ES5 syntax should be allowed
            esnext      : true, // if es.next specific syntax should be allowed
            evil        : true, // if eval should be allowed
            expr        : true, // if ExpressionStatement should be allowed as Programs
            forin       : true, // if for in statements must filter
            funcscope   : true, // if only function scope should be used for scope tests
            globalstrict: true, // if global "use strict"; should be allowed (also
                                // enables 'strict')
            immed       : true, // if immediate invocations must be wrapped in parens
            iterator    : true, // if the `__iterator__` property should be allowed
            jquery      : true, // if jQuery globals should be predefined
            lastsemic   : true, // if semicolons may be ommitted for the trailing
                                // statements inside of a one-line blocks.
            latedef     : true, // if the use before definition should not be tolerated
            laxbreak    : true, // if line breaks should not be checked
            laxcomma    : true, // if line breaks should not be checked around commas
            loopfunc    : true, // if functions should be allowed to be defined within
                                // loops
            mootools    : true, // if MooTools globals should be predefined
            multistr    : true, // allow multiline strings
            newcap      : true, // if constructor names must be capitalized
            noarg       : true, // if arguments.caller and arguments.callee should be
                                // disallowed
            node        : true, // if the Node.js environment globals should be
                                // predefined
            noempty     : true, // if empty blocks should be disallowed
            nonew       : true, // if using `new` for side-effects should be disallowed
            nonstandard : true, // if non-standard (but widely adopted) globals should
                                // be predefined
            nomen       : true, // if names should be checked
            onevar      : true, // if only one var statement per function should be
                                // allowed
            onecase     : true, // if one case switch statements should be allowed
            passfail    : true, // if the scan should stop on first error
            plusplus    : true, // if increment/decrement should not be allowed
            proto       : true, // if the `__proto__` property should be allowed
            prototypejs : true, // if Prototype and Scriptaculous globals should be
                                // predefined
            regexdash   : true, // if unescaped first/last dash (-) inside brackets
                                // should be tolerated
            regexp      : true, // if the . should not be allowed in regexp literals
            rhino       : true, // if the Rhino environment globals should be predefined
            undef       : true, // if variables should be declared before used
            scripturl   : true, // if script-targeted URLs should be tolerated
            shadow      : true, // if variable shadowing should be tolerated
            smarttabs   : true, // if smarttabs should be tolerated
                                // (http://www.emacswiki.org/emacs/SmartTabs)
            strict      : true, // require the "use strict"; pragma
            sub         : true, // if all forms of subscript notation are tolerated
            supernew    : true, // if `new function () { ... };` and `new Object;`
                                // should be tolerated
            trailing    : true, // if trailing whitespace rules apply
            validthis   : true, // if 'this' inside a non-constructor function is valid.
                                // This is a function scoped option only.
            withstmt    : true, // if with statements should be allowed
            white       : true, // if strict whitespace rules apply
            wsh         : true  // if the Windows Scripting Host environment globals
                                // should be predefined
        },

        // These are the JSHint options that can take any value
        // (we use this object to detect invalid options)
        valOptions = {
            maxlen: false,
            indent: false,
            maxerr: false,
            predef: false
        },

        // These are JSHint boolean options which are shared with JSLint
        // where the definition in JSHint is opposite JSLint
        invertedOptions = {
            bitwise     : true,
            forin       : true,
            newcap      : true,
            nomen       : true,
            plusplus    : true,
            regexp      : true,
            undef       : true,
            white       : true,

            // Inverted and renamed, use JSHint name here
            eqeqeq      : true,
            onevar      : true
        },

        // These are JSHint boolean options which are shared with JSLint
        // where the name has been changed but the effect is unchanged
        renamedOptions = {
            eqeq        : "eqeqeq",
            vars        : "onevar",
            windows     : "wsh"
        },


        // browser contains a set of global names which are commonly provided by a
        // web browser environment.
        browser = {
            ArrayBuffer              :  false,
            ArrayBufferView          :  false,
            Audio                    :  false,
            addEventListener         :  false,
            applicationCache         :  false,
            atob                     :  false,
            blur                     :  false,
            btoa                     :  false,
            clearInterval            :  false,
            clearTimeout             :  false,
            close                    :  false,
            closed                   :  false,
            DataView                 :  false,
            DOMParser                :  false,
            defaultStatus            :  false,
            document                 :  false,
            event                    :  false,
            FileReader               :  false,
            Float32Array             :  false,
            Float64Array             :  false,
            FormData                 :  false,
            focus                    :  false,
            frames                   :  false,
            getComputedStyle         :  false,
            HTMLElement              :  false,
            HTMLAnchorElement        :  false,
            HTMLBaseElement          :  false,
            HTMLBlockquoteElement    :  false,
            HTMLBodyElement          :  false,
            HTMLBRElement            :  false,
            HTMLButtonElement        :  false,
            HTMLCanvasElement        :  false,
            HTMLDirectoryElement     :  false,
            HTMLDivElement           :  false,
            HTMLDListElement         :  false,
            HTMLFieldSetElement      :  false,
            HTMLFontElement          :  false,
            HTMLFormElement          :  false,
            HTMLFrameElement         :  false,
            HTMLFrameSetElement      :  false,
            HTMLHeadElement          :  false,
            HTMLHeadingElement       :  false,
            HTMLHRElement            :  false,
            HTMLHtmlElement          :  false,
            HTMLIFrameElement        :  false,
            HTMLImageElement         :  false,
            HTMLInputElement         :  false,
            HTMLIsIndexElement       :  false,
            HTMLLabelElement         :  false,
            HTMLLayerElement         :  false,
            HTMLLegendElement        :  false,
            HTMLLIElement            :  false,
            HTMLLinkElement          :  false,
            HTMLMapElement           :  false,
            HTMLMenuElement          :  false,
            HTMLMetaElement          :  false,
            HTMLModElement           :  false,
            HTMLObjectElement        :  false,
            HTMLOListElement         :  false,
            HTMLOptGroupElement      :  false,
            HTMLOptionElement        :  false,
            HTMLParagraphElement     :  false,
            HTMLParamElement         :  false,
            HTMLPreElement           :  false,
            HTMLQuoteElement         :  false,
            HTMLScriptElement        :  false,
            HTMLSelectElement        :  false,
            HTMLStyleElement         :  false,
            HTMLTableCaptionElement  :  false,
            HTMLTableCellElement     :  false,
            HTMLTableColElement      :  false,
            HTMLTableElement         :  false,
            HTMLTableRowElement      :  false,
            HTMLTableSectionElement  :  false,
            HTMLTextAreaElement      :  false,
            HTMLTitleElement         :  false,
            HTMLUListElement         :  false,
            HTMLVideoElement         :  false,
            history                  :  false,
            Int16Array               :  false,
            Int32Array               :  false,
            Int8Array                :  false,
            Image                    :  false,
            length                   :  false,
            localStorage             :  false,
            location                 :  false,
            MessageChannel           :  false,
            MessageEvent             :  false,
            MessagePort              :  false,
            moveBy                   :  false,
            moveTo                   :  false,
            name                     :  false,
            navigator                :  false,
            onbeforeunload           :  true,
            onblur                   :  true,
            onerror                  :  true,
            onfocus                  :  true,
            onload                   :  true,
            onresize                 :  true,
            onunload                 :  true,
            open                     :  false,
            openDatabase             :  false,
            opener                   :  false,
            Option                   :  false,
            parent                   :  false,
            print                    :  false,
            removeEventListener      :  false,
            resizeBy                 :  false,
            resizeTo                 :  false,
            screen                   :  false,
            scroll                   :  false,
            scrollBy                 :  false,
            scrollTo                 :  false,
            sessionStorage           :  false,
            setInterval              :  false,
            setTimeout               :  false,
            SharedWorker             :  false,
            status                   :  false,
            top                      :  false,
            Uint16Array              :  false,
            Uint32Array              :  false,
            Uint8Array               :  false,
            WebSocket                :  false,
            window                   :  false,
            Worker                   :  false,
            XMLHttpRequest           :  false,
            XMLSerializer            :  false,
            XPathEvaluator           :  false,
            XPathException           :  false,
            XPathExpression          :  false,
            XPathNamespace           :  false,
            XPathNSResolver          :  false,
            XPathResult              :  false
        },

        couch = {
            "require" : false,
            respond   : false,
            getRow    : false,
            emit      : false,
            send      : false,
            start     : false,
            sum       : false,
            log       : false,
            exports   : false,
            module    : false,
            provides  : false
        },

        devel = {
            alert   : false,
            confirm : false,
            console : false,
            Debug   : false,
            opera   : false,
            prompt  : false
        },

        dojo = {
            dojo      : false,
            dijit     : false,
            dojox     : false,
            define    : false,
            "require" : false
        },

        escapes = {
            '\b': '\\b',
            '\t': '\\t',
            '\n': '\\n',
            '\f': '\\f',
            '\r': '\\r',
            '"' : '\\"',
            '/' : '\\/',
            '\\': '\\\\'
        },

        funct,          // The current function

        functionicity = [
            'closure', 'exception', 'global', 'label',
            'outer', 'unused', 'var'
        ],

        functions,      // All of the functions

        global,         // The global scope
        implied,        // Implied globals
        inblock,
        indent,
        jsonmode,

        jquery = {
            '$'    : false,
            jQuery : false
        },

        lines,
        lookahead,
        member,
        membersOnly,

        mootools = {
            '$'             : false,
            '$$'            : false,
            Assets          : false,
            Browser         : false,
            Chain           : false,
            Class           : false,
            Color           : false,
            Cookie          : false,
            Core            : false,
            Document        : false,
            DomReady        : false,
            DOMReady        : false,
            Drag            : false,
            Element         : false,
            Elements        : false,
            Event           : false,
            Events          : false,
            Fx              : false,
            Group           : false,
            Hash            : false,
            HtmlTable       : false,
            Iframe          : false,
            IframeShim      : false,
            InputValidator  : false,
            instanceOf      : false,
            Keyboard        : false,
            Locale          : false,
            Mask            : false,
            MooTools        : false,
            Native          : false,
            Options         : false,
            OverText        : false,
            Request         : false,
            Scroller        : false,
            Slick           : false,
            Slider          : false,
            Sortables       : false,
            Spinner         : false,
            Swiff           : false,
            Tips            : false,
            Type            : false,
            typeOf          : false,
            URI             : false,
            Window          : false
        },

        nexttoken,

        node = {
            __filename    : false,
            __dirname     : false,
            Buffer        : false,
            console       : false,
            exports       : false,
            GLOBAL        : false,
            global        : false,
            module        : false,
            process       : false,
            require       : false,
            setTimeout    : false,
            clearTimeout  : false,
            setInterval   : false,
            clearInterval : false
        },

        noreach,
        option,
        predefined,     // Global variables defined by option
        prereg,
        prevtoken,

        prototypejs = {
            '$'               : false,
            '$$'              : false,
            '$A'              : false,
            '$F'              : false,
            '$H'              : false,
            '$R'              : false,
            '$break'          : false,
            '$continue'       : false,
            '$w'              : false,
            Abstract          : false,
            Ajax              : false,
            Class             : false,
            Enumerable        : false,
            Element           : false,
            Event             : false,
            Field             : false,
            Form              : false,
            Hash              : false,
            Insertion         : false,
            ObjectRange       : false,
            PeriodicalExecuter: false,
            Position          : false,
            Prototype         : false,
            Selector          : false,
            Template          : false,
            Toggle            : false,
            Try               : false,
            Autocompleter     : false,
            Builder           : false,
            Control           : false,
            Draggable         : false,
            Draggables        : false,
            Droppables        : false,
            Effect            : false,
            Sortable          : false,
            SortableObserver  : false,
            Sound             : false,
            Scriptaculous     : false
        },

        rhino = {
            defineClass  : false,
            deserialize  : false,
            gc           : false,
            help         : false,
            importPackage: false,
            "java"       : false,
            load         : false,
            loadClass    : false,
            print        : false,
            quit         : false,
            readFile     : false,
            readUrl      : false,
            runCommand   : false,
            seal         : false,
            serialize    : false,
            spawn        : false,
            sync         : false,
            toint32      : false,
            version      : false
        },

        scope,      // The current scope
        stack,

        // standard contains the global names that are provided by the
        // ECMAScript standard.
        standard = {
            Array               : false,
            Boolean             : false,
            Date                : false,
            decodeURI           : false,
            decodeURIComponent  : false,
            encodeURI           : false,
            encodeURIComponent  : false,
            Error               : false,
            'eval'              : false,
            EvalError           : false,
            Function            : false,
            hasOwnProperty      : false,
            isFinite            : false,
            isNaN               : false,
            JSON                : false,
            Math                : false,
            Number              : false,
            Object              : false,
            parseInt            : false,
            parseFloat          : false,
            RangeError          : false,
            ReferenceError      : false,
            RegExp              : false,
            String              : false,
            SyntaxError         : false,
            TypeError           : false,
            URIError            : false
        },

        // widely adopted global names that are not part of ECMAScript standard
        nonstandard = {
            escape              : false,
            unescape            : false
        },

        standard_member = {
            E                   : true,
            LN2                 : true,
            LN10                : true,
            LOG2E               : true,
            LOG10E              : true,
            MAX_VALUE           : true,
            MIN_VALUE           : true,
            NEGATIVE_INFINITY   : true,
            PI                  : true,
            POSITIVE_INFINITY   : true,
            SQRT1_2             : true,
            SQRT2               : true
        },

        directive,
        syntax = {},
        tab,
        token,
        urls,
        useESNextSyntax,
        warnings,

        wsh = {
            ActiveXObject             : true,
            Enumerator                : true,
            GetObject                 : true,
            ScriptEngine              : true,
            ScriptEngineBuildVersion  : true,
            ScriptEngineMajorVersion  : true,
            ScriptEngineMinorVersion  : true,
            VBArray                   : true,
            WSH                       : true,
            WScript                   : true,
            XDomainRequest            : true
        };

    // Regular expressions. Some of these are stupidly long.
    var ax, cx, tx, nx, nxg, lx, ix, jx, ft;
    (function () {
        /*jshint maxlen:300 */

        // unsafe comment or string
        ax = /@cc|<\/?|script|\]\s*\]|<\s*!|&lt/i;

        // unsafe characters that are silently deleted by one or more browsers
        cx = /[\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/;

        // token
        tx = /^\s*([(){}\[.,:;'"~\?\]#@]|==?=?|\/(\*(jshint|jslint|members?|global)?|=|\/)?|\*[\/=]?|\+(?:=|\++)?|-(?:=|-+)?|%=?|&[&=]?|\|[|=]?|>>?>?=?|<([\/=!]|\!(\[|--)?|<=?)?|\^=?|\!=?=?|[a-zA-Z_$][a-zA-Z0-9_$]*|[0-9]+([xX][0-9a-fA-F]+|\.[0-9]*)?([eE][+\-]?[0-9]+)?)/;

        // characters in strings that need escapement
        nx = /[\u0000-\u001f&<"\/\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/;
        nxg = /[\u0000-\u001f&<"\/\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;

        // star slash
        lx = /\*\/|\/\*/;

        // identifier
        ix = /^([a-zA-Z_$][a-zA-Z0-9_$]*)$/;

        // javascript url
        jx = /^(?:javascript|jscript|ecmascript|vbscript|mocha|livescript)\s*:/i;

        // catches /* falls through */ comments
        ft = /^\s*\/\*\s*falls\sthrough\s*\*\/\s*$/;
    }());

    function F() {}     // Used by Object.create

    function is_own(object, name) {

// The object.hasOwnProperty method fails when the property under consideration
// is named 'hasOwnProperty'. So we have to use this more convoluted form.

        return Object.prototype.hasOwnProperty.call(object, name);
    }

    function checkOption(name, t) {
        if (valOptions[name] === undefined && boolOptions[name] === undefined) {
            warning("Bad option: '" + name + "'.", t);
        }
    }

// Provide critical ES5 functions to ES3.

    if (typeof Array.isArray !== 'function') {
        Array.isArray = function (o) {
            return Object.prototype.toString.apply(o) === '[object Array]';
        };
    }

    if (typeof Object.create !== 'function') {
        Object.create = function (o) {
            F.prototype = o;
            return new F();
        };
    }

    if (typeof Object.keys !== 'function') {
        Object.keys = function (o) {
            var a = [], k;
            for (k in o) {
                if (is_own(o, k)) {
                    a.push(k);
                }
            }
            return a;
        };
    }

// Non standard methods

    if (typeof String.prototype.entityify !== 'function') {
        String.prototype.entityify = function () {
            return this
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');
        };
    }

    if (typeof String.prototype.isAlpha !== 'function') {
        String.prototype.isAlpha = function () {
            return (this >= 'a' && this <= 'z\uffff') ||
                (this >= 'A' && this <= 'Z\uffff');
        };
    }

    if (typeof String.prototype.isDigit !== 'function') {
        String.prototype.isDigit = function () {
            return (this >= '0' && this <= '9');
        };
    }

    if (typeof String.prototype.supplant !== 'function') {
        String.prototype.supplant = function (o) {
            return this.replace(/\{([^{}]*)\}/g, function (a, b) {
                var r = o[b];
                return typeof r === 'string' || typeof r === 'number' ? r : a;
            });
        };
    }

    if (typeof String.prototype.name !== 'function') {
        String.prototype.name = function () {

// If the string looks like an identifier, then we can return it as is.
// If the string contains no control characters, no quote characters, and no
// backslash characters, then we can simply slap some quotes around it.
// Otherwise we must also replace the offending characters with safe
// sequences.

            if (ix.test(this)) {
                return this;
            }
            if (nx.test(this)) {
                return '"' + this.replace(nxg, function (a) {
                    var c = escapes[a];
                    if (c) {
                        return c;
                    }
                    return '\\u' + ('0000' + a.charCodeAt().toString(16)).slice(-4);
                }) + '"';
            }
            return '"' + this + '"';
        };
    }


    function combine(t, o) {
        var n;
        for (n in o) {
            if (is_own(o, n)) {
                t[n] = o[n];
            }
        }
    }

    function assume() {
        if (option.couch) {
            combine(predefined, couch);
        }

        if (option.rhino) {
            combine(predefined, rhino);
        }

        if (option.prototypejs) {
            combine(predefined, prototypejs);
        }

        if (option.node) {
            combine(predefined, node);
            option.globalstrict = true;
        }

        if (option.devel) {
            combine(predefined, devel);
        }

        if (option.dojo) {
            combine(predefined, dojo);
        }

        if (option.browser) {
            combine(predefined, browser);
        }

        if (option.nonstandard) {
            combine(predefined, nonstandard);
        }

        if (option.jquery) {
            combine(predefined, jquery);
        }

        if (option.mootools) {
            combine(predefined, mootools);
        }

        if (option.wsh) {
            combine(predefined, wsh);
        }

        if (option.esnext) {
            useESNextSyntax();
        }

        if (option.globalstrict && option.strict !== false) {
            option.strict = true;
        }
    }


    // Produce an error warning.
    function quit(message, line, chr) {
        var percentage = Math.floor((line / lines.length) * 100);

        throw {
            name: 'JSHintError',
            line: line,
            character: chr,
            message: message + " (" + percentage + "% scanned).",
            raw: message
        };
    }

    function isundef(scope, m, t, a) {
        return JSHINT.undefs.push([scope, m, t, a]);
    }

    function warning(m, t, a, b, c, d) {
        var ch, l, w;
        t = t || nexttoken;
        if (t.id === '(end)') {  // `~
            t = token;
        }
        l = t.line || 0;
        ch = t.from || 0;
        w = {
            id: '(error)',
            raw: m,
            evidence: lines[l - 1] || '',
            line: l,
            character: ch,
            a: a,
            b: b,
            c: c,
            d: d
        };
        w.reason = m.supplant(w);
        JSHINT.errors.push(w);
        if (option.passfail) {
            quit('Stopping. ', l, ch);
        }
        warnings += 1;
        if (warnings >= option.maxerr) {
            quit("Too many errors.", l, ch);
        }
        return w;
    }

    function warningAt(m, l, ch, a, b, c, d) {
        return warning(m, {
            line: l,
            from: ch
        }, a, b, c, d);
    }

    function error(m, t, a, b, c, d) {
        var w = warning(m, t, a, b, c, d);
    }

    function errorAt(m, l, ch, a, b, c, d) {
        return error(m, {
            line: l,
            from: ch
        }, a, b, c, d);
    }



// lexical analysis and token construction

    var lex = (function lex() {
        var character, from, line, s;

// Private lex methods

        function nextLine() {
            var at,
                tw; // trailing whitespace check

            if (line >= lines.length)
                return false;

            character = 1;
            s = lines[line];
            line += 1;

            // If smarttabs option is used check for spaces followed by tabs only.
            // Otherwise check for any occurence of mixed tabs and spaces.
            if (option.smarttabs)
                at = s.search(/ \t/);
            else
                at = s.search(/ \t|\t /);

            if (at >= 0)
                warningAt("Mixed spaces and tabs.", line, at + 1);

            s = s.replace(/\t/g, tab);
            at = s.search(cx);

            if (at >= 0)
                warningAt("Unsafe character.", line, at);

            if (option.maxlen && option.maxlen < s.length)
                warningAt("Line too long.", line, s.length);

            // Check for trailing whitespaces
            tw = option.trailing && s.match(/^(.*?)\s+$/);
            if (tw && !/^\s+$/.test(s)) {
                warningAt("Trailing whitespace.", line, tw[1].length + 1);
            }
            return true;
        }

// Produce a token object.  The token inherits from a syntax symbol.

        function it(type, value) {
            var i, t;
            if (type === '(color)' || type === '(range)') {
                t = {type: type};
            } else if (type === '(punctuator)' ||
                    (type === '(identifier)' && is_own(syntax, value))) {
                t = syntax[value] || syntax['(error)'];
            } else {
                t = syntax[type];
            }
            t = Object.create(t);
            if (type === '(string)' || type === '(range)') {
                if (!option.scripturl && jx.test(value)) {
                    warningAt("Script URL.", line, from);
                }
            }
            if (type === '(identifier)') {
                t.identifier = true;
                if (value === '__proto__' && !option.proto) {
                    warningAt("The '{a}' property is deprecated.",
                        line, from, value);
                } else if (value === '__iterator__' && !option.iterator) {
                    warningAt("'{a}' is only available in JavaScript 1.7.",
                        line, from, value);
                } else if (option.nomen && (value.charAt(0) === '_' ||
                         value.charAt(value.length - 1) === '_')) {
                    if (!option.node || token.id === '.' ||
                            (value !== '__dirname' && value !== '__filename')) {
                        warningAt("Unexpected {a} in '{b}'.", line, from, "dangling '_'", value);
                    }
                }
            }
            t.value = value;
            t.line = line;
            t.character = character;
            t.from = from;
            i = t.id;
            if (i !== '(endline)') {
                prereg = i &&
                    (('(,=:[!&|?{};'.indexOf(i.charAt(i.length - 1)) >= 0) ||
                    i === 'return' ||
                    i === 'case');
            }
            return t;
        }

        // Public lex methods
        return {
            init: function (source) {
                if (typeof source === 'string') {
                    lines = source
                        .replace(/\r\n/g, '\n')
                        .replace(/\r/g, '\n')
                        .split('\n');
                } else {
                    lines = source;
                }

                // If the first line is a shebang (#!), make it a blank and move on.
                // Shebangs are used by Node scripts.
                if (lines[0] && lines[0].substr(0, 2) === '#!')
                    lines[0] = '';

                line = 0;
                nextLine();
                from = 1;
            },

            range: function (begin, end) {
                var c, value = '';
                from = character;
                if (s.charAt(0) !== begin) {
                    errorAt("Expected '{a}' and instead saw '{b}'.",
                            line, character, begin, s.charAt(0));
                }
                for (;;) {
                    s = s.slice(1);
                    character += 1;
                    c = s.charAt(0);
                    switch (c) {
                    case '':
                        errorAt("Missing '{a}'.", line, character, c);
                        break;
                    case end:
                        s = s.slice(1);
                        character += 1;
                        return it('(range)', value);
                    case '\\':
                        warningAt("Unexpected '{a}'.", line, character, c);
                    }
                    value += c;
                }

            },


            // token -- this is called by advance to get the next token
            token: function () {
                var b, c, captures, d, depth, high, i, l, low, q, t, isLiteral, isInRange, n;

                function match(x) {
                    var r = x.exec(s), r1;
                    if (r) {
                        l = r[0].length;
                        r1 = r[1];
                        c = r1.charAt(0);
                        s = s.substr(l);
                        from = character + l - r1.length;
                        character += l;
                        return r1;
                    }
                }

                function string(x) {
                    var c, j, r = '', allowNewLine = false;

                    if (jsonmode && x !== '"') {
                        warningAt("Strings must use doublequote.",
                                line, character);
                    }

                    function esc(n) {
                        var i = parseInt(s.substr(j + 1, n), 16);
                        j += n;
                        if (i >= 32 && i <= 126 &&
                                i !== 34 && i !== 92 && i !== 39) {
                            warningAt("Unnecessary escapement.", line, character);
                        }
                        character += n;
                        c = String.fromCharCode(i);
                    }
                    j = 0;
unclosedString:     for (;;) {
                        while (j >= s.length) {
                            j = 0;

                            var cl = line, cf = from;
                            if (!nextLine()) {
                                errorAt("Unclosed string.", cl, cf);
                                break unclosedString;
                            }

                            if (allowNewLine) {
                                allowNewLine = false;
                            } else {
                                warningAt("Unclosed string.", cl, cf);
                            }
                        }
                        c = s.charAt(j);
                        if (c === x) {
                            character += 1;
                            s = s.substr(j + 1);
                            return it('(string)', r, x);
                        }
                        if (c < ' ') {
                            if (c === '\n' || c === '\r') {
                                break;
                            }
                            warningAt("Control character in string: {a}.",
                                    line, character + j, s.slice(0, j));
                        } else if (c === '\\') {
                            j += 1;
                            character += 1;
                            c = s.charAt(j);
                            n = s.charAt(j + 1);
                            switch (c) {
                            case '\\':
                            case '"':
                            case '/':
                                break;
                            case '\'':
                                if (jsonmode) {
                                    warningAt("Avoid \\'.", line, character);
                                }
                                break;
                            case 'b':
                                c = '\b';
                                break;
                            case 'f':
                                c = '\f';
                                break;
                            case 'n':
                                c = '\n';
                                break;
                            case 'r':
                                c = '\r';
                                break;
                            case 't':
                                c = '\t';
                                break;
                            case '0':
                                c = '\0';
                                // Octal literals fail in strict mode
                                // check if the number is between 00 and 07
                                // where 'n' is the token next to 'c'
                                if (n >= 0 && n <= 7 && directive["use strict"]) {
                                    warningAt(
                                    "Octal literals are not allowed in strict mode.",
                                    line, character);
                                }
                                break;
                            case 'u':
                                esc(4);
                                break;
                            case 'v':
                                if (jsonmode) {
                                    warningAt("Avoid \\v.", line, character);
                                }
                                c = '\v';
                                break;
                            case 'x':
                                if (jsonmode) {
                                    warningAt("Avoid \\x-.", line, character);
                                }
                                esc(2);
                                break;
                            case '':
                                // last character is escape character
                                // always allow new line if escaped, but show
                                // warning if option is not set
                                allowNewLine = true;
                                if (option.multistr) {
                                    if (jsonmode) {
                                        warningAt("Avoid EOL escapement.", line, character);
                                    }
                                    c = '';
                                    character -= 1;
                                    break;
                                }
                                warningAt("Bad escapement of EOL. Use option multistr if needed.",
                                    line, character);
                                break;
                            default:
                                warningAt("Bad escapement.", line, character);
                            }
                        }
                        r += c;
                        character += 1;
                        j += 1;
                    }
                }

                for (;;) {
                    if (!s) {
                        return it(nextLine() ? '(endline)' : '(end)', '');
                    }
                    t = match(tx);
                    if (!t) {
                        t = '';
                        c = '';
                        while (s && s < '!') {
                            s = s.substr(1);
                        }
                        if (s) {
                            errorAt("Unexpected '{a}'.", line, character, s.substr(0, 1));
                            s = '';
                        }
                    } else {

    //      identifier

                        if (c.isAlpha() || c === '_' || c === '$') {
                            return it('(identifier)', t);
                        }

    //      number

                        if (c.isDigit()) {
                            if (!isFinite(Number(t))) {
                                warningAt("Bad number '{a}'.",
                                    line, character, t);
                            }
                            if (s.substr(0, 1).isAlpha()) {
                                warningAt("Missing space after '{a}'.",
                                        line, character, t);
                            }
                            if (c === '0') {
                                d = t.substr(1, 1);
                                if (d.isDigit()) {
                                    if (token.id !== '.') {
                                        warningAt("Don't use extra leading zeros '{a}'.",
                                            line, character, t);
                                    }
                                } else if (jsonmode && (d === 'x' || d === 'X')) {
                                    warningAt("Avoid 0x-. '{a}'.",
                                            line, character, t);
                                }
                            }
                            if (t.substr(t.length - 1) === '.') {
                                warningAt(
"A trailing decimal point can be confused with a dot '{a}'.", line, character, t);
                            }
                            return it('(number)', t);
                        }
                        switch (t) {

    //      string

                        case '"':
                        case "'":
                            return string(t);

    //      // comment

                        case '//':
                            s = '';
                            token.comment = true;
                            break;

    //      /* comment

                        case '/*':
                            for (;;) {
                                i = s.search(lx);
                                if (i >= 0) {
                                    break;
                                }
                                if (!nextLine()) {
                                    errorAt("Unclosed comment.", line, character);
                                }
                            }
                            character += i + 2;
                            if (s.substr(i, 1) === '/') {
                                errorAt("Nested comment.", line, character);
                            }
                            s = s.substr(i + 2);
                            token.comment = true;
                            break;

    //      /*members /*jshint /*global

                        case '/*members':
                        case '/*member':
                        case '/*jshint':
                        case '/*jslint':
                        case '/*global':
                        case '*/':
                            return {
                                value: t,
                                type: 'special',
                                line: line,
                                character: character,
                                from: from
                            };

                        case '':
                            break;
    //      /
                        case '/':
                            if (token.id === '/=') {
                                errorAt("A regular expression literal can be confused with '/='.",
                                    line, from);
                            }
                            if (prereg) {
                                depth = 0;
                                captures = 0;
                                l = 0;
                                for (;;) {
                                    b = true;
                                    c = s.charAt(l);
                                    l += 1;
                                    switch (c) {
                                    case '':
                                        errorAt("Unclosed regular expression.", line, from);
                                        return quit('Stopping.', line, from);
                                    case '/':
                                        if (depth > 0) {
                                            warningAt("{a} unterminated regular expression " +
                                                "group(s).", line, from + l, depth);
                                        }
                                        c = s.substr(0, l - 1);
                                        q = {
                                            g: true,
                                            i: true,
                                            m: true
                                        };
                                        while (q[s.charAt(l)] === true) {
                                            q[s.charAt(l)] = false;
                                            l += 1;
                                        }
                                        character += l;
                                        s = s.substr(l);
                                        q = s.charAt(0);
                                        if (q === '/' || q === '*') {
                                            errorAt("Confusing regular expression.",
                                                    line, from);
                                        }
                                        return it('(regexp)', c);
                                    case '\\':
                                        c = s.charAt(l);
                                        if (c < ' ') {
                                            warningAt(
"Unexpected control character in regular expression.", line, from + l);
                                        } else if (c === '<') {
                                            warningAt(
"Unexpected escaped character '{a}' in regular expression.", line, from + l, c);
                                        }
                                        l += 1;
                                        break;
                                    case '(':
                                        depth += 1;
                                        b = false;
                                        if (s.charAt(l) === '?') {
                                            l += 1;
                                            switch (s.charAt(l)) {
                                            case ':':
                                            case '=':
                                            case '!':
                                                l += 1;
                                                break;
                                            default:
                                                warningAt(
"Expected '{a}' and instead saw '{b}'.", line, from + l, ':', s.charAt(l));
                                            }
                                        } else {
                                            captures += 1;
                                        }
                                        break;
                                    case '|':
                                        b = false;
                                        break;
                                    case ')':
                                        if (depth === 0) {
                                            warningAt("Unescaped '{a}'.",
                                                    line, from + l, ')');
                                        } else {
                                            depth -= 1;
                                        }
                                        break;
                                    case ' ':
                                        q = 1;
                                        while (s.charAt(l) === ' ') {
                                            l += 1;
                                            q += 1;
                                        }
                                        if (q > 1) {
                                            warningAt(
"Spaces are hard to count. Use {{a}}.", line, from + l, q);
                                        }
                                        break;
                                    case '[':
                                        c = s.charAt(l);
                                        if (c === '^') {
                                            l += 1;
                                            if (option.regexp) {
                                                warningAt("Insecure '{a}'.",
                                                        line, from + l, c);
                                            } else if (s.charAt(l) === ']') {
                                                errorAt("Unescaped '{a}'.",
                                                    line, from + l, '^');
                                            }
                                        }
                                        if (c === ']') {
                                            warningAt("Empty class.", line,
                                                    from + l - 1);
                                        }
                                        isLiteral = false;
                                        isInRange = false;
klass:                                  do {
                                            c = s.charAt(l);
                                            l += 1;
                                            switch (c) {
                                            case '[':
                                            case '^':
                                                warningAt("Unescaped '{a}'.",
                                                        line, from + l, c);
                                                if (isInRange) {
                                                    isInRange = false;
                                                } else {
                                                    isLiteral = true;
                                                }
                                                break;
                                            case '-':
                                                if (isLiteral && !isInRange) {
                                                    isLiteral = false;
                                                    isInRange = true;
                                                } else if (isInRange) {
                                                    isInRange = false;
                                                } else if (s.charAt(l) === ']') {
                                                    isInRange = true;
                                                } else {
                                                    if (option.regexdash !== (l === 2 || (l === 3 &&
                                                        s.charAt(1) === '^'))) {
                                                        warningAt("Unescaped '{a}'.",
                                                            line, from + l - 1, '-');
                                                    }
                                                    isLiteral = true;
                                                }
                                                break;
                                            case ']':
                                                if (isInRange && !option.regexdash) {
                                                    warningAt("Unescaped '{a}'.",
                                                            line, from + l - 1, '-');
                                                }
                                                break klass;
                                            case '\\':
                                                c = s.charAt(l);
                                                if (c < ' ') {
                                                    warningAt(
"Unexpected control character in regular expression.", line, from + l);
                                                } else if (c === '<') {
                                                    warningAt(
"Unexpected escaped character '{a}' in regular expression.", line, from + l, c);
                                                }
                                                l += 1;

                                                // \w, \s and \d are never part of a character range
                                                if (/[wsd]/i.test(c)) {
                                                    if (isInRange) {
                                                        warningAt("Unescaped '{a}'.",
                                                            line, from + l, '-');
                                                        isInRange = false;
                                                    }
                                                    isLiteral = false;
                                                } else if (isInRange) {
                                                    isInRange = false;
                                                } else {
                                                    isLiteral = true;
                                                }
                                                break;
                                            case '/':
                                                warningAt("Unescaped '{a}'.",
                                                        line, from + l - 1, '/');

                                                if (isInRange) {
                                                    isInRange = false;
                                                } else {
                                                    isLiteral = true;
                                                }
                                                break;
                                            case '<':
                                                if (isInRange) {
                                                    isInRange = false;
                                                } else {
                                                    isLiteral = true;
                                                }
                                                break;
                                            default:
                                                if (isInRange) {
                                                    isInRange = false;
                                                } else {
                                                    isLiteral = true;
                                                }
                                            }
                                        } while (c);
                                        break;
                                    case '.':
                                        if (option.regexp) {
                                            warningAt("Insecure '{a}'.", line,
                                                    from + l, c);
                                        }
                                        break;
                                    case ']':
                                    case '?':
                                    case '{':
                                    case '}':
                                    case '+':
                                    case '*':
                                        warningAt("Unescaped '{a}'.", line,
                                                from + l, c);
                                    }
                                    if (b) {
                                        switch (s.charAt(l)) {
                                        case '?':
                                        case '+':
                                        case '*':
                                            l += 1;
                                            if (s.charAt(l) === '?') {
                                                l += 1;
                                            }
                                            break;
                                        case '{':
                                            l += 1;
                                            c = s.charAt(l);
                                            if (c < '0' || c > '9') {
                                                warningAt(
"Expected a number and instead saw '{a}'.", line, from + l, c);
                                            }
                                            l += 1;
                                            low = +c;
                                            for (;;) {
                                                c = s.charAt(l);
                                                if (c < '0' || c > '9') {
                                                    break;
                                                }
                                                l += 1;
                                                low = +c + (low * 10);
                                            }
                                            high = low;
                                            if (c === ',') {
                                                l += 1;
                                                high = Infinity;
                                                c = s.charAt(l);
                                                if (c >= '0' && c <= '9') {
                                                    l += 1;
                                                    high = +c;
                                                    for (;;) {
                                                        c = s.charAt(l);
                                                        if (c < '0' || c > '9') {
                                                            break;
                                                        }
                                                        l += 1;
                                                        high = +c + (high * 10);
                                                    }
                                                }
                                            }
                                            if (s.charAt(l) !== '}') {
                                                warningAt(
"Expected '{a}' and instead saw '{b}'.", line, from + l, '}', c);
                                            } else {
                                                l += 1;
                                            }
                                            if (s.charAt(l) === '?') {
                                                l += 1;
                                            }
                                            if (low > high) {
                                                warningAt(
"'{a}' should not be greater than '{b}'.", line, from + l, low, high);
                                            }
                                        }
                                    }
                                }
                                c = s.substr(0, l - 1);
                                character += l;
                                s = s.substr(l);
                                return it('(regexp)', c);
                            }
                            return it('(punctuator)', t);

    //      punctuator

                        case '#':
                            return it('(punctuator)', t);
                        default:
                            return it('(punctuator)', t);
                        }
                    }
                }
            }
        };
    }());


    function addlabel(t, type) {

        if (t === 'hasOwnProperty') {
            warning("'hasOwnProperty' is a really bad name.");
        }

// Define t in the current function in the current scope.
        if (is_own(funct, t) && !funct['(global)']) {
            if (funct[t] === true) {
                if (option.latedef)
                    warning("'{a}' was used before it was defined.", nexttoken, t);
            } else {
                if (!option.shadow && type !== "exception")
                    warning("'{a}' is already defined.", nexttoken, t);
            }
        }

        funct[t] = type;
        if (funct['(global)']) {
            global[t] = funct;
            if (is_own(implied, t)) {
                if (option.latedef)
                    warning("'{a}' was used before it was defined.", nexttoken, t);
                delete implied[t];
            }
        } else {
            scope[t] = funct;
        }
    }


    function doOption() {
        var b, obj, filter, o = nexttoken.value, t, tn, v;

        switch (o) {
        case '*/':
            error("Unbegun comment.");
            break;
        case '/*members':
        case '/*member':
            o = '/*members';
            if (!membersOnly) {
                membersOnly = {};
            }
            obj = membersOnly;
            break;
        case '/*jshint':
        case '/*jslint':
            obj = option;
            filter = boolOptions;
            break;
        case '/*global':
            obj = predefined;
            break;
        default:
            error("What?");
        }

        t = lex.token();
loop:   for (;;) {
            for (;;) {
                if (t.type === 'special' && t.value === '*/') {
                    break loop;
                }
                if (t.id !== '(endline)' && t.id !== ',') {
                    break;
                }
                t = lex.token();
            }
            if (t.type !== '(string)' && t.type !== '(identifier)' &&
                    o !== '/*members') {
                error("Bad option.", t);
            }

            v = lex.token();
            if (v.id === ':') {
                v = lex.token();

                if (obj === membersOnly) {
                    error("Expected '{a}' and instead saw '{b}'.",
                            t, '*/', ':');
                }

                if (o === '/*jshint') {
                    checkOption(t.value, t);
                }

                if (t.value === 'indent' && (o === '/*jshint' || o === '/*jslint')) {
                    b = +v.value;
                    if (typeof b !== 'number' || !isFinite(b) || b <= 0 ||
                            Math.floor(b) !== b) {
                        error("Expected a small integer and instead saw '{a}'.",
                                v, v.value);
                    }
                    obj.white = true;
                    obj.indent = b;
                } else if (t.value === 'maxerr' && (o === '/*jshint' || o === '/*jslint')) {
                    b = +v.value;
                    if (typeof b !== 'number' || !isFinite(b) || b <= 0 ||
                            Math.floor(b) !== b) {
                        error("Expected a small integer and instead saw '{a}'.",
                                v, v.value);
                    }
                    obj.maxerr = b;
                } else if (t.value === 'maxlen' && (o === '/*jshint' || o === '/*jslint')) {
                    b = +v.value;
                    if (typeof b !== 'number' || !isFinite(b) || b <= 0 ||
                            Math.floor(b) !== b) {
                        error("Expected a small integer and instead saw '{a}'.",
                                v, v.value);
                    }
                    obj.maxlen = b;
                } else if (t.value === 'validthis') {
                    if (funct['(global)']) {
                        error("Option 'validthis' can't be used in a global scope.");
                    } else {
                        if (v.value === 'true' || v.value === 'false')
                            obj[t.value] = v.value === 'true';
                        else
                            error("Bad option value.", v);
                    }
                } else if (v.value === 'true' || v.value === 'false') {
                    if (o === '/*jslint') {
                        tn = renamedOptions[t.value] || t.value;
                        obj[tn] = v.value === 'true';
                        if (invertedOptions[tn] !== undefined) {
                            obj[tn] = !obj[tn];
                        }
                    } else {
                        obj[t.value] = v.value === 'true';
                    }
                } else {
                    error("Bad option value.", v);
                }
                t = lex.token();
            } else {
                if (o === '/*jshint' || o === '/*jslint') {
                    error("Missing option value.", t);
                }
                obj[t.value] = false;
                t = v;
            }
        }
        if (filter) {
            assume();
        }
    }


// We need a peek function. If it has an argument, it peeks that much farther
// ahead. It is used to distinguish
//     for ( var i in ...
// from
//     for ( var i = ...

    function peek(p) {
        var i = p || 0, j = 0, t;

        while (j <= i) {
            t = lookahead[j];
            if (!t) {
                t = lookahead[j] = lex.token();
            }
            j += 1;
        }
        return t;
    }



// Produce the next token. It looks for programming errors.

    function advance(id, t) {
        switch (token.id) {
        case '(number)':
            if (nexttoken.id === '.') {
                warning("A dot following a number can be confused with a decimal point.", token);
            }
            break;
        case '-':
            if (nexttoken.id === '-' || nexttoken.id === '--') {
                warning("Confusing minusses.");
            }
            break;
        case '+':
            if (nexttoken.id === '+' || nexttoken.id === '++') {
                warning("Confusing plusses.");
            }
            break;
        }

        if (token.type === '(string)' || token.identifier) {
            anonname = token.value;
        }

        if (id && nexttoken.id !== id) {
            if (t) {
                if (nexttoken.id === '(end)') {
                    warning("Unmatched '{a}'.", t, t.id);
                } else {
                    warning("Expected '{a}' to match '{b}' from line {c} and instead saw '{d}'.",
                            nexttoken, id, t.id, t.line, nexttoken.value);
                }
            } else if (nexttoken.type !== '(identifier)' ||
                            nexttoken.value !== id) {
                warning("Expected '{a}' and instead saw '{b}'.",
                        nexttoken, id, nexttoken.value);
            }
        }

        prevtoken = token;
        token = nexttoken;
        for (;;) {
            nexttoken = lookahead.shift() || lex.token();
            if (nexttoken.id === '(end)' || nexttoken.id === '(error)') {
                return;
            }
            if (nexttoken.type === 'special') {
                doOption();
            } else {
                if (nexttoken.id !== '(endline)') {
                    break;
                }
            }
        }
    }


// This is the heart of JSHINT, the Pratt parser. In addition to parsing, it
// is looking for ad hoc lint patterns. We add .fud to Pratt's model, which is
// like .nud except that it is only used on the first token of a statement.
// Having .fud makes it much easier to define statement-oriented languages like
// JavaScript. I retained Pratt's nomenclature.

// .nud     Null denotation
// .fud     First null denotation
// .led     Left denotation
//  lbp     Left binding power
//  rbp     Right binding power

// They are elements of the parsing method called Top Down Operator Precedence.

    function expression(rbp, initial) {
        var left, isArray = false, isObject = false;

        if (nexttoken.id === '(end)')
            error("Unexpected early end of program.", token);

        advance();
        if (initial) {
            anonname = 'anonymous';
            funct['(verb)'] = token.value;
        }
        if (initial === true && token.fud) {
            left = token.fud();
        } else {
            if (token.nud) {
                left = token.nud();
            } else {
                if (nexttoken.type === '(number)' && token.id === '.') {
                    warning("A leading decimal point can be confused with a dot: '.{a}'.",
                            token, nexttoken.value);
                    advance();
                    return token;
                } else {
                    error("Expected an identifier and instead saw '{a}'.",
                            token, token.id);
                }
            }
            while (rbp < nexttoken.lbp) {
                isArray = token.value === 'Array';
                isObject = token.value === 'Object';

                // #527, new Foo.Array(), Foo.Array(), new Foo.Object(), Foo.Object()
                // Line breaks in IfStatement heads exist to satisfy the checkJSHint
                // "Line too long." error.
                if (left && (left.value || (left.first && left.first.value))) {
                    // If the left.value is not "new", or the left.first.value is a "."
                    // then safely assume that this is not "new Array()" and possibly
                    // not "new Object()"...
                    if (left.value !== 'new' ||
                      (left.first && left.first.value && left.first.value === '.')) {
                        isArray = false;
                        // ...In the case of Object, if the left.value and token.value
                        // are not equal, then safely assume that this not "new Object()"
                        if (left.value !== token.value) {
                            isObject = false;
                        }
                    }
                }

                advance();
                if (isArray && token.id === '(' && nexttoken.id === ')')
                    warning("Use the array literal notation [].", token);
                if (isObject && token.id === '(' && nexttoken.id === ')')
                    warning("Use the object literal notation {}.", token);
                if (token.led) {
                    left = token.led(left);
                } else {
                    error("Expected an operator and instead saw '{a}'.",
                        token, token.id);
                }
            }
        }
        return left;
    }


// Functions for conformance of style.

    function adjacent(left, right) {
        left = left || token;
        right = right || nexttoken;
        if (option.white) {
            if (left.character !== right.from && left.line === right.line) {
                left.from += (left.character - left.from);
                warning("Unexpected space after '{a}'.", left, left.value);
            }
        }
    }

    function nobreak(left, right) {
        left = left || token;
        right = right || nexttoken;
        if (option.white && (left.character !== right.from || left.line !== right.line)) {
            warning("Unexpected space before '{a}'.", right, right.value);
        }
    }

    function nospace(left, right) {
        left = left || token;
        right = right || nexttoken;
        if (option.white && !left.comment) {
            if (left.line === right.line) {
                adjacent(left, right);
            }
        }
    }

    function nonadjacent(left, right) {
        if (option.white) {
            left = left || token;
            right = right || nexttoken;
            if (left.line === right.line && left.character === right.from) {
                left.from += (left.character - left.from);
                warning("Missing space after '{a}'.",
                        left, left.value);
            }
        }
    }

    function nobreaknonadjacent(left, right) {
        left = left || token;
        right = right || nexttoken;
        if (!option.laxbreak && left.line !== right.line) {
            warning("Bad line breaking before '{a}'.", right, right.id);
        } else if (option.white) {
            left = left || token;
            right = right || nexttoken;
            if (left.character === right.from) {
                left.from += (left.character - left.from);
                warning("Missing space after '{a}'.",
                        left, left.value);
            }
        }
    }

    function indentation(bias) {
        var i;
        if (option.white && nexttoken.id !== '(end)') {
            i = indent + (bias || 0);
            if (nexttoken.from !== i) {
                warning(
"Expected '{a}' to have an indentation at {b} instead at {c}.",
                        nexttoken, nexttoken.value, i, nexttoken.from);
            }
        }
    }

    function nolinebreak(t) {
        t = t || token;
        if (t.line !== nexttoken.line) {
            warning("Line breaking error '{a}'.", t, t.value);
        }
    }


    function comma() {
        if (token.line !== nexttoken.line) {
            if (!option.laxcomma) {
                if (comma.first) {
                    warning("Comma warnings can be turned off with 'laxcomma'");
                    comma.first = false;
                }
                warning("Bad line breaking before '{a}'.", token, nexttoken.id);
            }
        } else if (!token.comment && token.character !== nexttoken.from && option.white) {
            token.from += (token.character - token.from);
            warning("Unexpected space after '{a}'.", token, token.value);
        }
        advance(',');
        nonadjacent(token, nexttoken);
    }


// Functional constructors for making the symbols that will be inherited by
// tokens.

    function symbol(s, p) {
        var x = syntax[s];
        if (!x || typeof x !== 'object') {
            syntax[s] = x = {
                id: s,
                lbp: p,
                value: s
            };
        }
        return x;
    }


    function delim(s) {
        return symbol(s, 0);
    }


    function stmt(s, f) {
        var x = delim(s);
        x.identifier = x.reserved = true;
        x.fud = f;
        return x;
    }


    function blockstmt(s, f) {
        var x = stmt(s, f);
        x.block = true;
        return x;
    }


    function reserveName(x) {
        var c = x.id.charAt(0);
        if ((c >= 'a' && c <= 'z') || (c >= 'A' && c <= 'Z')) {
            x.identifier = x.reserved = true;
        }
        return x;
    }


    function prefix(s, f) {
        var x = symbol(s, 150);
        reserveName(x);
        x.nud = (typeof f === 'function') ? f : function () {
            this.right = expression(150);
            this.arity = 'unary';
            if (this.id === '++' || this.id === '--') {
                if (option.plusplus) {
                    warning("Unexpected use of '{a}'.", this, this.id);
                } else if ((!this.right.identifier || this.right.reserved) &&
                        this.right.id !== '.' && this.right.id !== '[') {
                    warning("Bad operand.", this);
                }
            }
            return this;
        };
        return x;
    }


    function type(s, f) {
        var x = delim(s);
        x.type = s;
        x.nud = f;
        return x;
    }


    function reserve(s, f) {
        var x = type(s, f);
        x.identifier = x.reserved = true;
        return x;
    }


    function reservevar(s, v) {
        return reserve(s, function () {
            if (typeof v === 'function') {
                v(this);
            }
            return this;
        });
    }


    function infix(s, f, p, w) {
        var x = symbol(s, p);
        reserveName(x);
        x.led = function (left) {
            if (!w) {
                nobreaknonadjacent(prevtoken, token);
                nonadjacent(token, nexttoken);
            }
            if (s === "in" && left.id === "!") {
                warning("Confusing use of '{a}'.", left, '!');
            }
            if (typeof f === 'function') {
                return f(left, this);
            } else {
                this.left = left;
                this.right = expression(p);
                return this;
            }
        };
        return x;
    }


    function relation(s, f) {
        var x = symbol(s, 100);
        x.led = function (left) {
            nobreaknonadjacent(prevtoken, token);
            nonadjacent(token, nexttoken);
            var right = expression(100);
            if ((left && left.id === 'NaN') || (right && right.id === 'NaN')) {
                warning("Use the isNaN function to compare with NaN.", this);
            } else if (f) {
                f.apply(this, [left, right]);
            }
            if (left.id === '!') {
                warning("Confusing use of '{a}'.", left, '!');
            }
            if (right.id === '!') {
                warning("Confusing use of '{a}'.", right, '!');
            }
            this.left = left;
            this.right = right;
            return this;
        };
        return x;
    }


    function isPoorRelation(node) {
        return node &&
              ((node.type === '(number)' && +node.value === 0) ||
               (node.type === '(string)' && node.value === '') ||
               (node.type === 'null' && !option.eqnull) ||
                node.type === 'true' ||
                node.type === 'false' ||
                node.type === 'undefined');
    }


    function assignop(s, f) {
        symbol(s, 20).exps = true;
        return infix(s, function (left, that) {
            var l;
            that.left = left;
            if (predefined[left.value] === false &&
                    scope[left.value]['(global)'] === true) {
                warning("Read only.", left);
            } else if (left['function']) {
                warning("'{a}' is a function.", left, left.value);
            }
            if (left) {
                if (option.esnext && funct[left.value] === 'const') {
                    warning("Attempting to override '{a}' which is a constant", left, left.value);
                }
                if (left.id === '.' || left.id === '[') {
                    if (!left.left || left.left.value === 'arguments') {
                        warning('Bad assignment.', that);
                    }
                    that.right = expression(19);
                    return that;
                } else if (left.identifier && !left.reserved) {
                    if (funct[left.value] === 'exception') {
                        warning("Do not assign to the exception parameter.", left);
                    }
                    that.right = expression(19);
                    return that;
                }
                if (left === syntax['function']) {
                    warning(
"Expected an identifier in an assignment and instead saw a function invocation.",
                                token);
                }
            }
            error("Bad assignment.", that);
        }, 20);
    }


    function bitwise(s, f, p) {
        var x = symbol(s, p);
        reserveName(x);
        x.led = (typeof f === 'function') ? f : function (left) {
            if (option.bitwise) {
                warning("Unexpected use of '{a}'.", this, this.id);
            }
            this.left = left;
            this.right = expression(p);
            return this;
        };
        return x;
    }


    function bitwiseassignop(s) {
        symbol(s, 20).exps = true;
        return infix(s, function (left, that) {
            if (option.bitwise) {
                warning("Unexpected use of '{a}'.", that, that.id);
            }
            nonadjacent(prevtoken, token);
            nonadjacent(token, nexttoken);
            if (left) {
                if (left.id === '.' || left.id === '[' ||
                        (left.identifier && !left.reserved)) {
                    expression(19);
                    return that;
                }
                if (left === syntax['function']) {
                    warning(
"Expected an identifier in an assignment, and instead saw a function invocation.",
                                token);
                }
                return that;
            }
            error("Bad assignment.", that);
        }, 20);
    }


    function suffix(s, f) {
        var x = symbol(s, 150);
        x.led = function (left) {
            if (option.plusplus) {
                warning("Unexpected use of '{a}'.", this, this.id);
            } else if ((!left.identifier || left.reserved) &&
                    left.id !== '.' && left.id !== '[') {
                warning("Bad operand.", this);
            }
            this.left = left;
            return this;
        };
        return x;
    }


    // fnparam means that this identifier is being defined as a function
    // argument (see identifier())
    function optionalidentifier(fnparam) {
        if (nexttoken.identifier) {
            advance();
            if (token.reserved && !option.es5) {
                // `undefined` as a function param is a common pattern to protect
                // against the case when somebody does `undefined = true` and
                // help with minification. More info: https://gist.github.com/315916
                if (!fnparam || token.value !== 'undefined') {
                    warning("Expected an identifier and instead saw '{a}' (a reserved word).",
                            token, token.id);
                }
            }
            return token.value;
        }
    }

    // fnparam means that this identifier is being defined as a function
    // argument
    function identifier(fnparam) {
        var i = optionalidentifier(fnparam);
        if (i) {
            return i;
        }
        if (token.id === 'function' && nexttoken.id === '(') {
            warning("Missing name in function declaration.");
        } else {
            error("Expected an identifier and instead saw '{a}'.",
                    nexttoken, nexttoken.value);
        }
    }


    function reachable(s) {
        var i = 0, t;
        if (nexttoken.id !== ';' || noreach) {
            return;
        }
        for (;;) {
            t = peek(i);
            if (t.reach) {
                return;
            }
            if (t.id !== '(endline)') {
                if (t.id === 'function') {
                    if (!option.latedef) {
                        break;
                    }
                    warning(
"Inner functions should be listed at the top of the outer function.", t);
                    break;
                }
                warning("Unreachable '{a}' after '{b}'.", t, t.value, s);
                break;
            }
            i += 1;
        }
    }


    function statement(noindent) {
        var i = indent, r, s = scope, t = nexttoken;

        if (t.id === ";") {
            advance(";");
            return;
        }

// Is this a labelled statement?

        if (t.identifier && !t.reserved && peek().id === ':') {
            advance();
            advance(':');
            scope = Object.create(s);
            addlabel(t.value, 'label');
            if (!nexttoken.labelled) {
                warning("Label '{a}' on {b} statement.",
                        nexttoken, t.value, nexttoken.value);
            }
            if (jx.test(t.value + ':')) {
                warning("Label '{a}' looks like a javascript url.",
                        t, t.value);
            }
            nexttoken.label = t.value;
            t = nexttoken;
        }

// Parse the statement.

        if (!noindent) {
            indentation();
        }
        r = expression(0, true);

        // Look for the final semicolon.
        if (!t.block) {
            if (!option.expr && (!r || !r.exps)) {
                warning("Expected an assignment or function call and instead saw an expression.",
                    token);
            } else if (option.nonew && r.id === '(' && r.left.id === 'new') {
                warning("Do not use 'new' for side effects.");
            }

            if (nexttoken.id === ',') {
                return comma();
            }

            if (nexttoken.id !== ';') {
                if (!option.asi) {
                    // If this is the last statement in a block that ends on
                    // the same line *and* option lastsemic is on, ignore the warning.
                    // Otherwise, complain about missing semicolon.
                    if (!option.lastsemic || nexttoken.id !== '}' ||
                            nexttoken.line !== token.line) {
                        warningAt("Missing semicolon.", token.line, token.character);
                    }
                }
            } else {
                adjacent(token, nexttoken);
                advance(';');
                nonadjacent(token, nexttoken);
            }
        }

// Restore the indentation.

        indent = i;
        scope = s;
        return r;
    }


    function statements(startLine) {
        var a = [], f, p;

        while (!nexttoken.reach && nexttoken.id !== '(end)') {
            if (nexttoken.id === ';') {
                p = peek();
                if (!p || p.id !== "(") {
                    warning("Unnecessary semicolon.");
                }
                advance(';');
            } else {
                a.push(statement(startLine === nexttoken.line));
            }
        }
        return a;
    }


    /*
     * read all directives
     * recognizes a simple form of asi, but always
     * warns, if it is used
     */
    function directives() {
        var i, p, pn;

        for (;;) {
            if (nexttoken.id === "(string)") {
                p = peek(0);
                if (p.id === "(endline)") {
                    i = 1;
                    do {
                        pn = peek(i);
                        i = i + 1;
                    } while (pn.id === "(endline)");

                    if (pn.id !== ";") {
                        if (pn.id !== "(string)" && pn.id !== "(number)" &&
                            pn.id !== "(regexp)" && pn.identifier !== true &&
                            pn.id !== "}") {
                            break;
                        }
                        warning("Missing semicolon.", nexttoken);
                    } else {
                        p = pn;
                    }
                } else if (p.id === "}") {
                    // directive with no other statements, warn about missing semicolon
                    warning("Missing semicolon.", p);
                } else if (p.id !== ";") {
                    break;
                }

                indentation();
                advance();
                if (directive[token.value]) {
                    warning("Unnecessary directive \"{a}\".", token, token.value);
                }

                if (token.value === "use strict") {
                    option.newcap = true;
                    option.undef = true;
                }

                // there's no directive negation, so always set to true
                directive[token.value] = true;

                if (p.id === ";") {
                    advance(";");
                }
                continue;
            }
            break;
        }
    }


    /*
     * Parses a single block. A block is a sequence of statements wrapped in
     * braces.
     *
     * ordinary - true for everything but function bodies and try blocks.
     * stmt     - true if block can be a single statement (e.g. in if/for/while).
     * isfunc   - true if block is a function body
     */
    function block(ordinary, stmt, isfunc) {
        var a,
            b = inblock,
            old_indent = indent,
            m,
            s = scope,
            t,
            line,
            d;

        inblock = ordinary;
        if (!ordinary || !option.funcscope) scope = Object.create(scope);
        nonadjacent(token, nexttoken);
        t = nexttoken;

        if (nexttoken.id === '{') {
            advance('{');
            line = token.line;
            if (nexttoken.id !== '}') {
                indent += option.indent;
                while (!ordinary && nexttoken.from > indent) {
                    indent += option.indent;
                }

                if (isfunc) {
                    m = {};
                    for (d in directive) {
                        if (is_own(directive, d)) {
                            m[d] = directive[d];
                        }
                    }
                    directives();

                    if (option.strict && funct['(context)']['(global)']) {
                        if (!m["use strict"] && !directive["use strict"]) {
                            warning("Missing \"use strict\" statement.");
                        }
                    }
                }

                a = statements(line);

                if (isfunc) {
                    directive = m;
                }

                indent -= option.indent;
                if (line !== nexttoken.line) {
                    indentation();
                }
            } else if (line !== nexttoken.line) {
                indentation();
            }
            advance('}', t);
            indent = old_indent;
        } else if (!ordinary) {
            error("Expected '{a}' and instead saw '{b}'.",
                  nexttoken, '{', nexttoken.value);
        } else {
            if (!stmt || option.curly)
                warning("Expected '{a}' and instead saw '{b}'.",
                        nexttoken, '{', nexttoken.value);

            noreach = true;
            indent += option.indent;
            // test indentation only if statement is in new line
            a = [statement(nexttoken.line === token.line)];
            indent -= option.indent;
            noreach = false;
        }
        funct['(verb)'] = null;
        if (!ordinary || !option.funcscope) scope = s;
        inblock = b;
        if (ordinary && option.noempty && (!a || a.length === 0)) {
            warning("Empty block.");
        }
        return a;
    }


    function countMember(m) {
        if (membersOnly && typeof membersOnly[m] !== 'boolean') {
            warning("Unexpected /*member '{a}'.", token, m);
        }
        if (typeof member[m] === 'number') {
            member[m] += 1;
        } else {
            member[m] = 1;
        }
    }


    function note_implied(token) {
        var name = token.value, line = token.line, a = implied[name];
        if (typeof a === 'function') {
            a = false;
        }

        if (!a) {
            a = [line];
            implied[name] = a;
        } else if (a[a.length - 1] !== line) {
            a.push(line);
        }
    }


    // Build the syntax table by declaring the syntactic elements of the language.

    type('(number)', function () {
        return this;
    });

    type('(string)', function () {
        return this;
    });

    syntax['(identifier)'] = {
        type: '(identifier)',
        lbp: 0,
        identifier: true,
        nud: function () {
            var v = this.value,
                s = scope[v],
                f;

            if (typeof s === 'function') {
                // Protection against accidental inheritance.
                s = undefined;
            } else if (typeof s === 'boolean') {
                f = funct;
                funct = functions[0];
                addlabel(v, 'var');
                s = funct;
                funct = f;
            }

            // The name is in scope and defined in the current function.
            if (funct === s) {
                // Change 'unused' to 'var', and reject labels.
                switch (funct[v]) {
                case 'unused':
                    funct[v] = 'var';
                    break;
                case 'unction':
                    funct[v] = 'function';
                    this['function'] = true;
                    break;
                case 'function':
                    this['function'] = true;
                    break;
                case 'label':
                    warning("'{a}' is a statement label.", token, v);
                    break;
                }
            } else if (funct['(global)']) {
                // The name is not defined in the function.  If we are in the global
                // scope, then we have an undefined variable.
                //
                // Operators typeof and delete do not raise runtime errors even if
                // the base object of a reference is null so no need to display warning
                // if we're inside of typeof or delete.

                if (option.undef && typeof predefined[v] !== 'boolean') {
                    // Attempting to subscript a null reference will throw an
                    // error, even within the typeof and delete operators
                    if (!(anonname === 'typeof' || anonname === 'delete') ||
                        (nexttoken && (nexttoken.value === '.' || nexttoken.value === '['))) {

                        isundef(funct, "'{a}' is not defined.", token, v);
                    }
                }
                note_implied(token);
            } else {
                // If the name is already defined in the current
                // function, but not as outer, then there is a scope error.

                switch (funct[v]) {
                case 'closure':
                case 'function':
                case 'var':
                case 'unused':
                    warning("'{a}' used out of scope.", token, v);
                    break;
                case 'label':
                    warning("'{a}' is a statement label.", token, v);
                    break;
                case 'outer':
                case 'global':
                    break;
                default:
                    // If the name is defined in an outer function, make an outer entry,
                    // and if it was unused, make it var.
                    if (s === true) {
                        funct[v] = true;
                    } else if (s === null) {
                        warning("'{a}' is not allowed.", token, v);
                        note_implied(token);
                    } else if (typeof s !== 'object') {
                        // Operators typeof and delete do not raise runtime errors even
                        // if the base object of a reference is null so no need to
                        // display warning if we're inside of typeof or delete.
                        if (option.undef) {
                            // Attempting to subscript a null reference will throw an
                            // error, even within the typeof and delete operators
                            if (!(anonname === 'typeof' || anonname === 'delete') ||
                                (nexttoken &&
                                    (nexttoken.value === '.' || nexttoken.value === '['))) {

                                isundef(funct, "'{a}' is not defined.", token, v);
                            }
                        }
                        funct[v] = true;
                        note_implied(token);
                    } else {
                        switch (s[v]) {
                        case 'function':
                        case 'unction':
                            this['function'] = true;
                            s[v] = 'closure';
                            funct[v] = s['(global)'] ? 'global' : 'outer';
                            break;
                        case 'var':
                        case 'unused':
                            s[v] = 'closure';
                            funct[v] = s['(global)'] ? 'global' : 'outer';
                            break;
                        case 'closure':
                        case 'parameter':
                            funct[v] = s['(global)'] ? 'global' : 'outer';
                            break;
                        case 'label':
                            warning("'{a}' is a statement label.", token, v);
                        }
                    }
                }
            }
            return this;
        },
        led: function () {
            error("Expected an operator and instead saw '{a}'.",
                nexttoken, nexttoken.value);
        }
    };

    type('(regexp)', function () {
        return this;
    });


// ECMAScript parser

    delim('(endline)');
    delim('(begin)');
    delim('(end)').reach = true;
    delim('</').reach = true;
    delim('<!');
    delim('<!--');
    delim('-->');
    delim('(error)').reach = true;
    delim('}').reach = true;
    delim(')');
    delim(']');
    delim('"').reach = true;
    delim("'").reach = true;
    delim(';');
    delim(':').reach = true;
    delim(',');
    delim('#');
    delim('@');
    reserve('else');
    reserve('case').reach = true;
    reserve('catch');
    reserve('default').reach = true;
    reserve('finally');
    reservevar('arguments', function (x) {
        if (directive['use strict'] && funct['(global)']) {
            warning("Strict violation.", x);
        }
    });
    reservevar('eval');
    reservevar('false');
    reservevar('Infinity');
    reservevar('NaN');
    reservevar('null');
    reservevar('this', function (x) {
        if (directive['use strict'] && !option.validthis && ((funct['(statement)'] &&
                funct['(name)'].charAt(0) > 'Z') || funct['(global)'])) {
            warning("Possible strict violation.", x);
        }
    });
    reservevar('true');
    reservevar('undefined');
    assignop('=', 'assign', 20);
    assignop('+=', 'assignadd', 20);
    assignop('-=', 'assignsub', 20);
    assignop('*=', 'assignmult', 20);
    assignop('/=', 'assigndiv', 20).nud = function () {
        error("A regular expression literal can be confused with '/='.");
    };
    assignop('%=', 'assignmod', 20);
    bitwiseassignop('&=', 'assignbitand', 20);
    bitwiseassignop('|=', 'assignbitor', 20);
    bitwiseassignop('^=', 'assignbitxor', 20);
    bitwiseassignop('<<=', 'assignshiftleft', 20);
    bitwiseassignop('>>=', 'assignshiftright', 20);
    bitwiseassignop('>>>=', 'assignshiftrightunsigned', 20);
    infix('?', function (left, that) {
        that.left = left;
        that.right = expression(10);
        advance(':');
        that['else'] = expression(10);
        return that;
    }, 30);

    infix('||', 'or', 40);
    infix('&&', 'and', 50);
    bitwise('|', 'bitor', 70);
    bitwise('^', 'bitxor', 80);
    bitwise('&', 'bitand', 90);
    relation('==', function (left, right) {
        var eqnull = option.eqnull && (left.value === 'null' || right.value === 'null');

        if (!eqnull && option.eqeqeq)
            warning("Expected '{a}' and instead saw '{b}'.", this, '===', '==');
/*        else if (isPoorRelation(left))
            warning("Use '{a}' to compare with '{b}'.", this, '===', left.value);
        else if (isPoorRelation(right))
            warning("Use '{a}' to compare with '{b}'.", this, '===', right.value);
*/
        return this;
    });
    relation('===');
    relation('!=', function (left, right) {
        var eqnull = option.eqnull &&
                (left.value === 'null' || right.value === 'null');

        if (!eqnull && option.eqeqeq) {
            warning("Expected '{a}' and instead saw '{b}'.",
                    this, '!==', '!=');
        }/* else if (isPoorRelation(left)) {
            warning("Use '{a}' to compare with '{b}'.",
                    this, '!==', left.value);
        } else if (isPoorRelation(right)) {
            warning("Use '{a}' to compare with '{b}'.",
                    this, '!==', right.value);
        }*/
        return this;
    });
    relation('!==');
    relation('<');
    relation('>');
    relation('<=');
    relation('>=');
    bitwise('<<', 'shiftleft', 120);
    bitwise('>>', 'shiftright', 120);
    bitwise('>>>', 'shiftrightunsigned', 120);
    infix('in', 'in', 120);
    infix('instanceof', 'instanceof', 120);
    infix('+', function (left, that) {
        var right = expression(130);
        if (left && right && left.id === '(string)' && right.id === '(string)') {
            left.value += right.value;
            left.character = right.character;
            if (!option.scripturl && jx.test(left.value)) {
                warning("JavaScript URL.", left);
            }
            return left;
        }
        that.left = left;
        that.right = right;
        return that;
    }, 130);
    prefix('+', 'num');
    prefix('+++', function () {
        warning("Confusing pluses.");
        this.right = expression(150);
        this.arity = 'unary';
        return this;
    });
    infix('+++', function (left) {
        warning("Confusing pluses.");
        this.left = left;
        this.right = expression(130);
        return this;
    }, 130);
    infix('-', 'sub', 130);
    prefix('-', 'neg');
    prefix('---', function () {
        warning("Confusing minuses.");
        this.right = expression(150);
        this.arity = 'unary';
        return this;
    });
    infix('---', function (left) {
        warning("Confusing minuses.");
        this.left = left;
        this.right = expression(130);
        return this;
    }, 130);
    infix('*', 'mult', 140);
    infix('/', 'div', 140);
    infix('%', 'mod', 140);

    suffix('++', 'postinc');
    prefix('++', 'preinc');
    syntax['++'].exps = true;

    suffix('--', 'postdec');
    prefix('--', 'predec');
    syntax['--'].exps = true;
    prefix('delete', function () {
        var p = expression(0);
        if (!p || (p.id !== '.' && p.id !== '[')) {
            warning("Variables should not be deleted.");
        }
        this.first = p;
        return this;
    }).exps = true;

    prefix('~', function () {
        if (option.bitwise) {
            warning("Unexpected '{a}'.", this, '~');
        }
        expression(150);
        return this;
    });

    prefix('!', function () {
        this.right = expression(150);
        this.arity = 'unary';
        if (bang[this.right.id] === true) {
            warning("Confusing use of '{a}'.", this, '!');
        }
        return this;
    });
    prefix('typeof', 'typeof');
    prefix('new', function () {
        var c = expression(155), i;
        if (c && c.id !== 'function') {
            if (c.identifier) {
                c['new'] = true;
                switch (c.value) {
                case 'Number':
                case 'String':
                case 'Boolean':
                case 'Math':
                case 'JSON':
                    warning("Do not use {a} as a constructor.", token, c.value);
                    break;
                case 'Function':
                    if (!option.evil) {
                        warning("The Function constructor is eval.");
                    }
                    break;
                case 'Date':
                case 'RegExp':
                    break;
                default:
                    if (c.id !== 'function') {
                        i = c.value.substr(0, 1);
                        if (option.newcap && (i < 'A' || i > 'Z')) {
                            warning("A constructor name should start with an uppercase letter.",
                                token);
                        }
                    }
                }
            } else {
                if (c.id !== '.' && c.id !== '[' && c.id !== '(') {
                    warning("Bad constructor.", token);
                }
            }
        } else {
            if (!option.supernew)
                warning("Weird construction. Delete 'new'.", this);
        }
        adjacent(token, nexttoken);
        if (nexttoken.id !== '(' && !option.supernew) {
            warning("Missing '()' invoking a constructor.");
        }
        this.first = c;
        return this;
    });
    syntax['new'].exps = true;

    prefix('void').exps = true;

    infix('.', function (left, that) {
        adjacent(prevtoken, token);
        nobreak();
        var m = identifier();
        if (typeof m === 'string') {
            countMember(m);
        }
        that.left = left;
        that.right = m;
        if (left && left.value === 'arguments' && (m === 'callee' || m === 'caller')) {
            if (option.noarg)
                warning("Avoid arguments.{a}.", left, m);
            else if (directive['use strict'])
                error('Strict violation.');
        } else if (!option.evil && left && left.value === 'document' &&
                (m === 'write' || m === 'writeln')) {
            warning("document.write can be a form of eval.", left);
        }
        if (!option.evil && (m === 'eval' || m === 'execScript')) {
            warning('eval is evil.');
        }
        return that;
    }, 160, true);

    infix('(', function (left, that) {
        if (prevtoken.id !== '}' && prevtoken.id !== ')') {
            nobreak(prevtoken, token);
        }
        nospace();
        if (option.immed && !left.immed && left.id === 'function') {
            warning("Wrap an immediate function invocation in parentheses " +
                "to assist the reader in understanding that the expression " +
                "is the result of a function, and not the function itself.");
        }
        var n = 0,
            p = [];
        if (left) {
            if (left.type === '(identifier)') {
                if (left.value.match(/^[A-Z]([A-Z0-9_$]*[a-z][A-Za-z0-9_$]*)?$/)) {
                    if (left.value !== 'Number' && left.value !== 'String' &&
                            left.value !== 'Boolean' &&
                            left.value !== 'Date') {
                        if (left.value === 'Math') {
                            warning("Math is not a function.", left);
                        } else if (option.newcap) {
                            warning(
"Missing 'new' prefix when invoking a constructor.", left);
                        }
                    }
                }
            }
        }
        if (nexttoken.id !== ')') {
            for (;;) {
                p[p.length] = expression(10);
                n += 1;
                if (nexttoken.id !== ',') {
                    break;
                }
                comma();
            }
        }
        advance(')');
        nospace(prevtoken, token);
        if (typeof left === 'object') {
            if (left.value === 'parseInt' && n === 1) {
                warning("Missing radix parameter.", left);
            }
            if (!option.evil) {
                if (left.value === 'eval' || left.value === 'Function' ||
                        left.value === 'execScript') {
                    warning("eval is evil.", left);
                } else if (p[0] && p[0].id === '(string)' &&
                       (left.value === 'setTimeout' ||
                        left.value === 'setInterval')) {
                    warning(
    "Implied eval is evil. Pass a function instead of a string.", left);
                }
            }
            if (!left.identifier && left.id !== '.' && left.id !== '[' &&
                    left.id !== '(' && left.id !== '&&' && left.id !== '||' &&
                    left.id !== '?') {
                warning("Bad invocation.", left);
            }
        }
        that.left = left;
        return that;
    }, 155, true).exps = true;

    prefix('(', function () {
        nospace();
        if (nexttoken.id === 'function') {
            nexttoken.immed = true;
        }
        var v = expression(0);
        advance(')', this);
        nospace(prevtoken, token);
        if (option.immed && v.id === 'function') {
            if (nexttoken.id === '(' ||
              (nexttoken.id === '.' && (peek().value === 'call' || peek().value === 'apply'))) {
                warning(
"Move the invocation into the parens that contain the function.", nexttoken);
            } else {
                warning(
"Do not wrap function literals in parens unless they are to be immediately invoked.",
                        this);
            }
        }
        return v;
    });

    infix('[', function (left, that) {
        nobreak(prevtoken, token);
        nospace();
        var e = expression(0), s;
        if (e && e.type === '(string)') {
            if (!option.evil && (e.value === 'eval' || e.value === 'execScript')) {
                warning("eval is evil.", that);
            }
            countMember(e.value);
            if (!option.sub && ix.test(e.value)) {
                s = syntax[e.value];
                if (!s || !s.reserved) {
                    warning("['{a}'] is better written in dot notation.",
                            e, e.value);
                }
            }
        }
        advance(']', that);
        nospace(prevtoken, token);
        that.left = left;
        that.right = e;
        return that;
    }, 160, true);

    prefix('[', function () {
        var b = token.line !== nexttoken.line;
        this.first = [];
        if (b) {
            indent += option.indent;
            if (nexttoken.from === indent + option.indent) {
                indent += option.indent;
            }
        }
        while (nexttoken.id !== '(end)') {
            while (nexttoken.id === ',') {
                warning("Extra comma.");
                advance(',');
            }
            if (nexttoken.id === ']') {
                break;
            }
            if (b && token.line !== nexttoken.line) {
                indentation();
            }
            this.first.push(expression(10));
            if (nexttoken.id === ',') {
                comma();
                if (nexttoken.id === ']' && !option.es5) {
                    warning("Extra comma.", token);
                    break;
                }
            } else {
                break;
            }
        }
        if (b) {
            indent -= option.indent;
            indentation();
        }
        advance(']', this);
        return this;
    }, 160);


    function property_name() {
        var id = optionalidentifier(true);
        if (!id) {
            if (nexttoken.id === '(string)') {
                id = nexttoken.value;
                advance();
            } else if (nexttoken.id === '(number)') {
                id = nexttoken.value.toString();
                advance();
            }
        }
        return id;
    }


    function functionparams() {
        var i, t = nexttoken, p = [];
        advance('(');
        nospace();
        if (nexttoken.id === ')') {
            advance(')');
            return;
        }
        for (;;) {
            i = identifier(true);
            p.push(i);
            addlabel(i, 'parameter');
            if (nexttoken.id === ',') {
                comma();
            } else {
                advance(')', t);
                nospace(prevtoken, token);
                return p;
            }
        }
    }


    function doFunction(i, statement) {
        var f,
            oldOption = option,
            oldScope  = scope;

        option = Object.create(option);
        scope = Object.create(scope);

        funct = {
            '(name)'     : i || '"' + anonname + '"',
            '(line)'     : nexttoken.line,
            '(context)'  : funct,
            '(breakage)' : 0,
            '(loopage)'  : 0,
            '(scope)'    : scope,
            '(statement)': statement
        };
        f = funct;
        token.funct = funct;
        functions.push(funct);
        if (i) {
            addlabel(i, 'function');
        }
        funct['(params)'] = functionparams();

        block(false, false, true);
        scope = oldScope;
        option = oldOption;
        funct['(last)'] = token.line;
        funct = funct['(context)'];
        return f;
    }


    (function (x) {
        x.nud = function () {
            var b, f, i, j, p, t;
            var props = {}; // All properties, including accessors

            function saveProperty(name, token) {
                if (props[name] && is_own(props, name))
                    warning("Duplicate member '{a}'.", nexttoken, i);
                else
                    props[name] = {};

                props[name].basic = true;
                props[name].basicToken = token;
            }

            function saveSetter(name, token) {
                if (props[name] && is_own(props, name)) {
                    if (props[name].basic || props[name].setter)
                        warning("Duplicate member '{a}'.", nexttoken, i);
                } else {
                    props[name] = {};
                }

                props[name].setter = true;
                props[name].setterToken = token;
            }

            function saveGetter(name) {
                if (props[name] && is_own(props, name)) {
                    if (props[name].basic || props[name].getter)
                        warning("Duplicate member '{a}'.", nexttoken, i);
                } else {
                    props[name] = {};
                }

                props[name].getter = true;
                props[name].getterToken = token;
            }

            b = token.line !== nexttoken.line;
            if (b) {
                indent += option.indent;
                if (nexttoken.from === indent + option.indent) {
                    indent += option.indent;
                }
            }
            for (;;) {
                if (nexttoken.id === '}') {
                    break;
                }
                if (b) {
                    indentation();
                }
                if (nexttoken.value === 'get' && peek().id !== ':') {
                    advance('get');
                    if (!option.es5) {
                        error("get/set are ES5 features.");
                    }
                    i = property_name();
                    if (!i) {
                        error("Missing property name.");
                    }
                    saveGetter(i);
                    t = nexttoken;
                    adjacent(token, nexttoken);
                    f = doFunction();
                    p = f['(params)'];
                    if (p) {
                        warning("Unexpected parameter '{a}' in get {b} function.", t, p[0], i);
                    }
                    adjacent(token, nexttoken);
                } else if (nexttoken.value === 'set' && peek().id !== ':') {
                    advance('set');
                    if (!option.es5) {
                        error("get/set are ES5 features.");
                    }
                    i = property_name();
                    if (!i) {
                        error("Missing property name.");
                    }
                    saveSetter(i, nexttoken);
                    t = nexttoken;
                    adjacent(token, nexttoken);
                    f = doFunction();
                    p = f['(params)'];
                    if (!p || p.length !== 1) {
                        warning("Expected a single parameter in set {a} function.", t, i);
                    }
                } else {
                    i = property_name();
                    saveProperty(i, nexttoken);
                    if (typeof i !== 'string') {
                        break;
                    }
                    advance(':');
                    nonadjacent(token, nexttoken);
                    expression(10);
                }

                countMember(i);
                if (nexttoken.id === ',') {
                    comma();
                    if (nexttoken.id === ',') {
                        warning("Extra comma.", token);
                    } else if (nexttoken.id === '}' && !option.es5) {
                        warning("Extra comma.", token);
                    }
                } else {
                    break;
                }
            }
            if (b) {
                indent -= option.indent;
                indentation();
            }
            advance('}', this);

            // Check for lonely setters if in the ES5 mode.
            if (option.es5) {
                for (var name in props) {
                    if (is_own(props, name) && props[name].setter && !props[name].getter) {
                        warning("Setter is defined without getter.", props[name].setterToken);
                    }
                }
            }
            return this;
        };
        x.fud = function () {
            error("Expected to see a statement and instead saw a block.", token);
        };
    }(delim('{')));

// This Function is called when esnext option is set to true
// it adds the `const` statement to JSHINT

    useESNextSyntax = function () {
        var conststatement = stmt('const', function (prefix) {
            var id, name, value;

            this.first = [];
            for (;;) {
                nonadjacent(token, nexttoken);
                id = identifier();
                if (funct[id] === "const") {
                    warning("const '" + id + "' has already been declared");
                }
                if (funct['(global)'] && predefined[id] === false) {
                    warning("Redefinition of '{a}'.", token, id);
                }
                addlabel(id, 'const');
                if (prefix) {
                    break;
                }
                name = token;
                this.first.push(token);

                if (nexttoken.id !== "=") {
                    warning("const " +
                      "'{a}' is initialized to 'undefined'.", token, id);
                }

                if (nexttoken.id === '=') {
                    nonadjacent(token, nexttoken);
                    advance('=');
                    nonadjacent(token, nexttoken);
                    if (nexttoken.id === 'undefined') {
                        warning("It is not necessary to initialize " +
                          "'{a}' to 'undefined'.", token, id);
                    }
                    if (peek(0).id === '=' && nexttoken.identifier) {
                        error("Constant {a} was not declared correctly.",
                                nexttoken, nexttoken.value);
                    }
                    value = expression(0);
                    name.first = value;
                }

                if (nexttoken.id !== ',') {
                    break;
                }
                comma();
            }
            return this;
        });
        conststatement.exps = true;
    };

    var varstatement = stmt('var', function (prefix) {
        // JavaScript does not have block scope. It only has function scope. So,
        // declaring a variable in a block can have unexpected consequences.
        var id, name, value;

        if (funct['(onevar)'] && option.onevar) {
            warning("Too many var statements.");
        } else if (!funct['(global)']) {
            funct['(onevar)'] = true;
        }
        this.first = [];
        for (;;) {
            nonadjacent(token, nexttoken);
            id = identifier();
            if (option.esnext && funct[id] === "const") {
                warning("const '" + id + "' has already been declared");
            }
            if (funct['(global)'] && predefined[id] === false) {
                warning("Redefinition of '{a}'.", token, id);
            }
            addlabel(id, 'unused');
            if (prefix) {
                break;
            }
            name = token;
            this.first.push(token);
            if (nexttoken.id === '=') {
                nonadjacent(token, nexttoken);
                advance('=');
                nonadjacent(token, nexttoken);
                if (nexttoken.id === 'undefined') {
                    warning("It is not necessary to initialize '{a}' to 'undefined'.", token, id);
                }
                if (peek(0).id === '=' && nexttoken.identifier) {
                    error("Variable {a} was not declared correctly.",
                            nexttoken, nexttoken.value);
                }
                value = expression(0);
                name.first = value;
            }
            if (nexttoken.id !== ',') {
                break;
            }
            comma();
        }
        return this;
    });
    varstatement.exps = true;

    blockstmt('function', function () {
        if (inblock) {
            warning("Function declarations should not be placed in blocks. " +
                "Use a function expression or move the statement to the top of " +
                "the outer function.", token);

        }
        var i = identifier();
        if (option.esnext && funct[i] === "const") {
            warning("const '" + i + "' has already been declared");
        }
        adjacent(token, nexttoken);
        addlabel(i, 'unction');
        doFunction(i, true);
        if (nexttoken.id === '(' && nexttoken.line === token.line) {
            error(
"Function declarations are not invocable. Wrap the whole function invocation in parens.");
        }
        return this;
    });

    prefix('function', function () {
        var i = optionalidentifier();
        if (i) {
            adjacent(token, nexttoken);
        } else {
            nonadjacent(token, nexttoken);
        }
        doFunction(i);
        if (!option.loopfunc && funct['(loopage)']) {
            warning("Don't make functions within a loop.");
        }
        return this;
    });

    blockstmt('if', function () {
        var t = nexttoken;
        advance('(');
        nonadjacent(this, t);
        nospace();
        expression(20);
        if (nexttoken.id === '=') {
            if (!option.boss)
                warning("Expected a conditional expression and instead saw an assignment.");
            advance('=');
            expression(20);
        }
        advance(')', t);
        nospace(prevtoken, token);
        block(true, true);
        if (nexttoken.id === 'else') {
            nonadjacent(token, nexttoken);
            advance('else');
            if (nexttoken.id === 'if' || nexttoken.id === 'switch') {
                statement(true);
            } else {
                block(true, true);
            }
        }
        return this;
    });

    blockstmt('try', function () {
        var b, e, s;

        block(false);
        if (nexttoken.id === 'catch') {
            advance('catch');
            nonadjacent(token, nexttoken);
            advance('(');
            s = scope;
            scope = Object.create(s);
            e = nexttoken.value;
            if (nexttoken.type !== '(identifier)') {
                warning("Expected an identifier and instead saw '{a}'.",
                    nexttoken, e);
            } else {
                addlabel(e, 'exception');
            }
            advance();
            advance(')');
            block(false);
            b = true;
            scope = s;
        }
        if (nexttoken.id === 'finally') {
            advance('finally');
            block(false);
            return;
        } else if (!b) {
            error("Expected '{a}' and instead saw '{b}'.",
                    nexttoken, 'catch', nexttoken.value);
        }
        return this;
    });

    blockstmt('while', function () {
        var t = nexttoken;
        funct['(breakage)'] += 1;
        funct['(loopage)'] += 1;
        advance('(');
        nonadjacent(this, t);
        nospace();
        expression(20);
        if (nexttoken.id === '=') {
            if (!option.boss)
                warning("Expected a conditional expression and instead saw an assignment.");
            advance('=');
            expression(20);
        }
        advance(')', t);
        nospace(prevtoken, token);
        block(true, true);
        funct['(breakage)'] -= 1;
        funct['(loopage)'] -= 1;
        return this;
    }).labelled = true;

    blockstmt('with', function () {
        var t = nexttoken;
        if (directive['use strict']) {
            error("'with' is not allowed in strict mode.", token);
        } else if (!option.withstmt) {
            warning("Don't use 'with'.", token);
        }

        advance('(');
        nonadjacent(this, t);
        nospace();
        expression(0);
        advance(')', t);
        nospace(prevtoken, token);
        block(true, true);

        return this;
    });

    blockstmt('switch', function () {
        var t = nexttoken,
            g = false;
        funct['(breakage)'] += 1;
        advance('(');
        nonadjacent(this, t);
        nospace();
        this.condition = expression(20);
        advance(')', t);
        nospace(prevtoken, token);
        nonadjacent(token, nexttoken);
        t = nexttoken;
        advance('{');
        nonadjacent(token, nexttoken);
        indent += option.indent;
        this.cases = [];
        for (;;) {
            switch (nexttoken.id) {
            case 'case':
                switch (funct['(verb)']) {
                case 'break':
                case 'case':
                case 'continue':
                case 'return':
                case 'switch':
                case 'throw':
                    break;
                default:
                    // You can tell JSHint that you don't use break intentionally by
                    // adding a comment /* falls through */ on a line just before
                    // the next `case`.
                    if (!ft.test(lines[nexttoken.line - 2])) {
                        warning(
                            "Expected a 'break' statement before 'case'.",
                            token);
                    }
                }
                indentation(-option.indent);
                advance('case');
                this.cases.push(expression(20));
                g = true;
                advance(':');
                funct['(verb)'] = 'case';
                break;
            case 'default':
                switch (funct['(verb)']) {
                case 'break':
                case 'continue':
                case 'return':
                case 'throw':
                    break;
                default:
                    if (!ft.test(lines[nexttoken.line - 2])) {
                        warning(
                            "Expected a 'break' statement before 'default'.",
                            token);
                    }
                }
                indentation(-option.indent);
                advance('default');
                g = true;
                advance(':');
                break;
            case '}':
                indent -= option.indent;
                indentation();
                advance('}', t);
                if (this.cases.length === 1 || this.condition.id === 'true' ||
                        this.condition.id === 'false') {
                    if (!option.onecase)
                        warning("This 'switch' should be an 'if'.", this);
                }
                funct['(breakage)'] -= 1;
                funct['(verb)'] = undefined;
                return;
            case '(end)':
                error("Missing '{a}'.", nexttoken, '}');
                return;
            default:
                if (g) {
                    switch (token.id) {
                    case ',':
                        error("Each value should have its own case label.");
                        return;
                    case ':':
                        g = false;
                        statements();
                        break;
                    default:
                        error("Missing ':' on a case clause.", token);
                        return;
                    }
                } else {
                    if (token.id === ':') {
                        advance(':');
                        error("Unexpected '{a}'.", token, ':');
                        statements();
                    } else {
                        error("Expected '{a}' and instead saw '{b}'.",
                            nexttoken, 'case', nexttoken.value);
                        return;
                    }
                }
            }
        }
    }).labelled = true;

    stmt('debugger', function () {
        if (!option.debug) {
            warning("All 'debugger' statements should be removed.");
        }
        return this;
    }).exps = true;

    (function () {
        var x = stmt('do', function () {
            funct['(breakage)'] += 1;
            funct['(loopage)'] += 1;
            this.first = block(true);
            advance('while');
            var t = nexttoken;
            nonadjacent(token, t);
            advance('(');
            nospace();
            expression(20);
            if (nexttoken.id === '=') {
                if (!option.boss)
                    warning("Expected a conditional expression and instead saw an assignment.");
                advance('=');
                expression(20);
            }
            advance(')', t);
            nospace(prevtoken, token);
            funct['(breakage)'] -= 1;
            funct['(loopage)'] -= 1;
            return this;
        });
        x.labelled = true;
        x.exps = true;
    }());

    blockstmt('for', function () {
        var s, t = nexttoken;
        funct['(breakage)'] += 1;
        funct['(loopage)'] += 1;
        advance('(');
        nonadjacent(this, t);
        nospace();
        if (peek(nexttoken.id === 'var' ? 1 : 0).id === 'in') {
            if (nexttoken.id === 'var') {
                advance('var');
                varstatement.fud.call(varstatement, true);
            } else {
                switch (funct[nexttoken.value]) {
                case 'unused':
                    funct[nexttoken.value] = 'var';
                    break;
                case 'var':
                    break;
                default:
                    warning("Bad for in variable '{a}'.",
                            nexttoken, nexttoken.value);
                }
                advance();
            }
            advance('in');
            expression(20);
            advance(')', t);
            s = block(true, true);
            if (option.forin && s && (s.length > 1 || typeof s[0] !== 'object' ||
                    s[0].value !== 'if')) {
                warning("The body of a for in should be wrapped in an if statement to filter " +
                        "unwanted properties from the prototype.", this);
            }
            funct['(breakage)'] -= 1;
            funct['(loopage)'] -= 1;
            return this;
        } else {
            if (nexttoken.id !== ';') {
                if (nexttoken.id === 'var') {
                    advance('var');
                    varstatement.fud.call(varstatement);
                } else {
                    for (;;) {
                        expression(0, 'for');
                        if (nexttoken.id !== ',') {
                            break;
                        }
                        comma();
                    }
                }
            }
            nolinebreak(token);
            advance(';');
            if (nexttoken.id !== ';') {
                expression(20);
                if (nexttoken.id === '=') {
                    if (!option.boss)
                        warning("Expected a conditional expression and instead saw an assignment.");
                    advance('=');
                    expression(20);
                }
            }
            nolinebreak(token);
            advance(';');
            if (nexttoken.id === ';') {
                error("Expected '{a}' and instead saw '{b}'.",
                        nexttoken, ')', ';');
            }
            if (nexttoken.id !== ')') {
                for (;;) {
                    expression(0, 'for');
                    if (nexttoken.id !== ',') {
                        break;
                    }
                    comma();
                }
            }
            advance(')', t);
            nospace(prevtoken, token);
            block(true, true);
            funct['(breakage)'] -= 1;
            funct['(loopage)'] -= 1;
            return this;
        }
    }).labelled = true;


    stmt('break', function () {
        var v = nexttoken.value;

        if (funct['(breakage)'] === 0)
            warning("Unexpected '{a}'.", nexttoken, this.value);

        if (!option.asi)
            nolinebreak(this);

        if (nexttoken.id !== ';') {
            if (token.line === nexttoken.line) {
                if (funct[v] !== 'label') {
                    warning("'{a}' is not a statement label.", nexttoken, v);
                } else if (scope[v] !== funct) {
                    warning("'{a}' is out of scope.", nexttoken, v);
                }
                this.first = nexttoken;
                advance();
            }
        }
        reachable('break');
        return this;
    }).exps = true;


    stmt('continue', function () {
        var v = nexttoken.value;

        if (funct['(breakage)'] === 0)
            warning("Unexpected '{a}'.", nexttoken, this.value);

        if (!option.asi)
            nolinebreak(this);

        if (nexttoken.id !== ';') {
            if (token.line === nexttoken.line) {
                if (funct[v] !== 'label') {
                    warning("'{a}' is not a statement label.", nexttoken, v);
                } else if (scope[v] !== funct) {
                    warning("'{a}' is out of scope.", nexttoken, v);
                }
                this.first = nexttoken;
                advance();
            }
        } else if (!funct['(loopage)']) {
            warning("Unexpected '{a}'.", nexttoken, this.value);
        }
        reachable('continue');
        return this;
    }).exps = true;


    stmt('return', function () {
        if (this.line === nexttoken.line) {
            if (nexttoken.id === '(regexp)')
                warning("Wrap the /regexp/ literal in parens to disambiguate the slash operator.");

            if (nexttoken.id !== ';' && !nexttoken.reach) {
                nonadjacent(token, nexttoken);
                if (peek().value === "=" && !option.boss) {
                    warningAt("Did you mean to return a conditional instead of an assignment?",
                              token.line, token.character + 1);
                }
                this.first = expression(0);
            }
        } else if (!option.asi) {
            nolinebreak(this); // always warn (Line breaking error)
        }
        reachable('return');
        return this;
    }).exps = true;


    stmt('throw', function () {
        nolinebreak(this);
        nonadjacent(token, nexttoken);
        this.first = expression(20);
        reachable('throw');
        return this;
    }).exps = true;

//  Superfluous reserved words

    reserve('class');
    reserve('const');
    reserve('enum');
    reserve('export');
    reserve('extends');
    reserve('import');
    reserve('super');

    reserve('let');
    reserve('yield');
    reserve('implements');
    reserve('interface');
    reserve('package');
    reserve('private');
    reserve('protected');
    reserve('public');
    reserve('static');


// Parse JSON

    function jsonValue() {

        function jsonObject() {
            var o = {}, t = nexttoken;
            advance('{');
            if (nexttoken.id !== '}') {
                for (;;) {
                    if (nexttoken.id === '(end)') {
                        error("Missing '}' to match '{' from line {a}.",
                                nexttoken, t.line);
                    } else if (nexttoken.id === '}') {
                        warning("Unexpected comma.", token);
                        break;
                    } else if (nexttoken.id === ',') {
                        error("Unexpected comma.", nexttoken);
                    } else if (nexttoken.id !== '(string)') {
                        warning("Expected a string and instead saw {a}.",
                                nexttoken, nexttoken.value);
                    }
                    if (o[nexttoken.value] === true) {
                        warning("Duplicate key '{a}'.",
                                nexttoken, nexttoken.value);
                    } else if ((nexttoken.value === '__proto__' &&
                        !option.proto) || (nexttoken.value === '__iterator__' &&
                        !option.iterator)) {
                        warning("The '{a}' key may produce unexpected results.",
                            nexttoken, nexttoken.value);
                    } else {
                        o[nexttoken.value] = true;
                    }
                    advance();
                    advance(':');
                    jsonValue();
                    if (nexttoken.id !== ',') {
                        break;
                    }
                    advance(',');
                }
            }
            advance('}');
        }

        function jsonArray() {
            var t = nexttoken;
            advance('[');
            if (nexttoken.id !== ']') {
                for (;;) {
                    if (nexttoken.id === '(end)') {
                        error("Missing ']' to match '[' from line {a}.",
                                nexttoken, t.line);
                    } else if (nexttoken.id === ']') {
                        warning("Unexpected comma.", token);
                        break;
                    } else if (nexttoken.id === ',') {
                        error("Unexpected comma.", nexttoken);
                    }
                    jsonValue();
                    if (nexttoken.id !== ',') {
                        break;
                    }
                    advance(',');
                }
            }
            advance(']');
        }

        switch (nexttoken.id) {
        case '{':
            jsonObject();
            break;
        case '[':
            jsonArray();
            break;
        case 'true':
        case 'false':
        case 'null':
        case '(number)':
        case '(string)':
            advance();
            break;
        case '-':
            advance('-');
            if (token.character !== nexttoken.from) {
                warning("Unexpected space after '-'.", token);
            }
            adjacent(token, nexttoken);
            advance('(number)');
            break;
        default:
            error("Expected a JSON value.", nexttoken);
        }
    }


// The actual JSHINT function itself.

    var itself = function (s, o, g) {
        var a, i, k, x,
            optionKeys,
            newOptionObj = {};

        JSHINT.errors = [];
        JSHINT.undefs = [];
        predefined = Object.create(standard);
        combine(predefined, g || {});
        if (o) {
            a = o.predef;
            if (a) {
                if (Array.isArray(a)) {
                    for (i = 0; i < a.length; i += 1) {
                        predefined[a[i]] = true;
                    }
                } else if (typeof a === 'object') {
                    k = Object.keys(a);
                    for (i = 0; i < k.length; i += 1) {
                        predefined[k[i]] = !!a[k[i]];
                    }
                }
            }
            optionKeys = Object.keys(o);
            for (x = 0; x < optionKeys.length; x++) {
                newOptionObj[optionKeys[x]] = o[optionKeys[x]];
            }
        }

        option = newOptionObj;

        option.indent = option.indent || 4;
        option.maxerr = option.maxerr || 50;

        tab = '';
        for (i = 0; i < option.indent; i += 1) {
            tab += ' ';
        }
        indent = 1;
        global = Object.create(predefined);
        scope = global;
        funct = {
            '(global)': true,
            '(name)': '(global)',
            '(scope)': scope,
            '(breakage)': 0,
            '(loopage)': 0
        };
        functions = [funct];
        urls = [];
        stack = null;
        member = {};
        membersOnly = null;
        implied = {};
        inblock = false;
        lookahead = [];
        jsonmode = false;
        warnings = 0;
        lex.init(s);
        prereg = true;
        directive = {};

        prevtoken = token = nexttoken = syntax['(begin)'];

        // Check options
        for (var name in o) {
            if (is_own(o, name)) {
                checkOption(name, token);
            }
        }

        assume();

        // combine the passed globals after we've assumed all our options
        combine(predefined, g || {});

        //reset values
        comma.first = true;

        try {
            advance();
            switch (nexttoken.id) {
            case '{':
            case '[':
                option.laxbreak = true;
                jsonmode = true;
                jsonValue();
                break;
            default:
                directives();
                if (directive["use strict"] && !option.globalstrict) {
                    warning("Use the function form of \"use strict\".", prevtoken);
                }

                statements();
            }
            advance('(end)');

            var markDefined = function (name, context) {
                do {
                    if (typeof context[name] === 'string') {
                        // JSHINT marks unused variables as 'unused' and
                        // unused function declaration as 'unction'. This
                        // code changes such instances back 'var' and
                        // 'closure' so that the code in JSHINT.data()
                        // doesn't think they're unused.

                        if (context[name] === 'unused')
                            context[name] = 'var';
                        else if (context[name] === 'unction')
                            context[name] = 'closure';

                        return true;
                    }

                    context = context['(context)'];
                } while (context);

                return false;
            };

            var clearImplied = function (name, line) {
                if (!implied[name])
                    return;

                var newImplied = [];
                for (var i = 0; i < implied[name].length; i += 1) {
                    if (implied[name][i] !== line)
                        newImplied.push(implied[name][i]);
                }

                if (newImplied.length === 0)
                    delete implied[name];
                else
                    implied[name] = newImplied;
            };

            // Check queued 'x is not defined' instances to see if they're still undefined.
            for (i = 0; i < JSHINT.undefs.length; i += 1) {
                k = JSHINT.undefs[i].slice(0);

                if (markDefined(k[2].value, k[0])) {
                    clearImplied(k[2].value, k[2].line);
                } else {
                    warning.apply(warning, k.slice(1));
                }
            }
        } catch (e) {
            if (e) {
                var nt = nexttoken || {};
                JSHINT.errors.push({
                    raw       : e.raw,
                    reason    : e.message,
                    line      : e.line || nt.line,
                    character : e.character || nt.from
                }, null);
            }
        }

        return JSHINT.errors.length === 0;
    };

    // Data summary.
    itself.data = function () {

        var data = { functions: [], options: option }, fu, globals, implieds = [], f, i, j,
            members = [], n, unused = [], v;
        if (itself.errors.length) {
            data.errors = itself.errors;
        }

        if (jsonmode) {
            data.json = true;
        }

        for (n in implied) {
            if (is_own(implied, n)) {
                implieds.push({
                    name: n,
                    line: implied[n]
                });
            }
        }
        if (implieds.length > 0) {
            data.implieds = implieds;
        }

        if (urls.length > 0) {
            data.urls = urls;
        }

        globals = Object.keys(scope);
        if (globals.length > 0) {
            data.globals = globals;
        }
        for (i = 1; i < functions.length; i += 1) {
            f = functions[i];
            fu = {};
            for (j = 0; j < functionicity.length; j += 1) {
                fu[functionicity[j]] = [];
            }
            for (n in f) {
                if (is_own(f, n) && n.charAt(0) !== '(') {
                    v = f[n];
                    if (v === 'unction') {
                        v = 'unused';
                    }
                    if (Array.isArray(fu[v])) {
                        fu[v].push(n);
                        if (v === 'unused') {
                            unused.push({
                                name: n,
                                line: f['(line)'],
                                'function': f['(name)']
                            });
                        }
                    }
                }
            }
            for (j = 0; j < functionicity.length; j += 1) {
                if (fu[functionicity[j]].length === 0) {
                    delete fu[functionicity[j]];
                }
            }
            fu.name = f['(name)'];
            fu.param = f['(params)'];
            fu.line = f['(line)'];
            fu.last = f['(last)'];
            data.functions.push(fu);
        }

        if (unused.length > 0) {
            data.unused = unused;
        }

        members = [];
        for (n in member) {
            if (typeof member[n] === 'number') {
                data.member = member;
                break;
            }
        }

        return data;
    };

    itself.report = function (option) {
        var data = itself.data();

        var a = [], c, e, err, f, i, k, l, m = '', n, o = [], s;

        function detail(h, array) {
            var b, i, singularity;
            if (array) {
                o.push('<div><i>' + h + '</i> ');
                array = array.sort();
                for (i = 0; i < array.length; i += 1) {
                    if (array[i] !== singularity) {
                        singularity = array[i];
                        o.push((b ? ', ' : '') + singularity);
                        b = true;
                    }
                }
                o.push('</div>');
            }
        }


        if (data.errors || data.implieds || data.unused) {
            err = true;
            o.push('<div id=errors><i>Error:</i>');
            if (data.errors) {
                for (i = 0; i < data.errors.length; i += 1) {
                    c = data.errors[i];
                    if (c) {
                        e = c.evidence || '';
                        o.push('<p>Problem' + (isFinite(c.line) ? ' at line ' +
                                c.line + ' character ' + c.character : '') +
                                ': ' + c.reason.entityify() +
                                '</p><p class=evidence>' +
                                (e && (e.length > 80 ? e.slice(0, 77) + '...' :
                                e).entityify()) + '</p>');
                    }
                }
            }

            if (data.implieds) {
                s = [];
                for (i = 0; i < data.implieds.length; i += 1) {
                    s[i] = '<code>' + data.implieds[i].name + '</code>&nbsp;<i>' +
                        data.implieds[i].line + '</i>';
                }
                o.push('<p><i>Implied global:</i> ' + s.join(', ') + '</p>');
            }

            if (data.unused) {
                s = [];
                for (i = 0; i < data.unused.length; i += 1) {
                    s[i] = '<code><u>' + data.unused[i].name + '</u></code>&nbsp;<i>' +
                        data.unused[i].line + '</i> <code>' +
                        data.unused[i]['function'] + '</code>';
                }
                o.push('<p><i>Unused variable:</i> ' + s.join(', ') + '</p>');
            }
            if (data.json) {
                o.push('<p>JSON: bad.</p>');
            }
            o.push('</div>');
        }

        if (!option) {

            o.push('<br><div id=functions>');

            if (data.urls) {
                detail("URLs<br>", data.urls, '<br>');
            }

            if (data.json && !err) {
                o.push('<p>JSON: good.</p>');
            } else if (data.globals) {
                o.push('<div><i>Global</i> ' +
                        data.globals.sort().join(', ') + '</div>');
            } else {
                o.push('<div><i>No new global variables introduced.</i></div>');
            }

            for (i = 0; i < data.functions.length; i += 1) {
                f = data.functions[i];

                o.push('<br><div class=function><i>' + f.line + '-' +
                        f.last + '</i> ' + (f.name || '') + '(' +
                        (f.param ? f.param.join(', ') : '') + ')</div>');
                detail('<big><b>Unused</b></big>', f.unused);
                detail('Closure', f.closure);
                detail('Variable', f['var']);
                detail('Exception', f.exception);
                detail('Outer', f.outer);
                detail('Global', f.global);
                detail('Label', f.label);
            }

            if (data.member) {
                a = Object.keys(data.member);
                if (a.length) {
                    a = a.sort();
                    m = '<br><pre id=members>/*members ';
                    l = 10;
                    for (i = 0; i < a.length; i += 1) {
                        k = a[i];
                        n = k.name();
                        if (l + n.length > 72) {
                            o.push(m + '<br>');
                            m = '    ';
                            l = 1;
                        }
                        l += n.length + 2;
                        if (data.member[k] === 1) {
                            n = '<i>' + n + '</i>';
                        }
                        if (i < a.length - 1) {
                            n += ', ';
                        }
                        m += n;
                    }
                    o.push(m + '<br>*/</pre>');
                }
                o.push('</div>');
            }
        }
        return o.join('');
    };

    itself.jshint = itself;

    return itself;
}());

// Make JSHINT a Node module, if possible.
if (typeof exports === 'object' && exports)
    exports.JSHINT = JSHINT;



/* CodeMirror - Minified & Bundled
   Generated on 23/1/2015 with http://codemirror.net/doc/compress.html
   Version: HEAD

   CodeMirror Library:
   - codemirror.js
   Modes:
   - commonlisp.js
   - javascript.js
   - python.js
   Add-ons:
   - active-line.js
   - brace-fold.js
   - foldcode.js
   - foldgutter.js
   - javascript-hint.js
   - javascript-lint.js
   - lint.js
   - matchbrackets.js
   - show-hint.js
 */

!function(a){if("object"==typeof exports&&"object"==typeof module)module.exports=a();else{if("function"==typeof define&&define.amd)return define([],a);this.CodeMirror=a()}}(function(){"use strict";function w(a,b){if(!(this instanceof w))return new w(a,b);this.options=b=b?Xg(b):{},Xg(pe,b,!1),J(b);var c=b.value;"string"==typeof c&&(c=new Sf(c,b.mode)),this.doc=c;var g=this.display=new x(a,c);g.wrapper.CodeMirror=this,F(this),D(this),b.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),b.autofocus&&!o&&fd(this),N(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,draggingText:!1,highlight:new Ng,keySeq:null},d&&11>e&&setTimeout(Yg(ed,this,!0),20),id(this),ph(),Gc(this),this.curOp.forceUpdate=!0,Wf(this,c),b.autofocus&&!o||ih()==g.input?setTimeout(Yg(Od,this),20):Pd(this);for(var h in qe)qe.hasOwnProperty(h)&&qe[h](this,b[h],se);S(this);for(var i=0;i<we.length;++i)we[i](this);Ic(this),f&&b.lineWrapping&&"optimizelegibility"==getComputedStyle(g.lineDiv).textRendering&&(g.lineDiv.style.textRendering="auto")}function x(a,b){var c=this,g=c.input=dh("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none");f?g.style.width="1000px":g.setAttribute("wrap","off"),n&&(g.style.border="1px solid black"),g.setAttribute("autocorrect","off"),g.setAttribute("autocapitalize","off"),g.setAttribute("spellcheck","false"),c.inputDiv=dh("div",[g],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),c.scrollbarFiller=dh("div",null,"CodeMirror-scrollbar-filler"),c.scrollbarFiller.setAttribute("not-content","true"),c.gutterFiller=dh("div",null,"CodeMirror-gutter-filler"),c.gutterFiller.setAttribute("not-content","true"),c.lineDiv=dh("div",null,"CodeMirror-code"),c.selectionDiv=dh("div",null,null,"position: relative; z-index: 1"),c.cursorDiv=dh("div",null,"CodeMirror-cursors"),c.measure=dh("div",null,"CodeMirror-measure"),c.lineMeasure=dh("div",null,"CodeMirror-measure"),c.lineSpace=dh("div",[c.measure,c.lineMeasure,c.selectionDiv,c.cursorDiv,c.lineDiv],null,"position: relative; outline: none"),c.mover=dh("div",[dh("div",[c.lineSpace],"CodeMirror-lines")],null,"position: relative"),c.sizer=dh("div",[c.mover],"CodeMirror-sizer"),c.sizerWidth=null,c.heightForcer=dh("div",null,null,"position: absolute; height: "+Ig+"px; width: 1px;"),c.gutters=dh("div",null,"CodeMirror-gutters"),c.lineGutter=null,c.scroller=dh("div",[c.sizer,c.heightForcer,c.gutters],"CodeMirror-scroll"),c.scroller.setAttribute("tabIndex","-1"),c.wrapper=dh("div",[c.inputDiv,c.scrollbarFiller,c.gutterFiller,c.scroller],"CodeMirror"),d&&8>e&&(c.gutters.style.zIndex=-1,c.scroller.style.paddingRight=0),n&&(g.style.width="0px"),f||(c.scroller.draggable=!0),k&&(c.inputDiv.style.height="1px",c.inputDiv.style.position="absolute"),a&&(a.appendChild?a.appendChild(c.wrapper):a(c.wrapper)),c.viewFrom=c.viewTo=b.first,c.reportedViewFrom=c.reportedViewTo=b.first,c.view=[],c.renderedView=null,c.externalMeasured=null,c.viewOffset=0,c.lastWrapHeight=c.lastWrapWidth=0,c.updateLineNumbers=null,c.nativeBarWidth=c.barHeight=c.barWidth=0,c.scrollbarsClipped=!1,c.lineNumWidth=c.lineNumInnerWidth=c.lineNumChars=null,c.prevInput="",c.alignWidgets=!1,c.pollingFast=!1,c.poll=new Ng,c.cachedCharWidth=c.cachedTextHeight=c.cachedPaddingH=null,c.inaccurateSelection=!1,c.maxLine=null,c.maxLineLength=0,c.maxLineChanged=!1,c.wheelDX=c.wheelDY=c.wheelStartX=c.wheelStartY=null,c.shift=!1,c.selForContextMenu=null}function y(a){a.doc.mode=w.getMode(a.options,a.doc.modeOption),z(a)}function z(a){a.doc.iter(function(a){a.stateAfter&&(a.stateAfter=null),a.styles&&(a.styles=null)}),a.doc.frontier=a.doc.first,Wb(a,100),a.state.modeGen++,a.curOp&&Vc(a)}function A(a){a.options.lineWrapping?(lh(a.display.wrapper,"CodeMirror-wrap"),a.display.sizer.style.minWidth="",a.display.sizerWidth=null):(kh(a.display.wrapper,"CodeMirror-wrap"),I(a)),C(a),Vc(a),qc(a),setTimeout(function(){O(a)},100)}function B(a){var b=Cc(a.display),c=a.options.lineWrapping,d=c&&Math.max(5,a.display.scroller.clientWidth/Dc(a.display)-3);return function(e){if(mf(a.doc,e))return 0;var f=0;if(e.widgets)for(var g=0;g<e.widgets.length;g++)e.widgets[g].height&&(f+=e.widgets[g].height);return c?f+(Math.ceil(e.text.length/d)||1)*b:f+b}}function C(a){var b=a.doc,c=B(a);b.iter(function(a){var b=c(a);b!=a.height&&$f(a,b)})}function D(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-"),qc(a)}function E(a){F(a),Vc(a),setTimeout(function(){R(a)},20)}function F(a){var b=a.display.gutters,c=a.options.gutters;fh(b);for(var d=0;d<c.length;++d){var e=c[d],f=b.appendChild(dh("div",null,"CodeMirror-gutter "+e));"CodeMirror-linenumbers"==e&&(a.display.lineGutter=f,f.style.width=(a.display.lineNumWidth||1)+"px")}b.style.display=d?"":"none",G(a)}function G(a){var b=a.display.gutters.offsetWidth;a.display.sizer.style.marginLeft=b+"px"}function H(a){if(0==a.height)return 0;for(var c,b=a.text.length,d=a;c=ef(d);){var e=c.find(0,!0);d=e.from.line,b+=e.from.ch-e.to.ch}for(d=a;c=ff(d);){var e=c.find(0,!0);b-=d.text.length-e.from.ch,d=e.to.line,b+=d.text.length-e.to.ch}return b}function I(a){var b=a.display,c=a.doc;b.maxLine=Xf(c,c.first),b.maxLineLength=H(b.maxLine),b.maxLineChanged=!0,c.iter(function(a){var c=H(a);c>b.maxLineLength&&(b.maxLineLength=c,b.maxLine=a)})}function J(a){var b=Ug(a.gutters,"CodeMirror-linenumbers");-1==b&&a.lineNumbers?a.gutters=a.gutters.concat(["CodeMirror-linenumbers"]):b>-1&&!a.lineNumbers&&(a.gutters=a.gutters.slice(0),a.gutters.splice(b,1))}function K(a){var b=a.display,c=b.gutters.offsetWidth,d=Math.round(a.doc.height+_b(a.display));return{clientHeight:b.scroller.clientHeight,viewHeight:b.wrapper.clientHeight,scrollWidth:b.scroller.scrollWidth,clientWidth:b.scroller.clientWidth,viewWidth:b.wrapper.clientWidth,barLeft:a.options.fixedGutter?c:0,docHeight:d,scrollHeight:d+bc(a)+b.barHeight,nativeBarWidth:b.nativeBarWidth,gutterWidth:c}}function L(a,b,c){this.cm=c;var f=this.vert=dh("div",[dh("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),g=this.horiz=dh("div",[dh("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");a(f),a(g),yg(f,"scroll",function(){f.clientHeight&&b(f.scrollTop,"vertical")}),yg(g,"scroll",function(){g.clientWidth&&b(g.scrollLeft,"horizontal")}),this.checkedOverlay=!1,d&&8>e&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")}function M(){}function N(a){a.display.scrollbars&&(a.display.scrollbars.clear(),a.display.scrollbars.addClass&&kh(a.display.wrapper,a.display.scrollbars.addClass)),a.display.scrollbars=new w.scrollbarModel[a.options.scrollbarStyle](function(b){a.display.wrapper.insertBefore(b,a.display.scrollbarFiller),yg(b,"mousedown",function(){a.state.focused&&setTimeout(Yg(fd,a),0)}),b.setAttribute("not-content","true")},function(b,c){"horizontal"==c?yd(a,b):xd(a,b)},a),a.display.scrollbars.addClass&&lh(a.display.wrapper,a.display.scrollbars.addClass)}function O(a,b){b||(b=K(a));var c=a.display.barWidth,d=a.display.barHeight;P(a,b);for(var e=0;4>e&&c!=a.display.barWidth||d!=a.display.barHeight;e++)c!=a.display.barWidth&&a.options.lineWrapping&&_(a),P(a,K(a)),c=a.display.barWidth,d=a.display.barHeight}function P(a,b){var c=a.display,d=c.scrollbars.update(b);c.sizer.style.paddingRight=(c.barWidth=d.right)+"px",c.sizer.style.paddingBottom=(c.barHeight=d.bottom)+"px",d.right&&d.bottom?(c.scrollbarFiller.style.display="block",c.scrollbarFiller.style.height=d.bottom+"px",c.scrollbarFiller.style.width=d.right+"px"):c.scrollbarFiller.style.display="",d.bottom&&a.options.coverGutterNextToScrollbar&&a.options.fixedGutter?(c.gutterFiller.style.display="block",c.gutterFiller.style.height=d.bottom+"px",c.gutterFiller.style.width=b.gutterWidth+"px"):c.gutterFiller.style.display=""}function Q(a,b,c){var d=c&&null!=c.top?Math.max(0,c.top):a.scroller.scrollTop;d=Math.floor(d-$b(a));var e=c&&null!=c.bottom?c.bottom:d+a.wrapper.clientHeight,f=ag(b,d),g=ag(b,e);if(c&&c.ensure){var h=c.ensure.from.line,i=c.ensure.to.line;f>h?(f=h,g=ag(b,bg(Xf(b,h))+a.wrapper.clientHeight)):Math.min(i,b.lastLine())>=g&&(f=ag(b,bg(Xf(b,i))-a.wrapper.clientHeight),g=i)}return{from:f,to:Math.max(g,f+1)}}function R(a){var b=a.display,c=b.view;if(b.alignWidgets||b.gutters.firstChild&&a.options.fixedGutter){for(var d=U(b)-b.scroller.scrollLeft+a.doc.scrollLeft,e=b.gutters.offsetWidth,f=d+"px",g=0;g<c.length;g++)if(!c[g].hidden){a.options.fixedGutter&&c[g].gutter&&(c[g].gutter.style.left=f);var h=c[g].alignable;if(h)for(var i=0;i<h.length;i++)h[i].style.left=f}a.options.fixedGutter&&(b.gutters.style.left=d+e+"px")}}function S(a){if(!a.options.lineNumbers)return!1;var b=a.doc,c=T(a.options,b.first+b.size-1),d=a.display;if(c.length!=d.lineNumChars){var e=d.measure.appendChild(dh("div",[dh("div",c)],"CodeMirror-linenumber CodeMirror-gutter-elt")),f=e.firstChild.offsetWidth,g=e.offsetWidth-f;return d.lineGutter.style.width="",d.lineNumInnerWidth=Math.max(f,d.lineGutter.offsetWidth-g),d.lineNumWidth=d.lineNumInnerWidth+g,d.lineNumChars=d.lineNumInnerWidth?c.length:-1,d.lineGutter.style.width=d.lineNumWidth+"px",G(a),!0}return!1}function T(a,b){return String(a.lineNumberFormatter(b+a.firstLineNumber))}function U(a){return a.scroller.getBoundingClientRect().left-a.sizer.getBoundingClientRect().left}function V(a,b,c){var d=a.display;this.viewport=b,this.visible=Q(d,a.doc,b),this.editorIsHidden=!d.wrapper.offsetWidth,this.wrapperHeight=d.wrapper.clientHeight,this.wrapperWidth=d.wrapper.clientWidth,this.oldDisplayWidth=cc(a),this.force=c,this.dims=bb(a)}function W(a){var b=a.display;!b.scrollbarsClipped&&b.scroller.offsetWidth&&(b.nativeBarWidth=b.scroller.offsetWidth-b.scroller.clientWidth,b.heightForcer.style.height=bc(a)+"px",b.sizer.style.marginBottom=-b.nativeBarWidth+"px",b.sizer.style.borderRightWidth=bc(a)+"px",b.scrollbarsClipped=!0)}function X(a,b){var c=a.display,d=a.doc;if(b.editorIsHidden)return Xc(a),!1;if(!b.force&&b.visible.from>=c.viewFrom&&b.visible.to<=c.viewTo&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo)&&c.renderedView==c.view&&0==_c(a))return!1;S(a)&&(Xc(a),b.dims=bb(a));var e=d.first+d.size,f=Math.max(b.visible.from-a.options.viewportMargin,d.first),g=Math.min(e,b.visible.to+a.options.viewportMargin);c.viewFrom<f&&f-c.viewFrom<20&&(f=Math.max(d.first,c.viewFrom)),c.viewTo>g&&c.viewTo-g<20&&(g=Math.min(e,c.viewTo)),v&&(f=kf(a.doc,f),g=lf(a.doc,g));var h=f!=c.viewFrom||g!=c.viewTo||c.lastWrapHeight!=b.wrapperHeight||c.lastWrapWidth!=b.wrapperWidth;$c(a,f,g),c.viewOffset=bg(Xf(a.doc,c.viewFrom)),a.display.mover.style.top=c.viewOffset+"px";var i=_c(a);if(!h&&0==i&&!b.force&&c.renderedView==c.view&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo))return!1;var j=ih();return i>4&&(c.lineDiv.style.display="none"),cb(a,c.updateLineNumbers,b.dims),i>4&&(c.lineDiv.style.display=""),c.renderedView=c.view,j&&ih()!=j&&j.offsetHeight&&j.focus(),fh(c.cursorDiv),fh(c.selectionDiv),c.gutters.style.height=0,h&&(c.lastWrapHeight=b.wrapperHeight,c.lastWrapWidth=b.wrapperWidth,Wb(a,400)),c.updateLineNumbers=null,!0}function Y(a,b){for(var c=b.force,d=b.viewport,e=!0;;e=!1){if(e&&a.options.lineWrapping&&b.oldDisplayWidth!=cc(a))c=!0;else if(c=!1,d&&null!=d.top&&(d={top:Math.min(a.doc.height+_b(a.display)-dc(a),d.top)}),b.visible=Q(a.display,a.doc,d),b.visible.from>=a.display.viewFrom&&b.visible.to<=a.display.viewTo)break;if(!X(a,b))break;_(a);var f=K(a);Sb(a),$(a,f),O(a,f)}Cg(a,"update",a),(a.display.viewFrom!=a.display.reportedViewFrom||a.display.viewTo!=a.display.reportedViewTo)&&(Cg(a,"viewportChange",a,a.display.viewFrom,a.display.viewTo),a.display.reportedViewFrom=a.display.viewFrom,a.display.reportedViewTo=a.display.viewTo)}function Z(a,b){var c=new V(a,b);if(X(a,c)){_(a),Y(a,c);var d=K(a);Sb(a),$(a,d),O(a,d)}}function $(a,b){a.display.sizer.style.minHeight=b.docHeight+"px";var c=b.docHeight+a.display.barHeight;a.display.heightForcer.style.top=c+"px",a.display.gutters.style.height=Math.max(c+bc(a),b.clientHeight)+"px"}function _(a){for(var b=a.display,c=b.lineDiv.offsetTop,f=0;f<b.view.length;f++){var h,g=b.view[f];if(!g.hidden){if(d&&8>e){var i=g.node.offsetTop+g.node.offsetHeight;h=i-c,c=i}else{var j=g.node.getBoundingClientRect();h=j.bottom-j.top}var k=g.line.height-h;if(2>h&&(h=Cc(b)),(k>.001||-.001>k)&&($f(g.line,h),ab(g.line),g.rest))for(var l=0;l<g.rest.length;l++)ab(g.rest[l])}}}function ab(a){if(a.widgets)for(var b=0;b<a.widgets.length;++b)a.widgets[b].height=a.widgets[b].node.offsetHeight}function bb(a){for(var b=a.display,c={},d={},e=b.gutters.clientLeft,f=b.gutters.firstChild,g=0;f;f=f.nextSibling,++g)c[a.options.gutters[g]]=f.offsetLeft+f.clientLeft+e,d[a.options.gutters[g]]=f.clientWidth;return{fixedPos:U(b),gutterTotalWidth:b.gutters.offsetWidth,gutterLeft:c,gutterWidth:d,wrapperWidth:b.wrapper.clientWidth}}function cb(a,b,c){function i(b){var c=b.nextSibling;return f&&p&&a.display.currentWheelTarget==b?b.style.display="none":b.parentNode.removeChild(b),c}for(var d=a.display,e=a.options.lineNumbers,g=d.lineDiv,h=g.firstChild,j=d.view,k=d.viewFrom,l=0;l<j.length;l++){var m=j[l];if(m.hidden);else if(m.node){for(;h!=m.node;)h=i(h);var o=e&&null!=b&&k>=b&&m.lineNumber;m.changes&&(Ug(m.changes,"gutter")>-1&&(o=!1),db(a,m,k,c)),o&&(fh(m.lineNumber),m.lineNumber.appendChild(document.createTextNode(T(a.options,k)))),h=m.node.nextSibling}else{var n=lb(a,m,k,c);g.insertBefore(n,h)}k+=m.size}for(;h;)h=i(h)}function db(a,b,c,d){for(var e=0;e<b.changes.length;e++){var f=b.changes[e];"text"==f?hb(a,b):"gutter"==f?jb(a,b,c,d):"class"==f?ib(b):"widget"==f&&kb(b,d)}b.changes=null}function eb(a){return a.node==a.text&&(a.node=dh("div",null,null,"position: relative"),a.text.parentNode&&a.text.parentNode.replaceChild(a.node,a.text),a.node.appendChild(a.text),d&&8>e&&(a.node.style.zIndex=2)),a.node}function fb(a){var b=a.bgClass?a.bgClass+" "+(a.line.bgClass||""):a.line.bgClass;if(b&&(b+=" CodeMirror-linebackground"),a.background)b?a.background.className=b:(a.background.parentNode.removeChild(a.background),a.background=null);else if(b){var c=eb(a);a.background=c.insertBefore(dh("div",null,b),c.firstChild)}}function gb(a,b){var c=a.display.externalMeasured;return c&&c.line==b.line?(a.display.externalMeasured=null,b.measure=c.measure,c.built):Gf(a,b)}function hb(a,b){var c=b.text.className,d=gb(a,b);b.text==b.node&&(b.node=d.pre),b.text.parentNode.replaceChild(d.pre,b.text),b.text=d.pre,d.bgClass!=b.bgClass||d.textClass!=b.textClass?(b.bgClass=d.bgClass,b.textClass=d.textClass,ib(b)):c&&(b.text.className=c)}function ib(a){fb(a),a.line.wrapClass?eb(a).className=a.line.wrapClass:a.node!=a.text&&(a.node.className="");var b=a.textClass?a.textClass+" "+(a.line.textClass||""):a.line.textClass;a.text.className=b||""}function jb(a,b,c,d){b.gutter&&(b.node.removeChild(b.gutter),b.gutter=null);var e=b.line.gutterMarkers;if(a.options.lineNumbers||e){var f=eb(b),g=b.gutter=f.insertBefore(dh("div",null,"CodeMirror-gutter-wrapper","left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px; width: "+d.gutterTotalWidth+"px"),b.text);if(b.line.gutterClass&&(g.className+=" "+b.line.gutterClass),!a.options.lineNumbers||e&&e["CodeMirror-linenumbers"]||(b.lineNumber=g.appendChild(dh("div",T(a.options,c),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+d.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+a.display.lineNumInnerWidth+"px"))),e)for(var h=0;h<a.options.gutters.length;++h){var i=a.options.gutters[h],j=e.hasOwnProperty(i)&&e[i];j&&g.appendChild(dh("div",[j],"CodeMirror-gutter-elt","left: "+d.gutterLeft[i]+"px; width: "+d.gutterWidth[i]+"px"))}}}function kb(a,b){a.alignable&&(a.alignable=null);for(var d,c=a.node.firstChild;c;c=d){var d=c.nextSibling;"CodeMirror-linewidget"==c.className&&a.node.removeChild(c)}mb(a,b)}function lb(a,b,c,d){var e=gb(a,b);return b.text=b.node=e.pre,e.bgClass&&(b.bgClass=e.bgClass),e.textClass&&(b.textClass=e.textClass),ib(b),jb(a,b,c,d),mb(b,d),b.node}function mb(a,b){if(nb(a.line,a,b,!0),a.rest)for(var c=0;c<a.rest.length;c++)nb(a.rest[c],a,b,!1)}function nb(a,b,c,d){if(a.widgets)for(var e=eb(b),f=0,g=a.widgets;f<g.length;++f){var h=g[f],i=dh("div",[h.node],"CodeMirror-linewidget");h.handleMouseEvents||i.setAttribute("cm-ignore-events","true"),ob(h,i,b,c),d&&h.above?e.insertBefore(i,b.gutter||b.text):e.appendChild(i),Cg(h,"redraw")}}function ob(a,b,c,d){if(a.noHScroll){(c.alignable||(c.alignable=[])).push(b);var e=d.wrapperWidth;b.style.left=d.fixedPos+"px",a.coverGutter||(e-=d.gutterTotalWidth,b.style.paddingLeft=d.gutterTotalWidth+"px"),b.style.width=e+"px"}a.coverGutter&&(b.style.zIndex=5,b.style.position="relative",a.noHScroll||(b.style.marginLeft=-d.gutterTotalWidth+"px"))}function rb(a){return pb(a.line,a.ch)}function sb(a,b){return qb(a,b)<0?b:a}function tb(a,b){return qb(a,b)<0?a:b}function ub(a,b){this.ranges=a,this.primIndex=b}function vb(a,b){this.anchor=a,this.head=b}function wb(a,b){var c=a[b];a.sort(function(a,b){return qb(a.from(),b.from())}),b=Ug(a,c);for(var d=1;d<a.length;d++){var e=a[d],f=a[d-1];if(qb(f.to(),e.from())>=0){var g=tb(f.from(),e.from()),h=sb(f.to(),e.to()),i=f.empty()?e.from()==e.head:f.from()==f.head;b>=d&&--b,a.splice(--d,2,new vb(i?h:g,i?g:h))}}return new ub(a,b)}function xb(a,b){return new ub([new vb(a,b||a)],0)}function yb(a,b){return Math.max(a.first,Math.min(b,a.first+a.size-1))}function zb(a,b){if(b.line<a.first)return pb(a.first,0);var c=a.first+a.size-1;return b.line>c?pb(c,Xf(a,c).text.length):Ab(b,Xf(a,b.line).text.length)}function Ab(a,b){var c=a.ch;return null==c||c>b?pb(a.line,b):0>c?pb(a.line,0):a}function Bb(a,b){return b>=a.first&&b<a.first+a.size}function Cb(a,b){for(var c=[],d=0;d<b.length;d++)c[d]=zb(a,b[d]);return c}function Db(a,b,c,d){if(a.cm&&a.cm.display.shift||a.extend){var e=b.anchor;if(d){var f=qb(c,e)<0;f!=qb(d,e)<0?(e=c,c=d):f!=qb(c,d)<0&&(c=d)}return new vb(e,c)}return new vb(d||c,c)}function Eb(a,b,c,d){Kb(a,new ub([Db(a,a.sel.primary(),b,c)],0),d)}function Fb(a,b,c){for(var d=[],e=0;e<a.sel.ranges.length;e++)d[e]=Db(a,a.sel.ranges[e],b[e],null);var f=wb(d,a.sel.primIndex);Kb(a,f,c)}function Gb(a,b,c,d){var e=a.sel.ranges.slice(0);e[b]=c,Kb(a,wb(e,a.sel.primIndex),d)}function Hb(a,b,c,d){Kb(a,xb(b,c),d)}function Ib(a,b){var c={ranges:b.ranges,update:function(b){this.ranges=[];for(var c=0;c<b.length;c++)this.ranges[c]=new vb(zb(a,b[c].anchor),zb(a,b[c].head))}};return Ag(a,"beforeSelectionChange",a,c),a.cm&&Ag(a.cm,"beforeSelectionChange",a.cm,c),c.ranges!=b.ranges?wb(c.ranges,c.ranges.length-1):b}function Jb(a,b,c){var d=a.history.done,e=Sg(d);e&&e.ranges?(d[d.length-1]=b,Lb(a,b,c)):Kb(a,b,c)}function Kb(a,b,c){Lb(a,b,c),jg(a,a.sel,a.cm?a.cm.curOp.id:0/0,c)}function Lb(a,b,c){(Gg(a,"beforeSelectionChange")||a.cm&&Gg(a.cm,"beforeSelectionChange"))&&(b=Ib(a,b));var d=c&&c.bias||(qb(b.primary().head,a.sel.primary().head)<0?-1:1);Mb(a,Ob(a,b,d,!0)),c&&c.scroll===!1||!a.cm||ie(a.cm)}function Mb(a,b){b.equals(a.sel)||(a.sel=b,a.cm&&(a.cm.curOp.updateInput=a.cm.curOp.selectionChanged=!0,Fg(a.cm)),Cg(a,"cursorActivity",a))}function Nb(a){Mb(a,Ob(a,a.sel,null,!1),Kg)}function Ob(a,b,c,d){for(var e,f=0;f<b.ranges.length;f++){var g=b.ranges[f],h=Pb(a,g.anchor,c,d),i=Pb(a,g.head,c,d);(e||h!=g.anchor||i!=g.head)&&(e||(e=b.ranges.slice(0,f)),e[f]=new vb(h,i))}return e?wb(e,b.primIndex):b}function Pb(a,b,c,d){var e=!1,f=b,g=c||1;a.cantEdit=!1;a:for(;;){var h=Xf(a,f.line);if(h.markedSpans)for(var i=0;i<h.markedSpans.length;++i){var j=h.markedSpans[i],k=j.marker;if((null==j.from||(k.inclusiveLeft?j.from<=f.ch:j.from<f.ch))&&(null==j.to||(k.inclusiveRight?j.to>=f.ch:j.to>f.ch))){if(d&&(Ag(k,"beforeCursorEnter"),k.explicitlyCleared)){if(h.markedSpans){--i;continue}break}if(!k.atomic)continue;var l=k.find(0>g?-1:1);if(0==qb(l,f)&&(l.ch+=g,l.ch<0?l=l.line>a.first?zb(a,pb(l.line-1)):null:l.ch>h.text.length&&(l=l.line<a.first+a.size-1?pb(l.line+1,0):null),!l)){if(e)return d?(a.cantEdit=!0,pb(a.first,0)):Pb(a,b,c,!0);e=!0,l=b,g=-g}f=l;continue a}}return f}}function Qb(a){for(var b=a.display,c=a.doc,d={},e=d.cursors=document.createDocumentFragment(),f=d.selection=document.createDocumentFragment(),g=0;g<c.sel.ranges.length;g++){var h=c.sel.ranges[g],i=h.empty();(i||a.options.showCursorWhenSelecting)&&Tb(a,h,e),i||Ub(a,h,f)}if(a.options.moveInputWithCursor){var j=wc(a,c.sel.primary().head,"div"),k=b.wrapper.getBoundingClientRect(),l=b.lineDiv.getBoundingClientRect();d.teTop=Math.max(0,Math.min(b.wrapper.clientHeight-10,j.top+l.top-k.top)),d.teLeft=Math.max(0,Math.min(b.wrapper.clientWidth-10,j.left+l.left-k.left))}return d}function Rb(a,b){gh(a.display.cursorDiv,b.cursors),gh(a.display.selectionDiv,b.selection),null!=b.teTop&&(a.display.inputDiv.style.top=b.teTop+"px",a.display.inputDiv.style.left=b.teLeft+"px")}function Sb(a){Rb(a,Qb(a))}function Tb(a,b,c){var d=wc(a,b.head,"div",null,null,!a.options.singleCursorHeightPerLine),e=c.appendChild(dh("div","\xa0","CodeMirror-cursor"));if(e.style.left=d.left+"px",e.style.top=d.top+"px",e.style.height=Math.max(0,d.bottom-d.top)*a.options.cursorHeight+"px",d.other){var f=c.appendChild(dh("div","\xa0","CodeMirror-cursor CodeMirror-secondarycursor"));f.style.display="",f.style.left=d.other.left+"px",f.style.top=d.other.top+"px",f.style.height=.85*(d.other.bottom-d.other.top)+"px"}}function Ub(a,b,c){function j(a,b,c,d){0>b&&(b=0),b=Math.round(b),d=Math.round(d),f.appendChild(dh("div",null,"CodeMirror-selected","position: absolute; left: "+a+"px; top: "+b+"px; width: "+(null==c?i-a:c)+"px; height: "+(d-b)+"px"))}function k(b,c,d){function m(c,d){return vc(a,pb(b,c),"div",f,d)}var k,l,f=Xf(e,b),g=f.text.length;return Ch(cg(f),c||0,null==d?g:d,function(a,b,e){var n,o,p,f=m(a,"left");if(a==b)n=f,o=p=f.left;else{if(n=m(b-1,"right"),"rtl"==e){var q=f;f=n,n=q}o=f.left,p=n.right}null==c&&0==a&&(o=h),n.top-f.top>3&&(j(o,f.top,null,f.bottom),o=h,f.bottom<n.top&&j(o,f.bottom,null,n.top)),null==d&&b==g&&(p=i),(!k||f.top<k.top||f.top==k.top&&f.left<k.left)&&(k=f),(!l||n.bottom>l.bottom||n.bottom==l.bottom&&n.right>l.right)&&(l=n),h+1>o&&(o=h),j(o,n.top,p-o,n.bottom)}),{start:k,end:l}}var d=a.display,e=a.doc,f=document.createDocumentFragment(),g=ac(a.display),h=g.left,i=Math.max(d.sizerWidth,cc(a)-d.sizer.offsetLeft)-g.right,l=b.from(),m=b.to();if(l.line==m.line)k(l.line,l.ch,m.ch);else{var n=Xf(e,l.line),o=Xf(e,m.line),p=hf(n)==hf(o),q=k(l.line,l.ch,p?n.text.length+1:null).end,r=k(m.line,p?0:null,m.ch).start;p&&(q.top<r.top-2?(j(q.right,q.top,null,q.bottom),j(h,r.top,r.left,r.bottom)):j(q.right,q.top,r.left-q.right,q.bottom)),q.bottom<r.top&&j(h,q.bottom,null,r.top)}c.appendChild(f)}function Vb(a){if(a.state.focused){var b=a.display;clearInterval(b.blinker);var c=!0;b.cursorDiv.style.visibility="",a.options.cursorBlinkRate>0?b.blinker=setInterval(function(){b.cursorDiv.style.visibility=(c=!c)?"":"hidden"},a.options.cursorBlinkRate):a.options.cursorBlinkRate<0&&(b.cursorDiv.style.visibility="hidden")}}function Wb(a,b){a.doc.mode.startState&&a.doc.frontier<a.display.viewTo&&a.state.highlight.set(b,Yg(Xb,a))}function Xb(a){var b=a.doc;if(b.frontier<b.first&&(b.frontier=b.first),!(b.frontier>=a.display.viewTo)){var c=+new Date+a.options.workTime,d=ye(b.mode,Zb(a,b.frontier)),e=[];b.iter(b.frontier,Math.min(b.first+b.size,a.display.viewTo+500),function(f){if(b.frontier>=a.display.viewFrom){var g=f.styles,h=Af(a,f,d,!0);f.styles=h.styles;var i=f.styleClasses,j=h.classes;j?f.styleClasses=j:i&&(f.styleClasses=null);for(var k=!g||g.length!=f.styles.length||i!=j&&(!i||!j||i.bgClass!=j.bgClass||i.textClass!=j.textClass),l=0;!k&&l<g.length;++l)k=g[l]!=f.styles[l];k&&e.push(b.frontier),f.stateAfter=ye(b.mode,d)}else Cf(a,f.text,d),f.stateAfter=0==b.frontier%5?ye(b.mode,d):null;return++b.frontier,+new Date>c?(Wb(a,a.options.workDelay),!0):void 0}),e.length&&Pc(a,function(){for(var b=0;b<e.length;b++)Wc(a,e[b],"text")})}}function Yb(a,b,c){for(var d,e,f=a.doc,g=c?-1:b-(a.doc.mode.innerMode?1e3:100),h=b;h>g;--h){if(h<=f.first)return f.first;var i=Xf(f,h-1);if(i.stateAfter&&(!c||h<=f.frontier))return h;var j=Og(i.text,null,a.options.tabSize);(null==e||d>j)&&(e=h-1,d=j)}return e}function Zb(a,b,c){var d=a.doc,e=a.display;if(!d.mode.startState)return!0;var f=Yb(a,b,c),g=f>d.first&&Xf(d,f-1).stateAfter;return g=g?ye(d.mode,g):ze(d.mode),d.iter(f,b,function(c){Cf(a,c.text,g);var h=f==b-1||0==f%5||f>=e.viewFrom&&f<e.viewTo;c.stateAfter=h?ye(d.mode,g):null,++f}),c&&(d.frontier=f),g}function $b(a){return a.lineSpace.offsetTop}function _b(a){return a.mover.offsetHeight-a.lineSpace.offsetHeight}function ac(a){if(a.cachedPaddingH)return a.cachedPaddingH;var b=gh(a.measure,dh("pre","x")),c=window.getComputedStyle?window.getComputedStyle(b):b.currentStyle,d={left:parseInt(c.paddingLeft),right:parseInt(c.paddingRight)};return isNaN(d.left)||isNaN(d.right)||(a.cachedPaddingH=d),d}function bc(a){return Ig-a.display.nativeBarWidth}function cc(a){return a.display.scroller.clientWidth-bc(a)-a.display.barWidth}function dc(a){return a.display.scroller.clientHeight-bc(a)-a.display.barHeight}function ec(a,b,c){var d=a.options.lineWrapping,e=d&&cc(a);if(!b.measure.heights||d&&b.measure.width!=e){var f=b.measure.heights=[];if(d){b.measure.width=e;for(var g=b.text.firstChild.getClientRects(),h=0;h<g.length-1;h++){var i=g[h],j=g[h+1];Math.abs(i.bottom-j.bottom)>2&&f.push((i.bottom+j.top)/2-c.top)}}f.push(c.bottom-c.top)}}function fc(a,b,c){if(a.line==b)return{map:a.measure.map,cache:a.measure.cache};for(var d=0;d<a.rest.length;d++)if(a.rest[d]==b)return{map:a.measure.maps[d],cache:a.measure.caches[d]};for(var d=0;d<a.rest.length;d++)if(_f(a.rest[d])>c)return{map:a.measure.maps[d],cache:a.measure.caches[d],before:!0}}function gc(a,b){b=hf(b);var c=_f(b),d=a.display.externalMeasured=new Tc(a.doc,b,c);d.lineN=c;var e=d.built=Gf(a,d);return d.text=e.pre,gh(a.display.lineMeasure,e.pre),d}function hc(a,b,c,d){return kc(a,jc(a,b),c,d)}function ic(a,b){if(b>=a.display.viewFrom&&b<a.display.viewTo)return a.display.view[Yc(a,b)];var c=a.display.externalMeasured;return c&&b>=c.lineN&&b<c.lineN+c.size?c:void 0}function jc(a,b){var c=_f(b),d=ic(a,c);d&&!d.text?d=null:d&&d.changes&&db(a,d,c,bb(a)),d||(d=gc(a,b));var e=fc(d,b,c);return{line:b,view:d,rect:null,map:e.map,cache:e.cache,before:e.before,hasHeights:!1}}function kc(a,b,c,d,e){b.before&&(c=-1);var g,f=c+(d||"");return b.cache.hasOwnProperty(f)?g=b.cache[f]:(b.rect||(b.rect=b.view.text.getBoundingClientRect()),b.hasHeights||(ec(a,b.view,b.rect),b.hasHeights=!0),g=mc(a,b,c,d),g.bogus||(b.cache[f]=g)),{left:g.left,right:g.right,top:e?g.rtop:g.top,bottom:e?g.rbottom:g.bottom}}function mc(a,b,c,f){for(var h,i,j,k,g=b.map,l=0;l<g.length;l+=3){var m=g[l],n=g[l+1];if(m>c?(i=0,j=1,k="left"):n>c?(i=c-m,j=i+1):(l==g.length-3||c==n&&g[l+3]>c)&&(j=n-m,i=j-1,c>=n&&(k="right")),null!=i){if(h=g[l+2],m==n&&f==(h.insertLeft?"left":"right")&&(k=f),"left"==f&&0==i)for(;l&&g[l-2]==g[l-3]&&g[l-1].insertLeft;)h=g[(l-=3)+2],k="left";if("right"==f&&i==n-m)for(;l<g.length-3&&g[l+3]==g[l+4]&&!g[l+5].insertLeft;)h=g[(l+=3)+2],k="right";break}}var o;if(3==h.nodeType){for(var l=0;4>l;l++){for(;i&&ch(b.line.text.charAt(m+i));)--i;for(;n>m+j&&ch(b.line.text.charAt(m+j));)++j;if(d&&9>e&&0==i&&j==n-m)o=h.parentNode.getBoundingClientRect();else if(d&&a.options.lineWrapping){var p=eh(h,i,j).getClientRects();o=p.length?p["right"==f?p.length-1:0]:lc}else o=eh(h,i,j).getBoundingClientRect()||lc;if(o.left||o.right||0==i)break;j=i,i-=1,k="right"}d&&11>e&&(o=nc(a.display.measure,o))}else{i>0&&(k=f="right");var p;o=a.options.lineWrapping&&(p=h.getClientRects()).length>1?p["right"==f?p.length-1:0]:h.getBoundingClientRect()}if(d&&9>e&&!i&&(!o||!o.left&&!o.right)){var q=h.parentNode.getClientRects()[0];o=q?{left:q.left,right:q.left+Dc(a.display),top:q.top,bottom:q.bottom}:lc}for(var r=o.top-b.rect.top,s=o.bottom-b.rect.top,t=(r+s)/2,u=b.view.measure.heights,l=0;l<u.length-1&&!(t<u[l]);l++);var v=l?u[l-1]:0,w=u[l],x={left:("right"==k?o.right:o.left)-b.rect.left,right:("left"==k?o.left:o.right)-b.rect.left,top:v,bottom:w};return o.left||o.right||(x.bogus=!0),a.options.singleCursorHeightPerLine||(x.rtop=r,x.rbottom=s),x}function nc(a,b){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!Ah(a))return b;var c=screen.logicalXDPI/screen.deviceXDPI,d=screen.logicalYDPI/screen.deviceYDPI;return{left:b.left*c,right:b.right*c,top:b.top*d,bottom:b.bottom*d}}function oc(a){if(a.measure&&(a.measure.cache={},a.measure.heights=null,a.rest))for(var b=0;b<a.rest.length;b++)a.measure.caches[b]={}}function pc(a){a.display.externalMeasure=null,fh(a.display.lineMeasure);for(var b=0;b<a.display.view.length;b++)oc(a.display.view[b])}function qc(a){pc(a),a.display.cachedCharWidth=a.display.cachedTextHeight=a.display.cachedPaddingH=null,a.options.lineWrapping||(a.display.maxLineChanged=!0),a.display.lineNumChars=null}function rc(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function sc(){return window.pageYOffset||(document.documentElement||document.body).scrollTop}function tc(a,b,c,d){if(b.widgets)for(var e=0;e<b.widgets.length;++e)if(b.widgets[e].above){var f=qf(b.widgets[e]);c.top+=f,c.bottom+=f}if("line"==d)return c;d||(d="local");var g=bg(b);if("local"==d?g+=$b(a.display):g-=a.display.viewOffset,"page"==d||"window"==d){var h=a.display.lineSpace.getBoundingClientRect();g+=h.top+("window"==d?0:sc());var i=h.left+("window"==d?0:rc());c.left+=i,c.right+=i}return c.top+=g,c.bottom+=g,c}function uc(a,b,c){if("div"==c)return b;var d=b.left,e=b.top;if("page"==c)d-=rc(),e-=sc();else if("local"==c||!c){var f=a.display.sizer.getBoundingClientRect();d+=f.left,e+=f.top}var g=a.display.lineSpace.getBoundingClientRect();return{left:d-g.left,top:e-g.top}}function vc(a,b,c,d,e){return d||(d=Xf(a.doc,b.line)),tc(a,d,hc(a,d,b.ch,e),c)}function wc(a,b,c,d,e,f){function g(b,g){var h=kc(a,e,b,g?"right":"left",f);return g?h.left=h.right:h.right=h.left,tc(a,d,h,c)}function h(a,b){var c=i[b],d=c.level%2;return a==Dh(c)&&b&&c.level<i[b-1].level?(c=i[--b],a=Eh(c)-(c.level%2?0:1),d=!0):a==Eh(c)&&b<i.length-1&&c.level<i[b+1].level&&(c=i[++b],a=Dh(c)-c.level%2,d=!1),d&&a==c.to&&a>c.from?g(a-1):g(a,d)}d=d||Xf(a.doc,b.line),e||(e=jc(a,d));var i=cg(d),j=b.ch;if(!i)return g(j);var k=Mh(i,j),l=h(j,k);return null!=Lh&&(l.other=h(j,Lh)),l}function xc(a,b){var c=0,b=zb(a.doc,b);a.options.lineWrapping||(c=Dc(a.display)*b.ch);var d=Xf(a.doc,b.line),e=bg(d)+$b(a.display);return{left:c,right:c,top:e,bottom:e+d.height}}function yc(a,b,c,d){var e=pb(a,b);return e.xRel=d,c&&(e.outside=!0),e}function zc(a,b,c){var d=a.doc;if(c+=a.display.viewOffset,0>c)return yc(d.first,0,!0,-1);var e=ag(d,c),f=d.first+d.size-1;if(e>f)return yc(d.first+d.size-1,Xf(d,f).text.length,!0,1);0>b&&(b=0);for(var g=Xf(d,e);;){var h=Ac(a,g,e,b,c),i=ff(g),j=i&&i.find(0,!0);if(!i||!(h.ch>j.from.ch||h.ch==j.from.ch&&h.xRel>0))return h;e=_f(g=j.to.line)}}function Ac(a,b,c,d,e){function j(d){var e=wc(a,pb(c,d),"line",b,i);return g=!0,f>e.bottom?e.left-h:f<e.top?e.left+h:(g=!1,e.left)}var f=e-bg(b),g=!1,h=2*a.display.wrapper.clientWidth,i=jc(a,b),k=cg(b),l=b.text.length,m=Fh(b),n=Gh(b),o=j(m),p=g,q=j(n),r=g;if(d>q)return yc(c,n,r,1);for(;;){if(k?n==m||n==Oh(b,m,1):1>=n-m){for(var s=o>d||q-d>=d-o?m:n,t=d-(s==m?o:q);ch(b.text.charAt(s));)++s;var u=yc(c,s,s==m?p:r,-1>t?-1:t>1?1:0);return u}var v=Math.ceil(l/2),w=m+v;if(k){w=m;for(var x=0;v>x;++x)w=Oh(b,w,1)}var y=j(w);y>d?(n=w,q=y,(r=g)&&(q+=1e3),l=v):(m=w,o=y,p=g,l-=v)}}function Cc(a){if(null!=a.cachedTextHeight)return a.cachedTextHeight;if(null==Bc){Bc=dh("pre");for(var b=0;49>b;++b)Bc.appendChild(document.createTextNode("x")),Bc.appendChild(dh("br"));Bc.appendChild(document.createTextNode("x"))}gh(a.measure,Bc);var c=Bc.offsetHeight/50;return c>3&&(a.cachedTextHeight=c),fh(a.measure),c||1}function Dc(a){if(null!=a.cachedCharWidth)return a.cachedCharWidth;var b=dh("span","xxxxxxxxxx"),c=dh("pre",[b]);gh(a.measure,c);var d=b.getBoundingClientRect(),e=(d.right-d.left)/10;return e>2&&(a.cachedCharWidth=e),e||10
}function Gc(a){a.curOp={cm:a,viewChanged:!1,startHeight:a.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,id:++Fc},Ec?Ec.ops.push(a.curOp):a.curOp.ownsGroup=Ec={ops:[a.curOp],delayedCallbacks:[]}}function Hc(a){var b=a.delayedCallbacks,c=0;do{for(;c<b.length;c++)b[c]();for(var d=0;d<a.ops.length;d++){var e=a.ops[d];if(e.cursorActivityHandlers)for(;e.cursorActivityCalled<e.cursorActivityHandlers.length;)e.cursorActivityHandlers[e.cursorActivityCalled++](e.cm)}}while(c<b.length)}function Ic(a){var b=a.curOp,c=b.ownsGroup;if(c)try{Hc(c)}finally{Ec=null;for(var d=0;d<c.ops.length;d++)c.ops[d].cm.curOp=null;Jc(c)}}function Jc(a){for(var b=a.ops,c=0;c<b.length;c++)Kc(b[c]);for(var c=0;c<b.length;c++)Lc(b[c]);for(var c=0;c<b.length;c++)Mc(b[c]);for(var c=0;c<b.length;c++)Nc(b[c]);for(var c=0;c<b.length;c++)Oc(b[c])}function Kc(a){var b=a.cm,c=b.display;W(b),a.updateMaxLine&&I(b),a.mustUpdate=a.viewChanged||a.forceUpdate||null!=a.scrollTop||a.scrollToPos&&(a.scrollToPos.from.line<c.viewFrom||a.scrollToPos.to.line>=c.viewTo)||c.maxLineChanged&&b.options.lineWrapping,a.update=a.mustUpdate&&new V(b,a.mustUpdate&&{top:a.scrollTop,ensure:a.scrollToPos},a.forceUpdate)}function Lc(a){a.updatedDisplay=a.mustUpdate&&X(a.cm,a.update)}function Mc(a){var b=a.cm,c=b.display;a.updatedDisplay&&_(b),a.barMeasure=K(b),c.maxLineChanged&&!b.options.lineWrapping&&(a.adjustWidthTo=hc(b,c.maxLine,c.maxLine.text.length).left+3,b.display.sizerWidth=a.adjustWidthTo,a.barMeasure.scrollWidth=Math.max(c.scroller.clientWidth,c.sizer.offsetLeft+a.adjustWidthTo+bc(b)+b.display.barWidth),a.maxScrollLeft=Math.max(0,c.sizer.offsetLeft+a.adjustWidthTo-cc(b))),(a.updatedDisplay||a.selectionChanged)&&(a.newSelectionNodes=Qb(b))}function Nc(a){var b=a.cm;null!=a.adjustWidthTo&&(b.display.sizer.style.minWidth=a.adjustWidthTo+"px",a.maxScrollLeft<b.doc.scrollLeft&&yd(b,Math.min(b.display.scroller.scrollLeft,a.maxScrollLeft),!0),b.display.maxLineChanged=!1),a.newSelectionNodes&&Rb(b,a.newSelectionNodes),a.updatedDisplay&&$(b,a.barMeasure),(a.updatedDisplay||a.startHeight!=b.doc.height)&&O(b,a.barMeasure),a.selectionChanged&&Vb(b),b.state.focused&&a.updateInput&&ed(b,a.typing)}function Oc(a){var b=a.cm,c=b.display,d=b.doc;if(a.updatedDisplay&&Y(b,a.update),null==c.wheelStartX||null==a.scrollTop&&null==a.scrollLeft&&!a.scrollToPos||(c.wheelStartX=c.wheelStartY=null),null==a.scrollTop||c.scroller.scrollTop==a.scrollTop&&!a.forceScroll||(d.scrollTop=Math.max(0,Math.min(c.scroller.scrollHeight-c.scroller.clientHeight,a.scrollTop)),c.scrollbars.setScrollTop(d.scrollTop),c.scroller.scrollTop=d.scrollTop),null==a.scrollLeft||c.scroller.scrollLeft==a.scrollLeft&&!a.forceScroll||(d.scrollLeft=Math.max(0,Math.min(c.scroller.scrollWidth-cc(b),a.scrollLeft)),c.scrollbars.setScrollLeft(d.scrollLeft),c.scroller.scrollLeft=d.scrollLeft,R(b)),a.scrollToPos){var e=ee(b,zb(d,a.scrollToPos.from),zb(d,a.scrollToPos.to),a.scrollToPos.margin);a.scrollToPos.isCursor&&b.state.focused&&de(b,e)}var f=a.maybeHiddenMarkers,g=a.maybeUnhiddenMarkers;if(f)for(var h=0;h<f.length;++h)f[h].lines.length||Ag(f[h],"hide");if(g)for(var h=0;h<g.length;++h)g[h].lines.length&&Ag(g[h],"unhide");c.wrapper.offsetHeight&&(d.scrollTop=b.display.scroller.scrollTop),a.changeObjs&&Ag(b,"changes",b,a.changeObjs)}function Pc(a,b){if(a.curOp)return b();Gc(a);try{return b()}finally{Ic(a)}}function Qc(a,b){return function(){if(a.curOp)return b.apply(a,arguments);Gc(a);try{return b.apply(a,arguments)}finally{Ic(a)}}}function Rc(a){return function(){if(this.curOp)return a.apply(this,arguments);Gc(this);try{return a.apply(this,arguments)}finally{Ic(this)}}}function Sc(a){return function(){var b=this.cm;if(!b||b.curOp)return a.apply(this,arguments);Gc(b);try{return a.apply(this,arguments)}finally{Ic(b)}}}function Tc(a,b,c){this.line=b,this.rest=jf(b),this.size=this.rest?_f(Sg(this.rest))-c+1:1,this.node=this.text=null,this.hidden=mf(a,b)}function Uc(a,b,c){for(var e,d=[],f=b;c>f;f=e){var g=new Tc(a.doc,Xf(a.doc,f),f);e=f+g.size,d.push(g)}return d}function Vc(a,b,c,d){null==b&&(b=a.doc.first),null==c&&(c=a.doc.first+a.doc.size),d||(d=0);var e=a.display;if(d&&c<e.viewTo&&(null==e.updateLineNumbers||e.updateLineNumbers>b)&&(e.updateLineNumbers=b),a.curOp.viewChanged=!0,b>=e.viewTo)v&&kf(a.doc,b)<e.viewTo&&Xc(a);else if(c<=e.viewFrom)v&&lf(a.doc,c+d)>e.viewFrom?Xc(a):(e.viewFrom+=d,e.viewTo+=d);else if(b<=e.viewFrom&&c>=e.viewTo)Xc(a);else if(b<=e.viewFrom){var f=Zc(a,c,c+d,1);f?(e.view=e.view.slice(f.index),e.viewFrom=f.lineN,e.viewTo+=d):Xc(a)}else if(c>=e.viewTo){var f=Zc(a,b,b,-1);f?(e.view=e.view.slice(0,f.index),e.viewTo=f.lineN):Xc(a)}else{var g=Zc(a,b,b,-1),h=Zc(a,c,c+d,1);g&&h?(e.view=e.view.slice(0,g.index).concat(Uc(a,g.lineN,h.lineN)).concat(e.view.slice(h.index)),e.viewTo+=d):Xc(a)}var i=e.externalMeasured;i&&(c<i.lineN?i.lineN+=d:b<i.lineN+i.size&&(e.externalMeasured=null))}function Wc(a,b,c){a.curOp.viewChanged=!0;var d=a.display,e=a.display.externalMeasured;if(e&&b>=e.lineN&&b<e.lineN+e.size&&(d.externalMeasured=null),!(b<d.viewFrom||b>=d.viewTo)){var f=d.view[Yc(a,b)];if(null!=f.node){var g=f.changes||(f.changes=[]);-1==Ug(g,c)&&g.push(c)}}}function Xc(a){a.display.viewFrom=a.display.viewTo=a.doc.first,a.display.view=[],a.display.viewOffset=0}function Yc(a,b){if(b>=a.display.viewTo)return null;if(b-=a.display.viewFrom,0>b)return null;for(var c=a.display.view,d=0;d<c.length;d++)if(b-=c[d].size,0>b)return d}function Zc(a,b,c,d){var f,e=Yc(a,b),g=a.display.view;if(!v||c==a.doc.first+a.doc.size)return{index:e,lineN:c};for(var h=0,i=a.display.viewFrom;e>h;h++)i+=g[h].size;if(i!=b){if(d>0){if(e==g.length-1)return null;f=i+g[e].size-b,e++}else f=i-b;b+=f,c+=f}for(;kf(a.doc,c)!=c;){if(e==(0>d?0:g.length-1))return null;c+=d*g[e-(0>d?1:0)].size,e+=d}return{index:e,lineN:c}}function $c(a,b,c){var d=a.display,e=d.view;0==e.length||b>=d.viewTo||c<=d.viewFrom?(d.view=Uc(a,b,c),d.viewFrom=b):(d.viewFrom>b?d.view=Uc(a,b,d.viewFrom).concat(d.view):d.viewFrom<b&&(d.view=d.view.slice(Yc(a,b))),d.viewFrom=b,d.viewTo<c?d.view=d.view.concat(Uc(a,d.viewTo,c)):d.viewTo>c&&(d.view=d.view.slice(0,Yc(a,c)))),d.viewTo=c}function _c(a){for(var b=a.display.view,c=0,d=0;d<b.length;d++){var e=b[d];e.hidden||e.node&&!e.changes||++c}return c}function ad(a){a.display.pollingFast||a.display.poll.set(a.options.pollInterval,function(){dd(a),a.state.focused&&ad(a)})}function bd(a){function c(){var d=dd(a);d||b?(a.display.pollingFast=!1,ad(a)):(b=!0,a.display.poll.set(60,c))}var b=!1;a.display.pollingFast=!0,a.display.poll.set(20,c)}function dd(a){var b=a.display.input,c=a.display.prevInput,f=a.doc;if(!a.state.focused||xh(b)&&!c||hd(a)||a.options.disableInput||a.state.keySeq)return!1;a.state.pasteIncoming&&a.state.fakedLastChar&&(b.value=b.value.substring(0,b.value.length-1),a.state.fakedLastChar=!1);var g=b.value;if(g==c&&!a.somethingSelected())return!1;if(d&&e>=9&&a.display.inputHasSelection===g||p&&/[\uf700-\uf7ff]/.test(g))return ed(a),!1;var h=!a.curOp;h&&Gc(a),a.display.shift=!1,8203!=g.charCodeAt(0)||f.sel!=a.display.selForContextMenu||c||(c="\u200b");for(var i=0,j=Math.min(c.length,g.length);j>i&&c.charCodeAt(i)==g.charCodeAt(i);)++i;var k=g.slice(i),l=wh(k),m=null;a.state.pasteIncoming&&f.sel.ranges.length>1&&(cd&&cd.join("\n")==k?m=0==f.sel.ranges.length%cd.length&&Vg(cd,wh):l.length==f.sel.ranges.length&&(m=Vg(l,function(a){return[a]})));for(var n=f.sel.ranges.length-1;n>=0;n--){var o=f.sel.ranges[n],q=o.from(),r=o.to();i<c.length?q=pb(q.line,q.ch-(c.length-i)):a.state.overwrite&&o.empty()&&!a.state.pasteIncoming&&(r=pb(r.line,Math.min(Xf(f,r.line).text.length,r.ch+Sg(l).length)));var s=a.curOp.updateInput,t={from:q,to:r,text:m?m[n%m.length]:l,origin:a.state.pasteIncoming?"paste":a.state.cutIncoming?"cut":"+input"};if(Yd(a.doc,t),Cg(a,"inputRead",a,t),k&&!a.state.pasteIncoming&&a.options.electricChars&&a.options.smartIndent&&o.head.ch<100&&(!n||f.sel.ranges[n-1].head.line!=o.head.line)){var u=a.getModeAt(o.head),v=Sd(t);if(u.electricChars){for(var w=0;w<u.electricChars.length;w++)if(k.indexOf(u.electricChars.charAt(w))>-1){ke(a,v.line,"smart");break}}else u.electricInput&&u.electricInput.test(Xf(f,v.line).text.slice(0,v.ch))&&ke(a,v.line,"smart")}}return ie(a),a.curOp.updateInput=s,a.curOp.typing=!0,g.length>1e3||g.indexOf("\n")>-1?b.value=a.display.prevInput="":a.display.prevInput=g,h&&Ic(a),a.state.pasteIncoming=a.state.cutIncoming=!1,!0}function ed(a,b){if(!a.display.contextMenuPending){var c,f,g=a.doc;if(a.somethingSelected()){a.display.prevInput="";var h=g.sel.primary();c=yh&&(h.to().line-h.from().line>100||(f=a.getSelection()).length>1e3);var i=c?"-":f||a.getSelection();a.display.input.value=i,a.state.focused&&Tg(a.display.input),d&&e>=9&&(a.display.inputHasSelection=i)}else b||(a.display.prevInput=a.display.input.value="",d&&e>=9&&(a.display.inputHasSelection=null));a.display.inaccurateSelection=c}}function fd(a){"nocursor"==a.options.readOnly||o&&ih()==a.display.input||a.display.input.focus()}function gd(a){a.state.focused||(fd(a),Od(a))}function hd(a){return a.options.readOnly||a.doc.cantEdit}function id(a){function c(b){Eg(a,b)||vg(b)}function g(c){if(a.somethingSelected())cd=a.getSelections(),b.inaccurateSelection&&(b.prevInput="",b.inaccurateSelection=!1,b.input.value=cd.join("\n"),Tg(b.input));else{for(var d=[],e=[],f=0;f<a.doc.sel.ranges.length;f++){var g=a.doc.sel.ranges[f].head.line,h={anchor:pb(g,0),head:pb(g+1,0)};e.push(h),d.push(a.getRange(h.anchor,h.head))}"cut"==c.type?a.setSelections(e,null,Kg):(b.prevInput="",b.input.value=d.join("\n"),Tg(b.input)),cd=d}"cut"==c.type&&(a.state.cutIncoming=!0)}var b=a.display;yg(b.scroller,"mousedown",Qc(a,md)),d&&11>e?yg(b.scroller,"dblclick",Qc(a,function(b){if(!Eg(a,b)){var c=ld(a,b);if(c&&!td(a,b)&&!kd(a.display,b)){sg(b);var d=a.findWordAt(c);Eb(a.doc,d.anchor,d.head)}}})):yg(b.scroller,"dblclick",function(b){Eg(a,b)||sg(b)}),yg(b.lineSpace,"selectstart",function(a){kd(b,a)||sg(a)}),t||yg(b.scroller,"contextmenu",function(b){Qd(a,b)}),yg(b.scroller,"scroll",function(){b.scroller.clientHeight&&(xd(a,b.scroller.scrollTop),yd(a,b.scroller.scrollLeft,!0),Ag(a,"scroll",a))}),yg(b.scroller,"mousewheel",function(b){Cd(a,b)}),yg(b.scroller,"DOMMouseScroll",function(b){Cd(a,b)}),yg(b.wrapper,"scroll",function(){b.wrapper.scrollTop=b.wrapper.scrollLeft=0}),yg(b.input,"keyup",function(b){Md.call(a,b)}),yg(b.input,"input",function(){d&&e>=9&&a.display.inputHasSelection&&(a.display.inputHasSelection=null),dd(a)}),yg(b.input,"keydown",Qc(a,Kd)),yg(b.input,"keypress",Qc(a,Nd)),yg(b.input,"focus",Yg(Od,a)),yg(b.input,"blur",Yg(Pd,a)),a.options.dragDrop&&(yg(b.scroller,"dragstart",function(b){wd(a,b)}),yg(b.scroller,"dragenter",c),yg(b.scroller,"dragover",c),yg(b.scroller,"drop",Qc(a,vd))),yg(b.scroller,"paste",function(c){kd(b,c)||(a.state.pasteIncoming=!0,fd(a),bd(a))}),yg(b.input,"paste",function(){if(f&&!a.state.fakedLastChar&&!(new Date-a.state.lastMiddleDown<200)){var c=b.input.selectionStart,d=b.input.selectionEnd;b.input.value+="$",b.input.selectionEnd=d,b.input.selectionStart=c,a.state.fakedLastChar=!0}a.state.pasteIncoming=!0,bd(a)}),yg(b.input,"cut",g),yg(b.input,"copy",g),k&&yg(b.sizer,"mouseup",function(){ih()==b.input&&b.input.blur(),fd(a)})}function jd(a){var b=a.display;(b.lastWrapHeight!=b.wrapper.clientHeight||b.lastWrapWidth!=b.wrapper.clientWidth)&&(b.cachedCharWidth=b.cachedTextHeight=b.cachedPaddingH=null,b.scrollbarsClipped=!1,a.setSize())}function kd(a,b){for(var c=wg(b);c!=a.wrapper;c=c.parentNode)if(!c||1==c.nodeType&&"true"==c.getAttribute("cm-ignore-events")||c.parentNode==a.sizer&&c!=a.mover)return!0}function ld(a,b,c,d){var e=a.display;if(!c&&"true"==wg(b).getAttribute("not-content"))return null;var f,g,h=e.lineSpace.getBoundingClientRect();try{f=b.clientX-h.left,g=b.clientY-h.top}catch(b){return null}var j,i=zc(a,f,g);if(d&&1==i.xRel&&(j=Xf(a.doc,i.line).text).length==i.ch){var k=Og(j,j.length,a.options.tabSize)-j.length;i=pb(i.line,Math.max(0,Math.round((f-ac(a.display).left)/Dc(a.display))-k))}return i}function md(a){if(!Eg(this,a)){var b=this,c=b.display;if(c.shift=a.shiftKey,kd(c,a))return f||(c.scroller.draggable=!1,setTimeout(function(){c.scroller.draggable=!0},100)),void 0;if(!td(b,a)){var d=ld(b,a);switch(window.focus(),xg(a)){case 1:d?pd(b,a,d):wg(a)==c.scroller&&sg(a);break;case 2:f&&(b.state.lastMiddleDown=+new Date),d&&Eb(b.doc,d),setTimeout(Yg(fd,b),20),sg(a);break;case 3:t&&Qd(b,a)}}}}function pd(a,b,c){setTimeout(Yg(gd,a),0);var e,d=+new Date;od&&od.time>d-400&&0==qb(od.pos,c)?e="triple":nd&&nd.time>d-400&&0==qb(nd.pos,c)?(e="double",od={time:d,pos:c}):(e="single",nd={time:d,pos:c});var h,f=a.doc.sel,g=p?b.metaKey:b.ctrlKey;a.options.dragDrop&&rh&&!hd(a)&&"single"==e&&(h=f.contains(c))>-1&&!f.ranges[h].empty()?qd(a,b,c,g):rd(a,b,c,e,g)}function qd(a,b,c,g){var h=a.display,i=Qc(a,function(j){f&&(h.scroller.draggable=!1),a.state.draggingText=!1,zg(document,"mouseup",i),zg(h.scroller,"drop",i),Math.abs(b.clientX-j.clientX)+Math.abs(b.clientY-j.clientY)<10&&(sg(j),g||Eb(a.doc,c),fd(a),d&&9==e&&setTimeout(function(){document.body.focus(),fd(a)},20))});f&&(h.scroller.draggable=!0),a.state.draggingText=i,h.scroller.dragDrop&&h.scroller.dragDrop(),yg(document,"mouseup",i),yg(h.scroller,"drop",i)}function rd(a,b,c,d,e){function o(b){if(0!=qb(n,b))if(n=b,"rect"==d){for(var e=[],f=a.options.tabSize,k=Og(Xf(g,c.line).text,c.ch,f),l=Og(Xf(g,b.line).text,b.ch,f),m=Math.min(k,l),o=Math.max(k,l),p=Math.min(c.line,b.line),q=Math.min(a.lastLine(),Math.max(c.line,b.line));q>=p;p++){var r=Xf(g,p).text,s=Pg(r,m,f);m==o?e.push(new vb(pb(p,s),pb(p,s))):r.length>s&&e.push(new vb(pb(p,s),pb(p,Pg(r,o,f))))}e.length||e.push(new vb(c,c)),Kb(g,wb(j.ranges.slice(0,i).concat(e),i),{origin:"*mouse",scroll:!1}),a.scrollIntoView(b)}else{var t=h,u=t.anchor,v=b;if("single"!=d){if("double"==d)var w=a.findWordAt(b);else var w=new vb(pb(b.line,0),zb(g,pb(b.line+1,0)));qb(w.anchor,u)>0?(v=w.head,u=tb(t.from(),w.anchor)):(v=w.anchor,u=sb(t.to(),w.head))}var e=j.ranges.slice(0);e[i]=new vb(zb(g,u),v),Kb(g,wb(e,i),Lg)}}function r(b){var c=++q,e=ld(a,b,!0,"rect"==d);if(e)if(0!=qb(e,n)){gd(a),o(e);var h=Q(f,g);(e.line>=h.to||e.line<h.from)&&setTimeout(Qc(a,function(){q==c&&r(b)}),150)}else{var i=b.clientY<p.top?-20:b.clientY>p.bottom?20:0;i&&setTimeout(Qc(a,function(){q==c&&(f.scroller.scrollTop+=i,r(b))}),50)}}function s(b){q=1/0,sg(b),fd(a),zg(document,"mousemove",t),zg(document,"mouseup",u),g.history.lastSelOrigin=null}var f=a.display,g=a.doc;sg(b);var h,i,j=g.sel,k=j.ranges;if(e&&!b.shiftKey?(i=g.sel.contains(c),h=i>-1?k[i]:new vb(c,c)):h=g.sel.primary(),b.altKey)d="rect",e||(h=new vb(c,c)),c=ld(a,b,!0,!0),i=-1;else if("double"==d){var l=a.findWordAt(c);h=a.display.shift||g.extend?Db(g,h,l.anchor,l.head):l}else if("triple"==d){var m=new vb(pb(c.line,0),zb(g,pb(c.line+1,0)));h=a.display.shift||g.extend?Db(g,h,m.anchor,m.head):m}else h=Db(g,h,c);e?-1==i?(i=k.length,Kb(g,wb(k.concat([h]),i),{scroll:!1,origin:"*mouse"})):k.length>1&&k[i].empty()&&"single"==d?(Kb(g,wb(k.slice(0,i).concat(k.slice(i+1)),0)),j=g.sel):Gb(g,i,h,Lg):(i=0,Kb(g,new ub([h],0),Lg),j=g.sel);var n=c,p=f.wrapper.getBoundingClientRect(),q=0,t=Qc(a,function(a){xg(a)?r(a):s(a)}),u=Qc(a,s);yg(document,"mousemove",t),yg(document,"mouseup",u)}function sd(a,b,c,d,e){try{var f=b.clientX,g=b.clientY}catch(b){return!1}if(f>=Math.floor(a.display.gutters.getBoundingClientRect().right))return!1;d&&sg(b);var h=a.display,i=h.lineDiv.getBoundingClientRect();if(g>i.bottom||!Gg(a,c))return ug(b);g-=i.top-h.viewOffset;for(var j=0;j<a.options.gutters.length;++j){var k=h.gutters.childNodes[j];if(k&&k.getBoundingClientRect().right>=f){var l=ag(a.doc,g),m=a.options.gutters[j];return e(a,c,a,l,m,b),ug(b)}}}function td(a,b){return sd(a,b,"gutterClick",!0,Cg)}function vd(a){var b=this;if(!Eg(b,a)&&!kd(b.display,a)){sg(a),d&&(ud=+new Date);var c=ld(b,a,!0),e=a.dataTransfer.files;if(c&&!hd(b))if(e&&e.length&&window.FileReader&&window.File)for(var f=e.length,g=Array(f),h=0,i=function(a,d){var e=new FileReader;e.onload=Qc(b,function(){if(g[d]=e.result,++h==f){c=zb(b.doc,c);var a={from:c,to:c,text:wh(g.join("\n")),origin:"paste"};Yd(b.doc,a),Jb(b.doc,xb(c,Sd(a)))}}),e.readAsText(a)},j=0;f>j;++j)i(e[j],j);else{if(b.state.draggingText&&b.doc.sel.contains(c)>-1)return b.state.draggingText(a),setTimeout(Yg(fd,b),20),void 0;try{var g=a.dataTransfer.getData("Text");if(g){if(b.state.draggingText&&!(p?a.metaKey:a.ctrlKey))var k=b.listSelections();if(Lb(b.doc,xb(c,c)),k)for(var j=0;j<k.length;++j)ce(b.doc,"",k[j].anchor,k[j].head,"drag");b.replaceSelection(g,"around","paste"),fd(b)}}catch(a){}}}}function wd(a,b){if(d&&(!a.state.draggingText||+new Date-ud<100))return vg(b),void 0;if(!Eg(a,b)&&!kd(a.display,b)&&(b.dataTransfer.setData("Text",a.getSelection()),b.dataTransfer.setDragImage&&!j)){var c=dh("img",null,null,"position: fixed; left: 0; top: 0;");c.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",i&&(c.width=c.height=1,a.display.wrapper.appendChild(c),c._top=c.offsetTop),b.dataTransfer.setDragImage(c,0,0),i&&c.parentNode.removeChild(c)}}function xd(b,c){Math.abs(b.doc.scrollTop-c)<2||(b.doc.scrollTop=c,a||Z(b,{top:c}),b.display.scroller.scrollTop!=c&&(b.display.scroller.scrollTop=c),b.display.scrollbars.setScrollTop(c),a&&Z(b),Wb(b,100))}function yd(a,b,c){(c?b==a.doc.scrollLeft:Math.abs(a.doc.scrollLeft-b)<2)||(b=Math.min(b,a.display.scroller.scrollWidth-a.display.scroller.clientWidth),a.doc.scrollLeft=b,R(a),a.display.scroller.scrollLeft!=b&&(a.display.scroller.scrollLeft=b),a.display.scrollbars.setScrollLeft(b))}function Cd(b,c){var d=Bd(c),e=d.x,g=d.y,h=b.display,j=h.scroller;if(e&&j.scrollWidth>j.clientWidth||g&&j.scrollHeight>j.clientHeight){if(g&&p&&f)a:for(var k=c.target,l=h.view;k!=j;k=k.parentNode)for(var m=0;m<l.length;m++)if(l[m].node==k){b.display.currentWheelTarget=k;break a}if(e&&!a&&!i&&null!=Ad)return g&&xd(b,Math.max(0,Math.min(j.scrollTop+g*Ad,j.scrollHeight-j.clientHeight))),yd(b,Math.max(0,Math.min(j.scrollLeft+e*Ad,j.scrollWidth-j.clientWidth))),sg(c),h.wheelStartX=null,void 0;if(g&&null!=Ad){var n=g*Ad,o=b.doc.scrollTop,q=o+h.wrapper.clientHeight;0>n?o=Math.max(0,o+n-50):q=Math.min(b.doc.height,q+n+50),Z(b,{top:o,bottom:q})}20>zd&&(null==h.wheelStartX?(h.wheelStartX=j.scrollLeft,h.wheelStartY=j.scrollTop,h.wheelDX=e,h.wheelDY=g,setTimeout(function(){if(null!=h.wheelStartX){var a=j.scrollLeft-h.wheelStartX,b=j.scrollTop-h.wheelStartY,c=b&&h.wheelDY&&b/h.wheelDY||a&&h.wheelDX&&a/h.wheelDX;h.wheelStartX=h.wheelStartY=null,c&&(Ad=(Ad*zd+c)/(zd+1),++zd)}},200)):(h.wheelDX+=e,h.wheelDY+=g))}}function Dd(a,b,c){if("string"==typeof b&&(b=Ae[b],!b))return!1;a.display.pollingFast&&dd(a)&&(a.display.pollingFast=!1);var d=a.display.shift,e=!1;try{hd(a)&&(a.state.suppressEdits=!0),c&&(a.display.shift=!1),e=b(a)!=Jg}finally{a.display.shift=d,a.state.suppressEdits=!1}return e}function Ed(a,b,c){for(var d=0;d<a.state.keyMaps.length;d++){var e=De(b,a.state.keyMaps[d],c,a);if(e)return e}return a.options.extraKeys&&De(b,a.options.extraKeys,c,a)||De(b,a.options.keyMap,c,a)}function Gd(a,b,c,d){var e=a.state.keySeq;if(e){if(Ee(b))return"handled";Fd.set(50,function(){a.state.keySeq==e&&(a.state.keySeq=null,ed(a))}),b=e+" "+b}var f=Ed(a,b,d);return"multi"==f&&(a.state.keySeq=b),"handled"==f&&Cg(a,"keyHandled",a,b,c),("handled"==f||"multi"==f)&&(sg(c),Vb(a)),e&&!f&&/\'$/.test(b)?(sg(c),!0):!!f}function Hd(a,b){var c=Fe(b,!0);return c?b.shiftKey&&!a.state.keySeq?Gd(a,"Shift-"+c,b,function(b){return Dd(a,b,!0)})||Gd(a,c,b,function(b){return("string"==typeof b?/^go[A-Z]/.test(b):b.motion)?Dd(a,b):void 0}):Gd(a,c,b,function(b){return Dd(a,b)}):!1}function Id(a,b,c){return Gd(a,"'"+c+"'",b,function(b){return Dd(a,b,!0)})}function Kd(a){var b=this;if(gd(b),!Eg(b,a)){d&&11>e&&27==a.keyCode&&(a.returnValue=!1);var c=a.keyCode;b.display.shift=16==c||a.shiftKey;var f=Hd(b,a);i&&(Jd=f?c:null,!f&&88==c&&!yh&&(p?a.metaKey:a.ctrlKey)&&b.replaceSelection("",null,"cut")),18!=c||/\bCodeMirror-crosshair\b/.test(b.display.lineDiv.className)||Ld(b)}}function Ld(a){function c(a){18!=a.keyCode&&a.altKey||(kh(b,"CodeMirror-crosshair"),zg(document,"keyup",c),zg(document,"mouseover",c))}var b=a.display.lineDiv;lh(b,"CodeMirror-crosshair"),yg(document,"keyup",c),yg(document,"mouseover",c)}function Md(a){16==a.keyCode&&(this.doc.sel.shift=!1),Eg(this,a)}function Nd(a){var b=this;if(!(Eg(b,a)||a.ctrlKey&&!a.altKey||p&&a.metaKey)){var c=a.keyCode,f=a.charCode;if(i&&c==Jd)return Jd=null,sg(a),void 0;if(!(i&&(!a.which||a.which<10)||k)||!Hd(b,a)){var g=String.fromCharCode(null==f?c:f);Id(b,a,g)||(d&&e>=9&&(b.display.inputHasSelection=null),bd(b))}}}function Od(a){"nocursor"!=a.options.readOnly&&(a.state.focused||(Ag(a,"focus",a),a.state.focused=!0,lh(a.display.wrapper,"CodeMirror-focused"),a.curOp||a.display.selForContextMenu==a.doc.sel||(ed(a),f&&setTimeout(Yg(ed,a,!0),0))),ad(a),Vb(a))}function Pd(a){a.state.focused&&(Ag(a,"blur",a),a.state.focused=!1,kh(a.display.wrapper,"CodeMirror-focused")),clearInterval(a.display.blinker),setTimeout(function(){a.state.focused||(a.display.shift=!1)},150)}function Qd(a,b){function m(){if(null!=c.input.selectionStart){var b=a.somethingSelected(),d=c.input.value="\u200b"+(b?c.input.value:"");c.prevInput=b?"":"\u200b",c.input.selectionStart=1,c.input.selectionEnd=d.length,c.selForContextMenu=a.doc.sel}}function n(){if(c.contextMenuPending=!1,c.inputDiv.style.position="relative",c.input.style.cssText=k,d&&9>e&&c.scrollbars.setScrollTop(c.scroller.scrollTop=h),ad(a),null!=c.input.selectionStart){(!d||d&&9>e)&&m();var b=0,f=function(){c.selForContextMenu==a.doc.sel&&0==c.input.selectionStart?Qc(a,Ae.selectAll)(a):b++<10?c.detectingSelectAll=setTimeout(f,500):ed(a)};c.detectingSelectAll=setTimeout(f,200)}}if(!Eg(a,b,"contextmenu")){var c=a.display;if(!kd(c,b)&&!Rd(a,b)){var g=ld(a,b),h=c.scroller.scrollTop;if(g&&!i){var j=a.options.resetSelectionOnContextMenu;j&&-1==a.doc.sel.contains(g)&&Qc(a,Kb)(a.doc,xb(g),Kg);var k=c.input.style.cssText;if(c.inputDiv.style.position="absolute",c.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(b.clientY-5)+"px; left: "+(b.clientX-5)+"px; z-index: 1000; background: "+(d?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",f)var l=window.scrollY;if(fd(a),f&&window.scrollTo(null,l),ed(a),a.somethingSelected()||(c.input.value=c.prevInput=" "),c.contextMenuPending=!0,c.selForContextMenu=a.doc.sel,clearTimeout(c.detectingSelectAll),d&&e>=9&&m(),t){vg(b);var o=function(){zg(window,"mouseup",o),setTimeout(n,20)};yg(window,"mouseup",o)}else setTimeout(n,50)}}}}function Rd(a,b){return Gg(a,"gutterContextMenu")?sd(a,b,"gutterContextMenu",!1,Ag):!1}function Td(a,b){if(qb(a,b.from)<0)return a;if(qb(a,b.to)<=0)return Sd(b);var c=a.line+b.text.length-(b.to.line-b.from.line)-1,d=a.ch;return a.line==b.to.line&&(d+=Sd(b).ch-b.to.ch),pb(c,d)}function Ud(a,b){for(var c=[],d=0;d<a.sel.ranges.length;d++){var e=a.sel.ranges[d];c.push(new vb(Td(e.anchor,b),Td(e.head,b)))}return wb(c,a.sel.primIndex)}function Vd(a,b,c){return a.line==b.line?pb(c.line,a.ch-b.ch+c.ch):pb(c.line+(a.line-b.line),a.ch)}function Wd(a,b,c){for(var d=[],e=pb(a.first,0),f=e,g=0;g<b.length;g++){var h=b[g],i=Vd(h.from,e,f),j=Vd(Sd(h),e,f);if(e=h.to,f=j,"around"==c){var k=a.sel.ranges[g],l=qb(k.head,k.anchor)<0;d[g]=new vb(l?j:i,l?i:j)}else d[g]=new vb(i,i)}return new ub(d,a.sel.primIndex)}function Xd(a,b,c){var d={canceled:!1,from:b.from,to:b.to,text:b.text,origin:b.origin,cancel:function(){this.canceled=!0}};return c&&(d.update=function(b,c,d,e){b&&(this.from=zb(a,b)),c&&(this.to=zb(a,c)),d&&(this.text=d),void 0!==e&&(this.origin=e)}),Ag(a,"beforeChange",a,d),a.cm&&Ag(a.cm,"beforeChange",a.cm,d),d.canceled?null:{from:d.from,to:d.to,text:d.text,origin:d.origin}}function Yd(a,b,c){if(a.cm){if(!a.cm.curOp)return Qc(a.cm,Yd)(a,b,c);if(a.cm.state.suppressEdits)return}if(!(Gg(a,"beforeChange")||a.cm&&Gg(a.cm,"beforeChange"))||(b=Xd(a,b,!0))){var d=u&&!c&&Ze(a,b.from,b.to);if(d)for(var e=d.length-1;e>=0;--e)Zd(a,{from:d[e].from,to:d[e].to,text:e?[""]:b.text});else Zd(a,b)}}function Zd(a,b){if(1!=b.text.length||""!=b.text[0]||0!=qb(b.from,b.to)){var c=Ud(a,b);hg(a,b,c,a.cm?a.cm.curOp.id:0/0),ae(a,b,c,We(a,b));var d=[];Vf(a,function(a,c){c||-1!=Ug(d,a.history)||(rg(a.history,b),d.push(a.history)),ae(a,b,null,We(a,b))})}}function $d(a,b,c){if(!a.cm||!a.cm.state.suppressEdits){for(var e,d=a.history,f=a.sel,g="undo"==b?d.done:d.undone,h="undo"==b?d.undone:d.done,i=0;i<g.length&&(e=g[i],c?!e.ranges||e.equals(a.sel):e.ranges);i++);if(i!=g.length){for(d.lastOrigin=d.lastSelOrigin=null;e=g.pop(),e.ranges;){if(kg(e,h),c&&!e.equals(a.sel))return Kb(a,e,{clearRedo:!1}),void 0;f=e}var j=[];kg(f,h),h.push({changes:j,generation:d.generation}),d.generation=e.generation||++d.maxGeneration;for(var k=Gg(a,"beforeChange")||a.cm&&Gg(a.cm,"beforeChange"),i=e.changes.length-1;i>=0;--i){var l=e.changes[i];if(l.origin=b,k&&!Xd(a,l,!1))return g.length=0,void 0;j.push(eg(a,l));var m=i?Ud(a,l):Sg(g);ae(a,l,m,Ye(a,l)),!i&&a.cm&&a.cm.scrollIntoView({from:l.from,to:Sd(l)});var n=[];Vf(a,function(a,b){b||-1!=Ug(n,a.history)||(rg(a.history,l),n.push(a.history)),ae(a,l,null,Ye(a,l))})}}}}function _d(a,b){if(0!=b&&(a.first+=b,a.sel=new ub(Vg(a.sel.ranges,function(a){return new vb(pb(a.anchor.line+b,a.anchor.ch),pb(a.head.line+b,a.head.ch))}),a.sel.primIndex),a.cm)){Vc(a.cm,a.first,a.first-b,b);for(var c=a.cm.display,d=c.viewFrom;d<c.viewTo;d++)Wc(a.cm,d,"gutter")}}function ae(a,b,c,d){if(a.cm&&!a.cm.curOp)return Qc(a.cm,ae)(a,b,c,d);if(b.to.line<a.first)return _d(a,b.text.length-1-(b.to.line-b.from.line)),void 0;if(!(b.from.line>a.lastLine())){if(b.from.line<a.first){var e=b.text.length-1-(a.first-b.from.line);_d(a,e),b={from:pb(a.first,0),to:pb(b.to.line+e,b.to.ch),text:[Sg(b.text)],origin:b.origin}}var f=a.lastLine();b.to.line>f&&(b={from:b.from,to:pb(f,Xf(a,f).text.length),text:[b.text[0]],origin:b.origin}),b.removed=Yf(a,b.from,b.to),c||(c=Ud(a,b)),a.cm?be(a.cm,b,d):Of(a,b,d),Lb(a,c,Kg)}}function be(a,b,c){var d=a.doc,e=a.display,f=b.from,g=b.to,h=!1,i=f.line;a.options.lineWrapping||(i=_f(hf(Xf(d,f.line))),d.iter(i,g.line+1,function(a){return a==e.maxLine?(h=!0,!0):void 0})),d.sel.contains(b.from,b.to)>-1&&Fg(a),Of(d,b,c,B(a)),a.options.lineWrapping||(d.iter(i,f.line+b.text.length,function(a){var b=H(a);b>e.maxLineLength&&(e.maxLine=a,e.maxLineLength=b,e.maxLineChanged=!0,h=!1)}),h&&(a.curOp.updateMaxLine=!0)),d.frontier=Math.min(d.frontier,f.line),Wb(a,400);var j=b.text.length-(g.line-f.line)-1;b.full?Vc(a):f.line!=g.line||1!=b.text.length||Nf(a.doc,b)?Vc(a,f.line,g.line+1,j):Wc(a,f.line,"text");var k=Gg(a,"changes"),l=Gg(a,"change");if(l||k){var m={from:f,to:g,text:b.text,removed:b.removed,origin:b.origin};l&&Cg(a,"change",a,m),k&&(a.curOp.changeObjs||(a.curOp.changeObjs=[])).push(m)}a.display.selForContextMenu=null}function ce(a,b,c,d,e){if(d||(d=c),qb(d,c)<0){var f=d;d=c,c=f}"string"==typeof b&&(b=wh(b)),Yd(a,{from:c,to:d,text:b,origin:e})}function de(a,b){if(!Eg(a,"scrollCursorIntoView")){var c=a.display,d=c.sizer.getBoundingClientRect(),e=null;if(b.top+d.top<0?e=!0:b.bottom+d.top>(window.innerHeight||document.documentElement.clientHeight)&&(e=!1),null!=e&&!m){var f=dh("div","\u200b",null,"position: absolute; top: "+(b.top-c.viewOffset-$b(a.display))+"px; height: "+(b.bottom-b.top+bc(a)+c.barHeight)+"px; left: "+b.left+"px; width: 2px;");a.display.lineSpace.appendChild(f),f.scrollIntoView(e),a.display.lineSpace.removeChild(f)}}}function ee(a,b,c,d){null==d&&(d=0);for(var e=0;5>e;e++){var f=!1,g=wc(a,b),h=c&&c!=b?wc(a,c):g,i=ge(a,Math.min(g.left,h.left),Math.min(g.top,h.top)-d,Math.max(g.left,h.left),Math.max(g.bottom,h.bottom)+d),j=a.doc.scrollTop,k=a.doc.scrollLeft;if(null!=i.scrollTop&&(xd(a,i.scrollTop),Math.abs(a.doc.scrollTop-j)>1&&(f=!0)),null!=i.scrollLeft&&(yd(a,i.scrollLeft),Math.abs(a.doc.scrollLeft-k)>1&&(f=!0)),!f)break}return g}function fe(a,b,c,d,e){var f=ge(a,b,c,d,e);null!=f.scrollTop&&xd(a,f.scrollTop),null!=f.scrollLeft&&yd(a,f.scrollLeft)}function ge(a,b,c,d,e){var f=a.display,g=Cc(a.display);0>c&&(c=0);var h=a.curOp&&null!=a.curOp.scrollTop?a.curOp.scrollTop:f.scroller.scrollTop,i=dc(a),j={};e-c>i&&(e=c+i);var k=a.doc.height+_b(f),l=g>c,m=e>k-g;if(h>c)j.scrollTop=l?0:c;else if(e>h+i){var n=Math.min(c,(m?k:e)-i);n!=h&&(j.scrollTop=n)}var o=a.curOp&&null!=a.curOp.scrollLeft?a.curOp.scrollLeft:f.scroller.scrollLeft,p=cc(a)-(a.options.fixedGutter?f.gutters.offsetWidth:0),q=d-b>p;return q&&(d=b+p),10>b?j.scrollLeft=0:o>b?j.scrollLeft=Math.max(0,b-(q?0:10)):d>p+o-3&&(j.scrollLeft=d+(q?0:10)-p),j}function he(a,b,c){(null!=b||null!=c)&&je(a),null!=b&&(a.curOp.scrollLeft=(null==a.curOp.scrollLeft?a.doc.scrollLeft:a.curOp.scrollLeft)+b),null!=c&&(a.curOp.scrollTop=(null==a.curOp.scrollTop?a.doc.scrollTop:a.curOp.scrollTop)+c)}function ie(a){je(a);var b=a.getCursor(),c=b,d=b;a.options.lineWrapping||(c=b.ch?pb(b.line,b.ch-1):b,d=pb(b.line,b.ch+1)),a.curOp.scrollToPos={from:c,to:d,margin:a.options.cursorScrollMargin,isCursor:!0}}function je(a){var b=a.curOp.scrollToPos;if(b){a.curOp.scrollToPos=null;var c=xc(a,b.from),d=xc(a,b.to),e=ge(a,Math.min(c.left,d.left),Math.min(c.top,d.top)-b.margin,Math.max(c.right,d.right),Math.max(c.bottom,d.bottom)+b.margin);a.scrollTo(e.scrollLeft,e.scrollTop)}}function ke(a,b,c,d){var f,e=a.doc;null==c&&(c="add"),"smart"==c&&(e.mode.indent?f=Zb(a,b):c="prev");var g=a.options.tabSize,h=Xf(e,b),i=Og(h.text,null,g);h.stateAfter&&(h.stateAfter=null);var k,j=h.text.match(/^\s*/)[0];if(d||/\S/.test(h.text)){if("smart"==c&&(k=e.mode.indent(f,h.text.slice(j.length),h.text),k==Jg||k>150)){if(!d)return;c="prev"}}else k=0,c="not";"prev"==c?k=b>e.first?Og(Xf(e,b-1).text,null,g):0:"add"==c?k=i+a.options.indentUnit:"subtract"==c?k=i-a.options.indentUnit:"number"==typeof c&&(k=i+c),k=Math.max(0,k);var l="",m=0;if(a.options.indentWithTabs)for(var n=Math.floor(k/g);n;--n)m+=g,l+="	";if(k>m&&(l+=Rg(k-m)),l!=j)ce(e,l,pb(b,0),pb(b,j.length),"+input");else for(var n=0;n<e.sel.ranges.length;n++){var o=e.sel.ranges[n];if(o.head.line==b&&o.head.ch<j.length){var m=pb(b,j.length);Gb(e,n,new vb(m,m));break}}h.stateAfter=null}function le(a,b,c,d){var e=b,f=b;return"number"==typeof b?f=Xf(a,yb(a,b)):e=_f(b),null==e?null:(d(f,e)&&a.cm&&Wc(a.cm,e,c),f)}function me(a,b){for(var c=a.doc.sel.ranges,d=[],e=0;e<c.length;e++){for(var f=b(c[e]);d.length&&qb(f.from,Sg(d).to)<=0;){var g=d.pop();if(qb(g.from,f.from)<0){f.from=g.from;break}}d.push(f)}Pc(a,function(){for(var b=d.length-1;b>=0;b--)ce(a.doc,"",d[b].from,d[b].to,"+delete");ie(a)})}function ne(a,b,c,d,e){function k(){var b=f+c;return b<a.first||b>=a.first+a.size?j=!1:(f=b,i=Xf(a,b))}function l(a){var b=(e?Oh:Ph)(i,g,c,!0);if(null==b){if(a||!k())return j=!1;g=e?(0>c?Gh:Fh)(i):0>c?i.text.length:0}else g=b;return!0}var f=b.line,g=b.ch,h=c,i=Xf(a,f),j=!0;if("char"==d)l();else if("column"==d)l(!0);else if("word"==d||"group"==d)for(var m=null,n="group"==d,o=a.cm&&a.cm.getHelper(b,"wordChars"),p=!0;!(0>c)||l(!p);p=!1){var q=i.text.charAt(g)||"\n",r=_g(q,o)?"w":n&&"\n"==q?"n":!n||/\s/.test(q)?null:"p";if(!n||p||r||(r="s"),m&&m!=r){0>c&&(c=1,l());break}if(r&&(m=r),c>0&&!l(!p))break}var s=Pb(a,pb(f,g),h,!0);return j||(s.hitSide=!0),s}function oe(a,b,c,d){var g,e=a.doc,f=b.left;if("page"==d){var h=Math.min(a.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);g=b.top+c*(h-(0>c?1.5:.5)*Cc(a.display))}else"line"==d&&(g=c>0?b.bottom+3:b.top-3);for(;;){var i=zc(a,f,g);if(!i.outside)break;if(0>c?0>=g:g>=e.height){i.hitSide=!0;break}g+=5*c}return i}function re(a,b,c,d){w.defaults[a]=b,c&&(qe[a]=d?function(a,b,d){d!=se&&c(a,b,d)}:c)}function Ce(a){for(var c,d,e,f,b=a.split(/-(?!$)/),a=b[b.length-1],g=0;g<b.length-1;g++){var h=b[g];if(/^(cmd|meta|m)$/i.test(h))f=!0;else if(/^a(lt)?$/i.test(h))c=!0;
else if(/^(c|ctrl|control)$/i.test(h))d=!0;else{if(!/^s(hift)$/i.test(h))throw new Error("Unrecognized modifier name: "+h);e=!0}}return c&&(a="Alt-"+a),d&&(a="Ctrl-"+a),f&&(a="Cmd-"+a),e&&(a="Shift-"+a),a}function Ge(a){return"string"==typeof a?Be[a]:a}function Ke(a,b,c,d,e){if(d&&d.shared)return Me(a,b,c,d,e);if(a.cm&&!a.cm.curOp)return Qc(a.cm,Ke)(a,b,c,d,e);var f=new Ie(a,e),g=qb(b,c);if(d&&Xg(d,f,!1),g>0||0==g&&f.clearWhenEmpty!==!1)return f;if(f.replacedWith&&(f.collapsed=!0,f.widgetNode=dh("span",[f.replacedWith],"CodeMirror-widget"),d.handleMouseEvents||f.widgetNode.setAttribute("cm-ignore-events","true"),d.insertLeft&&(f.widgetNode.insertLeft=!0)),f.collapsed){if(gf(a,b.line,b,c,f)||b.line!=c.line&&gf(a,c.line,b,c,f))throw new Error("Inserting collapsed marker partially overlapping an existing one");v=!0}f.addToHistory&&hg(a,{from:b,to:c,origin:"markText"},a.sel,0/0);var j,h=b.line,i=a.cm;if(a.iter(h,c.line+1,function(a){i&&f.collapsed&&!i.options.lineWrapping&&hf(a)==i.display.maxLine&&(j=!0),f.collapsed&&h!=b.line&&$f(a,0),Te(a,new Qe(f,h==b.line?b.ch:null,h==c.line?c.ch:null)),++h}),f.collapsed&&a.iter(b.line,c.line+1,function(b){mf(a,b)&&$f(b,0)}),f.clearOnEnter&&yg(f,"beforeCursorEnter",function(){f.clear()}),f.readOnly&&(u=!0,(a.history.done.length||a.history.undone.length)&&a.clearHistory()),f.collapsed&&(f.id=++Je,f.atomic=!0),i){if(j&&(i.curOp.updateMaxLine=!0),f.collapsed)Vc(i,b.line,c.line+1);else if(f.className||f.title||f.startStyle||f.endStyle||f.css)for(var k=b.line;k<=c.line;k++)Wc(i,k,"text");f.atomic&&Nb(i.doc),Cg(i,"markerAdded",i,f)}return f}function Me(a,b,c,d,e){d=Xg(d),d.shared=!1;var f=[Ke(a,b,c,d,e)],g=f[0],h=d.widgetNode;return Vf(a,function(a){h&&(d.widgetNode=h.cloneNode(!0)),f.push(Ke(a,zb(a,b),zb(a,c),d,e));for(var i=0;i<a.linked.length;++i)if(a.linked[i].isParent)return;g=Sg(f)}),new Le(f,g)}function Ne(a){return a.findMarks(pb(a.first,0),a.clipPos(pb(a.lastLine())),function(a){return a.parent})}function Oe(a,b){for(var c=0;c<b.length;c++){var d=b[c],e=d.find(),f=a.clipPos(e.from),g=a.clipPos(e.to);if(qb(f,g)){var h=Ke(a,f,g,d.primary,d.primary.type);d.markers.push(h),h.parent=d}}}function Pe(a){for(var b=0;b<a.length;b++){var c=a[b],d=[c.primary.doc];Vf(c.primary.doc,function(a){d.push(a)});for(var e=0;e<c.markers.length;e++){var f=c.markers[e];-1==Ug(d,f.doc)&&(f.parent=null,c.markers.splice(e--,1))}}}function Qe(a,b,c){this.marker=a,this.from=b,this.to=c}function Re(a,b){if(a)for(var c=0;c<a.length;++c){var d=a[c];if(d.marker==b)return d}}function Se(a,b){for(var c,d=0;d<a.length;++d)a[d]!=b&&(c||(c=[])).push(a[d]);return c}function Te(a,b){a.markedSpans=a.markedSpans?a.markedSpans.concat([b]):[b],b.marker.attachLine(a)}function Ue(a,b,c){if(a)for(var e,d=0;d<a.length;++d){var f=a[d],g=f.marker,h=null==f.from||(g.inclusiveLeft?f.from<=b:f.from<b);if(h||f.from==b&&"bookmark"==g.type&&(!c||!f.marker.insertLeft)){var i=null==f.to||(g.inclusiveRight?f.to>=b:f.to>b);(e||(e=[])).push(new Qe(g,f.from,i?null:f.to))}}return e}function Ve(a,b,c){if(a)for(var e,d=0;d<a.length;++d){var f=a[d],g=f.marker,h=null==f.to||(g.inclusiveRight?f.to>=b:f.to>b);if(h||f.from==b&&"bookmark"==g.type&&(!c||f.marker.insertLeft)){var i=null==f.from||(g.inclusiveLeft?f.from<=b:f.from<b);(e||(e=[])).push(new Qe(g,i?null:f.from-b,null==f.to?null:f.to-b))}}return e}function We(a,b){if(b.full)return null;var c=Bb(a,b.from.line)&&Xf(a,b.from.line).markedSpans,d=Bb(a,b.to.line)&&Xf(a,b.to.line).markedSpans;if(!c&&!d)return null;var e=b.from.ch,f=b.to.ch,g=0==qb(b.from,b.to),h=Ue(c,e,g),i=Ve(d,f,g),j=1==b.text.length,k=Sg(b.text).length+(j?e:0);if(h)for(var l=0;l<h.length;++l){var m=h[l];if(null==m.to){var n=Re(i,m.marker);n?j&&(m.to=null==n.to?null:n.to+k):m.to=e}}if(i)for(var l=0;l<i.length;++l){var m=i[l];if(null!=m.to&&(m.to+=k),null==m.from){var n=Re(h,m.marker);n||(m.from=k,j&&(h||(h=[])).push(m))}else m.from+=k,j&&(h||(h=[])).push(m)}h&&(h=Xe(h)),i&&i!=h&&(i=Xe(i));var o=[h];if(!j){var q,p=b.text.length-2;if(p>0&&h)for(var l=0;l<h.length;++l)null==h[l].to&&(q||(q=[])).push(new Qe(h[l].marker,null,null));for(var l=0;p>l;++l)o.push(q);o.push(i)}return o}function Xe(a){for(var b=0;b<a.length;++b){var c=a[b];null!=c.from&&c.from==c.to&&c.marker.clearWhenEmpty!==!1&&a.splice(b--,1)}return a.length?a:null}function Ye(a,b){var c=ng(a,b),d=We(a,b);if(!c)return d;if(!d)return c;for(var e=0;e<c.length;++e){var f=c[e],g=d[e];if(f&&g)a:for(var h=0;h<g.length;++h){for(var i=g[h],j=0;j<f.length;++j)if(f[j].marker==i.marker)continue a;f.push(i)}else g&&(c[e]=g)}return c}function Ze(a,b,c){var d=null;if(a.iter(b.line,c.line+1,function(a){if(a.markedSpans)for(var b=0;b<a.markedSpans.length;++b){var c=a.markedSpans[b].marker;!c.readOnly||d&&-1!=Ug(d,c)||(d||(d=[])).push(c)}}),!d)return null;for(var e=[{from:b,to:c}],f=0;f<d.length;++f)for(var g=d[f],h=g.find(0),i=0;i<e.length;++i){var j=e[i];if(!(qb(j.to,h.from)<0||qb(j.from,h.to)>0)){var k=[i,1],l=qb(j.from,h.from),m=qb(j.to,h.to);(0>l||!g.inclusiveLeft&&!l)&&k.push({from:j.from,to:h.from}),(m>0||!g.inclusiveRight&&!m)&&k.push({from:h.to,to:j.to}),e.splice.apply(e,k),i+=k.length-1}}return e}function $e(a){var b=a.markedSpans;if(b){for(var c=0;c<b.length;++c)b[c].marker.detachLine(a);a.markedSpans=null}}function _e(a,b){if(b){for(var c=0;c<b.length;++c)b[c].marker.attachLine(a);a.markedSpans=b}}function af(a){return a.inclusiveLeft?-1:0}function bf(a){return a.inclusiveRight?1:0}function cf(a,b){var c=a.lines.length-b.lines.length;if(0!=c)return c;var d=a.find(),e=b.find(),f=qb(d.from,e.from)||af(a)-af(b);if(f)return-f;var g=qb(d.to,e.to)||bf(a)-bf(b);return g?g:b.id-a.id}function df(a,b){var d,c=v&&a.markedSpans;if(c)for(var e,f=0;f<c.length;++f)e=c[f],e.marker.collapsed&&null==(b?e.from:e.to)&&(!d||cf(d,e.marker)<0)&&(d=e.marker);return d}function ef(a){return df(a,!0)}function ff(a){return df(a,!1)}function gf(a,b,c,d,e){var f=Xf(a,b),g=v&&f.markedSpans;if(g)for(var h=0;h<g.length;++h){var i=g[h];if(i.marker.collapsed){var j=i.marker.find(0),k=qb(j.from,c)||af(i.marker)-af(e),l=qb(j.to,d)||bf(i.marker)-bf(e);if(!(k>=0&&0>=l||0>=k&&l>=0)&&(0>=k&&(qb(j.to,c)>0||i.marker.inclusiveRight&&e.inclusiveLeft)||k>=0&&(qb(j.from,d)<0||i.marker.inclusiveLeft&&e.inclusiveRight)))return!0}}}function hf(a){for(var b;b=ef(a);)a=b.find(-1,!0).line;return a}function jf(a){for(var b,c;b=ff(a);)a=b.find(1,!0).line,(c||(c=[])).push(a);return c}function kf(a,b){var c=Xf(a,b),d=hf(c);return c==d?b:_f(d)}function lf(a,b){if(b>a.lastLine())return b;var d,c=Xf(a,b);if(!mf(a,c))return b;for(;d=ff(c);)c=d.find(1,!0).line;return _f(c)+1}function mf(a,b){var c=v&&b.markedSpans;if(c)for(var d,e=0;e<c.length;++e)if(d=c[e],d.marker.collapsed){if(null==d.from)return!0;if(!d.marker.widgetNode&&0==d.from&&d.marker.inclusiveLeft&&nf(a,b,d))return!0}}function nf(a,b,c){if(null==c.to){var d=c.marker.find(1,!0);return nf(a,d.line,Re(d.line.markedSpans,c.marker))}if(c.marker.inclusiveRight&&c.to==b.text.length)return!0;for(var e,f=0;f<b.markedSpans.length;++f)if(e=b.markedSpans[f],e.marker.collapsed&&!e.marker.widgetNode&&e.from==c.to&&(null==e.to||e.to!=c.from)&&(e.marker.inclusiveLeft||c.marker.inclusiveRight)&&nf(a,b,e))return!0}function pf(a,b,c){bg(b)<(a.curOp&&a.curOp.scrollTop||a.doc.scrollTop)&&he(a,null,c)}function qf(a){if(null!=a.height)return a.height;if(!hh(document.body,a.node)){var b="position: relative;";a.coverGutter&&(b+="margin-left: -"+a.cm.display.gutters.offsetWidth+"px;"),a.noHScroll&&(b+="width: "+a.cm.display.wrapper.clientWidth+"px;"),gh(a.cm.display.measure,dh("div",[a.node],null,b))}return a.height=a.node.offsetHeight}function rf(a,b,c,d){var e=new of(a,c,d);return e.noHScroll&&(a.display.alignWidgets=!0),le(a.doc,b,"widget",function(b){var c=b.widgets||(b.widgets=[]);if(null==e.insertAt?c.push(e):c.splice(Math.min(c.length-1,Math.max(0,e.insertAt)),0,e),e.line=b,!mf(a.doc,b)){var d=bg(b)<a.doc.scrollTop;$f(b,b.height+qf(e)),d&&he(a,null,e.height),a.curOp.forceUpdate=!0}return!0}),e}function tf(a,b,c,d){a.text=b,a.stateAfter&&(a.stateAfter=null),a.styles&&(a.styles=null),null!=a.order&&(a.order=null),$e(a),_e(a,c);var e=d?d(a):1;e!=a.height&&$f(a,e)}function uf(a){a.parent=null,$e(a)}function vf(a,b){if(a)for(;;){var c=a.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!c)break;a=a.slice(0,c.index)+a.slice(c.index+c[0].length);var d=c[1]?"bgClass":"textClass";null==b[d]?b[d]=c[2]:new RegExp("(?:^|s)"+c[2]+"(?:$|s)").test(b[d])||(b[d]+=" "+c[2])}return a}function wf(a,b){if(a.blankLine)return a.blankLine(b);if(a.innerMode){var c=w.innerMode(a,b);return c.mode.blankLine?c.mode.blankLine(c.state):void 0}}function xf(a,b,c,d){for(var e=0;10>e;e++){d&&(d[0]=w.innerMode(a,c).mode);var f=a.token(b,c);if(b.pos>b.start)return f}throw new Error("Mode "+a.name+" failed to advance stream.")}function yf(a,b,c,d){function e(a){return{start:k.start,end:k.pos,string:k.current(),type:h||null,state:a?ye(f.mode,j):j}}var h,f=a.doc,g=f.mode;b=zb(f,b);var l,i=Xf(f,b.line),j=Zb(a,b.line,c),k=new He(i.text,a.options.tabSize);for(d&&(l=[]);(d||k.pos<b.ch)&&!k.eol();)k.start=k.pos,h=xf(g,k,j),d&&l.push(e(!0));return d?l:e()}function zf(a,b,c,d,e,f,g){var h=c.flattenSpans;null==h&&(h=a.options.flattenSpans);var l,i=0,j=null,k=new He(b,a.options.tabSize),m=a.options.addModeClass&&[null];for(""==b&&vf(wf(c,d),f);!k.eol();){if(k.pos>a.options.maxHighlightLength?(h=!1,g&&Cf(a,b,d,k.pos),k.pos=b.length,l=null):l=vf(xf(c,k,d,m),f),m){var n=m[0].name;n&&(l="m-"+(l?n+" "+l:n))}if(!h||j!=l){for(;i<k.start;)i=Math.min(k.start,i+5e4),e(i,j);j=l}k.start=k.pos}for(;i<k.pos;){var o=Math.min(k.pos,i+5e4);e(o,j),i=o}}function Af(a,b,c,d){var e=[a.state.modeGen],f={};zf(a,b.text,a.doc.mode,c,function(a,b){e.push(a,b)},f,d);for(var g=0;g<a.state.overlays.length;++g){var h=a.state.overlays[g],i=1,j=0;zf(a,b.text,h.mode,!0,function(a,b){for(var c=i;a>j;){var d=e[i];d>a&&e.splice(i,1,a,e[i+1],d),i+=2,j=Math.min(a,d)}if(b)if(h.opaque)e.splice(c,i-c,a,"cm-overlay "+b),i=c+2;else for(;i>c;c+=2){var f=e[c+1];e[c+1]=(f?f+" ":"")+"cm-overlay "+b}},f)}return{styles:e,classes:f.bgClass||f.textClass?f:null}}function Bf(a,b,c){if(!b.styles||b.styles[0]!=a.state.modeGen){var d=Af(a,b,b.stateAfter=Zb(a,_f(b)));b.styles=d.styles,d.classes?b.styleClasses=d.classes:b.styleClasses&&(b.styleClasses=null),c===a.doc.frontier&&a.doc.frontier++}return b.styles}function Cf(a,b,c,d){var e=a.doc.mode,f=new He(b,a.options.tabSize);for(f.start=f.pos=d||0,""==b&&wf(e,c);!f.eol()&&f.pos<=a.options.maxHighlightLength;)xf(e,f,c),f.start=f.pos}function Ff(a,b){if(!a||/^\s*$/.test(a))return null;var c=b.addModeClass?Ef:Df;return c[a]||(c[a]=a.replace(/\S+/g,"cm-$&"))}function Gf(a,b){var c=dh("span",null,null,f?"padding-right: .1px":null),e={pre:dh("pre",[c]),content:c,col:0,pos:0,cm:a};b.measure={};for(var g=0;g<=(b.rest?b.rest.length:0);g++){var i,h=g?b.rest[g-1]:b.line;e.pos=0,e.addToken=If,(d||f)&&a.getOption("lineWrapping")&&(e.addToken=Jf(e.addToken)),vh(a.display.measure)&&(i=cg(h))&&(e.addToken=Kf(e.addToken,i)),e.map=[];var j=b!=a.display.externalMeasured&&_f(h);Mf(h,e,Bf(a,h,j)),h.styleClasses&&(h.styleClasses.bgClass&&(e.bgClass=mh(h.styleClasses.bgClass,e.bgClass||"")),h.styleClasses.textClass&&(e.textClass=mh(h.styleClasses.textClass,e.textClass||""))),0==e.map.length&&e.map.push(0,0,e.content.appendChild(th(a.display.measure))),0==g?(b.measure.map=e.map,b.measure.cache={}):((b.measure.maps||(b.measure.maps=[])).push(e.map),(b.measure.caches||(b.measure.caches=[])).push({}))}return f&&/\bcm-tab\b/.test(e.content.lastChild.className)&&(e.content.className="cm-tab-wrap-hack"),Ag(a,"renderLine",a,b.line,e.pre),e.pre.className&&(e.textClass=mh(e.pre.className,e.textClass||"")),e}function Hf(a){var b=dh("span","\u2022","cm-invalidchar");return b.title="\\u"+a.charCodeAt(0).toString(16),b}function If(a,b,c,f,g,h,i){if(b){var j=a.cm.options.specialChars,k=!1;if(j.test(b))for(var l=document.createDocumentFragment(),m=0;;){j.lastIndex=m;var n=j.exec(b),o=n?n.index-m:b.length-m;if(o){var p=document.createTextNode(b.slice(m,m+o));d&&9>e?l.appendChild(dh("span",[p])):l.appendChild(p),a.map.push(a.pos,a.pos+o,p),a.col+=o,a.pos+=o}if(!n)break;if(m+=o+1,"	"==n[0]){var q=a.cm.options.tabSize,r=q-a.col%q,p=l.appendChild(dh("span",Rg(r),"cm-tab"));a.col+=r}else{var p=a.cm.options.specialCharPlaceholder(n[0]);d&&9>e?l.appendChild(dh("span",[p])):l.appendChild(p),a.col+=1}a.map.push(a.pos,a.pos+1,p),a.pos++}else{a.col+=b.length;var l=document.createTextNode(b);a.map.push(a.pos,a.pos+b.length,l),d&&9>e&&(k=!0),a.pos+=b.length}if(c||f||g||k||i){var s=c||"";f&&(s+=f),g&&(s+=g);var t=dh("span",[l],s,i);return h&&(t.title=h),a.content.appendChild(t)}a.content.appendChild(l)}}function Jf(a){function b(a){for(var b=" ",c=0;c<a.length-2;++c)b+=c%2?" ":"\xa0";return b+=" "}return function(c,d,e,f,g,h){a(c,d.replace(/ {3,}/g,b),e,f,g,h)}}function Kf(a,b){return function(c,d,e,f,g,h){e=e?e+" cm-force-border":"cm-force-border";for(var i=c.pos,j=i+d.length;;){for(var k=0;k<b.length;k++){var l=b[k];if(l.to>i&&l.from<=i)break}if(l.to>=j)return a(c,d,e,f,g,h);a(c,d.slice(0,l.to-i),e,f,null,h),f=null,d=d.slice(l.to-i),i=l.to}}}function Lf(a,b,c,d){var e=!d&&c.widgetNode;e&&(a.map.push(a.pos,a.pos+b,e),a.content.appendChild(e)),a.pos+=b}function Mf(a,b,c){var d=a.markedSpans,e=a.text,f=0;if(d)for(var k,l,n,o,p,q,r,h=e.length,i=0,g=1,j="",m=0;;){if(m==i){n=o=p=q=l="",r=null,m=1/0;for(var s=[],t=0;t<d.length;++t){var u=d[t],v=u.marker;u.from<=i&&(null==u.to||u.to>i)?(null!=u.to&&m>u.to&&(m=u.to,o=""),v.className&&(n+=" "+v.className),v.css&&(l=v.css),v.startStyle&&u.from==i&&(p+=" "+v.startStyle),v.endStyle&&u.to==m&&(o+=" "+v.endStyle),v.title&&!q&&(q=v.title),v.collapsed&&(!r||cf(r.marker,v)<0)&&(r=u)):u.from>i&&m>u.from&&(m=u.from),"bookmark"==v.type&&u.from==i&&v.widgetNode&&s.push(v)}if(r&&(r.from||0)==i&&(Lf(b,(null==r.to?h+1:r.to)-i,r.marker,null==r.from),null==r.to))return;if(!r&&s.length)for(var t=0;t<s.length;++t)Lf(b,0,s[t])}if(i>=h)break;for(var w=Math.min(h,m);;){if(j){var x=i+j.length;if(!r){var y=x>w?j.slice(0,w-i):j;b.addToken(b,y,k?k+n:n,p,i+y.length==m?o:"",q,l)}if(x>=w){j=j.slice(w-i),i=w;break}i=x,p=""}j=e.slice(f,f=c[g++]),k=Ff(c[g++],b.cm.options)}}else for(var g=1;g<c.length;g+=2)b.addToken(b,e.slice(f,f=c[g]),Ff(c[g+1],b.cm.options))}function Nf(a,b){return 0==b.from.ch&&0==b.to.ch&&""==Sg(b.text)&&(!a.cm||a.cm.options.wholeLineUpdateBefore)}function Of(a,b,c,d){function e(a){return c?c[a]:null}function f(a,c,e){tf(a,c,e,d),Cg(a,"change",a,b)}function g(a,b){for(var c=a,f=[];b>c;++c)f.push(new sf(j[c],e(c),d));return f}var h=b.from,i=b.to,j=b.text,k=Xf(a,h.line),l=Xf(a,i.line),m=Sg(j),n=e(j.length-1),o=i.line-h.line;if(b.full)a.insert(0,g(0,j.length)),a.remove(j.length,a.size-j.length);else if(Nf(a,b)){var p=g(0,j.length-1);f(l,l.text,n),o&&a.remove(h.line,o),p.length&&a.insert(h.line,p)}else if(k==l)if(1==j.length)f(k,k.text.slice(0,h.ch)+m+k.text.slice(i.ch),n);else{var p=g(1,j.length-1);p.push(new sf(m+k.text.slice(i.ch),n,d)),f(k,k.text.slice(0,h.ch)+j[0],e(0)),a.insert(h.line+1,p)}else if(1==j.length)f(k,k.text.slice(0,h.ch)+j[0]+l.text.slice(i.ch),e(0)),a.remove(h.line+1,o);else{f(k,k.text.slice(0,h.ch)+j[0],e(0)),f(l,m+l.text.slice(i.ch),n);var p=g(1,j.length-1);o>1&&a.remove(h.line+1,o-1),a.insert(h.line+1,p)}Cg(a,"change",a,b)}function Pf(a){this.lines=a,this.parent=null;for(var b=0,c=0;b<a.length;++b)a[b].parent=this,c+=a[b].height;this.height=c}function Qf(a){this.children=a;for(var b=0,c=0,d=0;d<a.length;++d){var e=a[d];b+=e.chunkSize(),c+=e.height,e.parent=this}this.size=b,this.height=c,this.parent=null}function Vf(a,b,c){function d(a,e,f){if(a.linked)for(var g=0;g<a.linked.length;++g){var h=a.linked[g];if(h.doc!=e){var i=f&&h.sharedHist;(!c||i)&&(b(h.doc,i),d(h.doc,a,i))}}}d(a,null,!0)}function Wf(a,b){if(b.cm)throw new Error("This document is already in use.");a.doc=b,b.cm=a,C(a),y(a),a.options.lineWrapping||I(a),a.options.mode=b.modeOption,Vc(a)}function Xf(a,b){if(b-=a.first,0>b||b>=a.size)throw new Error("There is no line "+(b+a.first)+" in the document.");for(var c=a;!c.lines;)for(var d=0;;++d){var e=c.children[d],f=e.chunkSize();if(f>b){c=e;break}b-=f}return c.lines[b]}function Yf(a,b,c){var d=[],e=b.line;return a.iter(b.line,c.line+1,function(a){var f=a.text;e==c.line&&(f=f.slice(0,c.ch)),e==b.line&&(f=f.slice(b.ch)),d.push(f),++e}),d}function Zf(a,b,c){var d=[];return a.iter(b,c,function(a){d.push(a.text)}),d}function $f(a,b){var c=b-a.height;if(c)for(var d=a;d;d=d.parent)d.height+=c}function _f(a){if(null==a.parent)return null;for(var b=a.parent,c=Ug(b.lines,a),d=b.parent;d;b=d,d=d.parent)for(var e=0;d.children[e]!=b;++e)c+=d.children[e].chunkSize();return c+b.first}function ag(a,b){var c=a.first;a:do{for(var d=0;d<a.children.length;++d){var e=a.children[d],f=e.height;if(f>b){a=e;continue a}b-=f,c+=e.chunkSize()}return c}while(!a.lines);for(var d=0;d<a.lines.length;++d){var g=a.lines[d],h=g.height;if(h>b)break;b-=h}return c+d}function bg(a){a=hf(a);for(var b=0,c=a.parent,d=0;d<c.lines.length;++d){var e=c.lines[d];if(e==a)break;b+=e.height}for(var f=c.parent;f;c=f,f=c.parent)for(var d=0;d<f.children.length;++d){var g=f.children[d];if(g==c)break;b+=g.height}return b}function cg(a){var b=a.order;return null==b&&(b=a.order=Qh(a.text)),b}function dg(a){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=a||1}function eg(a,b){var c={from:rb(b.from),to:Sd(b),text:Yf(a,b.from,b.to)};return lg(a,c,b.from.line,b.to.line+1),Vf(a,function(a){lg(a,c,b.from.line,b.to.line+1)},!0),c}function fg(a){for(;a.length;){var b=Sg(a);if(!b.ranges)break;a.pop()}}function gg(a,b){return b?(fg(a.done),Sg(a.done)):a.done.length&&!Sg(a.done).ranges?Sg(a.done):a.done.length>1&&!a.done[a.done.length-2].ranges?(a.done.pop(),Sg(a.done)):void 0}function hg(a,b,c,d){var e=a.history;e.undone.length=0;var g,f=+new Date;if((e.lastOp==d||e.lastOrigin==b.origin&&b.origin&&("+"==b.origin.charAt(0)&&a.cm&&e.lastModTime>f-a.cm.options.historyEventDelay||"*"==b.origin.charAt(0)))&&(g=gg(e,e.lastOp==d))){var h=Sg(g.changes);0==qb(b.from,b.to)&&0==qb(b.from,h.to)?h.to=Sd(b):g.changes.push(eg(a,b))}else{var i=Sg(e.done);for(i&&i.ranges||kg(a.sel,e.done),g={changes:[eg(a,b)],generation:e.generation},e.done.push(g);e.done.length>e.undoDepth;)e.done.shift(),e.done[0].ranges||e.done.shift()}e.done.push(c),e.generation=++e.maxGeneration,e.lastModTime=e.lastSelTime=f,e.lastOp=e.lastSelOp=d,e.lastOrigin=e.lastSelOrigin=b.origin,h||Ag(a,"historyAdded")}function ig(a,b,c,d){var e=b.charAt(0);return"*"==e||"+"==e&&c.ranges.length==d.ranges.length&&c.somethingSelected()==d.somethingSelected()&&new Date-a.history.lastSelTime<=(a.cm?a.cm.options.historyEventDelay:500)}function jg(a,b,c,d){var e=a.history,f=d&&d.origin;c==e.lastSelOp||f&&e.lastSelOrigin==f&&(e.lastModTime==e.lastSelTime&&e.lastOrigin==f||ig(a,f,Sg(e.done),b))?e.done[e.done.length-1]=b:kg(b,e.done),e.lastSelTime=+new Date,e.lastSelOrigin=f,e.lastSelOp=c,d&&d.clearRedo!==!1&&fg(e.undone)}function kg(a,b){var c=Sg(b);c&&c.ranges&&c.equals(a)||b.push(a)}function lg(a,b,c,d){var e=b["spans_"+a.id],f=0;a.iter(Math.max(a.first,c),Math.min(a.first+a.size,d),function(c){c.markedSpans&&((e||(e=b["spans_"+a.id]={}))[f]=c.markedSpans),++f})}function mg(a){if(!a)return null;for(var c,b=0;b<a.length;++b)a[b].marker.explicitlyCleared?c||(c=a.slice(0,b)):c&&c.push(a[b]);return c?c.length?c:null:a}function ng(a,b){var c=b["spans_"+a.id];if(!c)return null;for(var d=0,e=[];d<b.text.length;++d)e.push(mg(c[d]));return e}function og(a,b,c){for(var d=0,e=[];d<a.length;++d){var f=a[d];if(f.ranges)e.push(c?ub.prototype.deepCopy.call(f):f);else{var g=f.changes,h=[];e.push({changes:h});for(var i=0;i<g.length;++i){var k,j=g[i];if(h.push({from:j.from,to:j.to,text:j.text}),b)for(var l in j)(k=l.match(/^spans_(\d+)$/))&&Ug(b,Number(k[1]))>-1&&(Sg(h)[l]=j[l],delete j[l])}}}return e}function pg(a,b,c,d){c<a.line?a.line+=d:b<a.line&&(a.line=b,a.ch=0)}function qg(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e],g=!0;if(f.ranges){f.copied||(f=a[e]=f.deepCopy(),f.copied=!0);for(var h=0;h<f.ranges.length;h++)pg(f.ranges[h].anchor,b,c,d),pg(f.ranges[h].head,b,c,d)}else{for(var h=0;h<f.changes.length;++h){var i=f.changes[h];if(c<i.from.line)i.from=pb(i.from.line+d,i.from.ch),i.to=pb(i.to.line+d,i.to.ch);else if(b<=i.to.line){g=!1;break}}g||(a.splice(0,e+1),e=0)}}}function rg(a,b){var c=b.from.line,d=b.to.line,e=b.text.length-(d-c)-1;qg(a.done,c,d,e),qg(a.undone,c,d,e)}function ug(a){return null!=a.defaultPrevented?a.defaultPrevented:0==a.returnValue}function wg(a){return a.target||a.srcElement}function xg(a){var b=a.which;return null==b&&(1&a.button?b=1:2&a.button?b=3:4&a.button&&(b=2)),p&&a.ctrlKey&&1==b&&(b=3),b}function Cg(a,b){function f(a){return function(){a.apply(null,d)}}var c=a._handlers&&a._handlers[b];if(c){var e,d=Array.prototype.slice.call(arguments,2);Ec?e=Ec.delayedCallbacks:Bg?e=Bg:(e=Bg=[],setTimeout(Dg,0));for(var g=0;g<c.length;++g)e.push(f(c[g]))}}function Dg(){var a=Bg;Bg=null;for(var b=0;b<a.length;++b)a[b]()}function Eg(a,b,c){return"string"==typeof b&&(b={type:b,preventDefault:function(){this.defaultPrevented=!0}}),Ag(a,c||b.type,a,b),ug(b)||b.codemirrorIgnore}function Fg(a){var b=a._handlers&&a._handlers.cursorActivity;if(b)for(var c=a.curOp.cursorActivityHandlers||(a.curOp.cursorActivityHandlers=[]),d=0;d<b.length;++d)-1==Ug(c,b[d])&&c.push(b[d])}function Gg(a,b){var c=a._handlers&&a._handlers[b];return c&&c.length>0}function Hg(a){a.prototype.on=function(a,b){yg(this,a,b)},a.prototype.off=function(a,b){zg(this,a,b)}}function Ng(){this.id=null}function Pg(a,b,c){for(var d=0,e=0;;){var f=a.indexOf("	",d);-1==f&&(f=a.length);var g=f-d;if(f==a.length||e+g>=b)return d+Math.min(g,b-e);if(e+=f-d,e+=c-e%c,d=f+1,e>=b)return d}}function Rg(a){for(;Qg.length<=a;)Qg.push(Sg(Qg)+" ");return Qg[a]}function Sg(a){return a[a.length-1]}function Ug(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return c;return-1}function Vg(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=b(a[d],d);return c}function Wg(a,b){var c;if(Object.create)c=Object.create(a);else{var d=function(){};d.prototype=a,c=new d}return b&&Xg(b,c),c}function Xg(a,b,c){b||(b={});for(var d in a)!a.hasOwnProperty(d)||c===!1&&b.hasOwnProperty(d)||(b[d]=a[d]);return b}function Yg(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b)}}function _g(a,b){return b?b.source.indexOf("\\w")>-1&&$g(a)?!0:b.test(a):$g(a)}function ah(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0}function ch(a){return a.charCodeAt(0)>=768&&bh.test(a)}function dh(a,b,c,d){var e=document.createElement(a);if(c&&(e.className=c),d&&(e.style.cssText=d),"string"==typeof b)e.appendChild(document.createTextNode(b));else if(b)for(var f=0;f<b.length;++f)e.appendChild(b[f]);return e}function fh(a){for(var b=a.childNodes.length;b>0;--b)a.removeChild(a.firstChild);return a}function gh(a,b){return fh(a).appendChild(b)}function hh(a,b){if(a.contains)return a.contains(b);for(;b=b.parentNode;)if(b==a)return!0}function ih(){return document.activeElement}function jh(a){return new RegExp("(^|\\s)"+a+"(?:$|\\s)\\s*")}function mh(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)c[d]&&!jh(c[d]).test(b)&&(b+=" "+c[d]);return b}function nh(a){if(document.body.getElementsByClassName)for(var b=document.body.getElementsByClassName("CodeMirror"),c=0;c<b.length;c++){var d=b[c].CodeMirror;d&&a(d)}}function ph(){oh||(qh(),oh=!0)}function qh(){var a;yg(window,"resize",function(){null==a&&(a=setTimeout(function(){a=null,nh(jd)},100))}),yg(window,"blur",function(){nh(Pd)})}function th(a){if(null==sh){var b=dh("span","\u200b");gh(a,dh("span",[b,document.createTextNode("x")])),0!=a.firstChild.offsetHeight&&(sh=b.offsetWidth<=1&&b.offsetHeight>2&&!(d&&8>e))}return sh?dh("span","\u200b"):dh("span","\xa0",null,"display: inline-block; width: 1px; margin-right: -1px")}function vh(a){if(null!=uh)return uh;var b=gh(a,document.createTextNode("A\u062eA")),c=eh(b,0,1).getBoundingClientRect();if(!c||c.left==c.right)return!1;var d=eh(b,1,2).getBoundingClientRect();return uh=d.right-c.right<3}function Ah(a){if(null!=zh)return zh;var b=gh(a,dh("span","x")),c=b.getBoundingClientRect(),d=eh(b,0,1).getBoundingClientRect();return zh=Math.abs(c.left-d.left)>1}function Ch(a,b,c,d){if(!a)return d(b,c,"ltr");for(var e=!1,f=0;f<a.length;++f){var g=a[f];(g.from<c&&g.to>b||b==c&&g.to==b)&&(d(Math.max(g.from,b),Math.min(g.to,c),1==g.level?"rtl":"ltr"),e=!0)}e||d(b,c,"ltr")}function Dh(a){return a.level%2?a.to:a.from}function Eh(a){return a.level%2?a.from:a.to}function Fh(a){var b=cg(a);return b?Dh(b[0]):0}function Gh(a){var b=cg(a);return b?Eh(Sg(b)):a.text.length}function Hh(a,b){var c=Xf(a.doc,b),d=hf(c);d!=c&&(b=_f(d));var e=cg(d),f=e?e[0].level%2?Gh(d):Fh(d):0;return pb(b,f)}function Ih(a,b){for(var c,d=Xf(a.doc,b);c=ff(d);)d=c.find(1,!0).line,b=null;var e=cg(d),f=e?e[0].level%2?Fh(d):Gh(d):d.text.length;return pb(null==b?_f(d):b,f)}function Jh(a,b){var c=Hh(a,b.line),d=Xf(a.doc,c.line),e=cg(d);if(!e||0==e[0].level){var f=Math.max(0,d.text.search(/\S/)),g=b.line==c.line&&b.ch<=f&&b.ch;return pb(c.line,g?0:f)}return c}function Kh(a,b,c){var d=a[0].level;return b==d?!0:c==d?!1:c>b}function Mh(a,b){Lh=null;for(var d,c=0;c<a.length;++c){var e=a[c];if(e.from<b&&e.to>b)return c;if(e.from==b||e.to==b){if(null!=d)return Kh(a,e.level,a[d].level)?(e.from!=e.to&&(Lh=d),c):(e.from!=e.to&&(Lh=c),d);d=c}}return d}function Nh(a,b,c,d){if(!d)return b+c;do b+=c;while(b>0&&ch(a.text.charAt(b)));return b}function Oh(a,b,c,d){var e=cg(a);if(!e)return Ph(a,b,c,d);for(var f=Mh(e,b),g=e[f],h=Nh(a,b,g.level%2?-c:c,d);;){if(h>g.from&&h<g.to)return h;if(h==g.from||h==g.to)return Mh(e,h)==f?h:(g=e[f+=c],c>0==g.level%2?g.to:g.from);if(g=e[f+=c],!g)return null;h=c>0==g.level%2?Nh(a,g.to,-1,d):Nh(a,g.from,1,d)}}function Ph(a,b,c,d){var e=b+c;if(d)for(;e>0&&ch(a.text.charAt(e));)e+=c;return 0>e||e>a.text.length?null:e}var a=/gecko\/\d/i.test(navigator.userAgent),b=/MSIE \d/.test(navigator.userAgent),c=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),d=b||c,e=d&&(b?document.documentMode||6:c[1]),f=/WebKit\//.test(navigator.userAgent),g=f&&/Qt\/\d+\.\d+/.test(navigator.userAgent),h=/Chrome\//.test(navigator.userAgent),i=/Opera\//.test(navigator.userAgent),j=/Apple Computer/.test(navigator.vendor),k=/KHTML\//.test(navigator.userAgent),l=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),m=/PhantomJS/.test(navigator.userAgent),n=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),o=n||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),p=n||/Mac/.test(navigator.platform),q=/win/i.test(navigator.platform),r=i&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);r&&(r=Number(r[1])),r&&r>=15&&(i=!1,f=!0);var s=p&&(g||i&&(null==r||12.11>r)),t=a||d&&e>=9,u=!1,v=!1;L.prototype=Xg({update:function(a){var b=a.scrollWidth>a.clientWidth+1,c=a.scrollHeight>a.clientHeight+1,d=a.nativeBarWidth;if(c){this.vert.style.display="block",this.vert.style.bottom=b?d+"px":"0";var e=a.viewHeight-(b?d:0);this.vert.firstChild.style.height=Math.max(0,a.scrollHeight-a.clientHeight+e)+"px"}else this.vert.style.display="",this.vert.firstChild.style.height="0";if(b){this.horiz.style.display="block",this.horiz.style.right=c?d+"px":"0",this.horiz.style.left=a.barLeft+"px";var f=a.viewWidth-a.barLeft-(c?d:0);this.horiz.firstChild.style.width=a.scrollWidth-a.clientWidth+f+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedOverlay&&a.clientHeight>0&&(0==d&&this.overlayHack(),this.checkedOverlay=!0),{right:c?d:0,bottom:b?d:0}},setScrollLeft:function(a){this.horiz.scrollLeft!=a&&(this.horiz.scrollLeft=a)},setScrollTop:function(a){this.vert.scrollTop!=a&&(this.vert.scrollTop=a)},overlayHack:function(){var a=p&&!l?"12px":"18px";this.horiz.style.minHeight=this.vert.style.minWidth=a;var b=this,c=function(a){wg(a)!=b.vert&&wg(a)!=b.horiz&&Qc(b.cm,md)(a)};yg(this.vert,"mousedown",c),yg(this.horiz,"mousedown",c)},clear:function(){var a=this.horiz.parentNode;a.removeChild(this.horiz),a.removeChild(this.vert)}},L.prototype),M.prototype=Xg({update:function(){return{bottom:0,right:0}},setScrollLeft:function(){},setScrollTop:function(){},clear:function(){}},M.prototype),w.scrollbarModel={"native":L,"null":M};var pb=w.Pos=function(a,b){return this instanceof pb?(this.line=a,this.ch=b,void 0):new pb(a,b)},qb=w.cmpPos=function(a,b){return a.line-b.line||a.ch-b.ch};ub.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(a){if(a==this)return!0;if(a.primIndex!=this.primIndex||a.ranges.length!=this.ranges.length)return!1;for(var b=0;b<this.ranges.length;b++){var c=this.ranges[b],d=a.ranges[b];if(0!=qb(c.anchor,d.anchor)||0!=qb(c.head,d.head))return!1}return!0},deepCopy:function(){for(var a=[],b=0;b<this.ranges.length;b++)a[b]=new vb(rb(this.ranges[b].anchor),rb(this.ranges[b].head));return new ub(a,this.primIndex)},somethingSelected:function(){for(var a=0;a<this.ranges.length;a++)if(!this.ranges[a].empty())return!0;return!1},contains:function(a,b){b||(b=a);for(var c=0;c<this.ranges.length;c++){var d=this.ranges[c];if(qb(b,d.from())>=0&&qb(a,d.to())<=0)return c}return-1}},vb.prototype={from:function(){return tb(this.anchor,this.head)},to:function(){return sb(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};var Bc,nd,od,lc={left:0,right:0,top:0,bottom:0},Ec=null,Fc=0,cd=null,ud=0,zd=0,Ad=null;d?Ad=-.53:a?Ad=15:h?Ad=-.7:j&&(Ad=-1/3);var Bd=function(a){var b=a.wheelDeltaX,c=a.wheelDeltaY;return null==b&&a.detail&&a.axis==a.HORIZONTAL_AXIS&&(b=a.detail),null==c&&a.detail&&a.axis==a.VERTICAL_AXIS?c=a.detail:null==c&&(c=a.wheelDelta),{x:b,y:c}};w.wheelEventPixels=function(a){var b=Bd(a);return b.x*=Ad,b.y*=Ad,b};var Fd=new Ng,Jd=null,Sd=w.changeEnd=function(a){return a.text?pb(a.from.line+a.text.length-1,Sg(a.text).length+(1==a.text.length?a.from.ch:0)):a.to};w.prototype={constructor:w,focus:function(){window.focus(),fd(this),bd(this)},setOption:function(a,b){var c=this.options,d=c[a];(c[a]!=b||"mode"==a)&&(c[a]=b,qe.hasOwnProperty(a)&&Qc(this,qe[a])(this,b,d))},getOption:function(a){return this.options[a]},getDoc:function(){return this.doc},addKeyMap:function(a,b){this.state.keyMaps[b?"push":"unshift"](Ge(a))},removeKeyMap:function(a){for(var b=this.state.keyMaps,c=0;c<b.length;++c)if(b[c]==a||b[c].name==a)return b.splice(c,1),!0},addOverlay:Rc(function(a,b){var c=a.token?a:w.getMode(this.options,a);if(c.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:c,modeSpec:a,opaque:b&&b.opaque}),this.state.modeGen++,Vc(this)}),removeOverlay:Rc(function(a){for(var b=this.state.overlays,c=0;c<b.length;++c){var d=b[c].modeSpec;if(d==a||"string"==typeof a&&d.name==a)return b.splice(c,1),this.state.modeGen++,Vc(this),void 0}}),indentLine:Rc(function(a,b,c){"string"!=typeof b&&"number"!=typeof b&&(b=null==b?this.options.smartIndent?"smart":"prev":b?"add":"subtract"),Bb(this.doc,a)&&ke(this,a,b,c)}),indentSelection:Rc(function(a){for(var b=this.doc.sel.ranges,c=-1,d=0;d<b.length;d++){var e=b[d];if(e.empty())e.head.line>c&&(ke(this,e.head.line,a,!0),c=e.head.line,d==this.doc.sel.primIndex&&ie(this));else{var f=e.from(),g=e.to(),h=Math.max(c,f.line);c=Math.min(this.lastLine(),g.line-(g.ch?0:1))+1;for(var i=h;c>i;++i)ke(this,i,a);var j=this.doc.sel.ranges;0==f.ch&&b.length==j.length&&j[d].from().ch>0&&Gb(this.doc,d,new vb(f,j[d].to()),Kg)}}}),getTokenAt:function(a,b){return yf(this,a,b)},getLineTokens:function(a,b){return yf(this,pb(a),b,!0)},getTokenTypeAt:function(a){a=zb(this.doc,a);var f,b=Bf(this,Xf(this.doc,a.line)),c=0,d=(b.length-1)/2,e=a.ch;if(0==e)f=b[2];else for(;;){var g=c+d>>1;if((g?b[2*g-1]:0)>=e)d=g;else{if(!(b[2*g+1]<e)){f=b[2*g+2];break}c=g+1}}var h=f?f.indexOf("cm-overlay "):-1;return 0>h?f:0==h?null:f.slice(0,h-1)},getModeAt:function(a){var b=this.doc.mode;
return b.innerMode?w.innerMode(b,this.getTokenAt(a).state).mode:b},getHelper:function(a,b){return this.getHelpers(a,b)[0]},getHelpers:function(a,b){var c=[];if(!xe.hasOwnProperty(b))return xe;var d=xe[b],e=this.getModeAt(a);if("string"==typeof e[b])d[e[b]]&&c.push(d[e[b]]);else if(e[b])for(var f=0;f<e[b].length;f++){var g=d[e[b][f]];g&&c.push(g)}else e.helperType&&d[e.helperType]?c.push(d[e.helperType]):d[e.name]&&c.push(d[e.name]);for(var f=0;f<d._global.length;f++){var h=d._global[f];h.pred(e,this)&&-1==Ug(c,h.val)&&c.push(h.val)}return c},getStateAfter:function(a,b){var c=this.doc;return a=yb(c,null==a?c.first+c.size-1:a),Zb(this,a+1,b)},cursorCoords:function(a,b){var c,d=this.doc.sel.primary();return c=null==a?d.head:"object"==typeof a?zb(this.doc,a):a?d.from():d.to(),wc(this,c,b||"page")},charCoords:function(a,b){return vc(this,zb(this.doc,a),b||"page")},coordsChar:function(a,b){return a=uc(this,a,b||"page"),zc(this,a.left,a.top)},lineAtHeight:function(a,b){return a=uc(this,{top:a,left:0},b||"page").top,ag(this.doc,a+this.display.viewOffset)},heightAtLine:function(a,b){var c=!1,d=this.doc.first+this.doc.size-1;a<this.doc.first?a=this.doc.first:a>d&&(a=d,c=!0);var e=Xf(this.doc,a);return tc(this,e,{top:0,left:0},b||"page").top+(c?this.doc.height-bg(e):0)},defaultTextHeight:function(){return Cc(this.display)},defaultCharWidth:function(){return Dc(this.display)},setGutterMarker:Rc(function(a,b,c){return le(this.doc,a,"gutter",function(a){var d=a.gutterMarkers||(a.gutterMarkers={});return d[b]=c,!c&&ah(d)&&(a.gutterMarkers=null),!0})}),clearGutter:Rc(function(a){var b=this,c=b.doc,d=c.first;c.iter(function(c){c.gutterMarkers&&c.gutterMarkers[a]&&(c.gutterMarkers[a]=null,Wc(b,d,"gutter"),ah(c.gutterMarkers)&&(c.gutterMarkers=null)),++d})}),addLineWidget:Rc(function(a,b,c){return rf(this,a,b,c)}),removeLineWidget:function(a){a.clear()},lineInfo:function(a){if("number"==typeof a){if(!Bb(this.doc,a))return null;var b=a;if(a=Xf(this.doc,a),!a)return null}else{var b=_f(a);if(null==b)return null}return{line:b,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(a,b,c,d,e){var f=this.display;a=wc(this,zb(this.doc,a));var g=a.bottom,h=a.left;if(b.style.position="absolute",b.setAttribute("cm-ignore-events","true"),f.sizer.appendChild(b),"over"==d)g=a.top;else if("above"==d||"near"==d){var i=Math.max(f.wrapper.clientHeight,this.doc.height),j=Math.max(f.sizer.clientWidth,f.lineSpace.clientWidth);("above"==d||a.bottom+b.offsetHeight>i)&&a.top>b.offsetHeight?g=a.top-b.offsetHeight:a.bottom+b.offsetHeight<=i&&(g=a.bottom),h+b.offsetWidth>j&&(h=j-b.offsetWidth)}b.style.top=g+"px",b.style.left=b.style.right="","right"==e?(h=f.sizer.clientWidth-b.offsetWidth,b.style.right="0px"):("left"==e?h=0:"middle"==e&&(h=(f.sizer.clientWidth-b.offsetWidth)/2),b.style.left=h+"px"),c&&fe(this,h,g,h+b.offsetWidth,g+b.offsetHeight)},triggerOnKeyDown:Rc(Kd),triggerOnKeyPress:Rc(Nd),triggerOnKeyUp:Md,execCommand:function(a){return Ae.hasOwnProperty(a)?Ae[a](this):void 0},findPosH:function(a,b,c,d){var e=1;0>b&&(e=-1,b=-b);for(var f=0,g=zb(this.doc,a);b>f&&(g=ne(this.doc,g,e,c,d),!g.hitSide);++f);return g},moveH:Rc(function(a,b){var c=this;c.extendSelectionsBy(function(d){return c.display.shift||c.doc.extend||d.empty()?ne(c.doc,d.head,a,b,c.options.rtlMoveVisually):0>a?d.from():d.to()},Mg)}),deleteH:Rc(function(a,b){var c=this.doc.sel,d=this.doc;c.somethingSelected()?d.replaceSelection("",null,"+delete"):me(this,function(c){var e=ne(d,c.head,a,b,!1);return 0>a?{from:e,to:c.head}:{from:c.head,to:e}})}),findPosV:function(a,b,c,d){var e=1,f=d;0>b&&(e=-1,b=-b);for(var g=0,h=zb(this.doc,a);b>g;++g){var i=wc(this,h,"div");if(null==f?f=i.left:i.left=f,h=oe(this,i,e,c),h.hitSide)break}return h},moveV:Rc(function(a,b){var c=this,d=this.doc,e=[],f=!c.display.shift&&!d.extend&&d.sel.somethingSelected();if(d.extendSelectionsBy(function(g){if(f)return 0>a?g.from():g.to();var h=wc(c,g.head,"div");null!=g.goalColumn&&(h.left=g.goalColumn),e.push(h.left);var i=oe(c,h,a,b);return"page"==b&&g==d.sel.primary()&&he(c,null,vc(c,i,"div").top-h.top),i},Mg),e.length)for(var g=0;g<d.sel.ranges.length;g++)d.sel.ranges[g].goalColumn=e[g]}),findWordAt:function(a){var b=this.doc,c=Xf(b,a.line).text,d=a.ch,e=a.ch;if(c){var f=this.getHelper(a,"wordChars");(a.xRel<0||e==c.length)&&d?--d:++e;for(var g=c.charAt(d),h=_g(g,f)?function(a){return _g(a,f)}:/\s/.test(g)?function(a){return/\s/.test(a)}:function(a){return!/\s/.test(a)&&!_g(a)};d>0&&h(c.charAt(d-1));)--d;for(;e<c.length&&h(c.charAt(e));)++e}return new vb(pb(a.line,d),pb(a.line,e))},toggleOverwrite:function(a){(null==a||a!=this.state.overwrite)&&((this.state.overwrite=!this.state.overwrite)?lh(this.display.cursorDiv,"CodeMirror-overwrite"):kh(this.display.cursorDiv,"CodeMirror-overwrite"),Ag(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return ih()==this.display.input},scrollTo:Rc(function(a,b){(null!=a||null!=b)&&je(this),null!=a&&(this.curOp.scrollLeft=a),null!=b&&(this.curOp.scrollTop=b)}),getScrollInfo:function(){var a=this.display.scroller;return{left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-bc(this)-this.display.barHeight,width:a.scrollWidth-bc(this)-this.display.barWidth,clientHeight:dc(this),clientWidth:cc(this)}},scrollIntoView:Rc(function(a,b){if(null==a?(a={from:this.doc.sel.primary().head,to:null},null==b&&(b=this.options.cursorScrollMargin)):"number"==typeof a?a={from:pb(a,0),to:null}:null==a.from&&(a={from:a,to:null}),a.to||(a.to=a.from),a.margin=b||0,null!=a.from.line)je(this),this.curOp.scrollToPos=a;else{var c=ge(this,Math.min(a.from.left,a.to.left),Math.min(a.from.top,a.to.top)-a.margin,Math.max(a.from.right,a.to.right),Math.max(a.from.bottom,a.to.bottom)+a.margin);this.scrollTo(c.scrollLeft,c.scrollTop)}}),setSize:Rc(function(a,b){function d(a){return"number"==typeof a||/^\d+$/.test(String(a))?a+"px":a}var c=this;null!=a&&(c.display.wrapper.style.width=d(a)),null!=b&&(c.display.wrapper.style.height=d(b)),c.options.lineWrapping&&pc(this);var e=c.display.viewFrom;c.doc.iter(e,c.display.viewTo,function(a){if(a.widgets)for(var b=0;b<a.widgets.length;b++)if(a.widgets[b].noHScroll){Wc(c,e,"widget");break}++e}),c.curOp.forceUpdate=!0,Ag(c,"refresh",this)}),operation:function(a){return Pc(this,a)},refresh:Rc(function(){var a=this.display.cachedTextHeight;Vc(this),this.curOp.forceUpdate=!0,qc(this),this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop),G(this),(null==a||Math.abs(a-Cc(this.display))>.5)&&C(this),Ag(this,"refresh",this)}),swapDoc:Rc(function(a){var b=this.doc;return b.cm=null,Wf(this,a),qc(this),ed(this),this.scrollTo(a.scrollLeft,a.scrollTop),this.curOp.forceScroll=!0,Cg(this,"swapDoc",this,b),b}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Hg(w);var pe=w.defaults={},qe=w.optionHandlers={},se=w.Init={toString:function(){return"CodeMirror.Init"}};re("value","",function(a,b){a.setValue(b)},!0),re("mode",null,function(a,b){a.doc.modeOption=b,y(a)},!0),re("indentUnit",2,y,!0),re("indentWithTabs",!1),re("smartIndent",!0),re("tabSize",4,function(a){z(a),qc(a),Vc(a)},!0),re("specialChars",/[\t\u0000-\u0019\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g,function(a,b){a.options.specialChars=new RegExp(b.source+(b.test("	")?"":"|	"),"g"),a.refresh()},!0),re("specialCharPlaceholder",Hf,function(a){a.refresh()},!0),re("electricChars",!0),re("rtlMoveVisually",!q),re("wholeLineUpdateBefore",!0),re("theme","default",function(a){D(a),E(a)},!0),re("keyMap","default",function(a,b,c){var d=Ge(b),e=c!=w.Init&&Ge(c);e&&e.detach&&e.detach(a,d),d.attach&&d.attach(a,e||null)}),re("extraKeys",null),re("lineWrapping",!1,A,!0),re("gutters",[],function(a){J(a.options),E(a)},!0),re("fixedGutter",!0,function(a,b){a.display.gutters.style.left=b?U(a.display)+"px":"0",a.refresh()},!0),re("coverGutterNextToScrollbar",!1,function(a){O(a)},!0),re("scrollbarStyle","native",function(a){N(a),O(a),a.display.scrollbars.setScrollTop(a.doc.scrollTop),a.display.scrollbars.setScrollLeft(a.doc.scrollLeft)},!0),re("lineNumbers",!1,function(a){J(a.options),E(a)},!0),re("firstLineNumber",1,E,!0),re("lineNumberFormatter",function(a){return a},E,!0),re("showCursorWhenSelecting",!1,Sb,!0),re("resetSelectionOnContextMenu",!0),re("readOnly",!1,function(a,b){"nocursor"==b?(Pd(a),a.display.input.blur(),a.display.disabled=!0):(a.display.disabled=!1,b||ed(a))}),re("disableInput",!1,function(a,b){b||ed(a)},!0),re("dragDrop",!0),re("cursorBlinkRate",530),re("cursorScrollMargin",0),re("cursorHeight",1,Sb,!0),re("singleCursorHeightPerLine",!0,Sb,!0),re("workTime",100),re("workDelay",100),re("flattenSpans",!0,z,!0),re("addModeClass",!1,z,!0),re("pollInterval",100),re("undoDepth",200,function(a,b){a.doc.history.undoDepth=b}),re("historyEventDelay",1250),re("viewportMargin",10,function(a){a.refresh()},!0),re("maxHighlightLength",1e4,z,!0),re("moveInputWithCursor",!0,function(a,b){b||(a.display.inputDiv.style.top=a.display.inputDiv.style.left=0)}),re("tabindex",null,function(a,b){a.display.input.tabIndex=b||""}),re("autofocus",null);var te=w.modes={},ue=w.mimeModes={};w.defineMode=function(a,b){w.defaults.mode||"null"==a||(w.defaults.mode=a),arguments.length>2&&(b.dependencies=Array.prototype.slice.call(arguments,2)),te[a]=b},w.defineMIME=function(a,b){ue[a]=b},w.resolveMode=function(a){if("string"==typeof a&&ue.hasOwnProperty(a))a=ue[a];else if(a&&"string"==typeof a.name&&ue.hasOwnProperty(a.name)){var b=ue[a.name];"string"==typeof b&&(b={name:b}),a=Wg(b,a),a.name=b.name}else if("string"==typeof a&&/^[\w\-]+\/[\w\-]+\+xml$/.test(a))return w.resolveMode("application/xml");return"string"==typeof a?{name:a}:a||{name:"null"}},w.getMode=function(a,b){var b=w.resolveMode(b),c=te[b.name];if(!c)return w.getMode(a,"text/plain");var d=c(a,b);if(ve.hasOwnProperty(b.name)){var e=ve[b.name];for(var f in e)e.hasOwnProperty(f)&&(d.hasOwnProperty(f)&&(d["_"+f]=d[f]),d[f]=e[f])}if(d.name=b.name,b.helperType&&(d.helperType=b.helperType),b.modeProps)for(var f in b.modeProps)d[f]=b.modeProps[f];return d},w.defineMode("null",function(){return{token:function(a){a.skipToEnd()}}}),w.defineMIME("text/plain","null");var ve=w.modeExtensions={};w.extendMode=function(a,b){var c=ve.hasOwnProperty(a)?ve[a]:ve[a]={};Xg(b,c)},w.defineExtension=function(a,b){w.prototype[a]=b},w.defineDocExtension=function(a,b){Sf.prototype[a]=b},w.defineOption=re;var we=[];w.defineInitHook=function(a){we.push(a)};var xe=w.helpers={};w.registerHelper=function(a,b,c){xe.hasOwnProperty(a)||(xe[a]=w[a]={_global:[]}),xe[a][b]=c},w.registerGlobalHelper=function(a,b,c,d){w.registerHelper(a,b,d),xe[a]._global.push({pred:c,val:d})};var ye=w.copyState=function(a,b){if(b===!0)return b;if(a.copyState)return a.copyState(b);var c={};for(var d in b){var e=b[d];e instanceof Array&&(e=e.concat([])),c[d]=e}return c},ze=w.startState=function(a,b,c){return a.startState?a.startState(b,c):!0};w.innerMode=function(a,b){for(;a.innerMode;){var c=a.innerMode(b);if(!c||c.mode==a)break;b=c.state,a=c.mode}return c||{mode:a,state:b}};var Ae=w.commands={selectAll:function(a){a.setSelection(pb(a.firstLine(),0),pb(a.lastLine()),Kg)},singleSelection:function(a){a.setSelection(a.getCursor("anchor"),a.getCursor("head"),Kg)},killLine:function(a){me(a,function(b){if(b.empty()){var c=Xf(a.doc,b.head.line).text.length;return b.head.ch==c&&b.head.line<a.lastLine()?{from:b.head,to:pb(b.head.line+1,0)}:{from:b.head,to:pb(b.head.line,c)}}return{from:b.from(),to:b.to()}})},deleteLine:function(a){me(a,function(b){return{from:pb(b.from().line,0),to:zb(a.doc,pb(b.to().line+1,0))}})},delLineLeft:function(a){me(a,function(a){return{from:pb(a.from().line,0),to:a.from()}})},delWrappedLineLeft:function(a){me(a,function(b){var c=a.charCoords(b.head,"div").top+5,d=a.coordsChar({left:0,top:c},"div");return{from:d,to:b.from()}})},delWrappedLineRight:function(a){me(a,function(b){var c=a.charCoords(b.head,"div").top+5,d=a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},"div");return{from:b.from(),to:d}})},undo:function(a){a.undo()},redo:function(a){a.redo()},undoSelection:function(a){a.undoSelection()},redoSelection:function(a){a.redoSelection()},goDocStart:function(a){a.extendSelection(pb(a.firstLine(),0))},goDocEnd:function(a){a.extendSelection(pb(a.lastLine()))},goLineStart:function(a){a.extendSelectionsBy(function(b){return Hh(a,b.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(a){a.extendSelectionsBy(function(b){return Jh(a,b.head)},{origin:"+move",bias:1})},goLineEnd:function(a){a.extendSelectionsBy(function(b){return Ih(a,b.head.line)},{origin:"+move",bias:-1})},goLineRight:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},"div")},Mg)},goLineLeft:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:0,top:c},"div")},Mg)},goLineLeftSmart:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5,d=a.coordsChar({left:0,top:c},"div");return d.ch<a.getLine(d.line).search(/\S/)?Jh(a,b.head):d},Mg)},goLineUp:function(a){a.moveV(-1,"line")},goLineDown:function(a){a.moveV(1,"line")},goPageUp:function(a){a.moveV(-1,"page")},goPageDown:function(a){a.moveV(1,"page")},goCharLeft:function(a){a.moveH(-1,"char")},goCharRight:function(a){a.moveH(1,"char")},goColumnLeft:function(a){a.moveH(-1,"column")},goColumnRight:function(a){a.moveH(1,"column")},goWordLeft:function(a){a.moveH(-1,"word")},goGroupRight:function(a){a.moveH(1,"group")},goGroupLeft:function(a){a.moveH(-1,"group")},goWordRight:function(a){a.moveH(1,"word")},delCharBefore:function(a){a.deleteH(-1,"char")},delCharAfter:function(a){a.deleteH(1,"char")},delWordBefore:function(a){a.deleteH(-1,"word")},delWordAfter:function(a){a.deleteH(1,"word")},delGroupBefore:function(a){a.deleteH(-1,"group")},delGroupAfter:function(a){a.deleteH(1,"group")},indentAuto:function(a){a.indentSelection("smart")},indentMore:function(a){a.indentSelection("add")},indentLess:function(a){a.indentSelection("subtract")},insertTab:function(a){a.replaceSelection("	")},insertSoftTab:function(a){for(var b=[],c=a.listSelections(),d=a.options.tabSize,e=0;e<c.length;e++){var f=c[e].from(),g=Og(a.getLine(f.line),f.ch,d);b.push(new Array(d-g%d+1).join(" "))}a.replaceSelections(b)},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):a.execCommand("insertTab")},transposeChars:function(a){Pc(a,function(){for(var b=a.listSelections(),c=[],d=0;d<b.length;d++){var e=b[d].head,f=Xf(a.doc,e.line).text;if(f)if(e.ch==f.length&&(e=new pb(e.line,e.ch-1)),e.ch>0)e=new pb(e.line,e.ch+1),a.replaceRange(f.charAt(e.ch-1)+f.charAt(e.ch-2),pb(e.line,e.ch-2),e,"+transpose");else if(e.line>a.doc.first){var g=Xf(a.doc,e.line-1).text;g&&a.replaceRange(f.charAt(0)+"\n"+g.charAt(g.length-1),pb(e.line-1,g.length-1),pb(e.line,1),"+transpose")}c.push(new vb(e,e))}a.setSelections(c)})},newlineAndIndent:function(a){Pc(a,function(){for(var b=a.listSelections().length,c=0;b>c;c++){var d=a.listSelections()[c];a.replaceRange("\n",d.anchor,d.head,"+input"),a.indentLine(d.from().line+1,null,!0),ie(a)}})},toggleOverwrite:function(a){a.toggleOverwrite()}},Be=w.keyMap={};Be.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Be.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Be.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},Be.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Be["default"]=p?Be.macDefault:Be.pcDefault,w.normalizeKeyMap=function(a){var b={};for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];if(/^(name|fallthrough|(de|at)tach)$/.test(c))continue;if("..."==d){delete a[c];continue}for(var e=Vg(c.split(" "),Ce),f=0;f<e.length;f++){var g,h;f==e.length-1?(h=c,g=d):(h=e.slice(0,f+1).join(" "),g="...");var i=b[h];if(i){if(i!=g)throw new Error("Inconsistent bindings for "+h)}else b[h]=g}delete a[c]}for(var j in b)a[j]=b[j];return a};var De=w.lookupKey=function(a,b,c,d){b=Ge(b);var e=b.call?b.call(a,d):b[a];if(e===!1)return"nothing";if("..."===e)return"multi";if(null!=e&&c(e))return"handled";if(b.fallthrough){if("[object Array]"!=Object.prototype.toString.call(b.fallthrough))return De(a,b.fallthrough,c,d);for(var f=0;f<b.fallthrough.length;f++){var g=De(a,b.fallthrough[f],c,d);if(g)return g}}},Ee=w.isModifierKey=function(a){var b="string"==typeof a?a:Bh[a.keyCode];return"Ctrl"==b||"Alt"==b||"Shift"==b||"Mod"==b},Fe=w.keyName=function(a,b){if(i&&34==a.keyCode&&a["char"])return!1;var c=Bh[a.keyCode],d=c;return null==d||a.altGraphKey?!1:(a.altKey&&"Alt"!=c&&(d="Alt-"+d),(s?a.metaKey:a.ctrlKey)&&"Ctrl"!=c&&(d="Ctrl-"+d),(s?a.ctrlKey:a.metaKey)&&"Cmd"!=c&&(d="Cmd-"+d),!b&&a.shiftKey&&"Shift"!=c&&(d="Shift-"+d),d)};w.fromTextArea=function(a,b){function d(){a.value=i.getValue()}if(b||(b={}),b.value=a.value,!b.tabindex&&a.tabindex&&(b.tabindex=a.tabindex),!b.placeholder&&a.placeholder&&(b.placeholder=a.placeholder),null==b.autofocus){var c=ih();b.autofocus=c==a||null!=a.getAttribute("autofocus")&&c==document.body}if(a.form&&(yg(a.form,"submit",d),!b.leaveSubmitMethodAlone)){var e=a.form,f=e.submit;try{var g=e.submit=function(){d(),e.submit=f,e.submit(),e.submit=g}}catch(h){}}a.style.display="none";var i=w(function(b){a.parentNode.insertBefore(b,a.nextSibling)},b);return i.save=d,i.getTextArea=function(){return a},i.toTextArea=function(){i.toTextArea=isNaN,d(),a.parentNode.removeChild(i.getWrapperElement()),a.style.display="",a.form&&(zg(a.form,"submit",d),"function"==typeof a.form.submit&&(a.form.submit=f))},i};var He=w.StringStream=function(a,b){this.pos=this.start=0,this.string=a,this.tabSize=b||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};He.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(a){var b=this.string.charAt(this.pos);if("string"==typeof a)var c=b==a;else var c=b&&(a.test?a.test(b):a(b));return c?(++this.pos,b):void 0},eatWhile:function(a){for(var b=this.pos;this.eat(a););return this.pos>b},eatSpace:function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a},skipToEnd:function(){this.pos=this.string.length},skipTo:function(a){var b=this.string.indexOf(a,this.pos);return b>-1?(this.pos=b,!0):void 0},backUp:function(a){this.pos-=a},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Og(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?Og(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return Og(this.string,null,this.tabSize)-(this.lineStart?Og(this.string,this.lineStart,this.tabSize):0)},match:function(a,b,c){if("string"!=typeof a){var f=this.string.slice(this.pos).match(a);return f&&f.index>0?null:(f&&b!==!1&&(this.pos+=f[0].length),f)}var d=function(a){return c?a.toLowerCase():a},e=this.string.substr(this.pos,a.length);return d(e)==d(a)?(b!==!1&&(this.pos+=a.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(a,b){this.lineStart+=a;try{return b()}finally{this.lineStart-=a}}};var Ie=w.TextMarker=function(a,b){this.lines=[],this.type=b,this.doc=a};Hg(Ie),Ie.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,b=a&&!a.curOp;if(b&&Gc(a),Gg(this,"clear")){var c=this.find();c&&Cg(this,"clear",c.from,c.to)}for(var d=null,e=null,f=0;f<this.lines.length;++f){var g=this.lines[f],h=Re(g.markedSpans,this);a&&!this.collapsed?Wc(a,_f(g),"text"):a&&(null!=h.to&&(e=_f(g)),null!=h.from&&(d=_f(g))),g.markedSpans=Se(g.markedSpans,h),null==h.from&&this.collapsed&&!mf(this.doc,g)&&a&&$f(g,Cc(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(var f=0;f<this.lines.length;++f){var i=hf(this.lines[f]),j=H(i);j>a.display.maxLineLength&&(a.display.maxLine=i,a.display.maxLineLength=j,a.display.maxLineChanged=!0)}null!=d&&a&&this.collapsed&&Vc(a,d,e+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&Nb(a.doc)),a&&Cg(a,"markerCleared",a,this),b&&Ic(a),this.parent&&this.parent.clear()}},Ie.prototype.find=function(a,b){null==a&&"bookmark"==this.type&&(a=1);for(var c,d,e=0;e<this.lines.length;++e){var f=this.lines[e],g=Re(f.markedSpans,this);if(null!=g.from&&(c=pb(b?f:_f(f),g.from),-1==a))return c;if(null!=g.to&&(d=pb(b?f:_f(f),g.to),1==a))return d}return c&&{from:c,to:d}},Ie.prototype.changed=function(){var a=this.find(-1,!0),b=this,c=this.doc.cm;a&&c&&Pc(c,function(){var d=a.line,e=_f(a.line),f=ic(c,e);if(f&&(oc(f),c.curOp.selectionChanged=c.curOp.forceUpdate=!0),c.curOp.updateMaxLine=!0,!mf(b.doc,d)&&null!=b.height){var g=b.height;b.height=null;var h=qf(b)-g;h&&$f(d,d.height+h)}})},Ie.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;b.maybeHiddenMarkers&&-1!=Ug(b.maybeHiddenMarkers,this)||(b.maybeUnhiddenMarkers||(b.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)},Ie.prototype.detachLine=function(a){if(this.lines.splice(Ug(this.lines,a),1),!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;(b.maybeHiddenMarkers||(b.maybeHiddenMarkers=[])).push(this)}};var Je=0,Le=w.SharedTextMarker=function(a,b){this.markers=a,this.primary=b;for(var c=0;c<a.length;++c)a[c].parent=this};Hg(Le),Le.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();Cg(this,"clear")}},Le.prototype.find=function(a,b){return this.primary.find(a,b)};var of=w.LineWidget=function(a,b,c){if(c)for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d]);this.cm=a,this.node=b};Hg(of),of.prototype.clear=function(){var a=this.cm,b=this.line.widgets,c=this.line,d=_f(c);if(null!=d&&b){for(var e=0;e<b.length;++e)b[e]==this&&b.splice(e--,1);b.length||(c.widgets=null);var f=qf(this);Pc(a,function(){pf(a,c,-f),Wc(a,d,"widget"),$f(c,Math.max(0,c.height-f))})}},of.prototype.changed=function(){var a=this.height,b=this.cm,c=this.line;this.height=null;var d=qf(this)-a;d&&Pc(b,function(){b.curOp.forceUpdate=!0,pf(b,c,d),$f(c,c.height+d)})};var sf=w.Line=function(a,b,c){this.text=a,_e(this,b),this.height=c?c(this):1};Hg(sf),sf.prototype.lineNo=function(){return _f(this)};var Df={},Ef={};Pf.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,b){for(var c=a,d=a+b;d>c;++c){var e=this.lines[c];this.height-=e.height,uf(e),Cg(e,"delete")}this.lines.splice(a,b)},collapse:function(a){a.push.apply(a,this.lines)},insertInner:function(a,b,c){this.height+=c,this.lines=this.lines.slice(0,a).concat(b).concat(this.lines.slice(a));for(var d=0;d<b.length;++d)b[d].parent=this},iterN:function(a,b,c){for(var d=a+b;d>a;++a)if(c(this.lines[a]))return!0}},Qf.prototype={chunkSize:function(){return this.size},removeInner:function(a,b){this.size-=b;for(var c=0;c<this.children.length;++c){var d=this.children[c],e=d.chunkSize();if(e>a){var f=Math.min(b,e-a),g=d.height;if(d.removeInner(a,f),this.height-=g-d.height,e==f&&(this.children.splice(c--,1),d.parent=null),0==(b-=f))break;a=0}else a-=e}if(this.size-b<25&&(this.children.length>1||!(this.children[0]instanceof Pf))){var h=[];this.collapse(h),this.children=[new Pf(h)],this.children[0].parent=this}},collapse:function(a){for(var b=0;b<this.children.length;++b)this.children[b].collapse(a)},insertInner:function(a,b,c){this.size+=b.length,this.height+=c;for(var d=0;d<this.children.length;++d){var e=this.children[d],f=e.chunkSize();if(f>=a){if(e.insertInner(a,b,c),e.lines&&e.lines.length>50){for(;e.lines.length>50;){var g=e.lines.splice(e.lines.length-25,25),h=new Pf(g);e.height-=h.height,this.children.splice(d+1,0,h),h.parent=this}this.maybeSpill()}break}a-=f}},maybeSpill:function(){if(!(this.children.length<=10)){var a=this;do{var b=a.children.splice(a.children.length-5,5),c=new Qf(b);if(a.parent){a.size-=c.size,a.height-=c.height;var e=Ug(a.parent.children,a);a.parent.children.splice(e+1,0,c)}else{var d=new Qf(a.children);d.parent=a,a.children=[d,c],a=d}c.parent=a.parent}while(a.children.length>10);a.parent.maybeSpill()}},iterN:function(a,b,c){for(var d=0;d<this.children.length;++d){var e=this.children[d],f=e.chunkSize();if(f>a){var g=Math.min(b,f-a);if(e.iterN(a,g,c))return!0;if(0==(b-=g))break;a=0}else a-=f}}};var Rf=0,Sf=w.Doc=function(a,b,c){if(!(this instanceof Sf))return new Sf(a,b,c);null==c&&(c=0),Qf.call(this,[new Pf([new sf("",null)])]),this.first=c,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.frontier=c;var d=pb(c,0);this.sel=xb(d),this.history=new dg(null),this.id=++Rf,this.modeOption=b,"string"==typeof a&&(a=wh(a)),Of(this,{from:d,to:d,text:a}),Kb(this,xb(d),Kg)};Sf.prototype=Wg(Qf.prototype,{constructor:Sf,iter:function(a,b,c){c?this.iterN(a-this.first,b-a,c):this.iterN(this.first,this.first+this.size,a)},insert:function(a,b){for(var c=0,d=0;d<b.length;++d)c+=b[d].height;this.insertInner(a-this.first,b,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=Zf(this,this.first,this.first+this.size);return a===!1?b:b.join(a||"\n")},setValue:Sc(function(a){var b=pb(this.first,0),c=this.first+this.size-1;Yd(this,{from:b,to:pb(c,Xf(this,c).text.length),text:wh(a),origin:"setValue",full:!0},!0),Kb(this,xb(b))}),replaceRange:function(a,b,c,d){b=zb(this,b),c=c?zb(this,c):b,ce(this,a,b,c,d)},getRange:function(a,b,c){var d=Yf(this,zb(this,a),zb(this,b));return c===!1?d:d.join(c||"\n")},getLine:function(a){var b=this.getLineHandle(a);return b&&b.text},getLineHandle:function(a){return Bb(this,a)?Xf(this,a):void 0},getLineNumber:function(a){return _f(a)},getLineHandleVisualStart:function(a){return"number"==typeof a&&(a=Xf(this,a)),hf(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(a){return zb(this,a)},getCursor:function(a){var c,b=this.sel.primary();return c=null==a||"head"==a?b.head:"anchor"==a?b.anchor:"end"==a||"to"==a||a===!1?b.to():b.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Sc(function(a,b,c){Hb(this,zb(this,"number"==typeof a?pb(a,b||0):a),null,c)}),setSelection:Sc(function(a,b,c){Hb(this,zb(this,a),zb(this,b||a),c)}),extendSelection:Sc(function(a,b,c){Eb(this,zb(this,a),b&&zb(this,b),c)}),extendSelections:Sc(function(a,b){Fb(this,Cb(this,a,b))}),extendSelectionsBy:Sc(function(a,b){Fb(this,Vg(this.sel.ranges,a),b)}),setSelections:Sc(function(a,b,c){if(a.length){for(var d=0,e=[];d<a.length;d++)e[d]=new vb(zb(this,a[d].anchor),zb(this,a[d].head));null==b&&(b=Math.min(a.length-1,this.sel.primIndex)),Kb(this,wb(e,b),c)}}),addSelection:Sc(function(a,b,c){var d=this.sel.ranges.slice(0);d.push(new vb(zb(this,a),zb(this,b||a))),Kb(this,wb(d,d.length-1),c)}),getSelection:function(a){for(var c,b=this.sel.ranges,d=0;d<b.length;d++){var e=Yf(this,b[d].from(),b[d].to());c=c?c.concat(e):e}return a===!1?c:c.join(a||"\n")},getSelections:function(a){for(var b=[],c=this.sel.ranges,d=0;d<c.length;d++){var e=Yf(this,c[d].from(),c[d].to());a!==!1&&(e=e.join(a||"\n")),b[d]=e}return b},replaceSelection:function(a,b,c){for(var d=[],e=0;e<this.sel.ranges.length;e++)d[e]=a;this.replaceSelections(d,b,c||"+input")},replaceSelections:Sc(function(a,b,c){for(var d=[],e=this.sel,f=0;f<e.ranges.length;f++){var g=e.ranges[f];d[f]={from:g.from(),to:g.to(),text:wh(a[f]),origin:c}}for(var h=b&&"end"!=b&&Wd(this,d,b),f=d.length-1;f>=0;f--)Yd(this,d[f]);h?Jb(this,h):this.cm&&ie(this.cm)}),undo:Sc(function(){$d(this,"undo")}),redo:Sc(function(){$d(this,"redo")}),undoSelection:Sc(function(){$d(this,"undo",!0)}),redoSelection:Sc(function(){$d(this,"redo",!0)}),setExtending:function(a){this.extend=a},getExtending:function(){return this.extend},historySize:function(){for(var a=this.history,b=0,c=0,d=0;d<a.done.length;d++)a.done[d].ranges||++b;for(var d=0;d<a.undone.length;d++)a.undone[d].ranges||++c;return{undo:b,redo:c}},clearHistory:function(){this.history=new dg(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(a){return a&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},getHistory:function(){return{done:og(this.history.done),undone:og(this.history.undone)}},setHistory:function(a){var b=this.history=new dg(this.history.maxGeneration);b.done=og(a.done.slice(0),null,!0),b.undone=og(a.undone.slice(0),null,!0)},addLineClass:Sc(function(a,b,c){return le(this,a,"gutter"==b?"gutter":"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass";if(a[d]){if(jh(c).test(a[d]))return!1;a[d]+=" "+c}else a[d]=c;return!0})}),removeLineClass:Sc(function(a,b,c){return le(this,a,"gutter"==b?"gutter":"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass",e=a[d];if(!e)return!1;if(null==c)a[d]=null;else{var f=e.match(jh(c));if(!f)return!1;var g=f.index+f[0].length;a[d]=e.slice(0,f.index)+(f.index&&g!=e.length?" ":"")+e.slice(g)||null}return!0})}),markText:function(a,b,c){return Ke(this,zb(this,a),zb(this,b),c,"range")},setBookmark:function(a,b){var c={replacedWith:b&&(null==b.nodeType?b.widget:b),insertLeft:b&&b.insertLeft,clearWhenEmpty:!1,shared:b&&b.shared};return a=zb(this,a),Ke(this,a,a,c,"bookmark")},findMarksAt:function(a){a=zb(this,a);var b=[],c=Xf(this,a.line).markedSpans;if(c)for(var d=0;d<c.length;++d){var e=c[d];(null==e.from||e.from<=a.ch)&&(null==e.to||e.to>=a.ch)&&b.push(e.marker.parent||e.marker)
}return b},findMarks:function(a,b,c){a=zb(this,a),b=zb(this,b);var d=[],e=a.line;return this.iter(a.line,b.line+1,function(f){var g=f.markedSpans;if(g)for(var h=0;h<g.length;h++){var i=g[h];e==a.line&&a.ch>i.to||null==i.from&&e!=a.line||e==b.line&&i.from>b.ch||c&&!c(i.marker)||d.push(i.marker.parent||i.marker)}++e}),d},getAllMarks:function(){var a=[];return this.iter(function(b){var c=b.markedSpans;if(c)for(var d=0;d<c.length;++d)null!=c[d].from&&a.push(c[d].marker)}),a},posFromIndex:function(a){var b,c=this.first;return this.iter(function(d){var e=d.text.length+1;return e>a?(b=a,!0):(a-=e,++c,void 0)}),zb(this,pb(c,b))},indexFromPos:function(a){a=zb(this,a);var b=a.ch;return a.line<this.first||a.ch<0?0:(this.iter(this.first,a.line,function(a){b+=a.text.length+1}),b)},copy:function(a){var b=new Sf(Zf(this,this.first,this.first+this.size),this.modeOption,this.first);return b.scrollTop=this.scrollTop,b.scrollLeft=this.scrollLeft,b.sel=this.sel,b.extend=!1,a&&(b.history.undoDepth=this.history.undoDepth,b.setHistory(this.getHistory())),b},linkedDoc:function(a){a||(a={});var b=this.first,c=this.first+this.size;null!=a.from&&a.from>b&&(b=a.from),null!=a.to&&a.to<c&&(c=a.to);var d=new Sf(Zf(this,b,c),a.mode||this.modeOption,b);return a.sharedHist&&(d.history=this.history),(this.linked||(this.linked=[])).push({doc:d,sharedHist:a.sharedHist}),d.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}],Oe(d,Ne(this)),d},unlinkDoc:function(a){if(a instanceof w&&(a=a.doc),this.linked)for(var b=0;b<this.linked.length;++b){var c=this.linked[b];if(c.doc==a){this.linked.splice(b,1),a.unlinkDoc(this),Pe(Ne(this));break}}if(a.history==this.history){var d=[a.id];Vf(a,function(a){d.push(a.id)},!0),a.history=new dg(null),a.history.done=og(this.history.done,d),a.history.undone=og(this.history.undone,d)}},iterLinkedDocs:function(a){Vf(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm}}),Sf.prototype.eachLine=Sf.prototype.iter;var Tf="iter insert remove copy getEditor".split(" ");for(var Uf in Sf.prototype)Sf.prototype.hasOwnProperty(Uf)&&Ug(Tf,Uf)<0&&(w.prototype[Uf]=function(a){return function(){return a.apply(this.doc,arguments)}}(Sf.prototype[Uf]));Hg(Sf);var sg=w.e_preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},tg=w.e_stopPropagation=function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},vg=w.e_stop=function(a){sg(a),tg(a)},yg=w.on=function(a,b,c){if(a.addEventListener)a.addEventListener(b,c,!1);else if(a.attachEvent)a.attachEvent("on"+b,c);else{var d=a._handlers||(a._handlers={}),e=d[b]||(d[b]=[]);e.push(c)}},zg=w.off=function(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else{var d=a._handlers&&a._handlers[b];if(!d)return;for(var e=0;e<d.length;++e)if(d[e]==c){d.splice(e,1);break}}},Ag=w.signal=function(a,b){var c=a._handlers&&a._handlers[b];if(c)for(var d=Array.prototype.slice.call(arguments,2),e=0;e<c.length;++e)c[e].apply(null,d)},Bg=null,Ig=30,Jg=w.Pass={toString:function(){return"CodeMirror.Pass"}},Kg={scroll:!1},Lg={origin:"*mouse"},Mg={origin:"+move"};Ng.prototype.set=function(a,b){clearTimeout(this.id),this.id=setTimeout(b,a)};var Og=w.countColumn=function(a,b,c,d,e){null==b&&(b=a.search(/[^\s\u00a0]/),-1==b&&(b=a.length));for(var f=d||0,g=e||0;;){var h=a.indexOf("	",f);if(0>h||h>=b)return g+(b-f);g+=h-f,g+=c-g%c,f=h+1}},Qg=[""],Tg=function(a){a.select()};n?Tg=function(a){a.selectionStart=0,a.selectionEnd=a.value.length}:d&&(Tg=function(a){try{a.select()}catch(b){}});var eh,Zg=/[\u00df\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,$g=w.isWordChar=function(a){return/\w/.test(a)||a>"\x80"&&(a.toUpperCase()!=a.toLowerCase()||Zg.test(a))},bh=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;eh=document.createRange?function(a,b,c){var d=document.createRange();return d.setEnd(a,c),d.setStart(a,b),d}:function(a,b,c){var d=document.body.createTextRange();try{d.moveToElementText(a.parentNode)}catch(e){return d}return d.collapse(!0),d.moveEnd("character",c),d.moveStart("character",b),d},d&&11>e&&(ih=function(){try{return document.activeElement}catch(a){return document.body}});var sh,uh,kh=w.rmClass=function(a,b){var c=a.className,d=jh(b).exec(c);if(d){var e=c.slice(d.index+d[0].length);a.className=c.slice(0,d.index)+(e?d[1]+e:"")}},lh=w.addClass=function(a,b){var c=a.className;jh(b).test(c)||(a.className+=(c?" ":"")+b)},oh=!1,rh=function(){if(d&&9>e)return!1;var a=dh("div");return"draggable"in a||"dragDrop"in a}(),wh=w.splitLines=3!="\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],d=a.length;d>=b;){var e=a.indexOf("\n",b);-1==e&&(e=a.length);var f=a.slice(b,"\r"==a.charAt(e-1)?e-1:e),g=f.indexOf("\r");-1!=g?(c.push(f.slice(0,g)),b+=g+1):(c.push(f),b=e+1)}return c}:function(a){return a.split(/\r\n?|\n/)},xh=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(b){return!1}}:function(a){try{var b=a.ownerDocument.selection.createRange()}catch(c){}return b&&b.parentElement()==a?0!=b.compareEndPoints("StartToEnd",b):!1},yh=function(){var a=dh("div");return"oncopy"in a?!0:(a.setAttribute("oncopy","return;"),"function"==typeof a.oncopy)}(),zh=null,Bh={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",107:"=",109:"-",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};w.keyNames=Bh,function(){for(var a=0;10>a;a++)Bh[a+48]=Bh[a+96]=String(a);for(var a=65;90>=a;a++)Bh[a]=String.fromCharCode(a);for(var a=1;12>=a;a++)Bh[a+111]=Bh[a+63235]="F"+a}();var Lh,Qh=function(){function c(c){return 247>=c?a.charAt(c):c>=1424&&1524>=c?"R":c>=1536&&1773>=c?b.charAt(c-1536):c>=1774&&2220>=c?"r":c>=8192&&8203>=c?"w":8204==c?"b":"L"}function j(a,b,c){this.level=a,this.from=b,this.to=c}var a="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",b="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm",d=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,e=/[stwN]/,f=/[LRr]/,g=/[Lb1n]/,h=/[1n]/,i="L";return function(a){if(!d.test(a))return!1;for(var m,b=a.length,k=[],l=0;b>l;++l)k.push(m=c(a.charCodeAt(l)));for(var l=0,n=i;b>l;++l){var m=k[l];"m"==m?k[l]=n:n=m}for(var l=0,o=i;b>l;++l){var m=k[l];"1"==m&&"r"==o?k[l]="n":f.test(m)&&(o=m,"r"==m&&(k[l]="R"))}for(var l=1,n=k[0];b-1>l;++l){var m=k[l];"+"==m&&"1"==n&&"1"==k[l+1]?k[l]="1":","!=m||n!=k[l+1]||"1"!=n&&"n"!=n||(k[l]=n),n=m}for(var l=0;b>l;++l){var m=k[l];if(","==m)k[l]="N";else if("%"==m){for(var p=l+1;b>p&&"%"==k[p];++p);for(var q=l&&"!"==k[l-1]||b>p&&"1"==k[p]?"1":"N",r=l;p>r;++r)k[r]=q;l=p-1}}for(var l=0,o=i;b>l;++l){var m=k[l];"L"==o&&"1"==m?k[l]="L":f.test(m)&&(o=m)}for(var l=0;b>l;++l)if(e.test(k[l])){for(var p=l+1;b>p&&e.test(k[p]);++p);for(var s="L"==(l?k[l-1]:i),t="L"==(b>p?k[p]:i),q=s||t?"L":"R",r=l;p>r;++r)k[r]=q;l=p-1}for(var v,u=[],l=0;b>l;)if(g.test(k[l])){var w=l;for(++l;b>l&&g.test(k[l]);++l);u.push(new j(0,w,l))}else{var x=l,y=u.length;for(++l;b>l&&"L"!=k[l];++l);for(var r=x;l>r;)if(h.test(k[r])){r>x&&u.splice(y,0,new j(1,x,r));var z=r;for(++r;l>r&&h.test(k[r]);++r);u.splice(y,0,new j(2,z,r)),x=r}else++r;l>x&&u.splice(y,0,new j(1,x,l))}return 1==u[0].level&&(v=a.match(/^\s+/))&&(u[0].from=v[0].length,u.unshift(new j(0,0,v[0].length))),1==Sg(u).level&&(v=a.match(/\s+$/))&&(Sg(u).to-=v[0].length,u.push(new j(0,b-v[0].length,b))),u[0].level!=Sg(u).level&&u.push(new j(u[0].level,b,b)),u}}();return w.version="4.12.1",w}),function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){"use strict";a.defineMode("commonlisp",function(a){function g(a){for(var b;b=a.next();)if("\\"==b)a.next();else if(!e.test(b)){a.backUp(1);break}return a.current()}function h(a,e){if(a.eatSpace())return f="ws",null;if(a.match(d))return"number";var h=a.next();if("\\"==h&&(h=a.next()),'"'==h)return(e.tokenize=i)(a,e);if("("==h)return f="open","bracket";if(")"==h||"]"==h)return f="close","bracket";if(";"==h)return a.skipToEnd(),f="ws","comment";if(/['`,@]/.test(h))return null;if("|"==h)return a.skipTo("|")?(a.next(),"symbol"):(a.skipToEnd(),"error");if("#"==h){var h=a.next();return"["==h?(f="open","bracket"):/[+\-=\.']/.test(h)?null:/\d/.test(h)&&a.match(/^\d*#/)?null:"|"==h?(e.tokenize=j)(a,e):":"==h?(g(a),"meta"):"error"}var k=g(a);return"."==k?null:(f="symbol","nil"==k||"t"==k||":"==k.charAt(0)?"atom":"open"==e.lastType&&(b.test(k)||c.test(k))?"keyword":"&"==k.charAt(0)?"variable-2":"variable")}function i(a,b){for(var d,c=!1;d=a.next();){if('"'==d&&!c){b.tokenize=h;break}c=!c&&"\\"==d}return"string"}function j(a,b){for(var c,d;c=a.next();){if("#"==c&&"|"==d){b.tokenize=h;break}d=c}return f="ws","comment"}var f,b=/^(block|let*|return-from|catch|load-time-value|setq|eval-when|locally|symbol-macrolet|flet|macrolet|tagbody|function|multiple-value-call|the|go|multiple-value-prog1|throw|if|progn|unwind-protect|labels|progv|let|quote)$/,c=/^with|^def|^do|^prog|case$|^cond$|bind$|when$|unless$/,d=/^(?:[+\-]?(?:\d+|\d*\.\d+)(?:[efd][+\-]?\d+)?|[+\-]?\d+(?:\/[+\-]?\d+)?|#b[+\-]?[01]+|#o[+\-]?[0-7]+|#x[+\-]?[\da-f]+)/,e=/[^\s'`,@()\[\]";]/;return{startState:function(){return{ctx:{prev:null,start:0,indentTo:0},lastType:null,tokenize:h}},token:function(b,d){b.sol()&&"number"!=typeof d.ctx.indentTo&&(d.ctx.indentTo=d.ctx.start+1),f=null;var e=d.tokenize(b,d);return"ws"!=f&&(null==d.ctx.indentTo?d.ctx.indentTo="symbol"==f&&c.test(b.current())?d.ctx.start+a.indentUnit:"next":"next"==d.ctx.indentTo&&(d.ctx.indentTo=b.column()),d.lastType=f),"open"==f?d.ctx={prev:d.ctx,start:b.column(),indentTo:null}:"close"==f&&(d.ctx=d.ctx.prev||d.ctx),e},indent:function(a){var c=a.ctx.indentTo;return"number"==typeof c?c:a.ctx.start+1},lineComment:";;",blockCommentStart:"#|",blockCommentEnd:"|#"}}),a.defineMIME("text/x-common-lisp","commonlisp")}),function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){"use strict";a.defineMode("javascript",function(b,c){function m(a){for(var c,b=!1,d=!1;null!=(c=a.next());){if(!b){if("/"==c&&!d)return;"["==c?d=!0:d&&"]"==c&&(d=!1)}b=!b&&"\\"==c}}function p(a,b,c){return n=a,o=c,b}function q(a,b){var c=a.next();if('"'==c||"'"==c)return b.tokenize=r(c),b.tokenize(a,b);if("."==c&&a.match(/^\d+(?:[eE][+\-]?\d+)?/))return p("number","number");if("."==c&&a.match(".."))return p("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(c))return p(c);if("="==c&&a.eat(">"))return p("=>","operator");if("0"==c&&a.eat(/x/i))return a.eatWhile(/[\da-f]/i),p("number","number");if(/\d/.test(c))return a.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),p("number","number");if("/"==c)return a.eat("*")?(b.tokenize=s,s(a,b)):a.eat("/")?(a.skipToEnd(),p("comment","comment")):"operator"==b.lastType||"keyword c"==b.lastType||"sof"==b.lastType||/^[\[{}\(,;:]$/.test(b.lastType)?(m(a),a.eatWhile(/[gimy]/),p("regexp","string-2")):(a.eatWhile(k),p("operator","operator",a.current()));if("`"==c)return b.tokenize=t,t(a,b);if("#"==c)return a.skipToEnd(),p("error","error");if(k.test(c))return a.eatWhile(k),p("operator","operator",a.current());if(i.test(c)){a.eatWhile(i);var d=a.current(),e=j.propertyIsEnumerable(d)&&j[d];return e&&"."!=b.lastType?p(e.type,e.style,d):p("variable","variable",d)}}function r(a){return function(b,c){var e,d=!1;if(f&&"@"==b.peek()&&b.match(l))return c.tokenize=q,p("jsonld-keyword","meta");for(;null!=(e=b.next())&&(e!=a||d);)d=!d&&"\\"==e;return d||(c.tokenize=q),p("string","string")}}function s(a,b){for(var d,c=!1;d=a.next();){if("/"==d&&c){b.tokenize=q;break}c="*"==d}return p("comment","comment")}function t(a,b){for(var d,c=!1;null!=(d=a.next());){if(!c&&("`"==d||"$"==d&&a.eat("{"))){b.tokenize=q;break}c=!c&&"\\"==d}return p("quasi","string-2",a.current())}function v(a,b){b.fatArrowAt&&(b.fatArrowAt=null);var c=a.string.indexOf("=>",a.start);if(!(0>c)){for(var d=0,e=!1,f=c-1;f>=0;--f){var g=a.string.charAt(f),h=u.indexOf(g);if(h>=0&&3>h){if(!d){++f;break}if(0==--d)break}else if(h>=3&&6>h)++d;else if(i.test(g))e=!0;else{if(/["'\/]/.test(g))return;if(e&&!d){++f;break}}}e&&!d&&(b.fatArrowAt=f)}}function x(a,b,c,d,e,f){this.indented=a,this.column=b,this.type=c,this.prev=e,this.info=f,null!=d&&(this.align=d)}function y(a,b){for(var c=a.localVars;c;c=c.next)if(c.name==b)return!0;for(var d=a.context;d;d=d.prev)for(var c=d.vars;c;c=c.next)if(c.name==b)return!0}function z(a,b,c,d,e){var f=a.cc;for(A.state=a,A.stream=e,A.marked=null,A.cc=f,A.style=b,a.lexical.hasOwnProperty("align")||(a.lexical.align=!0);;){var h=f.length?f.pop():g?L:K;if(h(c,d)){for(;f.length&&f[f.length-1].lex;)f.pop()();return A.marked?A.marked:"variable"==c&&y(a,d)?"variable-2":b}}}function B(){for(var a=arguments.length-1;a>=0;a--)A.cc.push(arguments[a])}function C(){return B.apply(null,arguments),!0}function D(a){function b(b){for(var c=b;c;c=c.next)if(c.name==a)return!0;return!1}var d=A.state;if(d.context){if(A.marked="def",b(d.localVars))return;d.localVars={name:a,next:d.localVars}}else{if(b(d.globalVars))return;c.globalVars&&(d.globalVars={name:a,next:d.globalVars})}}function F(){A.state.context={prev:A.state.context,vars:A.state.localVars},A.state.localVars=E}function G(){A.state.localVars=A.state.context.vars,A.state.context=A.state.context.prev}function H(a,b){var c=function(){var c=A.state,d=c.indented;if("stat"==c.lexical.type)d=c.lexical.indented;else for(var e=c.lexical;e&&")"==e.type&&e.align;e=e.prev)d=e.indented;c.lexical=new x(d,A.stream.column(),a,null,c.lexical,b)};return c.lex=!0,c}function I(){var a=A.state;a.lexical.prev&&(")"==a.lexical.type&&(a.indented=a.lexical.indented),a.lexical=a.lexical.prev)}function J(a){function b(c){return c==a?C():";"==a?B():C(b)}return b}function K(a,b){return"var"==a?C(H("vardef",b.length),eb,J(";"),I):"keyword a"==a?C(H("form"),L,K,I):"keyword b"==a?C(H("form"),K,I):"{"==a?C(H("}"),bb,I):";"==a?C():"if"==a?("else"==A.state.lexical.info&&A.state.cc[A.state.cc.length-1]==I&&A.state.cc.pop()(),C(H("form"),L,K,I,jb)):"function"==a?C(pb):"for"==a?C(H("form"),kb,K,I):"variable"==a?C(H("stat"),W):"switch"==a?C(H("form"),L,H("}","switch"),J("{"),bb,I,I):"case"==a?C(L,J(":")):"default"==a?C(J(":")):"catch"==a?C(H("form"),F,J("("),qb,J(")"),K,I,G):"module"==a?C(H("form"),F,vb,G,I):"class"==a?C(H("form"),rb,I):"export"==a?C(H("form"),wb,I):"import"==a?C(H("form"),xb,I):B(H("stat"),L,J(";"),I)}function L(a){return N(a,!1)}function M(a){return N(a,!0)}function N(a,b){if(A.state.fatArrowAt==A.stream.start){var c=b?V:U;if("("==a)return C(F,H(")"),_(fb,")"),I,J("=>"),c,G);if("variable"==a)return B(F,fb,J("=>"),c,G)}var d=b?R:Q;return w.hasOwnProperty(a)?C(d):"function"==a?C(pb,d):"keyword c"==a?C(b?P:O):"("==a?C(H(")"),O,Cb,J(")"),I,d):"operator"==a||"spread"==a?C(b?M:L):"["==a?C(H("]"),Ab,I,d):"{"==a?ab(Y,"}",null,d):"quasi"==a?B(S,d):C()}function O(a){return a.match(/[;\}\)\],]/)?B():B(L)}function P(a){return a.match(/[;\}\)\],]/)?B():B(M)}function Q(a,b){return","==a?C(L):R(a,b,!1)}function R(a,b,c){var d=0==c?Q:R,e=0==c?L:M;return"=>"==a?C(F,c?V:U,G):"operator"==a?/\+\+|--/.test(b)?C(d):"?"==b?C(L,J(":"),e):C(e):"quasi"==a?B(S,d):";"!=a?"("==a?ab(M,")","call",d):"."==a?C(X,d):"["==a?C(H("]"),O,J("]"),I,d):void 0:void 0}function S(a,b){return"quasi"!=a?B():"${"!=b.slice(b.length-2)?C(S):C(L,T)}function T(a){return"}"==a?(A.marked="string-2",A.state.tokenize=t,C(S)):void 0}function U(a){return v(A.stream,A.state),B("{"==a?K:L)}function V(a){return v(A.stream,A.state),B("{"==a?K:M)}function W(a){return":"==a?C(I,K):B(Q,J(";"),I)}function X(a){return"variable"==a?(A.marked="property",C()):void 0}function Y(a,b){return"variable"==a||"keyword"==A.style?(A.marked="property","get"==b||"set"==b?C(Z):C($)):"number"==a||"string"==a?(A.marked=f?"property":A.style+" property",C($)):"jsonld-keyword"==a?C($):"["==a?C(L,J("]"),$):void 0}function Z(a){return"variable"!=a?B($):(A.marked="property",C(pb))}function $(a){return":"==a?C(M):"("==a?B(pb):void 0}function _(a,b){function c(d){if(","==d){var e=A.state.lexical;return"call"==e.info&&(e.pos=(e.pos||0)+1),C(a,c)}return d==b?C():C(J(b))}return function(d){return d==b?C():B(a,c)}}function ab(a,b,c){for(var d=3;d<arguments.length;d++)A.cc.push(arguments[d]);return C(H(b,c),_(a,b),I)}function bb(a){return"}"==a?C():B(K,bb)}function cb(a){return h&&":"==a?C(db):void 0}function db(a){return"variable"==a?(A.marked="variable-3",C()):void 0}function eb(){return B(fb,cb,hb,ib)}function fb(a,b){return"variable"==a?(D(b),C()):"["==a?ab(fb,"]"):"{"==a?ab(gb,"}"):void 0}function gb(a,b){return"variable"!=a||A.stream.match(/^\s*:/,!1)?("variable"==a&&(A.marked="property"),C(J(":"),fb,hb)):(D(b),C(hb))}function hb(a,b){return"="==b?C(M):void 0}function ib(a){return","==a?C(eb):void 0}function jb(a,b){return"keyword b"==a&&"else"==b?C(H("form","else"),K,I):void 0}function kb(a){return"("==a?C(H(")"),lb,J(")"),I):void 0}function lb(a){return"var"==a?C(eb,J(";"),nb):";"==a?C(nb):"variable"==a?C(mb):B(L,J(";"),nb)}function mb(a,b){return"in"==b||"of"==b?(A.marked="keyword",C(L)):C(Q,nb)}function nb(a,b){return";"==a?C(ob):"in"==b||"of"==b?(A.marked="keyword",C(L)):B(L,J(";"),ob)}function ob(a){")"!=a&&C(L)}function pb(a,b){return"*"==b?(A.marked="keyword",C(pb)):"variable"==a?(D(b),C(pb)):"("==a?C(F,H(")"),_(qb,")"),I,K,G):void 0}function qb(a){return"spread"==a?C(qb):B(fb,cb)}function rb(a,b){return"variable"==a?(D(b),C(sb)):void 0}function sb(a,b){return"extends"==b?C(L,sb):"{"==a?C(H("}"),tb,I):void 0}function tb(a,b){return"variable"==a||"keyword"==A.style?(A.marked="property","get"==b||"set"==b?C(ub,pb,tb):C(pb,tb)):"*"==b?(A.marked="keyword",C(tb)):";"==a?C(tb):"}"==a?C():void 0}function ub(a){return"variable"!=a?B():(A.marked="property",C())}function vb(a,b){return"string"==a?C(K):"variable"==a?(D(b),C(zb)):void 0}function wb(a,b){return"*"==b?(A.marked="keyword",C(zb,J(";"))):"default"==b?(A.marked="keyword",C(L,J(";"))):B(K)}function xb(a){return"string"==a?C():B(yb,zb)}function yb(a,b){return"{"==a?ab(yb,"}"):("variable"==a&&D(b),C())}function zb(a,b){return"from"==b?(A.marked="keyword",C(L)):void 0}function Ab(a){return"]"==a?C():B(M,Bb)}function Bb(a){return"for"==a?B(Cb,J("]")):","==a?C(_(P,"]")):B(_(M,"]"))}function Cb(a){return"for"==a?C(kb,Cb):"if"==a?C(L,Cb):void 0}function Db(a,b){return"operator"==a.lastType||","==a.lastType||k.test(b.charAt(0))||/[,.]/.test(b.charAt(0))}var n,o,d=b.indentUnit,e=c.statementIndent,f=c.jsonld,g=c.json||f,h=c.typescript,i=c.wordCharacters||/[\w$\xa1-\uffff]/,j=function(){function a(a){return{type:a,style:"keyword"}}var b=a("keyword a"),c=a("keyword b"),d=a("keyword c"),e=a("operator"),f={type:"atom",style:"atom"},g={"if":a("if"),"while":b,"with":b,"else":c,"do":c,"try":c,"finally":c,"return":d,"break":d,"continue":d,"new":d,"delete":d,"throw":d,"debugger":d,"var":a("var"),"const":a("var"),let:a("var"),"function":a("function"),"catch":a("catch"),"for":a("for"),"switch":a("switch"),"case":a("case"),"default":a("default"),"in":e,"typeof":e,"instanceof":e,"true":f,"false":f,"null":f,undefined:f,NaN:f,Infinity:f,"this":a("this"),module:a("module"),"class":a("class"),"super":a("atom"),yield:d,"export":a("export"),"import":a("import"),"extends":d};if(h){var i={type:"variable",style:"variable-3"},j={"interface":a("interface"),"extends":a("extends"),constructor:a("constructor"),"public":a("public"),"private":a("private"),"protected":a("protected"),"static":a("static"),string:i,number:i,bool:i,any:i};for(var k in j)g[k]=j[k]}return g}(),k=/[+\-*&%=<>!?|~^]/,l=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/,u="([{}])",w={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,"this":!0,"jsonld-keyword":!0},A={state:null,column:null,marked:null,cc:null},E={name:"this",next:{name:"arguments"}};return I.lex=!0,{startState:function(a){var b={tokenize:q,lastType:"sof",cc:[],lexical:new x((a||0)-d,0,"block",!1),localVars:c.localVars,context:c.localVars&&{vars:c.localVars},indented:0};return c.globalVars&&"object"==typeof c.globalVars&&(b.globalVars=c.globalVars),b},token:function(a,b){if(a.sol()&&(b.lexical.hasOwnProperty("align")||(b.lexical.align=!1),b.indented=a.indentation(),v(a,b)),b.tokenize!=s&&a.eatSpace())return null;var c=b.tokenize(a,b);return"comment"==n?c:(b.lastType="operator"!=n||"++"!=o&&"--"!=o?n:"incdec",z(b,c,n,o,a))},indent:function(b,f){if(b.tokenize==s)return a.Pass;if(b.tokenize!=q)return 0;var g=f&&f.charAt(0),h=b.lexical;if(!/^\s*else\b/.test(f))for(var i=b.cc.length-1;i>=0;--i){var j=b.cc[i];if(j==I)h=h.prev;else if(j!=jb)break}"stat"==h.type&&"}"==g&&(h=h.prev),e&&")"==h.type&&"stat"==h.prev.type&&(h=h.prev);var k=h.type,l=g==k;return"vardef"==k?h.indented+("operator"==b.lastType||","==b.lastType?h.info+1:0):"form"==k&&"{"==g?h.indented:"form"==k?h.indented+d:"stat"==k?h.indented+(Db(b,f)?e||d:0):"switch"!=h.info||l||0==c.doubleIndentSwitch?h.align?h.column+(l?0:1):h.indented+(l?0:d):h.indented+(/^(?:case|default)\b/.test(f)?d:2*d)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:g?null:"/*",blockCommentEnd:g?null:"*/",lineComment:g?null:"//",fold:"brace",helperType:g?"json":"javascript",jsonldMode:f,jsonMode:g}}),a.registerHelper("wordChars","javascript",/[\w$]/),a.defineMIME("text/javascript","javascript"),a.defineMIME("text/ecmascript","javascript"),a.defineMIME("application/javascript","javascript"),a.defineMIME("application/x-javascript","javascript"),a.defineMIME("application/ecmascript","javascript"),a.defineMIME("application/json",{name:"javascript",json:!0}),a.defineMIME("application/x-json",{name:"javascript",json:!0}),a.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),a.defineMIME("text/typescript",{name:"javascript",typescript:!0}),a.defineMIME("application/typescript",{name:"javascript",typescript:!0})}),function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){"use strict";function b(a){return new RegExp("^(("+a.join(")|(")+"))\\b")}function h(a){return a.scopes[a.scopes.length-1]}var c=b(["and","or","not","is"]),d=["as","assert","break","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","lambda","pass","raise","return","try","while","with","yield","in"],e=["abs","all","any","bin","bool","bytearray","callable","chr","classmethod","compile","complex","delattr","dict","dir","divmod","enumerate","eval","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","property","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip","__import__","NotImplemented","Ellipsis","__debug__"],f={builtins:["apply","basestring","buffer","cmp","coerce","execfile","file","intern","long","raw_input","reduce","reload","unichr","unicode","xrange","False","True","None"],keywords:["exec","print"]},g={builtins:["ascii","bytes","exec","print"],keywords:["nonlocal","False","True","None"]};a.registerHelper("hintWords","python",d.concat(e)),a.defineMode("python",function(i,j){function x(a,b){if(a.sol()&&"py"==h(b).type){var c=h(b).offset;if(a.eatSpace()){var d=a.indentation();return d>c?A(a,b,"py"):c>d&&B(a,b)&&(b.errorToken=!0),null}var e=y(a,b);return c>0&&B(a,b)&&(e+=" "+k),e}return y(a,b)}function y(a,b){if(a.eatSpace())return null;var d=a.peek();if("#"==d)return a.skipToEnd(),"comment";if(a.match(/^[0-9\.]/,!1)){var e=!1;if(a.match(/^\d*\.\d+(e[\+\-]?\d+)?/i)&&(e=!0),a.match(/^\d+\.\d*/)&&(e=!0),a.match(/^\.\d+/)&&(e=!0),e)return a.eat(/J/i),"number";var f=!1;if(a.match(/^0x[0-9a-f]+/i)&&(f=!0),a.match(/^0b[01]+/i)&&(f=!0),a.match(/^0o[0-7]+/i)&&(f=!0),a.match(/^[1-9]\d*(e[\+\-]?\d+)?/)&&(a.eat(/J/i),f=!0),a.match(/^0(?![\dx])/i)&&(f=!0),f)return a.eat(/L/i),"number"}return a.match(u)?(b.tokenize=z(a.current()),b.tokenize(a,b)):a.match(o)||a.match(n)?null:a.match(m)||a.match(p)||a.match(c)?"operator":a.match(l)?null:a.match(v)?"keyword":a.match(w)?"builtin":a.match(/^(self|cls)\b/)?"variable-2":a.match(q)?"def"==b.lastToken||"class"==b.lastToken?"def":"variable":(a.next(),k)}function z(a){function d(d,e){for(;!d.eol();)if(d.eatWhile(/[^'"\\]/),d.eat("\\")){if(d.next(),b&&d.eol())return c}else{if(d.match(a))return e.tokenize=x,c;d.eat(/['"]/)}if(b){if(j.singleLineStringErrors)return k;e.tokenize=x}return c}for(;"rub".indexOf(a.charAt(0).toLowerCase())>=0;)a=a.substr(1);var b=1==a.length,c="string";return d.isString=!0,d}function A(a,b,c){var d=0,e=null;if("py"==c)for(;"py"!=h(b).type;)b.scopes.pop();d=h(b).offset+("py"==c?i.indentUnit:r),"py"==c||a.match(/^(\s|#.*)*$/,!1)||(e=a.column()+1),b.scopes.push({offset:d,type:c,align:e})}function B(a,b){for(var c=a.indentation();h(b).offset>c;){if("py"!=h(b).type)return!0;b.scopes.pop()}return h(b).offset!=c}function C(a,b){var c=b.tokenize(a,b),d=a.current();if("."==d)return c=a.match(q,!1)?null:k,null==c&&"meta"==b.lastStyle&&(c="meta"),c;if("@"==d)return j.version&&3==parseInt(j.version,10)?a.match(q,!1)?"meta":"operator":a.match(q,!1)?"meta":k;"variable"!=c&&"builtin"!=c||"meta"!=b.lastStyle||(c="meta"),("pass"==d||"return"==d)&&(b.dedent+=1),"lambda"==d&&(b.lambda=!0),":"!=d||b.lambda||"py"!=h(b).type||A(a,b,"py");var e=1==d.length?"[({".indexOf(d):-1;if(-1!=e&&A(a,b,"])}".slice(e,e+1)),e="])}".indexOf(d),-1!=e){if(h(b).type!=d)return k;b.scopes.pop()}return b.dedent>0&&a.eol()&&"py"==h(b).type&&(b.scopes.length>1&&b.scopes.pop(),b.dedent-=1),c}var k="error",l=j.singleDelimiters||new RegExp("^[\\(\\)\\[\\]\\{\\}@,:`=;\\.]"),m=j.doubleOperators||new RegExp("^((==)|(!=)|(<=)|(>=)|(<>)|(<<)|(>>)|(//)|(\\*\\*))"),n=j.doubleDelimiters||new RegExp("^((\\+=)|(\\-=)|(\\*=)|(%=)|(/=)|(&=)|(\\|=)|(\\^=))"),o=j.tripleDelimiters||new RegExp("^((//=)|(>>=)|(<<=)|(\\*\\*=))");if(j.version&&3==parseInt(j.version,10))var p=j.singleOperators||new RegExp("^[\\+\\-\\*/%&|\\^~<>!@]"),q=j.identifiers||new RegExp("^[_A-Za-z\xa1-\uffff][_A-Za-z0-9\xa1-\uffff]*");else var p=j.singleOperators||new RegExp("^[\\+\\-\\*/%&|\\^~<>!]"),q=j.identifiers||new RegExp("^[_A-Za-z][_A-Za-z0-9]*");var r=j.hangingIndent||i.indentUnit,s=d,t=e;if(void 0!=j.extra_keywords&&(s=s.concat(j.extra_keywords)),void 0!=j.extra_builtins&&(t=t.concat(j.extra_builtins)),j.version&&3==parseInt(j.version,10)){s=s.concat(g.keywords),t=t.concat(g.builtins);var u=new RegExp("^(([rb]|(br))?('{3}|\"{3}|['\"]))","i")}else{s=s.concat(f.keywords),t=t.concat(f.builtins);var u=new RegExp("^(([rub]|(ur)|(br))?('{3}|\"{3}|['\"]))","i")}var v=b(s),w=b(t),D={startState:function(a){return{tokenize:x,scopes:[{offset:a||0,type:"py",align:null}],lastStyle:null,lastToken:null,lambda:!1,dedent:0}},token:function(a,b){var c=b.errorToken;c&&(b.errorToken=!1);var d=C(a,b);b.lastStyle=d;var e=a.current();return e&&d&&(b.lastToken=e),a.eol()&&b.lambda&&(b.lambda=!1),c?d+" "+k:d},indent:function(b,c){if(b.tokenize!=x)return b.tokenize.isString?a.Pass:0;var d=h(b),e=c&&c.charAt(0)==d.type;return null!=d.align?d.align-(e?1:0):e&&b.scopes.length>1?b.scopes[b.scopes.length-2].offset:d.offset},lineComment:"#",fold:"indent"};return D}),a.defineMIME("text/x-python","python");var i=function(a){return a.split(" ")};a.defineMIME("text/x-cython",{name:"python",extra_keywords:i("by cdef cimport cpdef ctypedef enum exceptextern gil include nogil property publicreadonly struct union DEF IF ELIF ELSE")})}),function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){"use strict";function d(a){for(var d=0;d<a.state.activeLines.length;d++)a.removeLineClass(a.state.activeLines[d],"wrap",b),a.removeLineClass(a.state.activeLines[d],"background",c)}function e(a,b){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0}function f(a,f){for(var g=[],h=0;h<f.length;h++){var i=f[h];if(i.empty()){var j=a.getLineHandleVisualStart(i.head.line);g[g.length-1]!=j&&g.push(j)}}e(a.state.activeLines,g)||a.operation(function(){d(a);for(var e=0;e<g.length;e++)a.addLineClass(g[e],"wrap",b),a.addLineClass(g[e],"background",c);a.state.activeLines=g})}function g(a,b){f(a,b.ranges)}var b="CodeMirror-activeline",c="CodeMirror-activeline-background";a.defineOption("styleActiveLine",!1,function(b,c,e){var h=e&&e!=a.Init;c&&!h?(b.state.activeLines=[],f(b,b.listSelections()),b.on("beforeSelectionChange",g)):!c&&h&&(b.off("beforeSelectionChange",g),d(b),delete b.state.activeLines)})}),function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){"use strict";a.registerHelper("fold","brace",function(b,c){function h(f){for(var h=c.ch,i=0;;){var j=0>=h?-1:e.lastIndexOf(f,h-1);if(-1!=j){if(1==i&&j<c.ch)break;if(g=b.getTokenTypeAt(a.Pos(d,j+1)),!/^(comment|string)/.test(g))return j+1;h=j-1}else{if(1==i)break;i=1,h=e.length}}}var f,g,d=c.line,e=b.getLine(d),i="{",j="}",f=h("{");if(null==f&&(i="[",j="]",f=h("[")),null!=f){var m,n,k=1,l=b.lastLine();
a:for(var o=d;l>=o;++o)for(var p=b.getLine(o),q=o==d?f:0;;){var r=p.indexOf(i,q),s=p.indexOf(j,q);if(0>r&&(r=p.length),0>s&&(s=p.length),q=Math.min(r,s),q==p.length)break;if(b.getTokenTypeAt(a.Pos(o,q+1))==g)if(q==r)++k;else if(!--k){m=o,n=q;break a}++q}if(null!=m&&(d!=m||n!=f))return{from:a.Pos(d,f),to:a.Pos(m,n)}}}),a.registerHelper("fold","import",function(b,c){function d(c){if(c<b.firstLine()||c>b.lastLine())return null;var d=b.getTokenAt(a.Pos(c,1));if(/\S/.test(d.string)||(d=b.getTokenAt(a.Pos(c,d.end+1))),"keyword"!=d.type||"import"!=d.string)return null;for(var e=c,f=Math.min(b.lastLine(),c+10);f>=e;++e){var g=b.getLine(e),h=g.indexOf(";");if(-1!=h)return{startCh:d.end,end:a.Pos(e,h)}}}var f,c=c.line,e=d(c);if(!e||d(c-1)||(f=d(c-2))&&f.end.line==c-1)return null;for(var g=e.end;;){var h=d(g.line+1);if(null==h)break;g=h.end}return{from:b.clipPos(a.Pos(c,e.startCh+1)),to:g}}),a.registerHelper("fold","include",function(b,c){function d(c){if(c<b.firstLine()||c>b.lastLine())return null;var d=b.getTokenAt(a.Pos(c,1));return/\S/.test(d.string)||(d=b.getTokenAt(a.Pos(c,d.end+1))),"meta"==d.type&&"#include"==d.string.slice(0,8)?d.start+8:void 0}var c=c.line,e=d(c);if(null==e||null!=d(c-1))return null;for(var f=c;;){var g=d(f+1);if(null==g)break;++f}return{from:a.Pos(c,e+1),to:b.clipPos(a.Pos(f))}})}),function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){"use strict";function b(b,d,f,g){function j(a){var c=h(b,d);if(!c||c.to.line-c.from.line<i)return null;for(var e=b.findMarksAt(c.from),f=0;f<e.length;++f)if(e[f].__isFold&&"fold"!==g){if(!a)return null;c.cleared=!0,e[f].clear()}return c}if(f&&f.call){var h=f;f=null}else var h=e(b,f,"rangeFinder");"number"==typeof d&&(d=a.Pos(d,0));var i=e(b,f,"minFoldSize"),k=j(!0);if(e(b,f,"scanUp"))for(;!k&&d.line>b.firstLine();)d=a.Pos(d.line-1,0),k=j(!1);if(k&&!k.cleared&&"unfold"!==g){var l=c(b,f);a.on(l,"mousedown",function(b){m.clear(),a.e_preventDefault(b)});var m=b.markText(k.from,k.to,{replacedWith:l,clearOnEnter:!0,__isFold:!0});m.on("clear",function(c,d){a.signal(b,"unfold",b,c,d)}),a.signal(b,"fold",b,k.from,k.to)}}function c(a,b){var c=e(a,b,"widget");if("string"==typeof c){var d=document.createTextNode(c);c=document.createElement("span"),c.appendChild(d),c.className="CodeMirror-foldmarker"}return c}function e(a,b,c){if(b&&void 0!==b[c])return b[c];var e=a.options.foldOptions;return e&&void 0!==e[c]?e[c]:d[c]}a.newFoldFunction=function(a,c){return function(d,e){b(d,e,{rangeFinder:a,widget:c})}},a.defineExtension("foldCode",function(a,c,d){b(this,a,c,d)}),a.defineExtension("isFolded",function(a){for(var b=this.findMarksAt(a),c=0;c<b.length;++c)if(b[c].__isFold)return!0}),a.commands.toggleFold=function(a){a.foldCode(a.getCursor())},a.commands.fold=function(a){a.foldCode(a.getCursor(),null,"fold")},a.commands.unfold=function(a){a.foldCode(a.getCursor(),null,"unfold")},a.commands.foldAll=function(b){b.operation(function(){for(var c=b.firstLine(),d=b.lastLine();d>=c;c++)b.foldCode(a.Pos(c,0),null,"fold")})},a.commands.unfoldAll=function(b){b.operation(function(){for(var c=b.firstLine(),d=b.lastLine();d>=c;c++)b.foldCode(a.Pos(c,0),null,"unfold")})},a.registerHelper("fold","combine",function(){var a=Array.prototype.slice.call(arguments,0);return function(b,c){for(var d=0;d<a.length;++d){var e=a[d](b,c);if(e)return e}}}),a.registerHelper("fold","auto",function(a,b){for(var c=a.getHelpers(b,"fold"),d=0;d<c.length;d++){var e=c[d](a,b);if(e)return e}});var d={rangeFinder:a.fold.auto,widget:"\u2194",minFoldSize:0,scanUp:!1};a.defineOption("foldOptions",null),a.defineExtension("foldOption",function(a,b){return e(this,a,b)})}),function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("./foldcode")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./foldcode"],a):a(CodeMirror)}(function(a){"use strict";function c(a){this.options=a,this.from=this.to=0}function d(a){return a===!0&&(a={}),null==a.gutter&&(a.gutter="CodeMirror-foldgutter"),null==a.indicatorOpen&&(a.indicatorOpen="CodeMirror-foldgutter-open"),null==a.indicatorFolded&&(a.indicatorFolded="CodeMirror-foldgutter-folded"),a}function e(a,c){for(var d=a.findMarksAt(b(c)),e=0;e<d.length;++e)if(d[e].__isFold&&d[e].find().from.line==c)return!0}function f(a){if("string"==typeof a){var b=document.createElement("div");return b.className=a+" CodeMirror-guttermarker-subtle",b}return a.cloneNode(!0)}function g(a,c,d){var g=a.state.foldGutter.options,h=c,i=a.foldOption(g,"minFoldSize"),j=a.foldOption(g,"rangeFinder");a.eachLine(c,d,function(c){var d=null;if(e(a,h))d=f(g.indicatorFolded);else{var k=b(h,0),l=j&&j(a,k);l&&l.to.line-l.from.line>=i&&(d=f(g.indicatorOpen))}a.setGutterMarker(c,g.gutter,d),++h})}function h(a){var b=a.getViewport(),c=a.state.foldGutter;c&&(a.operation(function(){g(a,b.from,b.to)}),c.from=b.from,c.to=b.to)}function i(a,c,d){var e=a.state.foldGutter.options;d==e.gutter&&a.foldCode(b(c,0),e.rangeFinder)}function j(a){var b=a.state.foldGutter,c=a.state.foldGutter.options;b.from=b.to=0,clearTimeout(b.changeUpdate),b.changeUpdate=setTimeout(function(){h(a)},c.foldOnChangeTimeSpan||600)}function k(a){var b=a.state.foldGutter,c=a.state.foldGutter.options;clearTimeout(b.changeUpdate),b.changeUpdate=setTimeout(function(){var c=a.getViewport();b.from==b.to||c.from-b.to>20||b.from-c.to>20?h(a):a.operation(function(){c.from<b.from&&(g(a,c.from,b.from),b.from=c.from),c.to>b.to&&(g(a,b.to,c.to),b.to=c.to)})},c.updateViewportTimeSpan||400)}function l(a,b){var c=a.state.foldGutter,d=b.line;d>=c.from&&d<c.to&&g(a,d,d+1)}a.defineOption("foldGutter",!1,function(b,e,f){f&&f!=a.Init&&(b.clearGutter(b.state.foldGutter.options.gutter),b.state.foldGutter=null,b.off("gutterClick",i),b.off("change",j),b.off("viewportChange",k),b.off("fold",l),b.off("unfold",l),b.off("swapDoc",h)),e&&(b.state.foldGutter=new c(d(e)),h(b),b.on("gutterClick",i),b.on("change",j),b.on("viewportChange",k),b.on("fold",l),b.on("unfold",l),b.on("swapDoc",h))});var b=a.Pos}),function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){function c(a,b){for(var c=0,d=a.length;d>c;++c)b(a[c])}function d(a,b){if(!Array.prototype.indexOf){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1}return-1!=a.indexOf(b)}function e(c,d,e,f){var g=c.getCursor(),h=e(c,g);if(!/\b(?:string|comment)\b/.test(h.type)){h.state=a.innerMode(c.getMode(),h.state).state,/^[\w$_]*$/.test(h.string)?h.end>g.ch&&(h.end=g.ch,h.string=h.string.slice(0,g.ch-h.start)):h={start:g.ch,end:g.ch,string:"",state:h.state,type:"."==h.string?"property":null};for(var i=h;"property"==i.type;){if(i=e(c,b(g.line,i.start)),"."!=i.string)return;if(i=e(c,b(g.line,i.start)),!j)var j=[];j.push(i)}return{list:n(h,j,d,f),from:b(g.line,h.start),to:b(g.line,h.end)}}}function f(a,b){return e(a,l,function(a,b){return a.getTokenAt(b)},b)}function g(a,b){var c=a.getTokenAt(b);return b.ch==c.start+1&&"."==c.string.charAt(0)?(c.end=c.start,c.string=".",c.type="property"):/^\.[\w$_]*$/.test(c.string)&&(c.type="property",c.start++,c.string=c.string.replace(/\./,"")),c}function h(a,b){return e(a,m,g,b)}function n(a,b,e,f){function m(a){0!=a.lastIndexOf(h,0)||d(g,a)||g.push(a)}function n(a){"string"==typeof a?c(i,m):a instanceof Array?c(j,m):a instanceof Function&&c(k,m);for(var b in a)m(b)}var g=[],h=a.string,l=f&&f.globalScope||window;if(b&&b.length){var p,o=b.pop();for(o.type&&0===o.type.indexOf("variable")?(f&&f.additionalContext&&(p=f.additionalContext[o.string]),f&&f.useGlobalScope===!1||(p=p||l[o.string])):"string"==o.type?p="":"atom"==o.type?p=1:"function"==o.type&&(null==l.jQuery||"$"!=o.string&&"jQuery"!=o.string||"function"!=typeof l.jQuery?null!=l._&&"_"==o.string&&"function"==typeof l._&&(p=l._()):p=l.jQuery());null!=p&&b.length;)p=p[b.pop().string];null!=p&&n(p)}else{for(var q=a.state.localVars;q;q=q.next)m(q.name);for(var q=a.state.globalVars;q;q=q.next)m(q.name);f&&f.useGlobalScope===!1||n(l),c(e,m)}return g}var b=a.Pos;a.registerHelper("hint","javascript",f),a.registerHelper("hint","coffeescript",h);var i="charAt charCodeAt indexOf lastIndexOf substring substr slice trim trimLeft trimRight toUpperCase toLowerCase split concat match replace search".split(" "),j="length concat join splice push pop shift unshift slice reverse sort indexOf lastIndexOf every some filter forEach map reduce reduceRight ".split(" "),k="prototype apply call bind".split(" "),l="break case catch continue debugger default delete do else false finally for function if in instanceof new null return switch throw true try typeof var void while with".split(" "),m="and break catch class continue delete do else extends false finally for if in instanceof isnt new no not null of off on or return switch then throw true try typeof until void while with yes".split(" ")}),function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){"use strict";function e(a,b){if(!window.JSHINT)return[];JSHINT(a,b);var c=JSHINT.data().errors,d=[];return c&&i(c,d),d}function f(a){return g(a,c,"warning",!0),g(a,d,"error"),h(a)?null:a}function g(a,b,c,d){var e,f,g,h,i;e=a.description;for(var j=0;j<b.length;j++)f=b[j],g="string"==typeof f?f:f[0],h="string"==typeof f?null:f[1],i=-1!==e.indexOf(g),(d||i)&&(a.severity=c),i&&h&&(a.description=h)}function h(a){for(var c=a.description,d=0;d<b.length;d++)if(-1!==c.indexOf(b[d]))return!0;return!1}function i(b,c){for(var d=0;d<b.length;d++){var e=b[d];if(e){var g,h;if(g=[],e.evidence){var i=g[e.line];if(!i){var j=e.evidence;i=[],Array.prototype.forEach.call(j,function(a,b){"	"===a&&i.push(b+1)}),g[e.line]=i}if(i.length>0){var k=e.character;i.forEach(function(a){k>a&&(k-=1)}),e.character=k}}var l=e.character-1,m=l+1;e.evidence&&(h=e.evidence.substring(l).search(/.\b/),h>-1&&(m+=h)),e.description=e.reason,e.start=e.character,e.end=m,e=f(e),e&&c.push({message:e.description,severity:e.severity,from:a.Pos(e.line-1,l),to:a.Pos(e.line-1,m)})}}}var b=["Dangerous comment"],c=[["Expected '{'","Statement body should be inside '{ }' braces."]],d=["Missing semicolon","Extra comma","Missing property name","Unmatched "," and instead saw"," is not defined","Unclosed string","Stopping, unable to continue"];a.registerHelper("lint","javascript",e)}),function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){"use strict";function c(b,c){function e(b){return d.parentNode?(d.style.top=Math.max(0,b.clientY-d.offsetHeight-5)+"px",d.style.left=b.clientX+5+"px",void 0):a.off(document,"mousemove",e)}var d=document.createElement("div");return d.className="CodeMirror-lint-tooltip",d.appendChild(c.cloneNode(!0)),document.body.appendChild(d),a.on(document,"mousemove",e),e(b),null!=d.style.opacity&&(d.style.opacity=1),d}function d(a){a.parentNode&&a.parentNode.removeChild(a)}function e(a){a.parentNode&&(null==a.style.opacity&&d(a),a.style.opacity=0,setTimeout(function(){d(a)},600))}function f(b,d,f){function h(){a.off(f,"mouseout",h),g&&(e(g),g=null)}var g=c(b,d),i=setInterval(function(){if(g)for(var a=f;;a=a.parentNode){if(a==document.body)return;if(!a){h();break}}return g?void 0:clearInterval(i)},400);a.on(f,"mouseout",h)}function g(a,b,c){this.marked=[],this.options=b,this.timeout=null,this.hasGutter=c,this.onMouseOver=function(b){r(a,b)}}function h(b,c){if(c instanceof Function)return{getAnnotations:c};if(c&&c!==!0||(c={}),c.getAnnotations||(c.getAnnotations=b.getHelper(a.Pos(0,0),"lint")),!c.getAnnotations)throw new Error("Required option 'getAnnotations' missing (lint addon)");return c}function i(a){var c=a.state.lint;c.hasGutter&&a.clearGutter(b);for(var d=0;d<c.marked.length;++d)c.marked[d].clear();c.marked.length=0}function j(b,c,d,e){var g=document.createElement("div"),h=g;return g.className="CodeMirror-lint-marker-"+c,d&&(h=g.appendChild(document.createElement("div")),h.className="CodeMirror-lint-marker-multiple"),0!=e&&a.on(h,"mouseover",function(a){f(a,b,h)}),g}function k(a,b){return"error"==a?a:b}function l(a){for(var b=[],c=0;c<a.length;++c){var d=a[c],e=d.from.line;(b[e]||(b[e]=[])).push(d)}return b}function m(a){var b=a.severity;b||(b="error");var c=document.createElement("div");return c.className="CodeMirror-lint-message-"+b,c.appendChild(document.createTextNode(a.message)),c}function n(a){var b=a.state.lint,c=b.options,d=c.options||c;c.async?c.getAnnotations(a.getValue(),o,d,a):o(a,c.getAnnotations(a.getValue(),d,a))}function o(a,c){i(a);for(var d=a.state.lint,e=d.options,f=l(c),g=0;g<f.length;++g){var h=f[g];if(h){for(var n=null,o=d.hasGutter&&document.createDocumentFragment(),p=0;p<h.length;++p){var q=h[p],r=q.severity;r||(r="error"),n=k(n,r),e.formatAnnotation&&(q=e.formatAnnotation(q)),d.hasGutter&&o.appendChild(m(q)),q.to&&d.marked.push(a.markText(q.from,q.to,{className:"CodeMirror-lint-mark-"+r,__annotation:q}))}d.hasGutter&&a.setGutterMarker(g,b,j(o,n,h.length>1,d.options.tooltips))}}e.onUpdateLinting&&e.onUpdateLinting(c,f,a)}function p(a){var b=a.state.lint;clearTimeout(b.timeout),b.timeout=setTimeout(function(){n(a)},b.options.delay||500)}function q(a,b){var c=b.target||b.srcElement;f(b,m(a),c)}function r(a,b){var c=b.target||b.srcElement;if(/\bCodeMirror-lint-mark-/.test(c.className))for(var d=c.getBoundingClientRect(),e=(d.left+d.right)/2,f=(d.top+d.bottom)/2,g=a.findMarksAt(a.coordsChar({left:e,top:f},"client")),h=0;h<g.length;++h){var i=g[h].__annotation;if(i)return q(i,b)}}var b="CodeMirror-lint-markers";a.defineOption("lint",!1,function(c,d,e){if(e&&e!=a.Init&&(i(c),c.off("change",p),a.off(c.getWrapperElement(),"mouseover",c.state.lint.onMouseOver),delete c.state.lint),d){for(var f=c.getOption("gutters"),j=!1,k=0;k<f.length;++k)f[k]==b&&(j=!0);var l=c.state.lint=new g(c,h(c,d),j);c.on("change",p),0!=l.options.tooltips&&a.on(c.getWrapperElement(),"mouseover",l.onMouseOver),n(c)}})}),function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){function e(a,b,e,g){var h=a.getLineHandle(b.line),i=b.ch-1,j=i>=0&&d[h.text.charAt(i)]||d[h.text.charAt(++i)];if(!j)return null;var k=">"==j.charAt(1)?1:-1;if(e&&k>0!=(i==b.ch))return null;var l=a.getTokenTypeAt(c(b.line,i+1)),m=f(a,c(b.line,i+(k>0?1:0)),k,l||null,g);return null==m?null:{from:c(b.line,i),to:m&&m.pos,match:m&&m.ch==j.charAt(0),forward:k>0}}function f(a,b,e,f,g){for(var h=g&&g.maxScanLineLength||1e4,i=g&&g.maxScanLines||1e3,j=[],k=g&&g.bracketRegex?g.bracketRegex:/[(){}[\]]/,l=e>0?Math.min(b.line+i,a.lastLine()+1):Math.max(a.firstLine()-1,b.line-i),m=b.line;m!=l;m+=e){var n=a.getLine(m);if(n){var o=e>0?0:n.length-1,p=e>0?n.length:-1;if(!(n.length>h))for(m==b.line&&(o=b.ch-(0>e?1:0));o!=p;o+=e){var q=n.charAt(o);if(k.test(q)&&(void 0===f||a.getTokenTypeAt(c(m,o+1))==f)){var r=d[q];if(">"==r.charAt(1)==e>0)j.push(q);else{if(!j.length)return{pos:c(m,o),ch:q};j.pop()}}}}}return m-e==(e>0?a.lastLine():a.firstLine())?!1:null}function g(a,d,f){for(var g=a.state.matchBrackets.maxHighlightLineLength||1e3,h=[],i=a.listSelections(),j=0;j<i.length;j++){var k=i[j].empty()&&e(a,i[j].head,!1,f);if(k&&a.getLine(k.from.line).length<=g){var l=k.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";h.push(a.markText(k.from,c(k.from.line,k.from.ch+1),{className:l})),k.to&&a.getLine(k.to.line).length<=g&&h.push(a.markText(k.to,c(k.to.line,k.to.ch+1),{className:l}))}}if(h.length){b&&a.state.focused&&a.display.input.focus();var m=function(){a.operation(function(){for(var a=0;a<h.length;a++)h[a].clear()})};if(!d)return m;setTimeout(m,800)}}function i(a){a.operation(function(){h&&(h(),h=null),h=g(a,!1,a.state.matchBrackets)})}var b=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),c=a.Pos,d={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},h=null;a.defineOption("matchBrackets",!1,function(b,c,d){d&&d!=a.Init&&b.off("cursorActivity",i),c&&(b.state.matchBrackets="object"==typeof c?c:{},b.on("cursorActivity",i))}),a.defineExtension("matchBrackets",function(){g(this,!0)}),a.defineExtension("findMatchingBracket",function(a,b,c){return e(this,a,b,c)}),a.defineExtension("scanForBracket",function(a,b,c,d){return f(this,a,b,c,d)})}),function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){"use strict";function d(a,b){this.cm=a,this.options=this.buildOptions(b),this.widget=this.onClose=null}function e(a){return"string"==typeof a?a:a.text}function f(a,b){function f(a,d){var f;f="string"!=typeof d?function(a){return d(a,b)}:c.hasOwnProperty(d)?c[d]:d,e[a]=f}var c={Up:function(){b.moveFocus(-1)},Down:function(){b.moveFocus(1)},PageUp:function(){b.moveFocus(-b.menuSize()+1,!0)},PageDown:function(){b.moveFocus(b.menuSize()-1,!0)},Home:function(){b.setFocus(0)},End:function(){b.setFocus(b.length-1)},Enter:b.pick,Tab:b.pick,Esc:b.close},d=a.options.customKeys,e=d?{}:c;if(d)for(var g in d)d.hasOwnProperty(g)&&f(g,d[g]);var h=a.options.extraKeys;if(h)for(var g in h)h.hasOwnProperty(g)&&f(g,h[g]);return e}function g(a,b){for(;b&&b!=a;){if("LI"===b.nodeName.toUpperCase()&&b.parentNode==a)return b;b=b.parentNode}}function h(d,h){this.completion=d,this.data=h;var i=this,j=d.cm,k=this.hints=document.createElement("ul");k.className="CodeMirror-hints",this.selectedHint=h.selectedHint||0;for(var l=h.list,m=0;m<l.length;++m){var n=k.appendChild(document.createElement("li")),o=l[m],p=b+(m!=this.selectedHint?"":" "+c);null!=o.className&&(p=o.className+" "+p),n.className=p,o.render?o.render(n,h,o):n.appendChild(document.createTextNode(o.displayText||e(o))),n.hintId=m}var q=j.cursorCoords(d.options.alignWithWord?h.from:null),r=q.left,s=q.bottom,t=!0;k.style.left=r+"px",k.style.top=s+"px";var u=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth),v=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(d.options.container||document.body).appendChild(k);var w=k.getBoundingClientRect(),x=w.bottom-v;if(x>0){var y=w.bottom-w.top,z=q.top-(q.bottom-w.top);if(z-y>0)k.style.top=(s=q.top-y)+"px",t=!1;else if(y>v){k.style.height=v-5+"px",k.style.top=(s=q.bottom-w.top)+"px";var A=j.getCursor();h.from.ch!=A.ch&&(q=j.cursorCoords(A),k.style.left=(r=q.left)+"px",w=k.getBoundingClientRect())}}var B=w.right-u;if(B>0&&(w.right-w.left>u&&(k.style.width=u-5+"px",B-=w.right-w.left-u),k.style.left=(r=q.left-B)+"px"),j.addKeyMap(this.keyMap=f(d,{moveFocus:function(a,b){i.changeActive(i.selectedHint+a,b)},setFocus:function(a){i.changeActive(a)},menuSize:function(){return i.screenAmount()},length:l.length,close:function(){d.close()},pick:function(){i.pick()},data:h})),d.options.closeOnUnfocus){var C;j.on("blur",this.onBlur=function(){C=setTimeout(function(){d.close()},100)}),j.on("focus",this.onFocus=function(){clearTimeout(C)})}var D=j.getScrollInfo();return j.on("scroll",this.onScroll=function(){var a=j.getScrollInfo(),b=j.getWrapperElement().getBoundingClientRect(),c=s+D.top-a.top,e=c-(window.pageYOffset||(document.documentElement||document.body).scrollTop);return t||(e+=k.offsetHeight),e<=b.top||e>=b.bottom?d.close():(k.style.top=c+"px",k.style.left=r+D.left-a.left+"px",void 0)}),a.on(k,"dblclick",function(a){var b=g(k,a.target||a.srcElement);b&&null!=b.hintId&&(i.changeActive(b.hintId),i.pick())}),a.on(k,"click",function(a){var b=g(k,a.target||a.srcElement);b&&null!=b.hintId&&(i.changeActive(b.hintId),d.options.completeOnSingleClick&&i.pick())}),a.on(k,"mousedown",function(){setTimeout(function(){j.focus()},20)}),a.signal(h,"select",l[0],k.firstChild),!0}var b="CodeMirror-hint",c="CodeMirror-hint-active";a.showHint=function(a,b,c){if(!b)return a.showHint(c);c&&c.async&&(b.async=!0);var d={hint:b};if(c)for(var e in c)d[e]=c[e];return a.showHint(d)},a.defineExtension("showHint",function(b){if(!(this.listSelections().length>1||this.somethingSelected())){this.state.completionActive&&this.state.completionActive.close();var c=this.state.completionActive=new d(this,b),e=c.options.hint;if(e)return a.signal(this,"startCompletion",this),e.async?(e(this,function(a){c.showHints(a)},c.options),void 0):c.showHints(e(this,c.options))}}),d.prototype={close:function(){this.active()&&(this.cm.state.completionActive=null,this.widget&&this.widget.close(),this.onClose&&this.onClose(),a.signal(this.cm,"endCompletion",this.cm))},active:function(){return this.cm.state.completionActive==this},pick:function(b,c){var d=b.list[c];d.hint?d.hint(this.cm,b,d):this.cm.replaceRange(e(d),d.from||b.from,d.to||b.to,"complete"),a.signal(b,"pick",d),this.close()},showHints:function(a){return a&&a.list.length&&this.active()?(this.options.completeSingle&&1==a.list.length?this.pick(a,0):this.showWidget(a),void 0):this.close()},showWidget:function(b){function l(){e||(e=!0,d.close(),d.cm.off("cursorActivity",p),b&&a.signal(b,"close"))}function m(){if(!e){a.signal(b,"update");var c=d.options.hint;c.async?c(d.cm,n,d.options):n(c(d.cm,d.options))}}function n(a){if(b=a,!e){if(!b||!b.list.length)return l();d.widget&&d.widget.close(),d.widget=new h(d,b)}}function o(){c&&(k(c),c=0)}function p(){o();var a=d.cm.getCursor(),b=d.cm.getLine(a.line);a.line!=g.line||b.length-a.ch!=i-g.ch||a.ch<g.ch||d.cm.somethingSelected()||a.ch&&f.test(b.charAt(a.ch-1))?d.close():(c=j(m),d.widget&&d.widget.close())}this.widget=new h(this,b),a.signal(b,"shown");var e,c=0,d=this,f=this.options.closeCharacters,g=this.cm.getCursor(),i=this.cm.getLine(g.line).length,j=window.requestAnimationFrame||function(a){return setTimeout(a,1e3/60)},k=window.cancelAnimationFrame||clearTimeout;this.cm.on("cursorActivity",p),this.onClose=l},buildOptions:function(a){var b=this.cm.options.hintOptions,c={};for(var d in i)c[d]=i[d];if(b)for(var d in b)void 0!==b[d]&&(c[d]=b[d]);if(a)for(var d in a)void 0!==a[d]&&(c[d]=a[d]);return c}},h.prototype={close:function(){if(this.completion.widget==this){this.completion.widget=null,this.hints.parentNode.removeChild(this.hints),this.completion.cm.removeKeyMap(this.keyMap);var a=this.completion.cm;this.completion.options.closeOnUnfocus&&(a.off("blur",this.onBlur),a.off("focus",this.onFocus)),a.off("scroll",this.onScroll)}},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(b,d){if(b>=this.data.list.length?b=d?this.data.list.length-1:0:0>b&&(b=d?0:this.data.list.length-1),this.selectedHint!=b){var e=this.hints.childNodes[this.selectedHint];e.className=e.className.replace(" "+c,""),e=this.hints.childNodes[this.selectedHint=b],e.className+=" "+c,e.offsetTop<this.hints.scrollTop?this.hints.scrollTop=e.offsetTop-3:e.offsetTop+e.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=e.offsetTop+e.offsetHeight-this.hints.clientHeight+3),a.signal(this.data,"select",this.data.list[this.selectedHint],e)}},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}},a.registerHelper("hint","auto",function(b,c){var e,d=b.getHelpers(b.getCursor(),"hint");if(d.length)for(var f=0;f<d.length;f++){var g=d[f](b,c);if(g&&g.list.length)return g}else if(e=b.getHelper(b.getCursor(),"hintWords")){if(e)return a.hint.fromList(b,{words:e})}else if(a.hint.anyword)return a.hint.anyword(b,c)}),a.registerHelper("hint","fromList",function(b,c){for(var d=b.getCursor(),e=b.getTokenAt(d),f=[],g=0;g<c.words.length;g++){var h=c.words[g];h.slice(0,e.string.length)==e.string&&f.push(h)}return f.length?{list:f,from:a.Pos(d.line,e.start),to:a.Pos(d.line,e.end)}:void 0}),a.commands.autocomplete=a.showHint;var i={hint:a.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!1,container:null,customKeys:null,extraKeys:null};a.defineOption("hintOptions",null)});
</script>



<!--    <link rel="stylesheet" href="../../doc/docs.css"> -->
    <style type="text/css">
          .CodeMirror {
        float: left;
        width: 100%;
      }
    </style>

<script type="text/javascript">
function js_beautify(F,r){function E(a){for(a="undefined"===typeof a?!1:a;f.length&&(" "===f[f.length-1]||f[f.length-1]===w||a&&("\n"===f[f.length-1]||"\r"===f[f.length-1]));)f.pop()}function C(a){return"[EXPRESSION]"===a||"[INDENTED-EXPRESSION]"===a}function k(a){c.eat_next_space=!1;if(!v||!C(c.mode))if(a="undefined"===typeof a?!0:a,c.if_line=!1,E(),f.length){"\n"===f[f.length-1]&&a||(x=!0,f.push("\n"));for(a=0;a<c.indentation_level;a+=1)f.push(w);c.var_line&&c.var_line_reindented&&(" "===Q?f.push(" "):
f.push(w))}}function l(){if(c.eat_next_space)c.eat_next_space=!1;else{var a=" ";f.length&&(a=f[f.length-1]);" "!==a&&"\n"!==a&&a!==w&&f.push(" ")}}function n(){x=!1;c.eat_next_space=!1;f.push(d)}function M(){f.length&&f[f.length-1]===w&&f.pop()}function y(a){c&&G.push(c);c={previous_mode:c?c.mode:"BLOCK",mode:a,var_line:!1,var_line_tainted:!1,var_line_reindented:!1,in_html_comment:!1,if_line:!1,in_case:!1,eat_next_space:!1,indentation_baseline:-1,indentation_level:c?c.indentation_level+(c.var_line&&
c.var_line_reindented?1:0):U}}function C(a){return"[EXPRESSION]"===a||"[INDENTED-EXPRESSION]"===a}function H(a){return"[EXPRESSION]"===a||"[INDENTED-EXPRESSION]"===a||"(EXPRESSION)"===a}function I(){J="DO_BLOCK"===c.mode;0<G.length&&(c=G.pop())}function q(a,b){for(var c=0;c<b.length;c+=1)if(b[c]===a)return!0;return!1}function V(){for(var a=0,b=0,c=f.length-1;0<=c;c--)switch(f[c]){case ":":0===a&&b++;break;case "?":if(0===a){if(0===b)return!0;b--}break;case "{":if(0===a)return!1;a--;break;case "(":case "[":a--;
break;case ")":case "]":case "}":a++}}function R(){u=0;if(b>=t)return["","TK_EOF"];D=!1;var a=g.charAt(b);b+=1;if(v&&C(c.mode)){for(var m=0;q(a,N);){"\n"===a?(E(),f.push("\n"),x=!0,m=0):"\t"===a?m+=4:"\r"!==a&&(m+=1);if(b>=t)return["","TK_EOF"];a=g.charAt(b);b+=1}-1===c.indentation_baseline&&(c.indentation_baseline=m);if(x){var d;for(d=0;d<c.indentation_level+1;d+=1)f.push(w);if(-1!==c.indentation_baseline)for(d=0;d<m-c.indentation_baseline;d++)f.push(" ")}}else{for(;q(a,N);){"\n"===a&&(u+=S?u<=S?
1:0:1);if(b>=t)return["","TK_EOF"];a=g.charAt(b);b+=1}if(O&&1<u)for(d=0;d<u;d+=1)k(0===d),x=!0;D=0<u}if(q(a,K)){if(b<t)for(;q(g.charAt(b),K)&&(a+=g.charAt(b),b+=1,b!==t););if(b!==t&&a.match(/^[0-9]+[Ee]$/)&&("-"===g.charAt(b)||"+"===g.charAt(b)))return m=g.charAt(b),b+=1,d=R(b),a+=m+d[0],[a,"TK_WORD"];if("in"===a)return[a,"TK_OPERATOR"];!D||"TK_OPERATOR"===e||c.if_line||!O&&"var"===h||k();return[a,"TK_WORD"]}if("("===a||"["===a)return[a,"TK_START_EXPR"];if(")"===a||"]"===a)return[a,"TK_END_EXPR"];
if("{"===a)return[a,"TK_START_BLOCK"];if("}"===a)return[a,"TK_END_BLOCK"];if(";"===a)return[a,"TK_SEMICOLON"];if("/"===a){m="";d=!0;if("*"===g.charAt(b)){b+=1;if(b<t)for(;("*"!==g.charAt(b)||!g.charAt(b+1)||"/"!==g.charAt(b+1))&&b<t;){a=g.charAt(b);m+=a;if("\r"===a||"\n"===a)d=!1;b+=1;if(b>=t)break}b+=2;return d?["/*"+m+"*/","TK_INLINE_COMMENT"]:["/*"+m+"*/","TK_BLOCK_COMMENT"]}if("/"===g.charAt(b)){for(m=a;"\r"!==g.charAt(b)&&"\n"!==g.charAt(b)&&!(m+=g.charAt(b),b+=1,b>=t););b+=1;D&&k();return[m,
"TK_COMMENT"]}}if("'"===a||'"'===a||"/"===a&&("TK_WORD"===e&&q(h,["return","do"])||"TK_COMMENT"===e||"TK_START_EXPR"===e||"TK_START_BLOCK"===e||"TK_END_BLOCK"===e||"TK_OPERATOR"===e||"TK_EQUALS"===e||"TK_EOF"===e||"TK_SEMICOLON"===e)){m=a;d=!1;if(b<t)if("/"===m)for(var l=!1;d||l||g.charAt(b)!==m;){if(a+=g.charAt(b),d?d=!1:(d="\\"===g.charAt(b),"["===g.charAt(b)?l=!0:"]"===g.charAt(b)&&(l=!1)),b+=1,b>=t)return[a,"TK_STRING"]}else for(;d||g.charAt(b)!==m;)if(a+=g.charAt(b),d=d?!1:"\\"===g.charAt(b),
b+=1,b>=t)return[a,"TK_STRING"];b+=1;a+=m;if("/"===m)for(;b<t&&q(g.charAt(b),K);)a+=g.charAt(b),b+=1;return[a,"TK_STRING"]}if("#"===a&&(m="#",b<t&&q(g.charAt(b),T))){do a=g.charAt(b),m+=a,b+=1;while(b<t&&"#"!==a&&"="!==a);"#"!==a&&("["===g.charAt(b)&&"]"===g.charAt(b+1)?(m+="[]",b+=2):"{"===g.charAt(b)&&"}"===g.charAt(b+1)&&(m+="{}",b+=2));return[m,"TK_WORD"]}if("<"===a&&"\x3c!--"===g.substring(b-1,b+3))return b+=3,c.in_html_comment=!0,["\x3c!--","TK_COMMENT"];if("-"===a&&c.in_html_comment&&"--\x3e"===
g.substring(b-1,b+2))return c.in_html_comment=!1,b+=2,D&&k(),["--\x3e","TK_COMMENT"];if(q(a,P)){for(;b<t&&q(a+g.charAt(b),P)&&!(a+=g.charAt(b),b+=1,b>=t););return"="===a?[a,"TK_EQUALS"]:[a,"TK_OPERATOR"]}return[a,"TK_UNKNOWN"]}var g,f,d,e,h,s,z,c,G,w,N,K,P,b,A,T,p,B,J,D,x,u;r=r?r:{};var L=r.braces_on_own_line?r.braces_on_own_line:!1;z=r.indent_size?r.indent_size:4;var Q=r.indent_char?r.indent_char:" ",O="undefined"===typeof r.preserve_newlines?!0:r.preserve_newlines,S="undefined"===typeof r.max_preserve_newlines?
!1:r.max_preserve_newlines,U=r.indent_level?r.indent_level:0,W="undefined"===r.space_after_anon_function?!1:r.space_after_anon_function,v="undefined"===typeof r.keep_array_indentation?!1:r.keep_array_indentation;x=!1;var t=F.length;for(w="";0<z;)w+=Q,z-=1;g=F;z="";e="TK_START_EXPR";s=h="";f=[];J=!1;N=["\n","\r","\t"," "];K="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split("");T="0123456789".split("");P="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::".split(" ");
A="continue try throw return var if switch case default for while break function".split(" ");G=[];y("BLOCK");for(b=0;;){B=R(b);d=B[0];B=B[1];if("TK_EOF"===B)break;switch(B){case "TK_START_EXPR":if("["===d){if("TK_WORD"===e||")"===h){q(h,A)&&l();y("(EXPRESSION)");n();break}"[EXPRESSION]"===c.mode||"[INDENTED-EXPRESSION]"===c.mode?"]"===s&&","===h?("[EXPRESSION]"===c.mode&&(c.mode="[INDENTED-EXPRESSION]",v||(c.indentation_level+=1)),y("[EXPRESSION]"),v||k()):"["===h?("[EXPRESSION]"===c.mode&&(c.mode=
"[INDENTED-EXPRESSION]",v||(c.indentation_level+=1)),y("[EXPRESSION]"),v||k()):y("[EXPRESSION]"):y("[EXPRESSION]")}else y("(EXPRESSION)");";"===h||"TK_START_BLOCK"===e?k():"TK_END_EXPR"!==e&&"TK_START_EXPR"!==e&&"TK_END_BLOCK"!==e&&"."!==h&&("TK_WORD"!==e&&"TK_OPERATOR"!==e?l():"function"===z?W&&l():(q(h,A)||"catch"===h)&&l());n();break;case "TK_END_EXPR":if("]"===d)if(v){if("}"===h){M();n();I();break}}else if("[INDENTED-EXPRESSION]"===c.mode&&"]"===h){I();k();n();break}I();n();break;case "TK_START_BLOCK":"do"===
z?y("DO_BLOCK"):y("BLOCK");L?("TK_OPERATOR"!==e&&("return"==h?l():k(!0)),n(),c.indentation_level+=1):("TK_OPERATOR"!==e&&"TK_START_EXPR"!==e?"TK_START_BLOCK"===e?k():l():C(c.previous_mode)&&","===h&&("}"===s?l():k()),c.indentation_level+=1,n());break;case "TK_END_BLOCK":I();L?k():"TK_START_BLOCK"===e?x?M():E():C(c.mode)&&v?(v=!1,k(),v=!0):k();n();break;case "TK_WORD":if(J){l();n();l();J=!1;break}if("function"===d&&(x||";"===h)&&"{"!==h)for(u=x?u:0,O||(u=1),p=0;p<2-u;p++)k(!1);if("case"===d||"default"===
d){":"===h?M():(c.indentation_level--,k(),c.indentation_level++);n();c.in_case=!0;break}p="NONE";"TK_END_BLOCK"===e?q(d.toLowerCase(),["else","catch","finally"])?L?p="NEWLINE":(p="SPACE",l()):p="NEWLINE":"TK_SEMICOLON"!==e||"BLOCK"!==c.mode&&"DO_BLOCK"!==c.mode?"TK_SEMICOLON"===e&&H(c.mode)?p="SPACE":"TK_STRING"===e?p="NEWLINE":"TK_WORD"===e?p="SPACE":"TK_START_BLOCK"===e?p="NEWLINE":"TK_END_EXPR"===e&&(l(),p="NEWLINE"):p="NEWLINE";c.if_line&&"TK_END_EXPR"===e&&(c.if_line=!1);if(q(d.toLowerCase(),
["else","catch","finally"]))"TK_END_BLOCK"!==e||L?k():(E(!0),l());else if(q(d,A)||"NEWLINE"===p){if("TK_START_EXPR"!==e&&"="!==h&&","!==h||"function"!==d)"return"===h||"throw"===h?l():"TK_END_EXPR"!==e?"TK_START_EXPR"===e&&"var"===d||":"===h||("if"===d&&"else"===z&&"{"!==h?l():k()):q(d,A)&&")"!==h&&k()}else C(c.mode)&&","===h&&"}"===s?k():"SPACE"===p&&l();n();z=d;"var"===d&&(c.var_line=!0,c.var_line_reindented=!1,c.var_line_tainted=!1);"if"===d&&(c.if_line=!0);"else"===d&&(c.if_line=!1);break;case "TK_SEMICOLON":n();
c.var_line=!1;c.var_line_reindented=!1;break;case "TK_STRING":"TK_START_BLOCK"===e||"TK_END_BLOCK"===e||"TK_SEMICOLON"===e?k():"TK_WORD"===e&&l();n();break;case "TK_EQUALS":c.var_line&&(c.var_line_tainted=!0);l();n();l();break;case "TK_OPERATOR":p=s=!0;c.var_line&&","===d&&H(c.mode)&&(c.var_line_tainted=!1);if(c.var_line&&","===d)if(c.var_line_tainted){n();c.var_line_reindented=!0;c.var_line_tainted=!1;k();break}else c.var_line_tainted=!1;if("return"===h||"throw"===h){l();n();break}if(":"===d&&c.in_case){n();
k();c.in_case=!1;break}if("::"===d){n();break}if(","===d){c.var_line?c.var_line_tainted?(n(),k(),c.var_line_tainted=!1):(n(),l()):"TK_END_BLOCK"===e&&"(EXPRESSION)"!==c.mode?(n(),"OBJECT"===c.mode&&"}"===h?k():l()):"OBJECT"===c.mode?(n(),k()):(n(),l());break}else q(d,["--","++","!"])||q(d,["-","+"])&&(q(e,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||q(h,A))?(p=s=!1,";"===h&&H(c.mode)&&(s=!0),"TK_WORD"===e&&q(h,A)&&(s=!0),"BLOCK"!==c.mode||"{"!==h&&";"!==h||k()):"."===d?s=!1:":"!==
d||V()||(c.mode="OBJECT",s=!1);s&&l();n();p&&l();break;case "TK_BLOCK_COMMENT":s=d.split(/\x0a|\x0d\x0a/);if(/^\/\*\*/.test(d))for(k(),f.push(s[0]),p=1;p<s.length;p++)k(),f.push(" "),f.push(s[p].replace(/^\s\s*|\s\s*$/,""));else for(1<s.length?(k(),E()):l(),p=0;p<s.length;p++)f.push(s[p]),f.push("\n");k();break;case "TK_INLINE_COMMENT":l();n();H(c.mode)?l():k();break;case "TK_COMMENT":D?k():l();n();k();break;case "TK_UNKNOWN":"return"!==h&&"throw"!==h||l(),n()}s=h;e=B;h=d}return f.join("").replace(/[\n ]+$/,
"")}"undefined"!==typeof exports&&(exports.js_beautify=js_beautify);function Indente(){GEBID("lecode").value=editor.getValue();var F=GEBID("lecode").value.replace(/^\s+/,"");GEBID("lecode").value=js_beautify(F,{indent_size:2,braces_on_own_line:!1});editor.setValue(GEBID("lecode").value);return!0};</script>
		<script type="text/javascript" id="AllScripts">

// <!--

// Gestion Dropbox
var client, taskTable, DropboxSync=false;
var dircontent = [];
var openeddir = 0;

/*
function InitDropbox() {
   var DROPBOXKEY = DropboxAppID;
//var DROPBOXKEY = 'rbbpcq0cbk38qrm';
  client = new Dropbox.Client({
    key: DROPBOXKEY,
  });

  // Try to finish OAuth authorization.
  client.authenticate({
    interactive: true
  }, function(error) {
    if (error) {
      alert('Authentication error: ' + error);
    } else {
   }
  });
  if (client.isAuthenticated()) {
  DropboxSync=true;
  dircontent = [];
  openeddir = 0;
  ReadCompleteDir('');
  waitUntilOk(function() {
    SynchronizeWithDropbox(dircontent);
  });
  }
}
*/

  function getAccessTokenFromUrl() {
    return utils.parseQueryString(window.location.hash).access_token;
  }

  // If the user was just redirected from authenticating, the urls hash will
  // contain the access token.


  function isAuthenticated() {
    return !!getAccessTokenFromUrl();
  }

  // Render a list of items to #files


  function renderItems(items) {
    items.forEach(function(item) {
      Ecrire(item.name);
    });
  }

  (function(window){
    window.utils = {
      parseQueryString: function(str) {
        var ret = Object.create(null);

        if (typeof str !== 'string') {
          return ret;
        }

        str = str.trim().replace(/^(\?|#|&)/, '');

        if (!str) {
          return ret;
        }

        str.split('&').forEach(function (param) {
          var parts = param.replace(/\+/g, ' ').split('=');
          // Firefox (pre 40) decodes `%3D` to `=`
          // https://github.com/sindresorhus/query-string/pull/37
          var key = parts.shift();
          var val = parts.length > 0 ? parts.join('=') : undefined;

          key = decodeURIComponent(key);
          val = val === undefined ? null : decodeURIComponent(val);

          if (ret[key] === undefined) {
            ret[key] = val;
          } else if (Array.isArray(ret[key])) {
            ret[key].push(val);
          } else {
            ret[key] = [ret[key], val];
          }
        });

        return ret;
      }
    };
  })(window);

var client;

function InitDropbox() {


  var CLIENT_ID = DropboxAppID;

  // Parses the url and gets the access token if it is in the urls hash

  // This example keeps both the authenticate and non-authenticated setions
  // in the DOM and uses this function to show/hide the correct section.


  if (isAuthenticated()) {
    // Create an instance of Dropbox with the access token and use it to
    // fetch and render the files in the users root directory.
    client = new Dropbox({
      accessToken: getAccessTokenFromUrl()
    });
    client.writeFile = function(filename, filecontents, x, y) {
      client.filesUpload({
        path: '/' + filename,
        contents: filecontents,
        mode: 'overwrite'
      });
    };

    client.readFile = function(filename, b, c) {
      client.filesDownload({
        path: '/' + filename
      }).then(function(data) {
        var reader = new FileReader();
        reader.onload = function() {
          c(null, reader.result);
        };
        reader.readAsText(data.fileBlob.slice());
      });
    };

    client.remove = function(filename, f) {
      client.filesDelete({
        path: '/' + filename
      });
    };

    client.readdir = function(filename, b, f) {
      client.filesListFolder({
        path: '/' + filename
      }).then(function(x) {
        f(null, x.entries);
      });
    };

    DropboxSync=true;
    dircontent = [];
    openeddir = 0;
    ReadCompleteDir('');

    waitUntilOk(function() {
      SynchronizeWithDropbox(dircontent);
    });

    /*
    client.filesListFolder({
      path: ''
    }).then(function(response) {
      renderItems(response.entries);
    }).catch (function(error) {
      console.log(error);
    });
    */
  } else {

    // Set the login anchors href using dbx.getAuthenticationUrl()
    client = new Dropbox({
      clientId: CLIENT_ID
    });
    var authUrl = client.getAuthenticationUrl(window.location);
    window.location = authUrl;
  }

}


function importDropbox_file_to_InternalFS(filenameDB,filenameIFS) {
  var xhr = client.readFile(filenameDB, null, function(error, fs) {
    window.localStorage[filenameIFS]=fs;
  });
}

function lsDropboxFile() {
    client.readdir('',{},function(error, filesystem) {
      if (error) {
        return null;
      }

      AfficherTableau(filesystem);
    });
}

function exportAllFStoDropboxFS() {
  for (p in window.localStorage) {
    if (SousChaine(p,0,Longueur('dropbox-auth')) != 'dropbox-auth')
	    var xhr = client.writeFile(p, window.localStorage[p], null, function(error) {});
  }
}

function readDropboxFile(myfilename) {
	var fichier=taskTable.query({filename: myfilename});
    if (Taille(fichier)>0)
	    return (fichier[0].get('filecontents'));
	else return 'ERRORNOFILE';
}
/*
function writeDropboxFile(myfilename, myfilecontents) {
	var fichier=taskTable.query({filename: myfilename});
    try {
    if (Longueur(myfilecontents)<99000) {
    if (Taille(fichier)>0) {
	    fichier[0].update({filecontents: myfilecontents});
    } else {
		taskTable.insert({filename: myfilename, filecontents: myfilecontents});
    }
    } else Ecrire('ERROR : '+myfilename+' too big to be synchronized (Size='+Longueur(myfilecontents)+')');
    } catch (e) {alert('ERROR '+e);}
}
*/



function writeDropboxFile(myfilename, myfilecontents) {
	var xhr = client.writeFile(myfilename, myfilecontents, null, function(error) {});
}

/*
function removeDropboxFile(myfilename) {
	var fichier=taskTable.query({filename: myfilename});
    if (Taille(fichier)>0)
	    fichier[0].deleteRecord();
}
*/

function removeDropboxFile(myfilename) {
	try {
	  var xhr = client.remove(myfilename, function(error) {});
	} catch (e) {alert('ERROR '+e);}
}


function lsDropbox() {
	var fichier=taskTable.query({});
	for(var i=0; i<Taille(fichier); i++) {
		if (fichier[i].has('filename')) Ecrire(fichier[i].get('filename'));
	}
}

function exportLibraryToDropbox() {
	for(p in window.localStorage) {
		if (SousChaine(p,0,Longueur('dropbox-auth')) != 'dropbox-auth')
			writeDropboxFile(p,readFile(p));
	}
}



/*
function ReadCompleteDir(root) {
  openeddir++;
  client.readdir(root, {}, function(error, filesystem) {
    if (error) {
      alert('Error 1 opening default datastore: ' + error);
    }

    for (var p in filesystem) {
      if (filesystem[p].name()[0] == '"') dircontent.push(((root != '') ? (root + '/') : '') + filesystem[p]);
      else
      ReadCompleteDir(((root != '') ? (root + '/') : '') + filesystem[p].name());
    }
    openeddir--;
  });
}
*/

function ReadCompleteDir(root) {
  openeddir++;
  client.filesListFolder({
    path: root
  }).then(

  function(response) {
    filesystem = response.entries;
    for (var p in filesystem) {
      if (filesystem[p][".tag"] == 'folder') {
        ReadCompleteDir(((root != '') ? (root + '/') : '/') + filesystem[p].name);
      } else {
        dircontent.push(((root != '') ? (root + '/') : '/') + filesystem[p].name);
      }
    }
    openeddir--;
  });
}




function waitUntilOk(f) {
  if (openeddir > 0) {
    setTimeout(function() {
      waitUntilOk(f);
    }, 10);
  } else f();
}

/*
function ReadFromDropbox(filename, callback) {
  client.readFile(filename, function(error, data) {
    if (error) {
      return alert(error); // Something went wrong.
    }
    callback(filename, data);
  });
}
*/

function ReadFromDropbox(filename, callback) {
  client.filesDownload({
    path: '/' + filename
  }).then(function(data) {
    var reader = new FileReader();
    reader.onload = function() {
      callback(filename, reader.result);
    };
    reader.readAsText(data.fileBlob.slice());
  });
}



function SynchronizeWithDropbox(content) {
  for (var i = 0; i < Taille(content); i++) {
    if (content[i][0] == '/') content[i]=content[i].substring(1);
    if (content[i].substring(0, Longueur('__Conflicts/')) != '__Conflicts/') {
      if (window.localStorage[content[i]] == undefined) {
        ReadFromDropbox(content[i], function(n, d) {
          window.localStorage[n] = d;
        });
      } else {
        ReadFromDropbox(content[i], function(n, d) {
          if (d != window.localStorage[n]) {
            window.localStorage['__Conflicts/' + n] = window.localStorage[n];
            window.localStorage[n] = d;
          }
        });
      }
    }
  }
  for(var p in window.localStorage) {
  if (typeof(window.localStorage[p]) == 'string' && (p.substring(0,Longueur('__Conflicts/'))!='__Conflicts/') && (p.substring(0,Longueur('dropbox-auth:'))!='dropbox-auth:'))
    if (dircontent.indexOf(p) < 0) writeDropboxFile(p, window.localStorage[p]);
}

}





var builtin_ImagesToBePreloaded = 0;

function PreloadImage(imageurl) {
 var img = new Image();
 img.src = imageurl.replace(/^[\s\n]+/g, '').replace(/[\s\n]+$/g, '').replace(/\n/g, '');
 builtin_ImagesToBePreloaded++;
 img.onload = function() {
   builtin_ImagesToBePreloaded--;
 };
 return img;
}

function WaitPreload(f) {
 if (builtin_ImagesToBePreloaded > 0) {
   setTimeout(function () {WaitPreload(f);}, 10);
 } else {
   f();
 }
}

function DrawImageObject(image,x,y,l,h) {
  ctx.drawImage(image,ViewX(x),ViewY(y),ViewX(l),ViewY(h))
}


function PreloadGooglefont(familyname) {
 var name = 'Sedgwick Ave Display',
  typeOfFont = 'cursive';
 var t=familyname.split(',');
 name=t[0]; typeOfFont=t[1].replace(' ', '');
 name=name.replace(/\'/g,"");
 name=name.replace(/\"/g,"");
 var fname = name.replace(' ', '+');
 var link = document.createElement('link');
 link.rel = 'stylesheet';
 link.type = 'text/css';
 link.href = '//fonts.googleapis.com/css?family=' + fname;
 document.getElementsByTagName('head')[0].appendChild(link);
 return '"' + name + '" ,' + typeOfFont;
}

//var fontGabriola = PreloadGooglefont("'Ranga', cursive");



function includeURL(url) {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    var lignes=this.responseText;
    try {window.eval(lignes);} catch(e) {};
  };
  xhttp.open("GET", url, true);
  xhttp.send();
}

var builtin_PreloadedLibs = 0;
function PreloadLib(url) {
  var xhttp = new XMLHttpRequest();
  xhttp.onload = function(e) {
    //for(var p in this) Ecrire(p+"="+e[p]);
    builtin_PreloadedLibs--;
    var lignes=this.responseText;
    try {window.eval(lignes);} catch(e) {};
  };
  xhttp.open("GET", url, true);
  builtin_PreloadedLibs++;
  xhttp.send();
}

function WaitPreloadLibs(f) {
  if (builtin_PreloadedLibs>0) {
    setTimeout(function () {WaitPreloadLibs(f);},10);
  } else {f();}
}







// Gestion des évènements

builtin_oldfilename='';


function builtincapturetouch(e) {
	// Ecrire('capturetouch '+ e.changedTouches[0].pageY);
	e.preventDefault();
	var decy=GEBID('mycanvas').style.top.replace('px','');
	var y=(e.changedTouches[0].clientY-decy) * Math.abs(maxviewport_y-minviewport_y) / size_canvas_y;
	if (viewport_dir == 1) {
		y+=minviewport_y;
	} else {
		y=maxviewport_y-y;
	}
	if (builtinclick) MouseClick(minviewport_x+e.changedTouches[0].clientX * Math.abs(maxviewport_x-minviewport_x) / size_canvas_x,
			   y);
}

var builtinclick=false;

function builtinMouseDown(e) {
	// Ecrire('MouseDown');
	e.preventDefault();
	builtinclick=true;
	var decy=GEBID('mycanvas').style.top.replace('px','');

	if (typeof(e.changedTouches) != 'undefined') builtincapturemouse({layerX:e.changedTouches[0].clientX, layerY:(e.changedTouches[0].clientY-decy)});
	else builtincapturemouse(e);
}

function builtinMouseUp(e) {
	// Ecrire('MouseUp');
	e.preventDefault();
	builtinclick=false;
}

function builtinMouseMoveEvent(e) {
	// Ecrire('MouseMove');
	e.preventDefault();
	var y=e.layerY * Math.abs(maxviewport_y-minviewport_y) / size_canvas_y;
	if (viewport_dir == 1) {
		y+=minviewport_y;
	} else {
		y=maxviewport_y-y;
	}
	if (builtinclick) MouseMove(minviewport_x+e.layerX * Math.abs(maxviewport_x-minviewport_x) / size_canvas_x,
			   y);
}





function builtincapturemouse(e) {
	var y=e.layerY * Math.abs(maxviewport_y-minviewport_y) / size_canvas_y;
	if (viewport_dir == 1) {
		y+=minviewport_y;
	} else {
		y=maxviewport_y-y;
	}
	MouseClick(minviewport_x+e.layerX * Math.abs(maxviewport_x-minviewport_x) / size_canvas_x,
			   y);
}

/*
Initialiser();
var old_x=-1;
var old_y=-1;
function MouseClick(x,y) {
  if (old_x>0) {
	  Ligne(old_x,old_y,x,y,'black');
  }
  old_x=x;
  old_y=y;
}
*/

function builtincapturekey(e) {
	var res='';
	for(p in e) res+=p+'='+e[p]+'\n';
	alert(res);
//	Keypressed(Ascii_vers_Caractere(e.charCode));
}

function Keypressed(t) {}

function MouseClick(x,y) {
}

function MouseMove(x,y) {
}

function plot(f, deb, fin) {
  var nbpoints = 100;
  var T = [];
  for (var i = 0; i <= 100; i++) {
    var x = deb + (fin - deb) / nbpoints * i;
    T[i] = [x, f(x)];
  }
  AfficherCourbe(T, false, false, 'red', '-', 1);
}

// Gestion des sons
// Reprise de la classe RIFFWAVE
var FastBase64 = {

  chars: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
  encLookup: [],

  Init: function() {
    for (var i = 0; i < 4096; i++) {
      this.encLookup[i] = this.chars[i >> 6] + this.chars[i & 0x3F];
    }
  },

  Encode: function(src) {
    var len = src.length;
    var dst = '';
    var i = 0;
    while (len > 2) {
      n = (src[i] << 16) | (src[i + 1] << 8) | src[i + 2];
      dst += this.encLookup[n >> 12] + this.encLookup[n & 0xFFF];
      len -= 3;
      i += 3;
    }
    if (len > 0) {
      var n1 = (src[i] & 0xFC) >> 2;
      var n2 = (src[i] & 0x03) << 4;
      if (len > 1) n2 |= (src[++i] & 0xF0) >> 4;
      dst += this.chars[n1];
      dst += this.chars[n2];
      if (len == 2) {
        var n3 = (src[i++] & 0x0F) << 2;
        n3 |= (src[i] & 0xC0) >> 6;
        dst += this.chars[n3];
      }
      if (len == 1) dst += '=';
      dst += '=';
    }
    return dst;
  } // end Encode
}

FastBase64.Init();

var RIFFWAVE = function(data) {

  this.data = []; // Byte array containing audio samples
  this.wav = []; // Array containing the generated wave file
  this.dataURI = ''; // http://en.wikipedia.org/wiki/Data_URI_scheme
  this.header = { // OFFS SIZE NOTES
    chunkId: [0x52, 0x49, 0x46, 0x46],
    // 0    4    "RIFF" = 0x52494646
    chunkSize: 0,
    // 4    4    36+SubChunk2Size = 4+(8+SubChunk1Size)+(8+SubChunk2Size)
    format: [0x57, 0x41, 0x56, 0x45],
    // 8    4    "WAVE" = 0x57415645
    subChunk1Id: [0x66, 0x6d, 0x74, 0x20],
    // 12   4    "fmt " = 0x666d7420
    subChunk1Size: 16,
    // 16   4    16 for PCM
    audioFormat: 1,
    // 20   2    PCM = 1
    numChannels: 1,
    // 22   2    Mono = 1, Stereo = 2, etc.
    sampleRate: 8000,
    // 24   4    8000, 44100, etc
    byteRate: 0,
    // 28   4    SampleRate*NumChannels*BitsPerSample/8
    blockAlign: 0,
    // 32   2    NumChannels*BitsPerSample/8
    bitsPerSample: 8,
    // 34   2    8 bits = 8, 16 bits = 16, etc...
    subChunk2Id: [0x64, 0x61, 0x74, 0x61],
    // 36   4    "data" = 0x64617461
    subChunk2Size: 0 // 40   4    data size = NumSamples*NumChannels*BitsPerSample/8
  };

  function u32ToArray(i) {
    return [i & 0xFF, (i >> 8) & 0xFF, (i >> 16) & 0xFF, (i >> 24) & 0xFF];
  }

  function u16ToArray(i) {
    return [i & 0xFF, (i >> 8) & 0xFF];
  }

  this.Make = function(data) {
    if (data instanceof Array) this.data = data;
    this.header.byteRate = (this.header.sampleRate * this.header.numChannels * this.header.bitsPerSample) >> 3;
    this.header.blockAlign = (this.header.numChannels * this.header.bitsPerSample) >> 3;
    this.header.subChunk2Size = this.data.length;
    this.header.chunkSize = 36 + this.header.subChunk2Size;

    this.wav = this.header.chunkId.concat(
    u32ToArray(this.header.chunkSize), this.header.format, this.header.subChunk1Id, u32ToArray(this.header.subChunk1Size), u16ToArray(this.header.audioFormat), u16ToArray(this.header.numChannels), u32ToArray(this.header.sampleRate), u32ToArray(this.header.byteRate), u16ToArray(this.header.blockAlign), u16ToArray(this.header.bitsPerSample), this.header.subChunk2Id, u32ToArray(this.header.subChunk2Size), this.data);
    this.dataURI = 'data:audio/wav;base64,' + FastBase64.Encode(this.wav);
  };

  if (data instanceof Array) this.Make(data);

}; // end RIFFWAVE


function ChargerSon(url) {
  // Charge un son stocké dans un fichier externe
  var res = document.createElement('audio');
  res.setAttribute('src', url);
  res.load();
  return res;
}

function CreerSon(data, samplerate) {
  // création d'un objet sonore à partir d'un tableau et d'un taux d'échantillonnage
  var wave = new RIFFWAVE();
  wave.header.sampleRate = samplerate;
  wave.header.numChannels = 1;
  wave.Make(data);
  var res = document.createElement('audio');
  res.setAttribute('src', wave.dataURI);
  res.load();
  return res;
}


function encode64(input) {
var keyStr = "ABCDEFGHIJKLMNOP" + "QRSTUVWXYZabcdef" + "ghijklmnopqrstuv" + "wxyz0123456789+/" + "=";
  input = escape(input);
  var output = "";
  var chr1, chr2, chr3 = "";
  var enc1, enc2, enc3, enc4 = "";
  var i = 0;

  do {
    chr1 = input.charCodeAt(i++);
    chr2 = input.charCodeAt(i++);
    chr3 = input.charCodeAt(i++);

    enc1 = chr1 >> 2;
    enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
    enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
    enc4 = chr3 & 63;

    if (isNaN(chr2)) {
      enc3 = enc4 = 64;
    } else if (isNaN(chr3)) {
      enc4 = 64;
    }

    output = output + keyStr.charAt(enc1) + keyStr.charAt(enc2) + keyStr.charAt(enc3) + keyStr.charAt(enc4);
    chr1 = chr2 = chr3 = "";
    enc1 = enc2 = enc3 = enc4 = "";
  } while (i < input.length);

  return output;
}

function decode64(input) {
var keyStr = "ABCDEFGHIJKLMNOP" + "QRSTUVWXYZabcdef" + "ghijklmnopqrstuv" + "wxyz0123456789+/" + "=";
  var output = "";
  var chr1, chr2, chr3 = "";
  var enc1, enc2, enc3, enc4 = "";
  var i = 0;

  // remove all characters that are not A-Z, a-z, 0-9, +, /, or =
  var base64test = /[^A-Za-z0-9\+\/\=]/g;
  if (base64test.exec(input)) {
    alert("There were invalid base64 characters in the input text.\n" + "Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\n" + "Expect errors in decoding.");
  }
  input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");

  do {
    enc1 = keyStr.indexOf(input.charAt(i++));
    enc2 = keyStr.indexOf(input.charAt(i++));
    enc3 = keyStr.indexOf(input.charAt(i++));
    enc4 = keyStr.indexOf(input.charAt(i++));

    chr1 = (enc1 << 2) | (enc2 >> 4);
    chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
    chr3 = ((enc3 & 3) << 6) | enc4;

    output = output + String.fromCharCode(chr1);

    if (enc3 != 64) {
      output = output + String.fromCharCode(chr2);
    }
    if (enc4 != 64) {
      output = output + String.fromCharCode(chr3);
    }

    chr1 = chr2 = chr3 = "";
    enc1 = enc2 = enc3 = enc4 = "";

  } while (i < input.length);

  return unescape(output);
}


function ImportSon(nomfichier) {
  var sonurl = readFile(nomfichier).replace(/^[\s\n]+/g,'').replace(/[\s\n]+$/g,'');
  var sondata = decode64(SousChaine(sonurl, PositionDans(sonurl, 'base64') + 7), Longueur(sonurl));
  var numchannels = Caractere_vers_Ascii(sondata[22]) + Caractere_vers_Ascii(sondata[23]) * 256;
  var samplerate = Caractere_vers_Ascii(sondata[24]) + Caractere_vers_Ascii(sondata[25]) * 256 + 256 * 256 * Caractere_vers_Ascii(sondata[26]) + Caractere_vers_Ascii(sondata[27]) * 256 * 256 * 256;
  var bitssample = Caractere_vers_Ascii(sondata[34]) + Caractere_vers_Ascii(sondata[35]) * 256;
/*
Ecrire(numchannels + ' canaux');
Ecrire(samplerate + ' SR');
Ecrire(bitssample + ' b/s');
*/
  var decalage = Math.floor(bitssample / 8);

  var data = Tableau();
  var k = 0;
  for (var i = 0; i < Longueur(sondata) - 44; i += decalage) {
    data[k] = 0;
    puiss = 1;
    for (var j = 0; j < decalage && (44 + i + j < Longueur(sondata)); j++) {
      data[k] += (Caractere_vers_Ascii(CaractereEn(sondata, 44 + i + j, 1))) * puiss;
      puiss *= 256;
    }
    k++;
  }

  // pb du 0
  var maxval = Math.pow(2, bitssample);

  if (bitssample > 8) {
    for (var i = 0; i < Taille(data); i += 1) {
      // Pour une conversion en signed 16bits
      if (data[i] > maxval / 2) data[i] = data[i] - maxval;
      data[i] = Math.floor(0.5 * 256 * (data[i]) / maxval + 127);
    }
  }
  return data;
}

function SampleRate(nomfichier) {
  var sonurl = readFile(nomfichier).replace(/^[\s\n]+/g,'').replace(/[\s\n]+$/g,'');
  var sondata = decode64(SousChaine(sonurl, PositionDans(sonurl, 'base64') + 7), Longueur(sonurl));
  var samplerate = Caractere_vers_Ascii(sondata[24]) + Caractere_vers_Ascii(sondata[25]) * 256 + 256 * 256 * Caractere_vers_Ascii(sondata[26]) + Caractere_vers_Ascii(sondata[27]) * 256 * 256 * 256;
  return samplerate;
}

function SauverSon(nomfichier, data, samplerate) {
  // création d'un objet sonore à partir d'un tableau et d'un taux d'échantillonnage
  var wave = new RIFFWAVE();
  wave.header.sampleRate = samplerate;
  wave.header.numChannels = 1;
  wave.Make(data);
  writeFile(nomfichier, wave.dataURI);
}

function ExportSon(data, samplerate) {
  // création d'un objet sonore à partir d'un tableau et d'un taux d'échantillonnage
  var wave = new RIFFWAVE();
  wave.header.sampleRate = samplerate;
  wave.header.numChannels = 1;
  wave.Make(data);
  window.open(wave.dataURI);
}



// Fin gestion des sons

// Début gestion des fichiers
function writeFile(filename,content) {
 window.localStorage[filename]=content;
 if (DropboxSync) writeDropboxFile(filename,content)
}

function EcrireDans(filename,content) {
 window.localStorage[filename]+=content;
}

function includeFile(filename) {
  try {window.eval(readFile(filename));} catch(e) {};
}

function readAllFS(str) {
    var tab = str.split('\n');
	str = '';
	var flag = false;
	for (var i = 0; i < Taille(tab); i++) {
  		tab[i] = tab[i].replace(new RegExp('^[\-]{3,100}', 'g'), '-=-=-=-=-');
  		if (flag) str += '\n';
  		flag=true;
  		str += tab[i];
	}
    var tab=str.split('-=-=-=-=-');
    for(var i=0; i<Taille(tab)-1;i+=2) {
        writeFile(tab[i].replace(/\n/g,''),tab[i+1].replace(/\n/,''));
    }
}

function ls() {
 for(var p in window.localStorage) if (SousChaine(p,0,Longueur('dropbox-auth')) != 'dropbox-auth' && typeof(window.localStorage[p]) == 'string') Ecrire(p);
}

function directory() {
 var res=''; for(var p in window.localStorage) if (SousChaine(p,0,Longueur('dropbox-auth')) != 'dropbox-auth' && p.indexOf('togetherjs.')<0 && typeof(window.localStorage[p]) == 'string') res+=p+'\n'; return res;
}

function readFile(filename) {
 return window.localStorage[filename];
}

function removeFile(filename) {
 delete window.localStorage[filename];
 if (DropboxSync) removeDropboxFile(filename)

}

function clearAllFS() {
 for(var p in window.localStorage) removeFile(p);
}

function FileExists(filename) {
	return (window.localStorage[filename])?true:false;
}

function renameFile(oldname,newname) {
 writeFile(newname,readFile(oldname));
 removeFile(oldname);
}

function removeAllFiles() {
 for(var p in window.localStorage) removeFile(p);
}

// Fin gestion des ES

var Exemples_javascripts_nom = Array();
var Exemples_javascripts_inst = Array();
var Exemples_javascripts_fonctions = Array();


Exemples_javascripts_nom[0] = "Exemple d'utilisation d'AfficherCourbe";

Exemples_javascripts_inst[0] = "var tab=new Array(1,3,5,2,4);\nvar tab2=new Array(16,2,1,3,4);\n// Obtenir de l'aide sur AfficherCourbe\nAfficherCourbe();\nAfficherCourbe(tab2);\nAfficherCourbe(tab,true,false,'green','X',1);\n";

Exemples_javascripts_fonctions[0] = "";

function texte_a_etudier() {
  return GEBID("MonTexte").value;
}

function getEntreetexte() {
  return GEBID("MonTexte").value;
}

function setEntreetexte(valeur) {
  GEBID("MonTexte").value=valeur;
}

function AfficherTableau(tab) {
  for (var i = 0; i < tab.length; i++) {
    if (typeof(tab[i]) != "object") Ecrire(tab[i]);
    else {
      ligne = "";
      for (var p in tab[i])
      ligne = ligne + tab[i][p] + "\t";
      Ecrire(ligne);
    }
  }
}

function affiche_tableau(tab) {
  AfficherTableau(tab);
}

//function Point(x,y) {var res=new Array(x,y); return res;}

function point(x1, y1) {
  var tab = new Array(x1, y1);
  return (tab);
}

Exemples_javascripts_nom[1] = "Animation";

Exemples_javascripts_inst[1] = "Initialiser();\nAfficheGraphique();Anim(0);";

Exemples_javascripts_fonctions[1] = "function Anim(t) {\n  if (t<600) {\n    Effacer();\n    for(i=1; i<480; i++) {\n      Point(i,150+50*Math.cos((i+t)*3.14/180),'red');\n    }\n   setTimeout('Anim('+(t+1)+')',1);\n  }\n}";

Exemples_javascripts_nom[2] = "Fractale de Von Koch";

Exemples_javascripts_inst[2] = "Initialiser(); Viewport(0,0,600,400,1)\nDeplacer(100,100);\nDroite(90);\nAfficheGraphique();\nvar ch=Lsystems('F','F-F++F-F',4);\ninterprete(ch,2,60);\nDroite(120);\ninterprete(ch,2,60);\nDroite(120);\ninterprete(ch,2,60);\nDroite(120);\n";

Exemples_javascripts_fonctions[2] = "function Lsystems(current,regles,n) {\n  if (n<1)\n    return current;\n  else {\n    var res='';\n    var i;\n    for (i=0; i<current.length; i++) {\n      if (current.charAt(i) == 'F') {\n        res=res+regles;\n      } else {\n        res=res+current.charAt(i);\n      }\n    }\n    return Lsystems(res,regles,n-1);\n  }\n}\n\nfunction interprete(ch,l,a) {\n  var i;\n  for (i=0; i<ch.length; i++) {\n    switch (ch.charAt(i)) {\n    case 'F' : Avancer(l); break;\n    case '+' : Droite(a); break;\n    case '-' : Gauche(a); break;\n    }\n  }\n}\n";

Exemples_javascripts_nom[3] = "Fractale Ensemble de Mandelbrot";

Exemples_javascripts_inst[3] = "Initialiser(); Viewport(0,0,300,200,1);\nHideTurtle();\nAfficheGraphique();\nMandelbrot();\nStop('');\nDrawTurtle();\n";

Exemples_javascripts_fonctions[3] = "function TranslateX(x) {\n	return x*3/300-2;\n}\n\nfunction TranslateY(y) {\n	return (y-100)*3/200;\n}\n\n\nfunction Mandelbrot() {\n	var i;\n	var j;\n	for(i=0; i<300; i++) {\n		for(j=0; j<200; j++) {\n		var macouleur=CouleurMandelbrot(TranslateX(i),TranslateY(j));\n			var chcouleur='rgb('+((macouleur*4)%256)+',0,0)';\n			RectanglePlein(i,j,1,1,chcouleur);\n		}\n	}\n}\n\nfunction module(x,y) {\n	return Math.sqrt(x*x+y*y);\n}\n\nfunction CouleurMandelbrot(a,b) {\n	var i=0;\n	var x=a;\n	var y=b;\n	do {\n		var tmp=x;\n		x=x*x-y*y+a;\n		y=2*tmp*y+b;\n                i++;\n	}\n while ((module(x,y)<2) && (i<50));\n	return 50-i;\n}";


function putExemple(i) {
  if (Exemples_javascripts_inst[i] != '') GEBID('lecode').value = Exemples_javascripts_inst[i];
  //	if (Exemples_javascripts_fonctions[i] != '') GEBID('builtin_codejs').value=Exemples_javascripts_fonctions[i];
  if (Exemples_javascripts_fonctions[i] != '') GEBID('lecode').value += Exemples_javascripts_fonctions[i];
  //GEBID('Aide').style.visibility='hidden';
  // pour CodeMirror
  editor.setValue(GEBID('lecode').value);
  // fin
  GEBID('titre_onglet').selectedIndex = 0;
  MontreFenetre(0);
}

function ConstruitExemples() {
  var i;
  document.writeln('<ul>');
  for (i = 0; i < Exemples_javascripts_nom.length; i++) {
    document.writeln('<li><a href="javascript:(void(0))" onclick="putExemple(' + i + ')">' + Exemples_javascripts_nom[i] + '</a></li>');
  }
  document.writeln('</ul>');
}



function chronometre(instruction) {
  var avant = new Date();
  eval(instruction);
  var apres = new Date();
  return ((apres.getSeconds() - avant.getSeconds()) * 1000 + (apres.getMilliseconds() - avant.getMilliseconds()));
}

function builtin_max(a, b) {
  if (a < b) return b;
  else
  return a;
}

function InitGraphic() {
  canvas = GEBID('mycanvas');
  ctx = canvas.getContext('2d');
  DrawTurtle();
  CacheGraphique();
}

function AfficheGraphique() {
  fenetre_courante = builtin_fenetregraphique;
  MontreFenetre(0);
}

function CacheGraphique() {}

function Effacer() {
  HideTurtle();
  ctx.clearRect(0, 0, size_canvas_x, size_canvas_y);
  DrawTurtle();
}

function Rotation(angle) {
	ctx.setTransform(Math.cos(angle*3.14/180),Math.sin(angle*3.14/180),-Math.sin(angle*3.14/180),Math.cos(angle*3.14/180),1,1);
}

function Transformation(a,b,c,d,e,f) {
	ctx.setTransform(a,b,c,d,e,f);
}

function Initialiser() {
  currentx = 0;
  currenty = 0;
  currentcolor = 'black';
  ctx.strokeStyle = currentcolor;
  ctx.fillStyle = currentcolor;
  ctx.lineWidth = 1;
  currentangle = 0;
  plotflag = true;
  Viewport(0, 0, size_canvas_x, size_canvas_y, 1);
  Deplacer(200, 200);
  Rotation(0);
  ShadowOff();
  Effacer();
  HideTurtle();
}

var canvas;
var ctx;

var currentx = 0;
var currenty = 0;
var plotflag = true;
var currentcolor = 'black';
var currentangle = 0;
var currentMask;
var currentMaskX = 0;
var currentMaskY = 0;
var sizeTurtle = 10;
var minviewport_x = 0;
var minviewport_y = 0;
var maxviewport_x = 480;
var maxviewport_y = 300;
var viewport_dir = -1;
var turtleEnabled=true;

function Viewport(minx, miny, maxx, maxy, dir) {
  minviewport_x = minx;
  minviewport_y = miny;
  maxviewport_x = maxx;
  maxviewport_y = maxy;
  viewport_dir = dir;
}

function ViewX(x) {
  x = (x - minviewport_x) * size_canvas_x / (maxviewport_x - minviewport_x);
  if (x < 0) return 0;
  if (x >= size_canvas_x) return size_canvas_x - 1;
  return x;
}

function ViewY(y) {
  if (viewport_dir == 1) y = (y - minviewport_y) * size_canvas_y / (maxviewport_y - minviewport_y);
  else
  y = size_canvas_y - (y - minviewport_y) * size_canvas_y / (maxviewport_y - minviewport_y);
  if (y < 0) return 0;
  if (y >= size_canvas_y) return size_canvas_y - 1;
  return y;

}

function ShadowOn() {
	ctx.shadowColor='black';
	ctx.shadowBlur=3;
	ctx.shadowOffsetX=3;
	ctx.shadowOffsetY=3;
}

function ShadowOff() {
	ctx.shadowColor='black';
	ctx.shadowBlur=0;
	ctx.shadowOffsetX=0;
	ctx.shadowOffsetY=0;
}

function Ligne(x0, y0, x1, y1, color) {
  ctx.strokeStyle = color;
  ctx.beginPath();
  ctx.moveTo(ViewX(x0), ViewY(y0));
  ctx.lineTo(ViewX(x1), ViewY(y1));
  ctx.closePath();
  ctx.stroke();
}

function Cercle(x0, y0, r, color) {
  Ellipse(x0,y0,r,r,color);
}

function CerclePlein(x0, y0, r, color) {
  EllipsePlein(x0,y0,r,r,color);
}

function DrawImage(imageurl,x,y,w,h) {
	var monim=new Image();
	monim.src=imageurl.replace(/^[\s\n]+/g,'').replace(/[\s\n]+$/g,'').replace(/\n/g,'');
    monim.onload = function() {
      ctx.drawImage(this, ViewX(x), ViewY(y), ViewX(w), ViewY(h));
    };
}

function Polygone() {
  var args = Polygone.arguments;
  if (args.length % 2 != 0 && args.length > 2) {
    var color = args[args.length - 1];
    ctx.strokeStyle = color;
    ctx.beginPath();
    ctx.moveTo(ViewX(args[0]), ViewY(args[1]));
    for (var i = 0; i < args.length - 1; i += 2) {
      ctx.lineTo(ViewX(args[i]), ViewY(args[i + 1]));
    }
    ctx.lineTo(ViewX(args[0]), ViewY(args[1]));

    ctx.closePath();
    ctx.stroke();
  } else {alert('Wrong number of arguments in Polygone');}
}

function PolygonePlein() {
  var args = PolygonePlein.arguments;
  if (args.length % 2 != 0 && args.length > 2) {
    var color = args[args.length - 1];
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.moveTo(ViewX(args[0]), ViewY(args[1]));
    for (var i = 0; i < args.length - 1; i += 2) {
      ctx.lineTo(ViewX(args[i]), ViewY(args[i + 1]));
    }
    ctx.lineTo(ViewX(args[0]), ViewY(args[1]));

    ctx.closePath();
    ctx.fill();
  } else {alert('Wrong number of arguments in PolygonePlein');}
}

function Ellipse(x, y, w, h, color) {
  x-=w/2;
  y-=h/2;
  var kappa = .5522848;
      ox = (w / 2) * kappa, // control point offset horizontal
      oy = (h / 2) * kappa, // control point offset vertical
      xe = x + w,           // x-end
      ye = y + h,           // y-end
      xm = x + w / 2,       // x-middle
      ym = y + h / 2;       // y-middle

  ctx.strokeStyle = color;
  ctx.beginPath();
  ctx.moveTo(ViewX(x), ViewY(ym));
  ctx.bezierCurveTo(ViewX(x), ViewY(ym - oy), ViewX(xm - ox), ViewY(y), ViewX(xm), ViewY(y));
  ctx.bezierCurveTo(ViewX(xm + ox), ViewY(y), ViewX(xe), ViewY(ym - oy), ViewX(xe), ViewY(ym));
  ctx.bezierCurveTo(ViewX(xe), ViewY(ym + oy), ViewX(xm + ox), ViewY(ye), ViewX(xm), ViewY(ye));
  ctx.bezierCurveTo(ViewX(xm - ox), ViewY(ye), ViewX(x), ViewY(ym + oy), ViewX(x), ViewY(ym));
  ctx.closePath();
  ctx.stroke();
}

function EllipsePlein(x, y, w, h, color) {
  x-=w/2;
  y-=h/2;
  var kappa = .5522848;
      ox = (w / 2) * kappa, // control point offset horizontal
      oy = (h / 2) * kappa, // control point offset vertical
      xe = x + w,           // x-end
      ye = y + h,           // y-end
      xm = x + w / 2,       // x-middle
      ym = y + h / 2;       // y-middle

  ctx.strokeStyle = color;
  ctx.fillStyle = color;
  ctx.beginPath();
  ctx.moveTo(ViewX(x), ViewY(ym));
  ctx.bezierCurveTo(ViewX(x), ViewY(ym - oy), ViewX(xm - ox), ViewY(y), ViewX(xm), ViewY(y));
  ctx.bezierCurveTo(ViewX(xm + ox), ViewY(y), ViewX(xe), ViewY(ym - oy), ViewX(xe), ViewY(ym));
  ctx.bezierCurveTo(ViewX(xe), ViewY(ym + oy), ViewX(xm + ox), ViewY(ye), ViewX(xm), ViewY(ye));
  ctx.bezierCurveTo(ViewX(xm - ox), ViewY(ye), ViewX(x), ViewY(ym + oy), ViewX(x), ViewY(ym));
  ctx.closePath();
  ctx.fill();
}

function Rectangle(x, y, l, h, color) {
  ctx.strokeStyle = color;
  ctx.strokeRect(ViewX(x), ViewY(y), l * size_canvas_x / (maxviewport_x - minviewport_x), h * size_canvas_y / (maxviewport_y - minviewport_y))
}

function RectanglePlein(x, y, l, h, color) {
  ctx.fillStyle = color;
  ctx.fillRect(ViewX(x), ViewY(y), (l * size_canvas_x / (maxviewport_x - minviewport_x)) , (h * size_canvas_y / (maxviewport_y - minviewport_y)) );
}


function Point(x, y, color) {
  ctx.fillStyle = color;
  ctx.fillRect(ViewX(x), ViewY(y), 1, 1);
}

function getPointColor(x,y) {
  return ctx.getImageData(x,y,1,1).data;
}

function Texte(x, y, ch, color) {
  ctx.fillStyle = color;
  var ecart=ctx.measureText('oo').width;
  var T=[];
  ch=ch.toString();
  if (typeof(ch) == 'string') T=ch.split('\n');
  for(var i=0;i<T.length; i++) {
    ctx.fillText(T[i], ViewX(x), ViewY(y)+i*ecart);
  }
}


function setCanvasFont(_fontname, _fontsize, _extrastyle) {
	ctx.font = _extrastyle+' '+_fontsize+' '+_fontname;
}

function GradientLineaire(couleur1,couleur2,xd,yd,xf,yf) {
	var grd=ctx.createLinearGradient(ViewX(xd),ViewY(yd),ViewX(xf),ViewY(yf));
	grd.addColorStop(0,couleur1);
	grd.addColorStop(1,couleur2);
	return grd;
}

function AfficherCourbe() {
  if (AfficherCourbe.arguments.length == 0) {
    alert('ERROR AfficherCourbe/DrawTable\nUsage: AfficherCourbe/DrawTable(tab,[addition, filled, ColorLine, TypePoint=".OX", lineWidth])');
    return;
  }
  var tab = AfficherCourbe.arguments[0];
  var addition, filled, ColorLine, TypePoint, Eppline;
  if (AfficherCourbe.arguments.length > 1) addition = AfficherCourbe.arguments[1];
  else addition = false;
  if (AfficherCourbe.arguments.length > 2) filled = AfficherCourbe.arguments[2];
  else filled = true;
  if (AfficherCourbe.arguments.length > 3) ColorLine = AfficherCourbe.arguments[3];
  else ColorLine = 'rgb(255,0,0)';
  if (AfficherCourbe.arguments.length > 4) TypePoint = AfficherCourbe.arguments[4];
  else TypePoint = 'O';
  if (AfficherCourbe.arguments.length > 5) Eppline = AfficherCourbe.arguments[5];
  else Eppline = 5;
  if (!addition) {
    Initialiser();
    var minx = 0;
    var miny = 0;
    var maxx = 0;
    var maxy = 0;
    var x;
    var y;
    if (tab.length > 0) {
      if (typeof(tab[0]) != "object") {
        minx = 0;
        maxx = 0;
        miny = tab[0];
        maxy = tab[0];
      } else {
        minx = tab[0][0];
        maxx = tab[0][0];
        miny = tab[0][1];
        maxy = tab[0][1];
      }
    }

    for (var i = 0; i < tab.length; i++) {
      if (typeof(tab[i]) != "object") {
        x = i;
        y = tab[i];
      } else {
        x = tab[i][0];
        y = tab[i][1];
      }
      if (x < minx) minx = x;
      if (x > maxx) maxx = x;
      if (y < miny) miny = y;
      if (y > maxy) maxy = y;
    }
    Viewport(minx, miny, maxx, maxy, -1);
  }
  if (filled) CourbesFill(tab, 'rgb(200,200,255)');
  Courbes(tab, ColorLine, Eppline);
  AllPoints(tab, ColorLine, TypePoint);
}


function CourbesFill(tab, color) {
  ctx.fillStyle = color;
  ctx.strokeStyle = 'black';
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(ViewX(minviewport_x), ViewY(minviewport_y));
  for (var i = 0; i < tab.length; i++) {
    if (typeof(tab[i]) != "object") ctx.lineTo(ViewX(i), ViewY(tab[i]));
    else {
      ctx.lineTo(ViewX(tab[i][0]), ViewY(tab[i][1]));
    }
  }
  ctx.lineTo(ViewX(maxviewport_x), ViewY(minviewport_y));
  //	ctx.lineTo(ViewX(minviewport_x),ViewY(minviewport_y));
  ctx.closePath();
  ctx.fill();
  ctx.lineWidth = 1;
}

function Courbes(tab, color, epp) {
  var x, y;
  ctx.strokeStyle = color;
  ctx.lineWidth = epp;
  ctx.beginPath();
  for (var i = 0; i < tab.length; i++) {
    if (typeof(tab[i]) != "object") {
      x = ViewX(i);
      y = ViewY(tab[i]);
    } else {
      x = ViewX(tab[i][0]);
      y = ViewY(tab[i][1]);
    }
    if (i == 0) ctx.moveTo(x, y);
    else
    ctx.lineTo(x, y);

  }
  //	ctx.closePath();
  ctx.stroke();
  ctx.lineWidth = 1;
}

function AllPoints(tab, color, typep) {
  ctx.fillStyle = color;
  ctx.lineWidth = 1;
  var x, y;
  for (var i = 0; i < tab.length; i++) {
    if (typeof(tab[i]) != "object") {
      x = ViewX(i);
      y = ViewY(tab[i]);
    } else {
      x = ViewX(tab[i][0]);
      y = ViewY(tab[i][1]);
    }
    if (typep == "O") {
      ctx.beginPath();
      ctx.arc(x, y, 10, 0, Math.PI * 2, true);
      ctx.fill();
    } else if (typep == "X") {
      ctx.beginPath();
      ctx.moveTo(x - 5, y - 5);
      ctx.lineTo(x + 5, y + 5);
      ctx.moveTo(x - 5, y + 5);
      ctx.lineTo(x + 5, y - 5);
      ctx.stroke();
    }
  }
  ctx.lineWidth = 1;
}


function DrawTurtle() {
  if (turtleEnabled) {
  currentMaskX = builtin_max(0, ViewX(currentx) - sizeTurtle * 2);
  currentMaskY = builtin_max(0, ViewY(currenty) - sizeTurtle * 2);
  currentMask = ctx.getImageData(currentMaskX, currentMaskY, sizeTurtle * 2 * 2, sizeTurtle * 2 * 2);
  ctx.fillStyle = 'blue';
  ctx.lineWidth = 1;
  ctx.strokeStyle = 'black';
  ctx.beginPath();
  ctx.moveTo(ViewX(currentx), ViewY(currenty));
  ctx.lineTo(ViewX(currentx) + 0.5 * sizeTurtle * Math.cos(currentangle * 3.14 / 180), ViewY(currenty) - 0.5 * sizeTurtle * Math.sin(currentangle * 3.14 / 180));
  ctx.lineTo(ViewX(currentx) - sizeTurtle * Math.sin(currentangle * 3.14 / 180), ViewY(currenty) - 1.5 * sizeTurtle * Math.cos(currentangle * 3.14 / 180));
  ctx.lineTo(ViewX(currentx) - 0.5 * sizeTurtle * Math.cos(currentangle * 3.14 / 180), ViewY(currenty) + 0.5 * sizeTurtle * Math.sin(currentangle * 3.14 / 180));
  ctx.closePath();
  ctx.fill();
  }
}

var tortx=0;
var torty=0;
var tortdir=270;
var Tcos=[];
for(var i=0; i<360*4; i++) Tcos[i]=Math.cos(i/4*Math.PI/180);

function eCos(a) {
  a=Math.floor(4*a)%1440;
  return Tcos[a];
}

function eSin(a) {
  return eCos(a+270);
}


function eDeplacer(x,y) {
  currentx=x; currentx=y;
}

function eAvancer(L) {
  var ox=currentx, oy=currenty;
  currenty-=L*eCos(currentangle);
  currentx+=L*eSin(currentangle);
  ctx.beginPath();
  ctx.strokeStyle = currentcolor;
  ctx.moveTo(ox,oy);
  ctx.lineTo(currentx,currenty);
  ctx.stroke();
}

function eDroite(a) {
  while(a<0) a+=360;
  currentangle=(currentangle+a)%360;
}
function eGauche(a) {
  eDroite(-a);
}



function HideTurtle() {
  if (turtleEnabled) {
  ctx.putImageData(currentMask, currentMaskX, currentMaskY);
  }
}

function Gauche(a) {
  currentangle = (currentangle + a) % 360;
  HideTurtle();
  DrawTurtle();
}

function Droite(a) {
  currentangle = (360 + currentangle - a) % 360;
  HideTurtle();
  DrawTurtle();
}

function Avancer(l) {
//  var newx = currentx - l * Math.sin(currentangle * 3.14 / 180);
//  var newy = currenty - l * Math.cos(currentangle * 3.14 / 180);
  var newx = currentx - l * eSin(currentangle);
  var newy = currenty - l * eCos(currentangle);
  HideTurtle();
  if (plotflag) {
    Ligne(currentx, currenty, newx, newy, currentcolor);
  }
  currentx = newx;
  currenty = newy;
  DrawTurtle();
}

function Deplacer(x, y) {
  HideTurtle();
  currentx = x;
  currenty = y;
  DrawTurtle();
}

function Baisser() {
  plotflag = true;
}

function Couleur(c) {
  currentcolor = c;
}

function Lever() {
  plotflag = false;
}



// Manipulations de chaines de caract&egrave;res

function Caractere_vers_Ascii(c) {
  if (typeof(c) === 'string')
    return c.charCodeAt(0);
  else {alert("Erreur dans l'appel de Caractere_vers_Ascii\nError when invoking toAscii"); return -1;}
}

function Ascii_vers_Caractere(n) {
  return String.fromCharCode(n);
}

function Majuscule(c) {
  if (typeof(c) === 'string')
    return c.toUpperCase();
  else {alert("Erreur dans l'appel de Majuscule\nError when invoking Uppercase"); return "";}
}

function CaractereEn(ch, i) {
  if (typeof(ch) === 'string')
    return ch.charAt(i);
  else {alert("Erreur dans l'appel de CaractereEn"); return "";}
}

function Longueur(ch) {
  if (typeof(ch) === 'string')
    return ch.length;
  else {alert("Erreur dans l'appel de Longueur\nError when invoking Length"); return -1;}
}

function SousChaine(ch, deb, lo) {
  if (typeof(ch) === 'string')
    return ch.substr(deb, lo);
  else {alert("Erreur dans l'appel de SousChaine\nError when invoking Substr"); return "";}
}

function PositionDans(ch, ch_cherchee) {
  if (typeof(ch) === 'string')
    return ch.indexOf(ch_cherchee);
  else {alert("Erreur dans l'appel de PositionDans\nError when invoking Search"); return -1;}
}

// Manipulation de Tableaux

function Tableau() {
  if (Tableau.arguments.length == 0) {
    return [];
  } else {
    if (Tableau.arguments.length == 1) {
      return new Array(Tableau.arguments[0]);
    } else {
      var nbl = Tableau.arguments[0];
      var nbc = Tableau.arguments[1];
      var zzz;
      var tmp = [];
      for (var i = 0; i < nbl; i++) {
        tmp[i] = [];
        for (var j = 0; j < nbc; j++) tmp[i][j] = zzz;
      }
      return tmp;
    }
  }
}


function Taille(T) {
  return T.length;
}

function InitialiserTableau(T, valeur) {
  for (var i = 0; i < T.length; i++) {
    T[i] = valeur;
  }
}

// AfficherTableau d&eacute;jà d&eacute;clar&eacute;e

function ConcateneTableaux(T1, T2) {
  return T1.concat(T2);
}

function CombineTableauxL(T1, T2) {
  return new Array(T1, T2);
}

function CombineTableauxC(T1, T2) {
  var res = new Array();
  for (var i = 0; i < builtin_max(T1.length, T2.length); i++) {
    res[i] = new Array(T1[i], T2[i]);
  }
  return res;
}

function Renverser(T) {
  return T.reverse();
}

function Numerique(a, b) {
  return a - b;
}

function OrdreNumerique(T) {
  var res = T.slice(0, T.length);
  return res.sort(Numerique);
}

function OrdreLexicographique(T) {
  var res = T.slice(0, T.length);
  return res.sort();
}

function SousTableau(T, debut, longueur) {
  return T.slice(debut, debut + longueur);
}

// Autres fonctions

function Hasard(n) {
  return (Math.random() * n) >> 0;
}

function NormalizeAudio(T) {
  var res=[]; res[Taille(T)-1]=0;
  for(var i = 0; i<Taille(T); i++) {
    res[i]=Math.floor(128+128*T[i]);
  }
  return res;
}

function NormaliserSon(T) {
  return NormalizeAudio(T);
}

function flattenArray(channelBuffer, recordingLength) {
  var result = new Float32Array(recordingLength);
  var offset = 0;
  for (var i = 0; i < channelBuffer.length; i++) {
    var buffer = channelBuffer[i];
    result.set(buffer, offset);
    offset += buffer.length;
  }
  return result;
}

function interleave(leftChannel, rightChannel) {
  var length = leftChannel.length + rightChannel.length;
  var result = new Float32Array(length);
  var inputIndex = 0;
  for (var index = 0; index < length;) {
    result[index++] = leftChannel[inputIndex];
    result[index++] = rightChannel[inputIndex];
    inputIndex++;
  }
  return result;
}

function writeUTFBytes(view, offset, string) {
  for (var i = 0; i < string.length; i++) {
    view.setUint8(offset + i, string.charCodeAt(i));
  }
}


function CreerSon16bits(T, sampleRate) {
  var blob = null;
  // we flat the left and right channels down
  // Float32Array[] => Float32Array
  var leftBuffer = T;
  var rightBuffer = T;
  // we interleave both channels together
  // [left[0],right[0],left[1],right[1],...]
  var interleaved = interleave(leftBuffer, rightBuffer);
  // we create our wav file
  var buffer = new ArrayBuffer(44 + interleaved.length * 2);
  var view = new DataView(buffer);
  // RIFF chunk descriptor
  writeUTFBytes(view, 0, 'RIFF');
  view.setUint32(4, 44 + interleaved.length * 2, true);
  writeUTFBytes(view, 8, 'WAVE');
  // FMT sub-chunk
  writeUTFBytes(view, 12, 'fmt ');
  view.setUint32(16, 16, true); // chunkSize
  view.setUint16(20, 1, true); // wFormatTag
  view.setUint16(22, 2, true); // wChannels: stereo (2 channels)
  view.setUint32(24, sampleRate, true); // dwSamplesPerSec
  view.setUint32(28, sampleRate * 4, true); // dwAvgBytesPerSec
  view.setUint16(32, 4, true); // wBlockAlign
  view.setUint16(34, 16, true); // wBitsPerSample
  // data sub-chunk
  writeUTFBytes(view, 36, 'data');
  view.setUint32(40, interleaved.length * 2, true);
  // write the PCM samples
  var index = 44;
  var volume = 1;
  for (var i = 0; i < interleaved.length; i++) {
    view.setInt16(index, interleaved[i] * (0x7FFF * volume), true);
    index += 2;
  }
  // our final blob
  blob = new Blob([view], {
    type: 'audio/wav'
  });

  var url = window.URL.createObjectURL(blob);
  var audio = new Audio(url);
  return audio;
}


function ExportSon16bits(T, sampleRate) {
  var blob = null;
  // we flat the left and right channels down
  // Float32Array[] => Float32Array
  var leftBuffer = T;
  var rightBuffer = T;
  // we interleave both channels together
  // [left[0],right[0],left[1],right[1],...]
  var interleaved = interleave(leftBuffer, rightBuffer);
  // we create our wav file
  var buffer = new ArrayBuffer(44 + interleaved.length * 2);
  var view = new DataView(buffer);
  // RIFF chunk descriptor
  writeUTFBytes(view, 0, 'RIFF');
  view.setUint32(4, 44 + interleaved.length * 2, true);
  writeUTFBytes(view, 8, 'WAVE');
  // FMT sub-chunk
  writeUTFBytes(view, 12, 'fmt ');
  view.setUint32(16, 16, true); // chunkSize
  view.setUint16(20, 1, true); // wFormatTag
  view.setUint16(22, 2, true); // wChannels: stereo (2 channels)
  view.setUint32(24, sampleRate, true); // dwSamplesPerSec
  view.setUint32(28, sampleRate * 4, true); // dwAvgBytesPerSec
  view.setUint16(32, 4, true); // wBlockAlign
  view.setUint16(34, 16, true); // wBitsPerSample
  // data sub-chunk
  writeUTFBytes(view, 36, 'data');
  view.setUint32(40, interleaved.length * 2, true);
  // write the PCM samples
  var index = 44;
  var volume = 1;
  for (var i = 0; i < interleaved.length; i++) {
    view.setInt16(index, interleaved[i] * (0x7FFF * volume), true);
    index += 2;
  }
  // our final blob
  blob = new Blob([view], {
    type: 'audio/wav'
  });

  var url = window.URL.createObjectURL(blob);
  window.open(url);
}





// Gestion WebCam et micro
function getImagePoint(T, x, y) {
  return [T.data[4 * (T.width * y + x)], T.data[4 * (T.width * y + x) + 1], T.data[4 * (T.width * y + x) + 2], T.data[4 * (T.width * y + x) + 3]];
}


function setImagePoint(T, x, y, v) {
  var transp=255;
  if (Taille(v) > 3) transp = v[3];
  T.data[4 * (T.width * y + x)] = v[0];
  T.data[4 * (T.width * y + x) + 1] = v[1];
  T.data[4 * (T.width * y + x) + 2] = v[2];
  T.data[4 * (T.width * y + x) + 3] = transp;
}

var ForWebcamvideo = document.createElement("video");
ForWebcamvideo.setAttribute("width", 640);
ForWebcamvideo.setAttribute("height", 480);

var ForWebcamcanvas = document.createElement("canvas");
ForWebcamcanvas.setAttribute("width", 640);
ForWebcamcanvas.setAttribute("height", 480);
var ForWebcamcontext = ForWebcamcanvas.getContext('2d');

function ForWebcamProcess(f) {
  if (ForWebcamvideo.paused || ForWebcamvideo.ended) {
    return;
  }
  ForWebcamcontext.drawImage(ForWebcamvideo, 0, 0, 640, 480);
  var frame = ForWebcamcontext.getImageData(0, 0, 640, 480);
  f(frame);
  setTimeout(function() {
    ForWebcamProcess(f);
  }, 0);
}

function StartWebcam(f) {
  navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mediaDevices.GetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;
  navigator.getUserMedia({
    video: true
  }, function(stream) {
    ForWebcamvideo.srcObject = stream;
    ForWebcamvideo.play();
    ForWebcamProcess(f);
  }, function(e) {
    console.error(e);
  });
}

function StopWebcam() {
  ForWebcamvideo.pause();
}



var ForMicrorecorder = null;
var ForMicromediaStream = null;
var ForMicrosampleRate = 44100;
var ForMicrocontext = null;

function StartMicrophone(f) {
  navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mediaDevices.GetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;
  navigator.getUserMedia({
    audio: true
  }, function(e) {
    window.AudioContext = window.AudioContext || window.webkitAudioContext;
    ForMicrocontext = new AudioContext();
    ForMicromediaStream = ForMicrocontext.createMediaStreamSource(e);
    var bufferSize = 2048;
    var numberOfInputChannels = 2;
    var numberOfOutputChannels = 2;
    if (ForMicrocontext.createScriptProcessor) {
      ForMicrorecorder = ForMicrocontext.createScriptProcessor(bufferSize, numberOfInputChannels, numberOfOutputChannels);
    } else {
      ForMicrorecorder = ForMicrocontext.createJavaScriptNode(bufferSize, numberOfInputChannels, numberOfOutputChannels);
    }
    ForMicrorecorder.onaudioprocess = function(e) {
      f(e.inputBuffer.getChannelData(0));
    };
    ForMicromediaStream.connect(ForMicrorecorder);
    ForMicrorecorder.connect(ForMicrocontext.destination);
  }, function(e) {
    console.error(e);
  });
}

function StopMicrophone() {
  ForMicrorecorder.disconnect(ForMicrocontext.destination);
  ForMicromediaStream.disconnect(ForMicrorecorder);
}

/*
// Exemple d'utilisation

StartMicrophone(function (T) {T[0]=-1; T[1]=1; AfficherCourbe(T,false,false,'red','',1);});

function MouseClick(x,y) {
  StopMicrophone();
}

*/


//-->
//    <!--

function resetVariables() {
  for (builtin_p in this) {
    if ((typeof(eval(builtin_p)) == 'number') || (typeof(eval(builtin_p)) == 'string')) {
      if (">>>|name|scrollX|scrollY|status|defaultStatus|innerWidth|innerHeight|outerWidth|outerHeight|screenX|screenY|pageXOffset|pageYOffset|scrollMaxX|scrollMaxY|length|builtin_courant|builtin_codejs|builtin_wait|builtin_p|".lastIndexOf('|' + builtin_p + '|') <= 0) {
        //		    		Afficher('reset '+p+' : '+typeof(eval(p))+' = '+eval(builtin_p));
        eval(builtin_p + '=undefined');
        //		    		Afficher('reset '+p+' : '+typeof(eval(p))+' = '+eval(builtin_p));
      }
    }
  }
}

var size_canvas_x;
var size_canvas_y;

function Init() {
  GEBID('sortie').disabled = true;
  size_canvas_x = 800;
  size_canvas_y = 600;
  // GEBID('mycanvas').onclick=builtincapturemouse;
  GEBID('mycanvas').ontouchstart=builtinMouseDown;
  GEBID('mycanvas').ontouchmove=builtincapturetouch;
  GEBID('mycanvas').ontouchend=builtinMouseUp;
  GEBID('mycanvas').onmousedown=builtinMouseDown;
  GEBID('mycanvas').onmouseup=builtinMouseUp;
  GEBID('mycanvas').onmousemove=builtinMouseMoveEvent;
//  document.onkeypress=function (k) {/*for(p in k) Ecrire(p);*/ if (k['charCode'] == k['keyCode']) Keypressed(k['charCode']); else Keypressed(k['charCode']+1000*k['keyCode']);};
document.onkeydown = function(k) {
  if (!k) k = window.event;
  Keypressed(k['keyCode']);
  var c = k.keyCode;
  if (builtin_keydowntime[c] == undefined) {
    builtin_keydowntime[c] = new Date().getTime();
    Keydown(c);
  }
  if (k['keyCode'] >= 37 && k['keyCode'] <= 40) k.preventDefault();
};
document.onkeyup = function(e) {
  if (!e) e = window.event;
  var c = e.keyCode;
  Keyup(c, ((new Date().getTime()) - builtin_keydowntime[c]));
  builtin_keydowntime[c] = undefined;
};

}

var builtin_keydowntime = [];

function Keydown(c) {
}

function Keyup(c) {
}


var builtin_allvariables = '';

function getAllVariablesInMemory() {
  var i = 0;
  for (var p in window) {
    if ((typeof(eval("window." + p)) == "number") || (typeof(eval("window." + p)) == "boolean") || (typeof(eval("window." + p)) == "string")) {
      builtin_allvariables.push(p);
    }
  }
}

var builtin_wait = false;
var builtin_courant = '';
var builtin_code = Array();
var builtin_codejs;
var builtin_verrou=-1;

function Analyseur(ch) {
  var nbinstructions = 0;
  var instructions = Array();
  var deb = 0;
  var current = '';
  var parent = 0;
  var accolade = 0;
  var ligne = 0;
  var motcle = '';
  for (i = 0; i < ch.length; i++) {
    c = ch.charAt(i);
    if (c == '(') parent++;
    if (c == ')') parent--;
    if (c == '{') accolade++;
    if (c == '}') {
      accolade--;
    }
    if ("aabcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".lastIndexOf(c) > 0) motcle = motcle + c;
    else {
      if (motcle.length > 0) alert(motcle);
      motcle = '';
    }
    if (c == '\n') {
      ligne++;
      if (current == '') c = '';
      else c = '\n';
    }

    if ((c.charAt(c.length - 1) == ";") && (parent + accolade == 0)) {
      current = current + c + '\n';
      //				alert(current);
      instructions[nbinstructions] = current;
      nbinstructions++;
      current = '';
    } else {
      current = current + c;
    }
  }
  instructions[nbinstructions] = current;
  return instructions;
}

var Inspector_flag = false;
var Variables_a_inspecter = '';
var contenu_memoire = '';

function Inspector_on(ch) {
  Inspector_flag = true;
  Variables_a_inspecter = ch;
}

function Inspector_off() {
  Inspector_flag = false;
}

function Inspection() {
  alert('Execution trace\n--------------------------\n' + contenu_memoire);
}

function Inspecte(variables, obj) {
  var toutesvariables_du_stop = variables.split(',');
  var afficher_du_stop = '';
  var i_du_stop;
  var valeur_du_stop = '';
  for (i_du_stop = 0; i_du_stop < toutesvariables_du_stop.length; i_du_stop++) {
    try {
      valeur_du_stop = globaleval('obj.' + toutesvariables_du_stop[i_du_stop]);
      //valeur_du_stop=eval(toutesvariables_du_stop[i_du_stop]);
    } catch (e) {
      valeur_du_stop = '?';
    } finally {}
    if ('++undefined'.lastIndexOf(valeur_du_stop) > 0) valeur_du_stop = '?';
    afficher_du_stop = afficher_du_stop + toutesvariables_du_stop[i_du_stop] + '=' + valeur_du_stop + '\t';
  }
  contenu_memoire += afficher_du_stop + '\n';
}

function find_reverse(ch,i,car) {
	while ((i>0) && (ch[i] != car)) i--;
	return i;
}

function Evaluer() {
  //		resetVariables();
  // Effacer l'écran
  var maxsauvegardes=20;
  Initialiser();
  BeginningEvent=true;
  contenu_memoire = '';
  Variables_a_inspecter = GEBID('builtin_inspector').value;

  // Pour CodeMirror
  GEBID('lecode').value = editor.getValue();
  // Fin
  var tabcode = GEBID('lecode').value;
  // début sauvegarde automatique des 10 dernières exécutions
  if (DropboxSync && FileExists('Sauvegardes/save'+maxsauvegardes+'.js')) {
    client.filesDelete({
      path: '/' + 'Sauvegardes/save'+maxsauvegardes+'.js'
    });
  }
  for(var i=maxsauvegardes-1; i>=0; i--) {
  	if (FileExists('Sauvegardes/save'+i+'.js')) {
// Il faut juste renommer ici.....
  if (DropboxSync && FileExists('Sauvegardes/save'+maxsauvegardes+'.js')) {
    client.filesMove({from_path: '/'+'Sauvegardes/save'+(i)+'.js', to_path: '/'+'Sauvegardes/save'+(i+1)+'.js'});
  }
      window.localStorage['Sauvegardes/save'+(i+1)+'.js']=window.localStorage['Sauvegardes/save'+i+'.js'];
  	}
  }
  writeFile('Sauvegardes/save0.js',tabcode);
  // Fin

  if (Variables_a_inspecter != '') {
    var ch = tabcode;
    tabcode = '';
    var nbparenthesis = 0;
    var toutesvariables_du_stop = Variables_a_inspecter.split(',');
    var afficher_du_stop = '';
    var i_du_stop;
    var valeur_du_stop = '';
    contenu_memoire += afficher_du_stop + '\n';
    try {
      valeur_du_stop = globaleval('window.' + toutesvariables_du_stop[i_du_stop]);
    } catch (e) {
      valeur_du_stop = '?';
    } finally {}
    var k=1;
    for (var i = 0; i < ch.length; i++) {
      if ((ch.charAt(i) == ';') && (nbparenthesis == 0)) {
        tabcode += ';'; revi=find_reverse(ch,i,'\n'); if ((i-revi)>20) chaineaaffichermem=ch.substr(revi+1,10)+''+ ch.substr(i-10,10); else chaineaaffichermem=ch.substring(revi+1,i); tabcode+='contenu_memoire+="'+(k++)+') ['+chaineaaffichermem+'] => ";';
        for (i_du_stop = 0; i_du_stop < toutesvariables_du_stop.length; i_du_stop++) {
          tabcode += 'try {contenu_memoire+="' + toutesvariables_du_stop[i_du_stop] + '="+((typeof(eval("' + toutesvariables_du_stop[i_du_stop] + '")) == "string")?"\'"+eval("' + toutesvariables_du_stop[i_du_stop] + '")+"\'":eval("' + toutesvariables_du_stop[i_du_stop] + '")) +", ";} catch (e) {contenu_memoire+="' + toutesvariables_du_stop[i_du_stop] + '=undefined, ";} finally {}; ';
        }
        tabcode += 'contenu_memoire+="\\n"; ';
      } else tabcode += ch.charAt(i);
      if (ch.charAt(i) == '(') {
        nbparenthesis++;
      }
      if (ch.charAt(i) == ')') {
        nbparenthesis--;
      }
    }
  }
  //		alert(tabcode);
  //		builtin_code=tabcode.value.split("\n");
  if (builtin_allvariables == '') {
    // si premi&egrave;re ex&eacute;cution m&eacute;moirise les variables de base
    var ch = '|';
	var p;
    for (p in window) {
      var letype = ""
      try {
        letype = typeof(eval('window.' + p));
      } catch (e) {
        letype = "NONE";
      } finally {}
      //  Ecrire(p + ' -> ' + letype);
      if ((letype == "string") || (letype == "boolean") || (letype == "number")) {
        ch = ch + p + '|';
      }
    }
    builtin_allvariables = ch;
  } else {
    // sinon efface les variables cr&eacute;&eacute;es par la pr&eacute;c&eacute;dente ex&eacute;cution
    var supprimees = "";
    var p;
    for (p in window) {
      var letype = ""
      try {
        letype = typeof(eval('window["' + p+'"]'));
      } catch (e) {
        letype = "NONE";
      } finally {}
      //  Ecrire(p + ' -> ' + letype);
      if ((letype == "string") || (letype == "boolean") || (letype == "number")) {
        if (builtin_allvariables.indexOf('|' + p + '|') < 0) {
          //eval('window.' + p + '= "undefined";');
          Ecrire("Suppression de ("+p+")");
          eval('delete window["' + p + '"];');
          //supprimees+=p+'\n';
        }
      }
    }

  }


  //globaleval(GEBID('builtin_codejs').value);
  builtin_courant = '';
  GEBID('sortie').value = builtin_courant;
  var submemory=[];
  with (submemory) globaleval(tabcode);

  if (Variables_a_inspecter != '') {
    Inspection();
  }

  //alert('VAR\n'+supprimees);
}

function Evaluer_debug() {
  Initialiser();
  BeginningEvent=true;
  contenu_memoire = '';

  // Pour CodeMirror
  document.getElementById('lecode').value = editor.getValue();
  // Fin
  var tabcode = GEBID('lecode').value;

  builtin_courant = '';
  document.getElementById('sortie').value = builtin_courant;
  globaleval(tabcode);
}

function Executer(ligne, temporisation) {
  if (ligne < builtin_code.length) {
    lecode = "";
    flag = false;
    for (i = 0; i < builtin_code.length; i++) {
      if (flag) lecode = lecode + '';
      flag = true;
      if (i == ligne) symbole = ">>>> ";
      else symbole = "";
      lecode = lecode + symbole + builtin_code[i];
    }
    document.getElementById('lecode').value = lecode;
    try {
      globaleval(builtin_code[ligne]);
    } catch (err) {
      alert("Error of type : " + err.message);
    } finally {
      setTimeout('Executer(' + (ligne + 1) + ',' + temporisation + ')', temporisation);
    }
  } else {
    lecode = "";
    flag = false;
    for (i = 0; i < builtin_code.length; i++) {
      if (flag) lecode = lecode;
      flag = true;
      lecode = lecode + builtin_code[i];
    }
    document.getElementById('lecode').value = lecode;
  }
}

function Afficher() {
  var ch='';
  for(var i=0; i<Afficher.arguments.length; i++) ch+=Afficher.arguments[i];
  builtin_courant = builtin_courant + 'FONCTION OBSOLETE, UTILISEZ Ecrire A LA PLACE : '+ch + "\n";
  document.getElementById('sortie').value = builtin_courant;
}

function EffacerEcran() {
  builtin_courant = "";
  GEBID('sortie').value = builtin_courant;
}


function Ecrire() {
  var ch='';
  for(var i=0; i<Ecrire.arguments.length; i++) ch+=Ecrire.arguments[i];
  builtin_courant = builtin_courant + ch + "\n";
  document.getElementById('sortie').value = builtin_courant;
  console.clear();
  console.log(builtin_courant);
}

// Fonctions accessibilité

function Parle(txt) {
 var discours = new SpeechSynthesisUtterance(txt);
 discours.voice = builtin_voice;
 window.speechSynthesis.speak(discours);
}
var builtin_language;
var builtin_voice;

function getVoiceFromLanguage(lang) {
	var voices=window.speechSynthesis.getVoices();
	for(var i = 0 ; i<voices.length; i++) if (voices[i].lang==lang) {return voices[i];}
    return voices[0];
}

function setLanguage(lang) {
  builtin_language=lang;
  builtin_voice=getVoiceFromLanguage(lang);
}

setLanguage('fr-FR');

function EcrireAudio(txt) {
  Parle(txt);
  Ecrire(txt);
}

function SaisieAudio(txt) {
  Parle(txt);
  return Saisie(txt);
}

var SpeechRecognition = this.SpeechRecognition || this.webkitSpeechRecognition;
try {
var builtin_recognition = new SpeechRecognition();
builtin_recognition.continuous = false;
} catch(e) {
var builtin_recognition = [];
}
var builtin_recognitionon = false;

function StartSpeechRecognition(callback) {
  builtin_recognition.lang = builtin_language;
  builtin_recognition.onresult = function(event) {
    if (builtin_recognitionon) {
      for (i = event.resultIndex; i < event.results.length; i++) {
        console.log("J'ai compris : " + event.results[i][0].transcript);
        callback(event.results[i][0].transcript);
      }
      builtin_recognition.stop();
    }
  };
  builtin_recognition.onend = function(event) {
    if (builtin_recognitionon) {
      StartSpeechRecognition(callback);
    }
  };
  builtin_recognitionon = true;
  builtin_recognition.start();
}

function StopSpeechRecognition() {
  builtin_recognitionon = false;
  builtin_recognition.stop();
}

function Afficher_srl() {
  var ch='';
  for(var i=0; i<Afficher_srl.arguments.length; i++) ch+=Afficher_srl.arguments[i];
  builtin_courant = builtin_courant + ch;
  document.getElementById('sortie').value = builtin_courant;
}

var enablePrettyPrompt=false;

function setPrettyPrompt() {
	enablePrettyPrompt=true;
}

function unsetPrettyPrompt() {
	enablePrettyPrompt=false;
}

function myPrompt(message) {
  window.builtin_nbprompt++;
  var r=0;
  if (enablePrettyPrompt && typeof(window.showModalDialog)=='function' && (window.builtin_nbprompt<11)
  && (! (navigator.userAgent.indexOf('Android')>0))
  && (! (navigator.userAgent.indexOf('KHTML')>0))) {
    message=message.replace(/\n/g,'<br/>');
  	r = window.showModalDialog('data:text/html;base64,PGh0bWw+PGhlYWQ+PG1ldGEgY2hhcnNldD0iVVRGLTgiPjx0aXRsZT5GZW4mZWNpcmM7dHJlIGRlIHNhaXNpZSBBbGdvU2NyaXB0PC90aXRsZT48L2hlYWQ+Cjxib2R5IHN0eWxlPSJmb250LWZhbWlseTogaGVsdmV0aWNhLCBzYW5zLXNlcmlmLCBhcmlhbDsgZm9udC1zaXplOiAxLjVlbTsgd2lkdGg6IDEwMCU7IGhlaWdodDogYXV0bzogbWFyZ2luOiBhdXRvOyB0ZXh0LWFsaWduOiBjZW50ZXI7IG92ZXJmbG93LXg6IGhpZGRlbjsgb3ZlcmZsb3cteTogYXV0bzsgYmFja2dyb3VuZC1jb2xvcjogb3JhbmdlOyBjb2xvcjogYmxhY2s7IiBvbmxvYWQ9ImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb28nKS5mb2N1cygpOyIgb251bmxvYWQ9IndpbmRvdy5yZXR1cm5WYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb28nKS52YWx1ZTsiPgo8ZGl2IHN0eWxlPSJwb3NpdGlvbjogZml4ZWQ7IHRvcDowcHg7IGxlZnQ6IDBweDsgaGVpZ2h0OiA3MCU7IHdpZHRoOiAxMDAlOyB0ZXh0LWFsaWduOiBjZW50ZXI7IG1hcmdpbjogYXV0bzsiPgo8c2NyaXB0Pgp3aW5kb3cucmVzaXplVG8oMzAwLDI1MCk7CmRvY3VtZW50LndyaXRlKHdpbmRvdy5kaWFsb2dBcmd1bWVudHMpOwo8L3NjcmlwdD4KPGJyLz4KPGJyLz4KPC9kaXY+CjxkaXYgc3R5bGU9InBvc2l0aW9uOiBmaXhlZDsgYm90dG9tOiAwcHg7ICBoZWlnaHQ6IDgwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPgo8aW5wdXQgc3R5bGU9ImZvbnQtZmFtaWx5OiBoZWx2ZXRpY2EsIHNhbnMtc2VyaWYsIGFyaWFsOyBmb250LXNpemU6IDEuNWVtOyB3aWR0aDogOTAlOyBoZWlnaHQ6IDQwcHg7IiBpZD0iZm9vIiB0eXBlPSJ0ZXh0IiB2YWx1ZT0iIiBvbmNoYW5nZT0id2luZG93LnJldHVyblZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbycpLnZhbHVlOyB3aW5kb3cuY2xvc2UoKTsiPjxici8+CjxpbnB1dCBzdHlsZT0iZm9udC1mYW1pbHk6IGhlbHZldGljYSwgc2Fucy1zZXJpZiwgYXJpYWw7IGZvbnQtc2l6ZTogMS41ZW07IiB0eXBlPSJidXR0b24iIHZhbHVlPSJPSyIgb25jbGljaz0id2luZG93LnJldHVyblZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbycpLnZhbHVlOyB3aW5kb3cuY2xvc2UoKTsiPgo8L2Rpdj4KPC9ib2R5Pgo8L2h0bWw+', message, 'dialogwidth:50px; dialogLeft:'+Math.floor(window.innerWidth/2-150)+'px; dialogtop:'+Math.floor(window.innerHeight/2-125)+'px; dialogheight:50px; resizable:yes; status:no;');
  } else {
    r = prompt(message);
  }
  return r;
}

// the previous trick does not work with several navigators or media

if (navigator.userAgent.indexOf('KHTML') >0) unsetPrettyPrompt();
if (navigator.userAgent.indexOf('Android') >0) unsetPrettyPrompt();

function SaisieEntier() {
  var i;
  var test;
  var nb;
  var ch;
  do {
    if (SaisieEntier.arguments.length > 0) ch = SaisieEntier.arguments[0] + '\n';
    else ch = '';
    nb = myPrompt(ch+'\nPlease enter an Integer');
    test = true;
    for (i = 0; i < nb.length; i++)
    test = test && ("0-0123456789".lastIndexOf(nb.charAt(i)) > 0);
  } while (!test);
  return nb * 1;
}

function SaisieReel() {
  var i;
  var test;
  var nbpoint;
  var nb;
  var ch;
  do {
    if (SaisieReel.arguments.length > 0) ch = SaisieReel.arguments[0] + '\n';
    else ch = '';
    nb = myPrompt(ch+'\nPlease enter a Real');
    test = true;
    nbpoint = 0;
/*			for (i=0; i<nb.length; i++) {
				test=test && ("0-.0123456789".lastIndexOf(nb.charAt(i)) > 0);
				if (nb.charAt(i) == '.') nbpoint++;
			}
			test=test && (nbpoint < 2);
*/
  } while (!test);
  return nb * 1;
}

function SaisieChaine() {
  var ch;
  if (SaisieChaine.arguments.length > 0) ch = SaisieChaine.arguments[0] + '\n';
  else ch = '';
  return myPrompt(ch+'\nPlease enter a String');
}

function Saisie() {
  var ch;
  if (Saisie.arguments.length > 0) ch = Saisie.arguments[0] + '\n';
  else ch = '';
  return myPrompt(ch+'\nPlease enter a String');
}

function enReel(nb) {
  return 1 * nb;
}

function enEntier(nb) {
  return 1 * nb;

}

function enChaine(nb) {
  return nb + '';
}

function Stop() {
  alert('Break point');
}

function Stop(variables) {
  var toutesvariables_du_stop = variables.split(',');
  var afficher_du_stop = 'Break point\n';
  var i_du_stop;
  var valeur_du_stop = '';
  for (i_du_stop = 0; i_du_stop < toutesvariables_du_stop.length; i_du_stop++) {
    try {
      valeur_du_stop = globaleval('window.' + toutesvariables_du_stop[i_du_stop]);
    } catch (e) {
      valeur_du_stop = '?';
    } finally {}
    if ('++undefined'.lastIndexOf(valeur_du_stop) > 0) valeur_du_stop = '?';
    afficher_du_stop = afficher_du_stop + toutesvariables_du_stop[i_du_stop] + '=' + valeur_du_stop + '\n';
  }
  alert(afficher_du_stop);
}

function builtin_waitOn() {
  this.builtin_wait = true;
  setTimeout('builtin_waitOff()', 500);
}

function builtin_waitOff() {
  this.builtin_wait = false;
}

function Help() {
  GEBID('Aide').style.visibility = 'visible';
  // setTimeout("GEBID('Aide').style.visibility='hidden';",10000);
}

var builtin_fg = false;

function FenetreGraphique() {
  if (builtin_fg) {
    CacheGraphique();
    GEBID('bouton_fg').style.backgroundColor = 'rgb(230,230,230)';
    GEBID('bouton_fg').style.color = 'black';
    builtin_fg = false;
  } else {
    AfficheGraphique();
    GEBID('bouton_fg').style.backgroundColor = 'red';
    GEBID('bouton_fg').style.color = 'black';
    builtin_fg = true;
  }
}

// Tutoriel
var positionTUTOX = 0;
var positionTUTOY = 0;

function MoveTuto(x, y) {
  positionTUTOX = x;
  positionTUTOY = y;
  GEBID('divtuto').style.left = x + 'px';
  GEBID('divtuto').style.top = y + 'px';
}

function Deplacement(debut, fin, t, nbsteps) {
  return fin * t / nbsteps + debut * (1 - t / nbsteps);
}

function rgb(r, v, b) {
  return 'rgb(' + (r >> 0) + ',' + (v >> 0) + ',' + (b >> 0) + ')';
}

function rgba(r, v, b, a) {
  return 'rgba(' + (r >> 0) + ',' + (v >> 0) + ',' + (b >> 0) + ',' + a+ ')';
}

function MonInnerHTML(b, ch) {
  b.innerHTML = ch;
}

function MonInnerHTML_value(b, ch) {
  b.value = ch;
}

function HTMLoutput(ch) {
  //MonInnerHTML(GEBID('frameweboutput').contentDocument,ch);
  var maframe = GEBID('frameweboutput').contentDocument
  maframe.open();
  maframe.writeln(ch);
  maframe.close();
}


// Processing like functions
var mouseX=0,mouseY=0,clearTimeoutEvent=0,FrameRate=1000;

function builtinSetMouseXY(e) {
  mouseX=e.layerX*(maxviewport_x - minviewport_x)/size_canvas_x+minviewport_x;
  mouseY=e.layerY*(maxviewport_y - minviewport_y)/size_canvas_y+minviewport_y;
}

window.onmousemove=builtinSetMouseXY;

function setup() {}

function draw() {
  //Initialiser();
  //RectanglePlein(mouseX,mouseY,10,10,'red');
}

function MouseClick(x,y) {
//  Texte(x,y,'Bonjour','black');
//  Texte(mouseX,mouseY,'rien','blue');
}


var BeginningEvent=true;
var BeginningTime;
function Loop(ms) {
  if (typeof(clearTimeoutEvent) != 'undefined') clearTimeout(clearTimeoutEvent);
  if (BeginningEvent) {setup(); BeginningTime=new Date(); BeginningEvent=false;}

  draw();

  if (ms>0) {
    var time=new Date();
    var ecoule=(time.getSeconds()-BeginningTime.getSeconds())*1000+(time.getMilliseconds()-BeginningTime.getMilliseconds());
  } else {ecoule=ms-1;}
  if (ecoule<ms) {clearTimeoutEvent=setTimeout('Loop('+ms+')',1000/FrameRate);} else BeginningEvent=true;
}

function noLoop() {
    if (typeof(clearTimeoutEvent) != 'undefined') clearTimeout(clearTimeoutEvent);
}

var fenetre_courante;
var builtin_fenetregraphique = 2;

function getTransformProperty(element) {
    var properties = [
        'transform',
        'WebkitTransform',
        'msTransform',
        'MozTransform',
        'OTransform'
    ];
    var p;
    while (p = properties.shift()) {
        if (typeof element.style[p] != 'undefined') {
            return p;
        }
    }
    return false;
}

function RetailleFenetre(fen,viz,zindex,echelleX,echelleY) {
	var leselect = GEBID('titre_onglet');
	if (leselect) {
	var tr=getTransformProperty(GEBID(leselect.options[fen].value));
	if (tr) {
		GEBID(leselect.options[fen].value).style.visibility = viz;
		GEBID(leselect.options[fen].value).style.zIndex = zindex;
		GEBID(leselect.options[fen].value).style[tr] = 'scaleX('+echelleX+') scaleY('+echelleY+')';
	}
	}
}

function MontreFenetre(nb) {
  var leselect = GEBID('titre_onglet');
  if (leselect) {
  if ((fenetre_courante + nb >= 0) && (fenetre_courante + nb < Taille(leselect.options))) {
    GEBID(leselect.options[fenetre_courante].value).style.visibility = 'hidden';
//    GEBID(leselect.options[fenetre_courante].value).style.display = 'none';
    GEBID(leselect.options[fenetre_courante].value).style.zIndex = -1;
    if (leselect.options[fenetre_courante].value == 'lecode') {
    	// Même traitement pour l'éditeur
	    editor.getTextArea().style.visibility = 'hidden';
    	editor.getTextArea().style.zIndex = -1;
    }


    if (fenetre_courante == leselect.selectedIndex) {
      fenetre_courante += nb;
      leselect.selectedIndex = fenetre_courante;
    } else
    fenetre_courante = leselect.selectedIndex;
    GEBID(leselect.options[fenetre_courante].value).style.visibility = 'visible';
//	if (fenetre_courante == 3) GEBID('MonTexte').focus();
	if (leselect.value == 'GestionFichiers') UpdateFS();

	if (builtin_verrou >=0) {
		if (builtin_verrou == fenetre_courante) {
			RetailleFenetre(builtin_verrou,'visible',100,1,1);
		} else {
			RetailleFenetre(builtin_verrou,'visible',200,0.5,0.5);
		}
	}

    if (leselect.value == 'lecode') {
    	// Même traitement pour l'éditeur
	    editor.getTextArea().style.visibility = 'visible';
    	editor.getTextArea().style.zIndex = 101;
    }

    GEBID(leselect.options[fenetre_courante].value).style.zIndex = 100;
    window.scrollTo(0, 1);
  }
  }
}

function TailleBoite(b, x, y) {
if (b) {
  b.style.width = x + 'px';
  if (y != 'auto') b.style.height = y + 'px'; else b.style.height = y;
  }
}

function AdapterTaille(x, y) {
  TailleBoite(GEBID('sortie'), x, y - 30);
  TailleBoite(GEBID('lecode'), x-10, 'auto');
  TailleBoite(editor.getTextArea(), x, 'auto');
  TailleBoite(GEBID('credits'), x, 'auto');
  TailleBoite(GEBID('GestionFichiers'), x, 'auto');
  TailleBoite(GEBID('resizecode'), x-10, y - 30);

  editor.getWrapperElement().style.position = 'absolute';
  editor.getWrapperElement().style.width = (x-10) + 'px';
  editor.getWrapperElement().style.height = (y - 30) + 'px';

  TailleBoite(GEBID('Aide'), x, y - 30);
  TailleBoite(GEBID('divtuto'), x, y - 30);
  TailleBoite(GEBID('mycanvas'), x, y - 30);
  size_canvas_x = x;
  size_canvas_y = y - 30;
  GEBID('mycanvas').width = x;
  GEBID('mycanvas').height = (y - 30);
  TailleBoite(GEBID('SaisieTexte'), x, 'auto');
  TailleBoite(GEBID('MonTexte'), x, y - 30);
  TailleBoite(GEBID('weboutput'), x, y-30);
  if (x <= 419) {
    TailleBoite(GEBID('boutons'), x, 61);
    editor.getWrapperElement().style.top = '60px';
    GEBID('sortie').style.top = '60px';
    GEBID('GestionFichiers').style.top = '60px';
    GEBID('lecode').style.top = '60px';
	editor.getTextArea().style.top = '60px';
    GEBID('Aide').style.top = '60px';
    GEBID('credits').style.top = '60px';
    GEBID('divtuto').style.top = '60px';
    GEBID('mycanvas').style.top = '60px';
    GEBID('SaisieTexte').style.top = '60px';
    GEBID('weboutput').style.top = '60px';
  } else {
    TailleBoite(GEBID('boutons'), x, 31);
    editor.getWrapperElement().style.top = '30px';
    GEBID('sortie').style.top = '30px';
    GEBID('lecode').style.top = '30px';
	editor.getTextArea().style.top = '30px';
    GEBID('GestionFichiers').style.top = '30px';
    GEBID('Aide').style.top = '30px';
    GEBID('credits').style.top = '30px';
    GEBID('divtuto').style.top = '30px';
    GEBID('mycanvas').style.top = '30px';
    GEBID('SaisieTexte').style.top = '30px';
    GEBID('weboutput').style.top = '30px';
  }

}

function AdapterTaille2(x, y) {
  TailleBoite(GEBID('sortie'), x, y);
  TailleBoite(GEBID('mycanvas'), x, y);
  size_canvas_x = x;
  size_canvas_y = y;
  GEBID('mycanvas').width = x;
  GEBID('mycanvas').height = y;
}



function InitImages() {
	GEBID('MemExec').src=GEBID('icoExec').src;
	GEBID('MemIndent').src=GEBID('icoIndent').src;
	GEBID('MemResize').src=GEBID('icoResize').src;
	GEBID('MemSave').src=GEBID('icoSave').src;
	GEBID('MemLoad').src=GEBID('icoLoad').src;
	}

// Un début pour un bel affichage de la liste des fichiers.

function FS(_name) {
  this.name = _name;
  this.content = new Array();

  this.CreateFS=function (tab) {
    var MonFS = [];
    for (var i = 0; i < tab.length; i++) {
      var p = tab[i];
      var pos = (' ' + p).indexOf('/');
      if (pos > 0) {
        dirname = p.substr(0, pos - 1);
        basename = p.substr(pos);
        if (MonFS[dirname] == undefined) MonFS[dirname] = [];
        MonFS[dirname].push(basename);
      } else this.content.push(p);
    }
    for (p in MonFS) {
      var f = new FS(p);
      f.CreateFS(MonFS[p]);
      this.content.push(f);
    }
  }

  this.Print=function (dec,dec2) {
    var res = '';
    for (p in this.content) {
      if (typeof(this.content[p]) == 'string') {
        res += dec2 + this.content[p] + '\n';
      } else {
      res+=this.content[p].name+'\n'+this.content[p].Print(dec+'   ',dec2+this.content[p].name+'/');
      }
    }
    return res;
  }
  this.PrintPretty=function (dec,dec2) {
    var res = '';
    for (p in this.content) {
      if (typeof(this.content[p]) == 'string') {
        if (this.content[p].length>0) {res += '<option value="'+dec2 + this.content[p]+'">'+dec+this.content[p]+'</option>\n';}
      } else {
      res+='<optgroup label="'+dec+this.content[p].name+'">\n'+this.content[p].PrintPretty(dec+'&nbsp;&nbsp;',dec2+this.content[p].name+'/')+'</optgroup>';
      }
    }
    return res+'';
  }
}

function UpdateFS() {
	var tab = directory().split('\n').sort();
	var monFS=new FS('/');
	monFS.CreateFS(tab);
	GEBID('internalFS').innerHTML=monFS.PrintPretty('','');
	GEBID('internalFS_standalone').innerHTML=GEBID('internalFS').innerHTML;
	delete monFS;
}


function readExternal(fichier,dest) {
	var fr=new FileReader();
	switch (dest) {
		case 1:
		fr.onload=function (e) {
			editor.setValue(e.target.result); GEBID('lecode').value=editor.getValue();
		}
		break;
		case 2:
		fr.onload=function (e) {
			setEntreetexte(e.target.result);
		}
		break;
		case 3:
		fr.onload=function (e) {
			readAllFS(e.target.result);
		}
		break;
	}
	fr.readAsText(fichier.files[0]);
}

function monbasename(ch,ext) {
	var tab=ch.split('/');
	var res=tab[tab.length-1];
	if (res.lastIndexOf(ext)>0) res=res.substr(0,res.lastIndexOf(ext));
  return res;
}

function readDataToIFS(fichier) {
	var fr=new FileReader();
	fr.onload=function (e) {
		//for (p in fichier.files[0]) Ecrire(p+"="+fichier.files[0][p]);
		writeFile('Data/'+monbasename(fichier.files[0].name,''),e.target.result);
	}
	fr.readAsDataURL(fichier.files[0]);
}

function fonctionerreur(e,f,l) {
//	if (((l-evalligne)>0) && ((l-evalligne)<=editor.lineCount())) alert('Erreur ligne '+(l-evalligne)+'\n'+e); else
 if (e.indexOf('container only has')>0 || e.indexOf('Script error')>=0 || e.indexOf('CannotFind')>=0 ) {
   console.log('Erreur TogetherJS : '+e);
 } else {
   if (l<2000) {
     alert('Erreur ligne '+l+'\n'+e);
   } else {
     alert('Erreur\n'+e);
   }
 }
}





// Gestion des assertions
function GEBID(e) {
	var res;
	try {
		res=document.getElementById(e);
	} catch (error) {
		Ecrire("Affichage = "+e);
	}
	return res;
}


function EcrireAssert(ch) {
	console.log(ch);
}

function Assert(condition, description) {
	if (condition) description='PASS:'+description; else description='FAIL:'+description;
	EcrireAssert('WARNING ON ASSERT: '+description);
}


function EncodeWithCesar(ch,cle) {
	var res='';
	for(var i=0; i<Longueur(ch); i++) {
		if ( (Caractere_vers_Ascii(ch[i]) < 122) && (Caractere_vers_Ascii(ch[i])>= 32))
			res+=Ascii_vers_Caractere(32+ ((Caractere_vers_Ascii(ch[i])-32) + cle) % 90);
		else res+=ch[i];
	}
	return res;
}

function DecodeWithCesar(ch,cle) {
	return EncodeWithCesar(ch,90-cle);
}

function MaskCode(ch) {
	return EncodeWithCesar(ch,29);
}

function UnMaskCode(ch) {
	return DecodeWithCesar(ch,29);
}

// AlgoScript English version

var getString=Saisie;
var getInt=SaisieEntier;
var getReal=SaisieReel;

var toInt=enEntier;
var toReal=enReel;
var toString=enChaine;

var Write=Ecrire;
var Print=Afficher_srl;
var Write=Ecrire;

var ClearScreen=EffacerEcran;

var InitializeGraphics=Initialiser;

var Turtle_go=Avancer;
var Turtle_right=Droite;
var Turtle_left=Gauche;
var Turtle_up=Lever;
var Turtle_down=Baisser;
var Turtle_move=Deplacer;
var Turtle_color=Couleur;

var Line=Ligne;
var FilledRectangle=RectanglePlein;
var Circle=Cercle;
var FilledCircle=CerclePlein;
var FilledEllipse=EllipsePlein;
var Text=Texte;
var Polygon=Polygone;
var FilledPolygon=PolygonePlein;

var LinearGradient=GradientLineaire;
var Length=Longueur;
var Substr=SousChaine;
var Search=PositionDans;
var toAscii=Caractere_vers_Ascii;
var fromAscii=Ascii_vers_Caractere;
var Uppercase=Majuscule;

var Size=Taille;
var PrintTable=AfficherTableau;
var DrawTable=AfficherCourbe;
var InitTable=InitialiserTableau;
var ConcatTable=ConcateneTableaux;
var CombineTableByRow=CombineTableauxL;
var CombineTableByColumn=CombineTableauxC;
var Reverse=Renverser;
var SortNumericalOrder=OrdreNumerique;
var SortLexicographicOrder=OrdreLexicographique;
var SubTable=SousTableau;

var LoadAudio=ChargerSon;
var CreateAudio=CreerSon;
var CreateAudio16bits=CreerSon16bits;
var ImportAudio=ImportSon;

var SaveAudio=SauverSon;
var ExportAudio=ExportSon;
var ExportAudio16bits=ExportSon16bits;

var Random=Hasard;

var ExecutionTime=chronometre;

var getTextEntry=getEntreetexte;
var setTextEntry=setEntreetexte;


var isInFullScreenMode = false;

function launchIntoFullscreen(element) {
  if(element.requestFullscreen) {
    element.requestFullscreen();
  } else if(element.mozRequestFullScreen) {
    element.mozRequestFullScreen();
  } else if(element.webkitRequestFullscreen) {
    element.webkitRequestFullscreen();
  } else if(element.msRequestFullscreen) {
    element.msRequestFullscreen();
  }
}

function enterFullscreen() {
  isInFullScreenMode = true;
  launchIntoFullscreen(document.documentElement);
}
function exitFullscreen() {
  isInFullScreenMode = false;
  if(document.exitFullscreen) {
    document.exitFullscreen();
  } else if(document.mozCancelFullScreen) {
    document.mozCancelFullScreen();
  } else if(document.webkitExitFullscreen) {
    document.webkitExitFullscreen();
  }
}

//       -->

    </script>
    <style type="text/css" id="AllStyles">
    body {
    	font-size: 1em;
    	width: 480px;
    	height: 320px;
		overflow: hidden;
    }

    #sortie, #lecode, #mycanvas, #SaisieTexte, #weboutput, #Aide, #divtuto, #credits, #GestionFichiers {
		-ms-transition: -ms-transform 1s ease;
		-moz-transition: -moz-transform 1s ease;
		-webkit-transition: -webkit-transform 1s ease;
		-o-transition: -o-transform 1s ease;
		transition: transform 1s ease;
    	transform-origin: bottom right;
		-ms-transform-origin: bottom right;
		-moz-transform-origin: bottom right;
		-webkit-transform-origin: bottom right;
		-o-transform-origin: bottom right;
    }


	#sortie {
		position: absolute;
		top: 30px;
		left:0px;
		width: 480px;
		height: 300px;
		background-color: black;
		color: rgb(100,255,100);
		font-weight: bold;
		font-family: Monospace, system;
		overflow: auto;
	}
	#lecode {
		position: absolute;
		overflow: auto;
		top: 30px;
		left:0px;
		font-family: Monospace, system;
		width: 480px;
		height: 600px;
		background-color: rgb(220,220,220);
		color: black;
		font-size: 0.8em;
	}
	#mycanvas {
		position: absolute;
		border: 1px solid;
		border-color: black;
		top: 30px;
		left: 0px;
		width: 480px;
		height: 300px;
		background-color: white;
				overflow: hidden;

	}

	#SaisieTexte {
		position: absolute;
		top: 30px;
		left:0px;
		width: 480px;
		height: 300px;
		color: black;
		background-color: rgb(200,200,255);
		visibility: hidden;
		overflow: auto;
z-index:100;
	}


	#Aide {
		position: absolute;
		top: 30px;
		left:0px;
		width: 480px;
		color: black;
		border:1px solid;
		border-color: black;
		background-color: white;
		visibility: hidden;
		overflow: auto;
		font-size: 1em;
		height: auto;

	}
	#Aide dt {
		font-family: Monospace, system;
		color: red;
		font-weight: bold;
	}
	#Aide dd {
		font-family: Arial, helvetica, sans serif;
		color: black;
		font-style: italic;
	}

	#bouton_fg {
		background-color: rgb(10,10,118);
		color: black;
	}



#titre_onglet {
	color: black;
	font-size: 1em;
	font-family: helvetica, arial, sans-serif;
	border: none;
	font-style: italic;
	font-weight: bold;
	width: 120px;
}

#boutons table {
	width: 100%;
	padding: 0; margin: 0;
}

#boutons td {
	padding: 0; margin: 0;
}

#boutons {
	width: 480px;
	height: 31px;
	z-index: 2000;
	position: fixed;
	top: 0px;
	left: 0px;
	background-color: rgb(10,10,118);
//		background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAeCAIAAABi9+OQAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3AwQFDYbJJefXwAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAN0lEQVQI103MyQ3AMAACQe+4/4aS5vLwoSAeaEGM530piaYamEjlqNo7kpmblze4P6sdh/228gEumQLy/g1NKAAAAABJRU5ErkJggg==);
	margin: 0; padding: 0;
}

#boutons tr {
	padding: 0; margin: 0;
}

#boutons input, #boutons select, #boutons option  {
	padding: 0;
	margin: 0;
	border: 0;
	height: 25px;
	color: white;
	font-family: helvetica, arial, sans-serif;
	background-color: rgb(10,10,118);
//		background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAeCAIAAABi9+OQAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3AwQFDYbJJefXwAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAN0lEQVQI103MyQ3AMAACQe+4/4aS5vLwoSAeaEGM530piaYamEjlqNo7kpmblze4P6sdh/228gEumQLy/g1NKAAAAABJRU5ErkJggg==);
	vertical-align: top;
}


#boutons input.fleche {
	vertical-align: top; width: 40px;
	text-align: center;
	line-height: 1;
	font-size: 1.4em; color: blue; font-weight: bold;
}

#boutons input.fleche:hover {
	text-align: center;
		vertical-align: top;
	background-color: rgb(220,220,220);
}

#boutons img+div {
	position: absolute;
	visibility: hidden;
	-moz-transform: translateX(-20px) translateY(30px);
	-webkit-transform: translateX(-20px) translateY(30px);
	transform: translateX(-20px) translateY(30px);
	display: inline;
}

#boutons input+div,#boutons select+div {
	position: absolute;
	visibility: hidden;
	-ms-transform: translateX(-100px) translateY(30px);
	-o-transform: translateX(-100px) translateY(30px);
	-moz-transform: translateX(-100px) translateY(30px);
	-webkit-transform: translateX(-100px) translateY(30px);
	transform: translateX(-100px) translateY(30px);
	display: inline;
	color: black;
	width: auto;
	text-align: center;
}

#boutons img:hover+div, #boutons input:hover+div, #boutons select:hover+div {
	visibility: visible;
}

#boutons img+div>div, #boutons input+div>div, #boutons select+div>div {
	width: 0px;
	background-color: yellow;
	border-color: black;
	font-family: helvetica, sans-serif, arial;
	font-size: 12px;
	font-style: italic;
	display: inline;

}

.definition+div {
	z-index:100000;
	position: absolute;
	visibility: hidden;
	-ms-transform: translateX(-100px) translateY(30px);
	-o-transform: translateX(-100px) translateY(30px);
	-moz-transform: translateX(-100px) translateY(30px);
	-webkit-transform: translateX(-100px) translateY(30px);
	transform: translateX(-100px) translateY(30px);
	display: inline;
	color: blue;
	width: auto;
	text-align: center;
}

.definition+div>div {
	width: 0px;
	background-color: yellow;
	border-color: black;
	font-family: helvetica, sans-serif, arial;
	font-size: 12px;
	font-style: italic;
	display: inline;

}

.definition+div:hover {
	visibility: hidden;
}


#divtuto {
		position: absolute;
		top: 30px;
		left:0px;
		width: 480px;
		color: black;
		visibility: hidden;
		overflow: auto;
	z-index: 30;
	background-color: rgb(220,220,220);
}

#credits {
		position: absolute;
		top: 30px;
		left:0px;
		width: 480px;
		color: black;
		visibility: hidden;
		overflow: auto;
	z-index: 30;
	background-color: black; color: white;
	font-family: helvetica, arial, sans-serif;

}

#credits h1 {
	color: white;
	font-style: italic;
}

#credits a {
	color: white;
	text-decoration: none;
}

#credits a:hover {
	font-weight: bold;
}

#divtuto input {
	padding: 0;
	margin: 0;
	border: 0;
	height: 25px;
	color: black;
	font-family: helvetica, arial, sans-serif;
	background-color: rgb(200,200,200);
	vertical-align: top;
}


#divtuto input.fleche {
	vertical-align: top; width: 40px;
	text-align: center;
	line-height: 1px;
	font-size: 1.4em; color: blue; font-weight: bold;
}

#divtuto input.fleche:hover {
	text-align: center;
		vertical-align: top;
	background-color: rgb(220,220,220);
}

.divfullscreen {
	text-align: center;
	vertical-align: middle;
	text-align: center;
	font-size: 1.4em; color: green; font-weight: bold;
	letter-spacing: -8px;
	font-size: 25px;
}

.divfullscreen:hover {
	background-color: rgb(220,220,220);
}

#weboutput {
	padding: 0px;
	position: absolute;
	top:30px;
	left:0px;
	border: none;
	width: 800px;
	height: 100%;
	visibility: hidden;
			overflow: auto;

}

#GestionFichiers {
	background-color: black;
	color: white;
		position: absolute;
		top: 30px;
		left:0px;
		width: 480px;
		color: black;
		visibility: hidden;
		overflow: auto;
	z-index: 30;
	font-family: helvetica, arial, sans-serif;
	}

#GestionFichiers h1 {
	color: white;
	font-style: italic;
}


#frameweboutput {
	position: relative;
	top:0px;
	left:0px;
	border: none;
	background-color: rgb(230,230,230);
	width: 100%;
	height: 100%;
			overflow: auto;

}

.fleche {
	z-index: 2000;
	-ms-transition: all 0.5s ease;
	-o-transition: all 0.5s ease;
	-moz-transition: all 0.5s ease;
	-webkit-transition: all 0.5s ease;
	transition: all 0.5s ease;
}

.fleche:hover {
	transform: scale(1) translateY(0px);
	-webkit-transform: scale(1) translateY(0px);
	-ms-transform: scale(1) translateY(0px);
	-moz-transform: scale(1) translateY(0px);
	-o-transform: scale(1) translateY(0px);
}

#GestionFichiers>div>h1+div {
	-ms-transform-origin: top left;
	-webkit-transform-origin: top left;
	-moz-transform-origin: top left;
	-o-transform-origin: top left;
	transform-origin: top left;

	-ms-transition: -moz-transform 1s ease;
	-moz-transition: -moz-transform 1s ease;
	-webkit-transition: -webkit-transform 1s ease;
	-o-transition: -o-transform 1s ease;
	transition: transform 1s ease;

	-ms-transform: scaleY(1);
	-o-transform: scaleY(1);
	-webkit-transform: scaleY(1);
	transform: scaleY(1);
	-moz-transform: scaleY(1);
	height: auto;
	// display: none;
}



#GestionFichiers>div:hover>h1+div {
	-ms-transform: scaleY(1);
	-moz-transform: scaleY(1);
	-webkit-transform: scaleY(1);
	-o-transform: scaleY(1);
	transform: scaleY(1);
	height: auto;
//	display: inherit;
}

@media (max-width: 0px) {
.fleche:hover {
	transform: scale(1.5) translateY(10px);
	-webkit-transform: scale(1.5) translateY(10px);
	-ms-transform: scale(1.5) translateY(5px);
	-moz-transform: scale(1.5) translateY(5px);
	-o-transform: scale(1.5) translateY(5px);
}

#GestionFichiers>div>h1+div {
	-ms-transform-origin: top left;
	-webkit-transform-origin: top left;
	-moz-transform-origin: top left;
	-o-transform-origin: top left;
	transform-origin: top left;

	-ms-transition: -moz-transform 1s ease;
	-moz-transition: -moz-transform 1s ease;
	-webkit-transition: -webkit-transform 1s ease;
	-o-transition: -o-transform 1s ease;
	transition: transform 1s ease;

	-ms-transform: scaleY(0.2);
	-o-transform: scaleY(0.2);
	-webkit-transform: scaleY(0.2);
	transform: scaleY(0.2);
	-moz-transform: scaleY(0.2);
	height: 50px;
	// display: none;
}



#GestionFichiers>div:hover>h1+div {
	-ms-transform: scaleY(1);
	-moz-transform: scaleY(1);
	-webkit-transform: scaleY(1);
	-o-transform: scaleY(1);
	transform: scaleY(1);
	height: auto;
//	display: inherit;
}
}

#GestionFichiers {
	vertical-align: top;
}

#GestionFichiers .bonglet {
	-ms-transition: background-color 0.5s ease;
	-moz-transition: background-color 0.5s ease;
	-webkit-transition: background-color 0.5s ease;
	-o-transition: background-color 0.5s ease;
	transition: background-color 0.5s ease;
	padding-top: 25px;
	padding-left: 25px;
	padding-right: 25px;
	padding-bottom: 5px;
	vertical-align: middle;
	font-size: 1.5em;
	background-color: rgb(255,255,255);
	color: black;
}

    </style>
    <style type="text/css" >

#Aide span+div {
	position: absolute;
	visibility: hidden;
	-ms-transform: translateX(-50px) translateY(20px);
	-o-transform: translateX(-50px) translateY(20px);
	-moz-transform: translateX(-50px) translateY(20px);
	-webkit-transform: translateX(-50px) translateY(20px);
	transform: translateX(-50px) translateY(20px);
	display: inline;
	color: blue;
	border-color: blue;
	border: 1px solid;
	padding: 5px;
	width: auto;
	text-align: left;
	background-color: yellow;
	font-family: helvetica, sans-serif, arial;
	font-size: 12px;
	font-style: italic;
}

#Aide span:hover+div {
	visibility: visible;
}

#Aide span:hover {
	background-color: rgb(220,220,220);
}

#Aide span+div>div {
	width: auto;
	display: block;

}

    </style>
    </head>
    <body onload="Init(); InitGraphic(); GEBID('titre_onglet').selectedIndex=0; var builtin_oldfilename=''; fenetre_courante=0; MontreFenetre(0); AdapterTaille(window.innerWidth,window.innerHeight); window.onresize=function () {AdapterTaille(window.innerWidth,window.innerHeight);}; /*setTimeout('GEBID(\'divtuto\').style.visibility=\'hidden\';',2000);*/ readAllFS(GEBID('Libraries').value); window.onerror=fonctionerreur; GEBID('sortie').value=''; GEBID('MonTexte').value='Votre texte ici'; GEBID('MonTexte').disabled=false; builtin_ong=GEBID('onglet1'); builtin_bong=GEBID('bonglet1'); builtin_oldfilename=''; EnvironmentLanguage=getQuerystring('lang'); if (EnvironmentLanguage == '') EnvironmentLanguage=defaultEnvironmentLanguage; if (EnvironmentLanguage == 'french') {GEBID('Mementofrench').style.display='block'; GEBID('Mementoenglish').style.display='none';} else {GEBID('Mementofrench').style.display='none'; GEBID('Mementoenglish').style.display='block';}; if (window.location.href.substr(0,mybaseurl.length) == mybaseurl && navigator.onLine) {if (getQuerystring('dropbox','off') == 'off' || (defaultDropbox == 'off' && getQuerystring('dropbox','off') != 'on')) Dropboxsync=false; else if (getQuerystring('dropbox','off') == 'on' || defaultDropbox == true) Dropboxsync=true; else Dropboxsync=confirm('Do you want to synchronize the internal filesystem with Dropbox ?');} else {Dropboxsync=false;}; if (Dropboxsync) {InitDropbox(); document.title='[Synchronized] '+document.title;} if (MustCreateAlgoScriptConfigflag) MustCreateAlgoScriptConfig();/* InitImages();*/ var toload=getQuerystring('load'); if (toload != '') {editor.setValue(readFile(toload)); builtin_oldfilename=toload; GEBID('lecode').value=editor.getValue();}; if (getQuerystring('theme') == 'erlang') {editor.setOption('theme','default erlang-dark'); var y = document.getElementsByClassName('CodeMirror'); y[0].style.backgroundColor='#002240'; y[0].style.color='white';}; if (getQuerystring('newstyle') == 'on') ChangeNewStyle(); window.onmousemove=builtinSetMouseXY;">
        <form name="f" id="f" action="javascript:void(0)" method="post">
	<textarea id="lecode" style="border: 0;">// Your code here
</textarea>
	<div id="boutons">
	<table><tr><td style="width: 33%; text-align: left; vertical-align: middle; margin: 0; border: 0; padding: 0;">
	<img id="icoExec" src="icons/run_32.png" alt="&#x2714;: Run" onclick="GEBID('sortie').value='Execution en cours'; Evaluer();"  style="color:green; width:24px; height: 24px;" class="fleche"/><div><div>Execute</div></div>
	<img id="icoIndent" src="icons/indent_32.png" alt="&#x21F6;: Indent" onclick="Indente();"  style="color:black; width:24px; height: 24px;" class="fleche"/><div><div>Indent</div></div>
	<img id="icoSave" src="icons/save_32.png" alt="Save" onclick="builtin_oldfilename=prompt('Nom du fichier à sauvegarder',builtin_oldfilename); writeFile(builtin_oldfilename,editor.getValue());" style="color:black; width:24px; height: 24px;" class="fleche"/><div><div>Save</div></div>
	<img id="icoLock" src="icons/lock_32.png" alt="Lock" style="color:black; background-color: white; width:24px; height: 24px;" onclick="if (builtin_verrou>=0) {RetailleFenetre(builtin_verrou,'hidden',-1,1,1); builtin_verrou=-1; this.style.backgroundColor='white';  MontreFenetre(0);} else {if (fenetre_courante>0) {builtin_verrou=fenetre_courante; this.style.backgroundColor='red';}}"  class="fleche"/><div><div>[Un]-lock the current view</div></div>

	</td>
	<td style="width: 33%; text-align: center; vertical-align: middle; margin: 0; border: 0; padding: 0;"><!--<input type="text" value="Code" id="titre_onglet" disabled="disabled"/>-->
	<select id="titre_onglet" onchange="MontreFenetre(0);" style="border-radius: 4px;">
	<option value="lecode">Code JS</option>
	<option value="sortie">Text output</option>
	<option value="mycanvas">Graphic output</option>
	<option value="SaisieTexte">Text input</option>
	<option value="weboutput">HTML output</option>
	<option value="Aide">Memento</option>
	<option value="divtuto">Help</option>
	<option value="credits">Credits</option>
	<option value="GestionFichiers">File manager</option>
	</select><div><div>Fen&ecirc;tre&nbsp;visible</div></div></td>
	<td style="width: 33%; text-align: right; vertical-align: middle; margin: 0; border: 0; padding: 0;">
	<label style="vertical-align: middle; font-style: italic; font-size: 0.7em; font-family: helvetica, sans-serif, arial; color: blue"><input class="other" type="text" id="builtin_inspector" style="background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIQAAAAbCAYAAAC9dCcxAAABFmlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGBSSCwoyGESYGDIzSspCnJ3UoiIjFJgv8/AxSDOABRlYE1MLi5wDAjwYcAJvl1jYATRl3VBZuFWhxVwpaQWJwPpP0CcnVxQVMLAwJgBZCuXlxSA2D1AtkhSNpi9AMQuAjoQyN4CYqdD2CfAaiDsO2A1IUHOQPYHIJsvCcxmAtnFlw5hg/zFB7UXBAQdU/KTUhVAvtcwtLS00CTRDwRBSWpFCYh2zi+oLMpMzyhRcASGVKqCZ16yno6CkYGhKQMDKNwhqj8HgsOTUewMQgwBEGJzJBgY/JcyMLD8QYiZ9DIwLNBhYOCfihBTM2RgENBnYNg3J7m0qAxqDCOTMQMDIT4AgsBI/mJiKeMAAAAJcEhZcwAALiMAAC4jAXilP3YAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAZ3SURBVGgF7VpLT1RZEK7mTfNoutFpUIFu0aAxkUAwYpgYWKizcAKTMIGEDWt+EGt3Ju5MWAwZCQm6UBbEwMAkyGOGARUE+gECUR7DV83XXC7dTYOAt+2u5HbdU1Xn3HNPfaeqzgXbzs7OtliHbNaZyrnOZOdcnxbjYWkxdClVEq5AChBJ6PRYr5wCRKzVSUJdChBJ6PRYr5wCRKzVSUJdCBA7EqruybEQuDe2j1oc2pIfZR+H/suXL7K2tqZXHOY/pol5Pc1tvnU0OfTUkbNPBJ6hMrgeRG6+V+URP+xLfoR5POreP3pl+p9pycjIkK6urni6/Hg25vU0t/nG0eTQU0fOPhF4CBARFFYQBQIBnYaj0GGF6XzzHF78+UJ8fp9cvHhRGhsbv3m8sxjA0oAIrgT1nR2OHwMQU9NTsrGxIVZ+H8sCYnV1VTY3NxUQRc4i5cFgUBYXF/Xe6/XK1NSU+Hw+cTqd4vF4JD09XXX42d7elunpadVnZ2dLaWmpXLhwQfWoTWZnZ/W+vLxcx5ybmxO73S5lZWWSn5+vOuMPnv3hwwfBvFwul1RUVEha2uGanHYrKyvqeMxzYWFBPn/+rGDAmFubWzp3PK+kpMT4mO9+b1lA+P3+8OJwRw0PD8vQ0JBkZWWpc9+/fx+2ueq9Ko9/fazt5eVlef78ucApJJvNJg8fPpSqqioFQ09Pj6quXbsmExMTNJPMzEy1q6ysVBlA+XLgpYyOjSrIaOj+yS0tv7UIwAaKZudyumRrF5yBwP77vJt4J7hu3bplOUAchjjf+DvzSIAI+EM1BXb40tKSggKOBqH4hBzU29urYMBOr6ur0x1/48YNuX79uupZm6ABMMCOjv369av09/fL1taW2qKwHflrRAryCzTvV1dXC545vzAvACiJdohMACyiForhhp8bxFFYqG3aut0lcvnyZb0oswq3bIQwOq2oKJQyCJLc3Fzp6OjQEI9CbezvMdn9I53uUjjr06dPur4FBQUKgrt37x5IJ37f/m5F1ABYsMPh1MmpST3mYgyEebQx5qNfHoVz/+x/s7K0vCRIM3fu3JHJyUm1w0Nra2vl3r17+jwA2FHkEKSNwcFBef36tc6rpaU5DEAVWOjH8oBAXQDHglhkej1eBQNkObk5YOq0nJwczeuFBYVqi5z/9OlTtYWjcIEINtQVAAMIu7nCUxF2LHY6UwnA9uzZM7Uz/sAGRDs8v76+Pgw+gIFEMMOG0Yg6K3HLAoILmL8bqrFDsVsRzkFOlzO8hijiQHl5eeEir/X3Vq01Zv6dkWXfsu74V69eyaVLlzRnc2zUC0ZiTQIQ4mi4vrauahabRlvcu91uFdEODQArEvn2opLVj9Ch2eMLFj5akOON+FUrjo8ZugDsSx5pVY4ho6OdpnSBIVhk4p7ONcrm5+elpqZG7t+/L2/fvpWBgQGYao2BXb2yGio2P378KKOjowoU7PLx8XG181R4tLi059nD/RoaGrTWQKE6MjKikYCnDNrhSPnmzRu5efOmzMzMCE4whbv1A2hl7wgNUGMOuKKBRzvwx7ye5nY0O8rB2YfcqDPdhwBBp5PDyHhv6hSxSXvyiEbxCdfX18MFIsMuwzxGYE2BewKHsrGxMenr69OwXewqFv9edY/C8cqVK5oukAJAKEJhaySE9MamRhUhxQAkqC+ePHmihSGOuXAmItaDBw8O2EEOQOACFRcXS1tbmzqe4EHE6u7u1kjV2tqqdjF/zOtpbrNzNDn01JGzTwRuyVMGFp3Enc9IADmdfwA4ex+vkF7gVDgRJwHsyPKycsHiwynGcVAQokAFoR9qivb2dk0/kOG7RXNzswIBzsbJBieI27dvS1NTE0yUjHaUIe3gmwb6gVBbMEVBVuQIFcq0twq36b/QMZSQY3a4B8WBKrVjX3IVHvsn9MxjdzvcgR+CUJDCiSRjCuns7NSCNRgISq4994Ad7cmRDhBRmAIoN3PYAagAMqMCbQBSRDrIAWqAcI+i/wudeT3N7f0RQmmfbSNnH3KjznRvyZRhmuOJmigycZmJEYKnFziFaclsa2wj6uA6imLZoWZAGjkWmTekuc3Bosmhp46cfSJwS6aMCPM8NREBgZ1u2KGnNn6iD5R0gEBNgQKTR8ZEd+Bpzz9UQ5z2qCcfL5xUTz5EQvaMXkOc8+skXYQ45/VNuMelAJFwLjvbCacAcbbrm3Cj/w90Kb3vCEYilgAAAABJRU5ErkJggg==); background-color: white; width: 80px; text-align: center; background-repeat: no-repeat; background-position: center center; border-radius:2em; color: black; text-shadow: 2px 2px 4px #000000; font-size:1.5em; font-weight: bold;" value=""/><div><div>Variables&nbsp;à&nbsp;inspecter</div></div></label>
  <img id="icoVisioP" src="icons/visiop_32.png" alt="Visio Private" onclick="window.open('https://meet.jit.si/ALGOSCRIPTINFOPRIVATE_'+togetherjsid);" style="color:black; width:24px; height: 24px;" class="fleche"/><div style="transform: translateX(-100px) translateY(30px);"><div>Private visioconference channel</div></div>
  <img id="icoVisio" src="icons/visio_32.png" alt="Visio" onclick="ZoomSession(prompt('Entrer l\'identifiant de la session visioconference'));" style="color:black; width:24px; height: 24px;" class="fleche"/><div style="transform: translateX(-100px) translateY(30px);"><div>Visioconference session</div></div>
  <img id="icoCollaborate" src="icons/collaborate_32.png" alt="Collaborate" onclick="Collaborate();;" style="color:black; width:24px; height: 24px;" class="fleche"/><div style="transform: translateX(-50px) translateY(30px);"><div>Collaborate</div></div>
	<img id="icoFS" src="icons/resize_32.png" alt="FullScreen" style="color:black; width:24px; height: 24px;" onclick="if (isInFullScreenMode) exitFullscreen(); else enterFullscreen(); AdapterTaille(window.innerWidth,window.innerHeight);"  class="fleche"/><div style="transform: translateX(-60px) translateY(30px);"><div>FullScreen</div></div>
	</td></tr></table>
	</div>
	<textarea disabled="disabled" style="visibility: hidden; border:0;" id="sortie"></textarea>
	<canvas style="visibility: hidden;" id="mycanvas" width="480" height="300"></canvas>
	<div id="SaisieTexte">
	<input type="button" onclick="var textentryfilename=Saisie('Enter the filename'); if (textentryfilename!=null) writeFile(textentryfilename,getEntreetexte())" value="Save text entry" /><br>
	<textarea id="MonTexte" style="border:0; width: 480px; height: 300px; background-color: rgb(200,200,255); z-index:1000;">Your text here</textarea></div>
	<div style="visibility: hidden; overflow: scroll;" id="Aide">
<p><input type="button" value="English" onclick="GEBID('Mementoenglish').style.display='block';GEBID('Mementofrench').style.display='none';"/><input type="button" value="Français" onclick="GEBID('Mementoenglish').style.display='none';GEBID('Mementofrench').style.display='block';"/></p><div id="Mementoenglish" style="display:block">
<h2>Memento</h2>
<h3>The Algoscript Library</h3>
<dl>
<dt><span>a=getString();</span><div><div>Function that reads a string on the standard input (prompt). French translation = Saisie</div></div> [or <span>getString([message]</span><div><div>Function that reads a string on the standard input, a optional message is printed.</div></div>) or <span>getInt([message])</span><div><div>Function that reads an integer on the standard input, same syntax as getString. French translation = SaisieEntier.</div></div> ou <span>getReal([message])</span><div><div>Function that reads a real number on the standard input, same syntax as getString. French translation = SaisieReel.</div></div>]</dt>
<dd>Allows to enter a string, an integer or a real number.</dd>
<dt><span>toInt(x);</span><div><div>Function that casts a string to an integer number (Example, toInt('123') is equal to the number 123)</div></div> [or <span>toReal(x)</span><div><div>Function that casts a string to a real number (Example, toReal('1.23') is equal to the number 1.23)</div></div> or <span>toString(x)</span><div><div>Function that casts a number to a string (Example, toString(123) is equal to the string '123')</div></div>]</dt>
<dd>Conversion functions to integers, reals or strings.</dd>
<dt><span>Write(ch);</span><div><div>Function that prints the string ch on the standard text output. Adds a newline.</div></div> [or <span>Print(ch)</span><div><div>same as Write(ch) but without the newline.</div></div>]</dt>
<dd>Prints ch on the standard output [and continue of the same line].</dd>
<dt><span>ClearScreen();</span><div><div>Clear the standard text output.</div></div></dt>
<dd>Clear the standard text output.</dd>
<dt><span>Stop('variable1,variable2');</span><div><div>Debugging function that breaks the execution at a given point and prints the values of some given variables.</div></div></dt>
<dd>Debugging function that breaks the execution at a given point and prints the values of variables <tt>variable1</tt> and <tt>variable2</tt>.</dd>
<dt><span>Help();</span><div><div>Print this manual</div></div></dt>
<dd>Print this manual.</dd>
<dt><span>InitializeGraphics();</span><div><div>Clear the graphic window and et put the turtle at its initial position.</div></div> <span>Viewport(minx,miny,maxx,maxy,dir);</span><div><div>Defines the coordinate system.</div></div></dt>
<dd>Initialize the graphic window.</dd>
<dt><span>Turtle_go(l);</span><div><div>Go forward by l unities (depends on the coordinate system defined by viewport). A line is drawn is the turtle is down.</div></div> <span>Turtle_right(a);</span><div><div>Turn right the turtle by a given an angle in degrees.</div></div> <span>Turtle_left(a);</span><div><div>Turn left the turtle by a given angle in degrees.</div></div> <span>Turtle_up();</span><div><div>Disable the line drawing.</div></div> <span>Turtle_down();</span><div><div>Enable the line drawing.</div></div> <span>Turtle_move(x,y);</span><div><div>Put the turtle at a given position (default is position 0,0).</div></div> <span>Turtle_color(c);</span><div><div>Change the color of the line drawing.</div></div></dt>
<dd>Usual manipulation functions for the LOGO turtle.</dd>
<dt><span>Point(x,y,color);</span><div><div>Draw a point at coordinates x,y with the given color. The coordinate system is either the default one (expressed in pixels with an origine to the upper left corner), or provided by the Viewport function.<br/>Example: <pre>Point(100,200,'red');</pre></div></div>
<span>Line(x0,y0,x1,y1,color);</span><div><div>Draw a line joining the points at coordinates x0,y0 and x1,y1 using the given color. The coordinate system is either the default one (expressed in pixels with an origine to the upper left corner), or provided by the Viewport function.<br/>Example: <pre>Line(100,200,300,50,'red');</pre></div></div>
<span>Rectangle(x,y,l,h,color);</span><div><div>Draw (the border of) a rectangle whose upper left corner is at position x,y, having length l and height h with the given color. The coordinate system is either the default one (expressed in pixels with an origine to the upper left corner), or provided by the Viewport function.<br/>Example: <pre>Rectangle(100,200,150,50,'red');</pre></div></div>
<span>FilledRectangle(x,y,l,h,color);</span><div><div>Draw a rectangle whose upper left corner is at position x,y, having length l and height h with the given color. The coordinate system is either the default one (expressed in pixels with an origine to the upper left corner), or provided by the Viewport function.<br/>Exemple: <pre>FilledRectangle(100,200,150,50,'red');</pre></div></div>
<span>Circle(x,y,r,color);</span><div><div>Draw a circle whose center is at coordinate x,y, and diameter is r with the given color. The coordinate system is either the default one (expressed in pixels with an origine to the upper left corner), or provided by the Viewport function (in this latter case, the circle can appear as an ellipse).<br/>Example: <pre>Circle(100,200,50,'red');</pre></div></div>
<span>FilledCircle(x,y,r,color);</span><div><div>Draw a disk whose center is at coordinate x,y, and diameter is r with the given color. The coordinate system is either the default one (expressed in pixels with an origine to the upper left corner), or provided by the Viewport function (in this latter case, the disk can appear as an ellipse).<br/>Example: <pre>FilledCircle(100,200,50,'red');</pre></div></div>
<span>Ellipse(x,y,rx,ry,color);</span><div><div>Draw an ellipse whose center is at coordinate x,y, and horizontal and vertical diameters are rx and ry with the given color. The coordinate system is either the default one (expressed in pixels with an origine to the upper left corner), or provided by the Viewport function.<br/>Example: <pre>Ellipse(100,200,50,'red');</pre></div></div>
<span>FilledEllipse(x,y,rx,ry,color);</span><div><div>Draw a filled ellipse whose center is at coordinate x,y, and horizontal and vertical diameters are rx and ry with the given color. The coordinate system is either the default one (expressed in pixels with an origine to the upper left corner), or provided by the Viewport function.<br/>Example: <pre>FilledEllipse(100,200,50,'red');</pre></div></div>
<span>Polygon(x1,y1,x2,y2,...,color);</span><div><div>Draw a polygon constructed by using a list of points. The coordinate system is either the default one (expressed in pixels with an origine to the upper left corner), or provided by the Viewport function.<br/>Example: <pre>Polygon(100,200,150,100,200,200,'blue'); // draws a triangle</pre></div></div>
<span>FilledPolygon(x1,y1,x2,y2,...,color);</span><div><div>Draw a filled polygon constructed by using a list of points. The coordinate system is either the default one (expressed in pixels with an origine to the upper left corner), or provided by the Viewport function.<br/>Example: <pre>FilledPolygon(100,200,150,100,200,200,'blue'); // draw a filled triangle</pre></div></div>
<span>Text(x, y, ch, color);</span><div><div>Write the text ch on the graphical window at position x,y with the given color.<br/>Example: <pre>Text(100,200,'Hello world','red');</pre></div></div>
<span>setCanvasFont(fontname, fontsize, fontstyle);</span><div><div>Modify the default font. fontname is the name of the font family (eg. 'times', 'helvetica',...) that is installed of the system. fontsize is the size of the font expressed in pt (points) or px (pixels) (eg. '25pt'). fontstyle allows the change the style of the font (eg. 'bold', 'italic', 'bold italic').<br/>Example: <pre>
setCanvasFont('helvetica', '25pt', 'bold');
Text(100,100,'Hello world','blue');
setCanvasFont('helvetica', '25px', 'bold italic');
Text(100,200,'Hello world','red');</pre></div></div>
<span>PreloadGooglefont(familyname);</span><div><div>
It is usually hasardous to use exotic fonts because there is a almost no chance that the font is installed on all the systems. An alternative is to use licence free fonts by using the google font api mechanism <a href="https://fonts.google.com">https://fonts.google.com</a>. PreloadGooglefont allows to get such a font working in javascript.
<br/>Example: <pre>
var fontRanga=PreloadGooglefont("'Ranga', cursive");
// It is usually necessar to wait until 1s before using the fonts
setTimeout(function () {
  setCanvasFont(fontRanga, '25pt', '');
  Text(100,100,'Hello world','blue');
}, 1000);
</pre></div></div>
<span>DrawImage(imageurl,x,y,w,h);</span><div><div>Draw an image on the graphical window. The image, given by its url, is drawn at position x,y, with length w and height h. The use of the function is quite complex, mainly due to some security processes developed by the browser in order to forbid unusual use of externel images (for instance, the use of external images require to disable the logo turtle functionality by adding the instruction turtleEnabled=false;). Here are two examples:<ul>
<li>Use of an external image.
<pre>
turtleEnabled=false;
Initialiser();
DrawImage('https://algoscript.info/Logo.png',150,200,200,100);
</pre>
</li>
<li>Use of an image from the internal filesystem (compatible with the turtle and faster when on the low bandwidth internet connections). <em>The image must by integrated in the internal filesystem before</em> by using the following procedure: go to the "File Manager" of the environnement, then to "External FS". Browse your disk and select the image file (let say 'image.png' is store on your disk). Then select "Data file to Internal FS". After a few second, the file Data/image.png should appear in the internal filesystem. It can be used then with,
<pre>
Initialiser();
DrawImage(readFile('Data/image.png'),150,200,100,100);
</pre>
</li>
</ul></pre></div></div>
<span>PreloadImage(imageurl)/DrawImageObject(image,x,y,w,h);</span><div><div>Preload an image from an url.
The image, stored in a variable, is drawn with DrawImageObject at position x,y, with length w and height h. The usage and limitations are the same as DrawImage.
This preload process is much more efficient than its non preloaded counterpart.
It is also useful to use the function WaitPreload(f) that ensures a proper preload of all the images before executing the given function f.qui s'assure que toutes les images sont bien pr�charg�es avant d'ex�cuter la fonction f.
 Here are two examples:<ul>
<li>Use of an external image.
<pre>
turtleEnabled=false;
Initialiser();
var MyImage=PreloadImage('https://algoscript.info/Logo.png');

function run() {
   DrawImageObject(MyImage,150,200,200,100);
}

WaitPreload(run);
</pre>
</li>
<li>Use of an image from the internal filesystem (compatible with the turtle and faster when on the low bandwidth internet connections). <em>The image must by integrated in the internal filesystem before</em> by using the following procedure: go to the "File Manager" of the environnement, then to "External FS". Browse your disk and select the image file (let say 'image.png' is store on your disk). Then select "Data file to Internal FS". After a few second, the file Data/image.png should appear in the internal filesystem. It can be used then with,
<pre>
Initialiser();
var MyImage=PreloadImage(readFile('Data/image.png'));

function run() {
   DrawImageObject(MyImage,150,200,100,100);
}

WaitPreload(run);
</pre>
</li>
</ul></pre></div></div>

<span>rgb(cr,cv,cb); rgba(cr,cv,cb, opacité);</span><div><div>Define a color by providing its rgb components (three integers between 0 and 255), and for rgba by adding a transparency coefficient (real number between 0 and 1). These fonction can be used each time a color is required. <br/>Example:
<pre>
FilledRectangle(200,200,300,50,rgb(255,0,255));

// or another example
for(var i=0; i<10; i=i+1) {
   FilledRectangle(Hasard(500),Hasard(500),50,50,rgb(Hasard(255),Hasard(255),Hasard(255)));
}

FilledRectangle(200,200,300,50,rgba(255,0,255,0.5));
FilledRectangle(350,225,300,50,rgba(255,0,255,0.5));

</pre></div></div>
<span>LinearGradient(color1,color2,xd,yd,xf,yf);</span><div><div>Define a gradient of color between two colors (color1 and color2). Point xd,yd has color color1 and point xf,yf has color color2.<br/>Example: <pre>FilledCircle(200,200,100,LinearGradient('red','yellow',150,200,250,200));</pre></div></div>
<span>ShadowOn(); ShadowOff();</span><div><div>Enable or disable the shadow effect.<br/>Example:
<pre>
ShadowOn();
FilledRectangle(100,100,200,80,'red');
ShadowOff();
FilledRectangle(100,200,200,80,'red');
</pre></div></div>
</dt>
<dd>Usual functions for the graphical output.</dd>
<dt>
<span>ch[i];</span><div><div>Return the character at indice i is string ch (the first character is at indice 0).</div></div>
<span> Length(ch);</span><div><div>Return the length of ch.<br/>Example: <t>Write(Length('Hello'));</t> prints 5.</div></div>
<span> Substr(ch,begin,length);</span><div><div>Return a substring of ch composed by length characters from indice begin.<br/>Example: <t>Write(Substr('Bonjour',3,2));</t> prints 'jo'.</div></div>
<span> Search(ch,ch_searched);</span><div><div>Return the position of the first occurrence of ch_searched is ch (or -1 if ch_searched is not a substring of ch).<br/>Example: <t>Write(Search('Bonjour','jour'));</t> prints 3.</div></div>
</dt>
<dd>Standard manipulation functions of strings.</dd>
<dt>
<span> toAscii(c);</span><div><div>Return the ASCII code of character c (also works with unicode).<br/>Exemple: <t>Write(toAscii('A'));</t> prints 65.</div></div>
<span> fromAscii(n);</span><div><div>Return the symbol corresponding to the ASCII code n (also works with unicode).<br/>Example: <t>Write(fromAscii(66));</t> prints 'B'.</div></div>
<span> Uppercase(c);</span><div><div>Transform a lettre in uppercase.<br/>Example: <t>Write(Uppercase('é'));</t> prints 'E'.</div></div></dt>
<dd>Functions for symbol manipulations.</dd>
<dt><span>Tableau(n); </span><div><div>Create an array of size n. The other standard way of defining an array are:
<ul>
<li>By providing the list of its elements: var T=[1,2,3];</li>
<li>By creating an array of size 0: var T=[];</li>
<li>By using the javascript object Array: var T=new Array(10)</li>
</ul>
The element at index i is accessible for reading and writing by using T[i].
</div></div>
<span>Tableau(n,k); </span><div><div>Create an 2D array of size n x k.
The element at index (i,j) is accessible for reading and writing by using T[i][j].
</div></div><span>Size(T); </span><div><div>Return the size of T.<br/>Example:
<pre>var T=[3,4,5];
Write(Size(T));</pre> prints 3.</div></div>
<span>PrintTable(T); </span><div><div>Pretty print of the array on the standard text output.<br/>Example:
<pre>var T=[[2,6],[4,5],[7,8]]; // 2D array
PrintTable(T);</pre> prints
<pre>
2	6
4	5
7	8
</pre></div></div>
<span>DrawTable(T);</span><div><div>Create a diagram (in the graphical output) using the values stored in T.<br/>Example:
<pre>var T=[[2,6],[4,5],[7,8]]; // 2D array
DrawTable(T);</pre>
Numbers of options are associated to this function. Here is its complete syntax: DrawTable(T,addition,fill,color,type,thickness) where
<ul>
<li>addition is a boolean (default to false) indicate if the curve must be added to the preceding one.</li>
<li>fill is a boolean (default to true) indicate wether the area under the curve must be filled or not.</li>
<li>color is the color of the curve, (default to red).</li>
<li>type is a string defining the type of points: 'O', 'X' or ' ' (default to 'O').
<li>thickness is the thickness of the curve (default to 2).</li>
</ul>
</div></div>
<span>InitTable(T, value);</span><div><div>Assign the same value to all the elements of the tablea T.<br/>Example: <pre>var T=new Array(5);
InitTable(T, 0);
</pre></div></div>
<span>ConcatTable(T1,T2);</span><div><div>Concatenate two tables.</div></div>
<span>CombineTableByRow(T1,T2);</span><div><div>Construct a two dimensional table whose first column is T1 and second column is T2.</div></div>
<span>CombineTableByColumn(T1,T2);</span><div><div>Construct a two dimensional table whose first row is T1 and second row is T2.</div></div>
<span>Renverse(T);</span><div><div>Construct the inverse of table T.</div></div>
<span>SortNumericalOrder(T);</span><div><div>Sort T using a numerical order.</div></div>
<span>SortLexicographicOrder(T);</span><div><div>Sort T using a lexicographical order.</div></div>
<span>SubTable(T, begin, length);</span><div><div>Extract a subtable from T.</div></div>
</dt>
<dd>Table manipulation functions.</dd>
<dt>
<span>LoadAudio(url); </span><div><div>Return an audio object, read from a given url, that can be played by the method play(). Notice that the supported song format may vary depending on the browser (nevertheless, .wav files are largely supported). As for images, two usages are possible:<ul>
<li>Use of an external url.
<pre>
var song=LoadAudio('http://www.moviesoundscentral.com/sounds/star_wars/empire_strikes_back/jedi3.wav');
song.play();
</pre>
</li>
<li>Use of a song stored in the internal filesystem. <em>The song must by integrated in the internal filesystem before</em> by using the following procedure: go to the "File Manager" of the environnement, then to "External FS". Browse your disk and select the song file (let say 'song.wav' is store on your disk). Then select "Data file to Internal FS". After a few second, the file Data/song.wav should appear in the internal filesystem. It can be used then with,
<pre>
var song=LoadAudio(readFile('Data/song.wav'));
song.play();
</pre>
</li>
</ul></pre></div></div>
<span>CreateAudio(Table,SampleRate); </span><div><div>Create an audio object by using an array of values (integer between 0 and 255) that corresponds to the sample of the song at a given samplerate. It can be played using method play(). <br/>Example:
<pre>
var data=[]; for(var i=0; i<22050; i++) {data[i]=128+Math.floor(127*Math.sin(i*0.125315));}
var LA=CreateAudio(data,22050);
LA.play();
</pre>
</div></div>
<span>CreateAudio16bits(Table,SampleRate); </span><div><div>Create an audio object by using an array of values (real values between -1 and +1) that corresponds to the sample of the song at a given samplerate. It can be played using method play(). The main difference with CreateAudio is that the generated audio object has a better quality (16bits instead of 8bits).<br/>Exemple:
<pre>
var data=[]; for(var i=0; i<22050; i++) {data[i]=Math.sin(i*0.125315));}
var LA=CreateAudio16bits(data,22050);
LA.play();
</pre>
</div></div><span>ImportAudio(filename); SampleRate(nomfichier);</span><div><div>Create an array that corresponds to the sample of the song (only 8bit, mono wav files or supported). The song must be stored in the internal filesystem. The obtained table can be manipulated and replayed using the CreateAudio function. The sample rate of the original song can be retrieved by using the SampleRate function.
<pre>
var data=ImportAudio('Data/jedi3.wav');
var SR=SampleRate('Data/jedi3.wav');
var son=CreateAudio(data,SR*1.5);
son.play();
</pre>
</div></div>
<span>SaveAudio(filename, data, samplerate);</span><div><div>Generate a wav file and store the resulting file in the internal filesystem.
</div></div>
<span>ExportAudio(data, samplerate);/ExportAudio16bits(data, samplerate); </span><div><div>Generate a wav file on a url encoded form. Can be saved using the "save as" functionality of the browser.
</div></div>
<span>NormalizeAudio(data); </span><div><div>Generate a 0-255 integer array from [-1,1] real array.
</div></div>
<span>StartMicrophone(function (T) {...}); StopMicrophone();</span><div><div>Gives access to the microphone. The sound signal is splitted into small parts as arrays of -1 to +1 reals values aimed to be processed by the given function. StopMicrophone() disables the connection with the microphone.
<pre>
// a simplistic oscilloscope
StartMicrophone(function (T) {T[0]=-1; T[1]=1; DrawTable(T,false,false,'red','',1);});

function MouseClick(x,y) {
  StopMicrophone();
}
</pre>
</div></div>
<span>StartWebcam(function (T) {...}); StopWebcam();</span><div><div>Gives access to the webcam. The video signal is given image by image by means of a javascript imageData (see <a href="http://www.w3schools.com/tags/ref_canvas.asp">here</a> for a reference) aimed to be processed by the given function. StopWebcam() stops the process.
<pre>
// a simplistic example that draws the webcam signal on the standard output
StartWebcam(function (T) {ctx.putImageData(T,0,0)});

function MouseClick(x,y) {
  StopWebcam();
}
</pre>
</div></div>
<span>StartSpeechRecognition(function (T) {...}); </span><div><div>For Chrome users only. Gives access to the speech synthesis API. The speech is given fragment by fragment by means of a string aimed to be processed by the given function. Notice that setLanguage(lang) allows to change the recognition language.
<pre>
// a simplistic example that prints the recognized sentences on the standard text output
setLanguage('en-US');
StartSpeechRecognition(Write);
</pre>
</div></div>
</dt>
<dd>Functions for manipulating HTMLaudio objects.</dd>
<dt>
<span>Random(n); </span><div><div>Return a uniform random integer between 0 and n-1. <br/>Example: <t>Write(Random(10));</t></div></div>
<span>ExecutionTime(codeJS);</span><div><div>Return the execution time (in milliseconds) used by the given JS code<br/>Example: <pre>
Write(ExecutionTime('var c; for(var i=0; i<1000000; i++) {c=c+i;}'));
</pre></div></div>
<span>getTextEntry(); setTextEntry(chaine);</span><div><div>Input/output functions from/to the text input window. getTextEntry() returns a string corresponding the the content of the window and setTextEntry(ch) replaces the content of the window by the content of ch.</div></div>
<span>HTMLoutput(ch);</span><div><div>Interpret the HTML code ch. The result is displayed in the HTML output window.</div></div>
</dt>
<dd>Miscellaneous functions.</dd>
<dt>
<span>includeFile(filename);</span><div><div>Execute the javascript content of filename. This function can be used to define some external libraries. (ex: <t>includeFile('Library/libRS.js');</t>).</div></div>
<span>readFile(filename);</span><div><div>Read the content of file filename et return a string that corresponds to its content.</div></div>
<span>writeFile(filename,content);</span><div><div>Save the given content in filename</div></div>
<span>removeFile(filename);</span><div><div>Remove file filename.</div></div>
<span>renameFile(oldname, newname);</span><div><div>Rename a file.</div></div>
<span>ls();</span><div><div>List all the files stored in the internal filesystem.</div></div>
<span>FileExists(filename)</span><div><div>Test if a file exists in the internal filesystem.</div></div>
</dt>
<dd>File manipulation functions.</dd>
</dl>

<h2>Variable inspector</h2>
The variable inspector allows to follow the values of some variables by constructing a execution trace.
In order to follow a variable, it must be entered in the inspect field (several variables separated by a comma).
An execution trace is then constructed (evaluation of all the variables each time a ';' is reached).

<div id="exemples" style="font-size: 1.3em;">
<h2>A few examples (see the internal FS for further examples)</h2>
<script type="text/javascript">
ConstruitExemples();
for(var i=0; i<20; i++) document.write('<br/>');
</script>
</div>
</div>
<div id="Mementofrench" style="display:block">
<h2>Petit m&eacute;mento</h2>
<h3>La bibliothèque Algoscript</h3>
<dl>
<dt><span>a=Saisie();</span><div><div>Fonction permettant de saisir une chaîne de caractères</div></div> [ou <span>Saisie([message]</span><div><div>Fonction permettant de saisir une chaîne de caractères, un message optionnel peut être affiché au moment de la saisie</div></div>) ou <span>SaisieEntier([message])</span><div><div>Fonction permettant de saisir un nombre entier, sa syntaxe est la même que la fonction Saisie()</div></div> ou <span>SaisieReel([message])</span><div><div>Fonction permettant de saisir un nombre réel, sa syntaxe est la même que la fonction Saisie()</div></div>]. <span>SaisieAudio(message)</span><div><div>Fonction permettant de saisir une chaîne de caractères. A la différence de Saisie, le message est lu.</div></div></dt>
<dd>Permet la saisie d'une cha&icirc;ne de caract&egrave;re (ou d'un entier ou d'un réel).</dd>
<dt><span>enEntier(x);</span><div><div>Fonction permettant transformer une chaîne de caractères en un nombre entier (par exemple, enEntier('123') renvoie la valeur entière 123)</div></div> [ou <span>enReel(x)</span><div><div>Fonction permettant transformer une chaîne de caractères en un nombre réel (par exemple, enReel('1.23') renvoie la valeur réelle 1.23)</div></div> ou <span>enChaine(x)</span><div><div>Fonction permettant transformer un nombre en une chaîne de caractères (par exemple, enChaine(123) renvoie la chaîne '123')</div></div>]</dt>
<dd>Convertit x en entier (ou r&eacute;&egrave;l ou cha&icirc;ne de caract&egrave;re).</dd>
<dt><span>Ecrire(ch);</span><div><div>Fonction d'affichage. La chaîne ch est affichée dans la fenêtre de sortie texte. Il y a un retour à la ligne après l'affichage.</div></div> [ou <span>Afficher(ch)</span><div><div>Idem à Ecrire(ch). Cette fonction est conservée pour assurer une compatibilité.</div></div> ou <span>Afficher_srl(ch);</span><div><div>Idem à Ecrire(ch) sauf qu'il n'y a pas de retour à la ligne après l'affichage.</div></div>]. <span>EcrireAudio(ch);</span><div><div>Fonction qui lit la chaîne ch avant de l'afficher. Rq: setLanguage(lang) permet de changer la langue de lecture (eg. setLanguage('fr-FR') ou setLanguage('en-US')).</div></div></dt>
<dd>Affiche la cha&icirc;ne de caract&egrave;res ch [sans retour &agrave; la ligne].</dd>
<dt><span>EffacerEcran();</span><div><div>Efface la sortie texte.</div></div></dt>
<dd>Efface la sortie texte.</dd>
<dt><span>Stop('variable1,variable2');</span><div><div>Bloque l'exécution à un endroit déterminé est affiche les valeurs de variables données en paramètre</div></div></dt>
<dd>Suspend l'ex&eacute;cution du programme et affiche l'&eacute;tat courant des variables <tt>variable1</tt> et <tt>variable2</tt>.</dd>
<dt><span>Help();</span><div><div>Affiche l'aide</div></div></dt>
<dd>Affiche cette aide.</dd>
<dt><span>Initialiser();</span><div><div>Efface la fen&ecirc;tre graphique et replace la tortue en position initiale.</div></div> <span>Viewport(minx,miny,maxx,maxy,dir);</span><div><div>Défini le système de coordonnées qui est utilisé lors des affichages graphiques. dir définit le sens d'affichage, minx et miny définit les coordonnées du coin supérieur (inférieur si dir=-1) gauche et maxx et maxy définit les coordonnées du coin inférieur (supérieur si dir=-1) droit.</div></div></dt>
<dd>Fonctions d'initialisation de la fenêtre graphique.</dd>
<dt><span>Avancer(l);</span><div><div>Avance la tortue de l unités (dépend du système de coordonnées défini par Viewport). Une ligne est tracée si la tortue est baissée.</div></div> <span>Droite(a);</span><div><div>Tourne la tortue de a degrés dans le sens des aiguilles d'une montre.</div></div> <span>Gauche(a);</span><div><div>Tourne la tortue de a degrés dans le sens inverse des aiguilles d'une montre.</div></div> <span>Baisser();</span><div><div>Baisse la tortue (et donc la tortue laisse des traces lorsqu'elle avance).</div></div> <span>Lever();</span><div><div>Lève la tortue (et donc supprime les traces laissées par la tortue lorsqu'elle avance).</div></div> <span>Deplacer(x,y);</span><div><div>Place la tortue en une position fixée de l'écran (par défaut, elle est en position 0,0).</div></div> <span>Couleur(c);</span><div><div>Change la couleur de la trace laissée par la tortue.</div></div></dt>
<dd>Op&eacute;rations usuelles de manipulation de la tortue.</dd>
<dt><span>Point(x,y,couleur);</span><div><div>Trace un point aux coordonnées x,y avec la couleur donnée. Le système de coordonnée est soit celui par défaut (exprimée en pixel avec une origine au coin supérieur gauche), soit celui fourni par la commande Viewport.<br/>Exemple: <pre>Point(100,200,'red');</pre></div></div>
<span>Ligne(x0,y0,x1,y1,couleur);</span><div><div>Trace une ligne joignant les points de coordonnées x0,y0 et x1,y1 avec la couleur donnée. Le système de coordonnée est soit celui par défaut (exprimée en pixel avec une origine au coin supérieur gauche), soit celui fourni par la commande Viewport.<br/>Exemple: <pre>Ligne(100,200,300,50,'red');</pre></div></div>
<span>Rectangle(x,y,l,h,couleur);</span><div><div>Trace (les bords d')un rectangle dont le coin supérieur gauche est le point de coordonnées x,y, de longueur l et de hauteur h avec la couleur donnée. Le système de coordonnée est soit celui par défaut (exprimée en pixel avec une origine au coin supérieur gauche), soit celui fourni par la commande Viewport.<br/>Exemple: <pre>Rectangle(100,200,150,50,'red');</pre></div></div>
<span>RectanglePlein(x,y,l,h,couleur);</span><div><div>Trace un rectangle plein dont le coin supérieur gauche est le point de coordonnées x,y, de longueur l et de hauteur h avec la couleur donnée. Le système de coordonnée est soit celui par défaut (exprimée en pixel avec une origine au coin supérieur gauche), soit celui fourni par la commande Viewport.<br/>Exemple: <pre>RectanglePlein(100,200,150,50,'red');</pre></div></div>
<span>Cercle(x,y,r,couleur);</span><div><div>Trace un cercle dont le centre est le point de coordonnées x,y, et le rayon est r avec la couleur donnée. Le système de coordonnée est soit celui par défaut (exprimée en pixel avec une origine au coin supérieur gauche), soit celui fourni par la commande Viewport (dans ce cas, le cercle peut apparaître déformé).<br/>Exemple: <pre>Cercle(100,200,50,'red');</pre></div></div>
<span>CerclePlein(x,y,r,couleur);</span><div><div>Trace un disque dont le centre est le point de coordonnées x,y, et le rayon est r avec la couleur donnée. Le système de coordonnée est soit celui par défaut (exprimée en pixel avec une origine au coin supérieur gauche), soit celui fourni par la commande Viewport (dans ce cas, le cercle peut apparaître déformé).<br/>Exemple: <pre>CerclePlein(100,200,50,'red');</pre></div></div>
<span>Ellipse(x,y,rx,ry,couleur);</span><div><div>Trace une ellipse dont le centre est le point de coordonnées x,y, et les rayons sont rx et ry avec la couleur donnée. Le système de coordonnée est soit celui par défaut (exprimée en pixel avec une origine au coin supérieur gauche), soit celui fourni par la commande Viewport.<br/>Exemple: <pre>Ellipse(100,200,50,'red');</pre></div></div>
<span>EllipsePlein(x,y,rx,ry,couleur);</span><div><div>Trace une ellipse pleine dont le centre est le point de coordonnées x,y, et les rayons sont rx et ry avec la couleur donnée. Le système de coordonnée est soit celui par défaut (exprimée en pixel avec une origine au coin supérieur gauche), soit celui fourni par la commande Viewport.<br/>Exemple: <pre>EllipsePlein(100,200,50,'red');</pre></div></div>
<span>Polygone(x1,y1,x2,y2,...,color);</span><div><div>Trace un polygone à partir d'une liste de points. Le système de coordonnée est soit celui par défaut (exprimée en pixel avec une origine au coin supérieur gauche), soit celui fourni par la commande Viewport.<br/>Exemple: <pre>Polygone(100,200,150,100,200,200,'blue'); // trace un triangle</pre></div></div>
<span>PolygonePlein(x1,y1,x2,y2,...,color);</span><div><div>Dessine un polygone plein à partir d'une liste de points. Le système de coordonnée est soit celui par défaut (exprimée en pixel avec une origine au coin supérieur gauche), soit celui fourni par la commande Viewport.<br/>Exemple: <pre>PolygonePlein(100,200,150,100,200,200,'blue'); // trace un triangle plein</pre></div></div>
<span>Texte(x, y, ch, couleur);</span><div><div>Ecrit le texte ch sur la sortie graphique à partir du point de coordonnées x,y avec la couleur donnée. Le système de coordonnée est soit celui par défaut (exprimée en pixel avec une origine au coin supérieur gauche), soit celui fourni par la commande Viewport.<br/>Exemple: <pre>Texte(100,200,'Bonjour tout le monde','red');</pre></div></div>
<span>setCanvasFont(fontname, fontsize, fontstyle);</span><div><div>Modifie la police de caractères par défaut. fontname est le nom d'une police de caractères (ex: 'times', 'helvetica',...) qui doit être installée sur le système. fontsize est la taille de cette police exprimée en unité pt (points) )ou px (pixels) (par ex: '25pt'). fontstyle permet de changer le style de cette police (ex: 'bold', 'italic', 'bold italic').<br/>Exemple: <pre>
setCanvasFont('helvetica', '25pt', 'bold');
Texte(100,100,'Bonjour le monde','blue');
setCanvasFont('helvetica', '25px', 'bold italic');
Texte(100,200,'Bonjour le monde','red');</pre></div></div>
<span>PreloadGooglefont(familyname);</span><div><div>
Il est souvent hasardeux d'utiliser une police "exotique" étant donné qu'il y a peu de chance qu'elle soit installée sur toutes les machines visées. Une alternative consiste à utiliser le gestionnaire de polices libres de droite fourni pas Google <a href="https://fonts.google.com">https://fonts.google.com</a>. PreloadGooglefont permet de précharger de manière transparents ces polices de caractères pour une utilisation en javascript.
<br/>Exemple: <pre>
var fontRanga=PreloadGooglefont("'Ranga', cursive");
// Il est en général nécessaire d'attendre un temps de préchargement d'environ 1s avant de pouvoir utiliser la police
setTimeout(function () {
  setCanvasFont(fontRanga, '25pt', '');
  Text(100,100,'Bonjour le monde !','blue');
}, 1000);
</pre></div></div>
<span>DrawImage(imageurl,x,y,w,h);</span><div><div>Place une image dans le canvas. L'image, donnée par son url est placée au point de coordonnées x,y et affichée avec une largeur w et une hauteur h. L'utilisation de cette fonction est complexe, notamment car il y a des processus de sécurités développés par le serveur pour empêcher l'utilisation frauduleuse d'images externes (Il est possible d'utiliser ce type d'images mais il faut avoir au préalable desactivé la fonctionnalité "Tortue" de l'interface via l'instruction turtleEnabled=false;). Voici deux exemples:<ul>
<li>Utilisation d'une url externe.
<pre>
turtleEnabled=false;
Initialiser();
DrawImage('https://algoscript.info/Logo.png',150,200,200,100);
</pre>
</li>
<li>Utilisation d'une image du gestionnaire de fichiers interne (compatible avec l'utilisation de la tortue). <em>Il faut avoir intégré l'image correspondante dans le gestionnaire de fichiers interne</em> par la procédure suivante: aller dans GestionsFichiers, puis dans "External FS". Parcourez votre disque pour sélectionner l'image (imaginons qu'elle s'appelle 'image.png' sur votre disque). Cliquez sur "Data file to Internal FS". Normalement vous devriez voir apparaître le fichier image.png dans le répertoire Data du gestionnaire de fichiers interne. Pour l'utiliser,
<pre>
Initialiser();
DrawImage(readFile('Data/image.png'),150,200,100,100);
</pre>
</li>
</ul></pre></div></div>
<span>PreloadImage(imageurl)/DrawImageObject(image,x,y,w,h);</span><div><div>Précharge une image à partir d'une url. L'image, stockée dans une variable, peut être affichée par la suite grâce à DrawImageObject (même utilisation et limitations que DrawImage). Ce procédé de préchargement d'images est beaucoup plus optimal que sa version sans préchargement.
Il est aussi utile d'utiliser la fonction WaitPreload(f) qui s'assure que toutes les images sont bien préchargées avant d'exécuter la fonction f. Voici deux exemples:<ul>
<li>Utilisation d'une url externe.
<pre>
turtleEnabled=false;
Initialiser();
var MonImage=PreloadImage('https://algoscript.info/Logo.png');

function A_Executer() {
   DrawImageObject(MonImage,150,200,200,100);
}

WaitPreload(A_Executer);
</pre>
</li>
<li>Utilisation d'une image du gestionnaire de fichiers interne (compatible avec l'utilisation de la tortue). <em>Il faut avoir intégré l'image correspondante dans le gestionnaire de fichiers interne</em> par la procédure suivante: aller dans GestionsFichiers, puis dans "External FS". Parcourez votre disque pour sélectionner l'image (imaginons qu'elle s'appelle 'image.png' sur votre disque). Cliquez sur "Data file to Internal FS". Normalement vous devriez voir apparaître le fichier image.png dans le répertoire Data du gestionnaire de fichiers interne. Pour l'utiliser,
<pre>
Initialiser();
var MonImage=PreloadImage(readFile('Data/image.png'));

function A_Executer() {
   DrawImageObject(MonImage,150,200,100,100);
}

WaitPreload(A_Executer);
</pre>
</li>
</ul></pre></div></div>
<span>rgb(cr,cv,cb); rgba(cr,cv,cb, opacité);</span><div><div>Définit une couleur en fonction de ses composantes de rouge, vert et bleu (trois entiers entre 0 et 255), et pour rgba d'un coefficient d'opacité compris entre 0 et 1. Ceci peut être placé à chaque fois qu'une couleur est demandée. En général, l'attribut couleur peut être soit un nom 'red', 'blue',..., soit rgb(10,100,255), soit GradientLineaire('red',rgb(10,100,255),0,0,500,600);<br/>Exemple:
<pre>
RectanglePlein(200,200,300,50,rgb(255,0,255));

// ou un autre exemple
for(var i=0; i<10; i=i+1) {
   RectanglePlein(Hasard(500),Hasard(500),50,50,rgb(Hasard(255),Hasard(255),Hasard(255)));
}

RectanglePlein(200,200,300,50,rgba(255,0,255,0.5));
RectanglePlein(350,225,300,50,rgba(255,0,255,0.5));

</pre></div></div>
<span>GradientLineaire(couleur1,couleur2,xd,yd,xf,yf);</span><div><div>Définit un gradient de couleur entre deux couleurs (couleur1 et couleur2). Les points situés en xd,yd auront pour couleur couleur1, ceux situés en xf,yf auront pour couleur couleur2, les autres auront un mélange des deux couleurs.<br/>Exemple: <pre>CerclePlein(200,200,50,GradientLineaire('red','yellow',150,200,250,200));</pre></div></div>
<span>ShadowOn(); ShadowOff();</span><div><div>Active ou désactive l'effet d'ombre. Lorsque l'effet est activé, tout ce qui est tracé apparaît avec une légère ombre<br/>Exemple:
<pre>
ShadowOn();
RectanglePlein(100,100,200,80,'red');
ShadowOff();
RectanglePlein(100,200,200,80,'red');
</pre></div></div>
</dt>
<dd>Fonctions usuelles pour le mode graphique.</dd>
<dt>
<span>CaractereEn(ch,i);</span><div><div>Renvoie le caractère à l'indice i de la chaîne ch (le premier caractère est à l'indice 0). La notation ch[i] est un équivalent à cette fonction.<br/>Exemple: <t>Ecrire(CaractereEn('Bonjour',3));</t> affiche 'j'.</div></div>
<span> Longueur(ch);</span><div><div>Renvoie la longueur de la chaîne ch.<br/>Exemple: <t>Ecrire(Longueur('Bonjour'));</t> affiche 7.</div></div>
<span> SousChaine(ch,debut,longueur);</span><div><div>Renvoie un sous-chaîne composée des longueur caractères de la chaîne ch à partir de l'indice début.<br/>Exemple: <t>Ecrire(SousChaine('Bonjour',3,2));</t> affiche 'jo'.</div></div>
<span> PositionDans(ch,ch_cherchee);</span><div><div>Renvoie la première occurrence de la chaîne cherchée dans la chaîne ch (ou -1 si elle ne s'y trouve pas).<br/>Exemple: <t>Ecrire(PositionDans('Bonjour','jour'));</t> affiche 3.</div></div>
</dt>
<dd>Fonctions de manipulation de cha&icirc;nes de caract&egrave;res.</dd>
<dt>
<span> Caractere_vers_Ascii(c);</span><div><div>Renvoie le code ASCII du caractère c (fonctionne aussi avec les caractères UTF-8).<br/>Exemple: <t>Ecrire(Caractere_vers_Ascii('A'));</t> affiche 65.</div></div>
<span> Ascii_vers_Caractere(n);</span><div><div>Renvoie le caractère correspondant au code ASCII n (fonctionne aussi avec les caractères UTF-8).<br/>Exemple: <t>Ecrire(Ascii_vers_Caractere(66));</t> affiche 'B'.</div></div>
<span> Majuscule(c);</span><div><div>Transforme une letre en majuscule lorsque c'est possible.<br/>Exemple: <t>Ecrire(Majuscule('é'));</t> affiche 'E'.</div></div></dt>
<dd>Fonctions de manipulation de caract&egrave;res.</dd>
<dt><span>Tableau(n); </span><div><div>Crée un tableau de taille n (toutes les cases de ce tableau sont non définies). Les autres manières de déclarer sont:
<ul>
<li>En donnant la liste de ses valeurs: var T=[1,2,3];</li>
<li>En créant un tableau de taille 0: var T=[];</li>
<li>En l'objet javascript Array.</li>
</ul>
On accède alors à l'élément du tableau situé à l'indice i par T[i].
</div></div>
<span>Tableau(n,k); </span><div><div>Crée un tableau 2D de taille n x k (toutes les cases de ce tableau sont non définies).
On accède alors à l'élément du tableau situé dans la case (i,j) par T[i][j].
</div></div>
<span>Taille(T); </span><div><div>Renvoie la taille du tableau T.<br/>Exemple:
<pre>var T=[3,4,5];
Ecrire(Taille(T));</pre> affiche 3.</div></div>
<span>AfficherTableau(T); </span><div><div>Affiche le tableau, y compris s'il est à deux dimensions.<br/>Exemple:
<pre>var T=[[2,6],[4,5],[7,8]];
AfficherTableau(T);</pre> affiche
<pre>
2	6
4	5
7	8
</pre></div></div>
<span>AfficherCourbe(T);</span><div><div>Trace (dans la fenêtre graphique) la courbe correspondant aux valeurs stockées dans le  tableau (si le tableau est à deux dimensions, les valeurs d'abscisses sont celles d'indice 0 et les valeurs des ordonnées sont celles d'indice 1).<br/>Exemple:
<pre>var T=[[2,6],[4,5],[7,8]];
AfficherCourbe(T);</pre>
Il y a un certain nombre d'options à cette fonction. Voici sa syntaxe complète: AfficherCourbe(T,addition,remplissage,couleur,type,epaisseur) où
<ul>
<li>addition est un booléen (défaut false) qui indique si la courbe doit être tracée dans le même repère que la courbe précédente.</li>
<li>remplissage est un booléen (défaut true) qui indique si l'aire sous la courbe doit être tracée.</li>
<li>couleur est la couleur de la courbe (défaut rouge).</li>
<li>type est le type de tracé des points de la courbe. Peut-être 'O' (un gros point, c'est le défaut), 'X' (une croix) ou ' ' (rien du tout).
<li>épaisseur est l'épaisseur de la courbe (défaut 2).</li>
</ul>
</div></div>
<span>InitialiserTableau(T, valeur);</span><div><div>Donne à toutes les cases du tableau T la même valeur.<br/>Exemple: <pre>var T=Tableau(5);
InitialiserTableau(T, 0);
</pre></div></div>
<span>ConcateneTableaux(T1,T2);</span><div><div>Construit un tableau qui est la concatenation des deux tableaux T1 et T2.</div></div>
<span>CombineTableauxL(T1,T2);</span><div><div>Construit un tableau à deux dimensions dont la première colonne est T1 et la deuxième colonne est T2.</div></div>
<span>CombineTableauxC(T1,T2);</span><div><div>Construit un tableau à deux dimensions dont la ligne colonne est T1 et la deuxième ligne est T2.</div></div>
<span>Renverser(T);</span><div><div>Construit l'inverse du tableau T.</div></div>
<span>OrdreNumerique(T);</span><div><div>Trie le tableau T en utilisant un ordre numérique.</div></div>
<span>OrdreLexicographique(T);</span><div><div>Trie le tableau T en utilisant un ordre lexicographique.</div></div>
<span>SousTableau(T, debut, longueur);</span><div><div>Extrait du tableau T un sous-tableau de taille longueur à partir de l'indice début.</div></div>
</dt>
<dd>Fonctions de manipulation de tableaux.</dd>
<dt>
<span>ChargerSon(url); </span><div><div>Renvoie un objet audio, chargé à partir d'une url, qui peut être joué par la suite avec la méthode play(). Les formats sonores supportés dépendent du navigateur (les fichiers .wav sont les plus largement supportés). Voici deux exemples d'utilisation:<ul>
<li>Utilisation d'une url externe.
<pre>
var son=ChargerSon('http://www.moviesoundscentral.com/sounds/star_wars/empire_strikes_back/jedi3.wav');
son.play();
</pre>
</li>
<li>Utilisation d'un son du gestionnaire de fichiers interne. <em>Il faut avoir intégré l'image correspondante dans le gestionnaire de fichiers interne</em> par la procédure suivante: aller dans GestionsFichiers, puis dans "External FS". Parcourez votre disque pour sélectionner le fichier son (imaginons qu'il s'appelle 'son.wav' sur votre disque). Cliquez sur "Data file to Internal FS". Normalement vous devriez voir apparaître le fichier son.wav dans le répertoire Data du gestionnaire de fichiers interne. Pour l'utiliser,
<pre>
var son=ChargerSon(readFile('Data/son.wav'));
son.play();
</pre>
</li>
</ul></pre></div></div>
<span>CreerSon(Tableau,Echantillonnage); </span><div><div>Renvoie un objet audio, créé à partir du tableau donné (d'entiers compris entre 0 et 255) correspondant à un échantillonnage de ce son à la fréquence d'échantillonnage donnée. Il peut être joué par la suite avec la méthode play(). <br/>Exemple:
<pre>
var data=[]; for(var i=0; i<22050; i++) {data[i]=128+Math.floor(127*Math.sin(i*0.125315));}
var LA=CreerSon(data,22050);
LA.play();
</pre>
</div></div>
<span>CreerSon16bits(Tableau,Echantillonnage); </span><div><div>Renvoie un objet audio, créé à partir du tableau donné (de réels compris entre -1 et 1) correspondant à un échantillonnage de ce son à la fréquence d'échantillonnage donnée. Il peut être joué par la suite avec la méthode play(). La différence avec CreerSon est que le son généré est un son en 16bits, de meilleure qualité.<br/>Exemple:
<pre>
var data=[]; for(var i=0; i<22050; i++) {data[i]=Math.sin(i*0.125315));}
var LA=CreerSon16bits(data,22050);
LA.play();
</pre>
</div></div>
<span>ImportSon(nomfichier); SampleRate(nomfichier);</span><div><div>Renvoie le tableau de valeur correspondant au son stocké dans le fichier (uniquement format .wav, une seule voie, 8bits). Le son doit se trouver dans le gestionnaire de fichiers interne. Le tableau obtenu peut ensuite être manipulé et rejoué par exemple en utilisant la fonction CreerSon. Pour récupérer le taux d'échantillonnage du son, il faut utiliser la fonction SampleRate.
<pre>
var data=ImportSon('Data/jedi3.wav');
var SR=SampleRate('Data/jedi3.wav');
var son=CreerSon(data,SR*1.5);
son.play();
</pre>
</div></div>
<span>SauverSon(nomfichier, data, samplerate);</span><div><div>Génère le son au format .wav et l'enregistre dans le gestionnaire de fichiers interne. Il peut ensuite être rechargé avec la fonction ChargerSon.
</div></div>
<span>ExportSon(data, samplerate);/ExportSon16bits(data, samplerate); </span><div><div>Génère le son au format .wav et avec le son chargé sous forme d'url. Il peut alors être enregistré (via le navigateur) sur le disque et joué avec n'importe quel autre outil.
</div></div>
<span>NormaliserSon(data); </span><div><div>Crée un tableau d'entiers entre 0 et 255 à partir d'un tableau de réels entre -1 et 1.
</div></div>
<span>StartMicrophone(function (T) {...}); StopMicrophone();</span><div><div>donne accès au microphone. Le son est découpé en tableau de réels compris entre -1 et 1 que la fonction gère en temps réel. StopMicrophone() stoppe la connection avec le micro.
<pre>
// un oscilloscope très simple
StartMicrophone(function (T) {T[0]=-1; T[1]=1; AfficherCourbe(T,false,false,'red','',1);});

function MouseClick(x,y) {
  StopMicrophone();
}
</pre>
</div></div>
<span>StartWebcam(function (T) {...}); StopWebcam();</span><div><div>Donne accès à la webcam. Le signal video est obtenu sous la forme d'une imageData (cf <a href="http://www.w3schools.com/tags/ref_canvas.asp">here</a> pour une référence) qui est traité par la fonction passée en paramètre. StopWebcam() arrête le traitement.
<pre>
// Un exemple simple qui affiche le signal sur la sortie graphique
StartWebcam(function (T) {ctx.putImageData(T,0,0)});

function MouseClick(x,y) {
  StopWebcam();
}
</pre>
</div></div>
<span>StartSpeechRecognition(function (T) {...}); </span><div><div>Sous Chrome uniquement. Donne accès à l'API de reconnaissance vocale. Le discours est interprété fragment par fragment sous la forme d'une cha&icirc;ne de caract&egrave;res destinée à être traitée par la fonction fournie. Rq: setLanguage(lang) permet de changer la langue de reconnaissance (eg. setLanguage('fr-FR') ou setLanguage('en-US')).
<pre>
// un exemple simple qui répète tout ce qu'on dit
StartSpeechRecognition(EcrireAudio);
</pre>
</div></div>
</dt>
<dd>Fonctions de cr&eacute;ation de son (&agrave; partir d'un fichier ou directement en g&eacute;n&eacute;rant le son). A chaque fois, on objet HTMLAudio est retourn&eacute; qui peut &ecirc;tre jou&eacute; par sa m&eacute;thode play().</dd>
<dt>
<span>Hasard(n); </span><div><div>Renvoie un nombre au hasard (uniforme) compris entre 0 et n-1. <br/>Exemple: <t>Ecrire(Hasard(10));</t></div></div>
<span>chronometre(codeJS);</span><div><div>Renvoie le temps d'exécution en millisecondes mis par le code AlgoScript. <br/>Exemple: <pre>
Ecrire(chronometre('var c; for(var i=0; i<1000000; i++) {c=c+i;}'));
</pre></div></div>
<span>getEntreetexte(); setEntreetexte(chaine);</span><div><div>Permet de manipuler la fenêtre d'entrée de texte long. getEntreetexte() retourne une chaîne de caractère correspondant au contenu de la fenêtre et setEntreetexte(chaine) remplace le contenu de la fenêtre par le contenu de chaîne.</div></div>
<span>HTMLoutput(ch);</span><div><div>Interpr&egrave;te le code HTML stock&eacute; dans la cha&icirc;ne ch. Le r&eacute;sultat est affich&eacute; dans la fen&ecirc;tre de sortie HTML. NB: cette fonctionnalit&eacute; se combine tr&egrave;s bien avec le champ d'entrée de texte long (taper le code HTML dans le champ de texte long et interpr&eacute;ter le r&eacute;sultat via la commande "HTMLoutput(getEntreetexte());" dans la fen&ecirc;tre Code JS).</div></div>
</dt>
<dd>Divers.</dd>
<dt>
<span>includeFile(filename);</span><div><div>Exécute le contenu du fichier filename. Cette fonction permet par exemple de travailler avec des bibliothèques de fonctions (ex: <t>includeFile('Library/libRS.js');</t>).</div></div>
<span>readFile(filename);</span><div><div>Lire le contenu du fichier filename et retourne la chaîne de caractères correspondante.</div></div>
<span>writeFile(filename,content);</span><div><div>Sauvegarde le contenu content dans le fichier filename.</div></div>
<span>removeFile(filename);</span><div><div>Supprime le fichier filename.</div></div>
<span>renameFile(oldname, newname);</span><div><div>Renomme le fichier de oldname à newname.</div></div>
<span>ls();</span><div><div>Ecrit la liste de tous les fichiers contenu dans le gestionnaire de fichiers internes.</div></div>
<span>FileExists(filename)</span><div><div>Teste si un fichier existe dans le gestionnaire de fichiers internes.</div></div>
</dt>
<dd>Fonctions de gestion de fichiers (en particulier, includeFile permet d'inclure le code d'une biblioth&egrave;que au moment de l'ex&eacute;cution du code).</dd>
</dl>
<h2>Inspecteur de variables</h2>
L'inspecteur de variables permet de suivre l'&eacute;volution des valeurs des variables au cours de l'ex&eacute;cution. Les valeurs de variables saisies dans le champ Inspecteur (noms de variables s&eacute;par&eacute;s par des virgules) sont calcul&eacute;es &agrave; chaque fois qu'un ; est rencontr&eacute;. Un tableau r&eacute;capitulatif des diff&eacute;rentes valeurs est affich&eacute; &agrave; la fin de l'ex&eacute;cution.

<div id="exemples" style="font-size: 1.3em;">
<h2>Quelques exemples</h2>
<script type="text/javascript">
ConstruitExemples();
for(var i=0; i<20; i++) document.write('<br/>');
</script>
</div>

<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
</div>
</div>
<div id="divtuto" style="background-image: url(help.png); background-size: cover;">
<h3 style="text-align:center;">AlgoScript: a multi-platform development tool for javascript</h3>
<table>
<tr><th>
<img src="icons/run_32.png" id="MemExec" class="fleche" alt="Exec"/>
<!-- <input value="&#x2714;" style="color:green;" type="button" class="fleche"> -->
</th>
<td>
Execution
</td>
</tr>
<tr><th>
<img src="icons/indent_32.png" id="MemIndent" class="fleche" alt="Indent"/>
<!-- <input value="&#x21F6;" style="color:black;" type="button" class="fleche">-->
</th>
<td>
Automatic indentation
</td>
</tr>
<tr>
<th>
<img src="icons/save32.png" id="MemSave" class="fleche" alt="Save"/>
</th>
<td>
Save a script file
</td>
</tr>
<tr>
<th>
<img src="icons/lock_32.png" style="background-color: white;" id="MemLock" class="fleche" alt="Lock"/>
<img src="icons/lock_32.png" style="background-color: red;" id="MemUnlock" class="fleche" alt="Unlock"/>
</th>
<td>
Lock/unlock a window and split the screen in two parts.
</td>
</tr>
<tr>
<th style="width: 100px">
<span style="color: black; font-size: 1em; font-family: helvetica, arial, sans-serif; border: none; font-style: italic; font-weight: bold;">Code JS</span>
</th>
<td>
Name of the current window
</td>
</tr>
<tr>
<th>
<label style="vertical-align: middle; font-style: italic; font-size: 0.7em; font-family: helvetica, sans-serif, arial; color: blue">Inspect&nbsp;<input class="other" type="text" style="color: blue; background-color: white; width: 10px;" value=""/></label>
</th>
<td>
Variable inspector/construction of an execution trace
</td>
</tr>
<tr>
<th>
<img id="MemCollaborate" src="icons/collaborate_32.png" alt="Left" style="color:black; width:24px; height: 24px;"  class="fleche"/>
</th>
<td>
Start/Stop the collaborative mode.
</td>
</tr>
<tr>
<th>
<img src="icons/resize_32.png" id="MemResize" class="fleche" alt="Resize"/>
</th>
<td>
Start/Stop the fullscreen mode.
</td>
</tr>
</table>
</div>
	</form>
<div style="visibility: hidden; overflow: auto;" id="weboutput"><iframe id="frameweboutput"></iframe></div>
<div style="visibility: hidden; overflow: auto;" id="credits">
<h1>Developer</h1>
<ul>
<li>J&eacute;r&eacute;mie Bourdon</li>
</ul>
<h1>Contributors</h1>
<ul><li>Cl&eacute;ment Grenier</li></ul>
<h1>External libraries</h1>
<ul>
<li><a target="_blank" href="http://codemirror.net/">CodeMirror</a></li>
<li><a target="_blank" href="http://jsbeautifier.org/">JS Beautifier</a></li>
</ul>
<h1>Known bugs</h1>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
</div>
    <script>
      var editor = CodeMirror.fromTextArea(GEBID("lecode"), {
        extraKeys: {"Ctrl-Space": "autocomplete"},
        mode: {name: "javascript", globalVars: true},
//    	extraKeys: {"Ctrl-Q": function(cm){ cm.foldCode(cm.getCursor()); }},
//    	foldGutter: true,
//    	gutters: ["CodeMirror-lint-markers", "CodeMirror-linenumbers", "CodeMirror-foldgutter"],
    	gutters: ["CodeMirror-lint-markers", "CodeMirror-linenumbers"],
        lineNumbers: true,
        matchBrackets: true,
    	styleActiveLine: true,
	    lint: true
      });





    </script>
<div id="filebox"></div>
<div style="display: none">
<textarea id="Libraries">
Cours_3/JeuDeDes.js
--------------
setCanvasFont('arial', '14pt', 'bold');

RectanglePlein(100, 100, 100, 100, 'blue');
RectanglePlein(200, 100, 100, 100, 'red');
Texte(140, 80, 'L\'amphi', 'black');
Texte(140, 150, 'Go', 'black');
Texte(240, 150, 'Stop', 'black');
RectanglePlein(600, 100, 100, 100, 'blue');
RectanglePlein(700, 100, 100, 100, 'red');
Texte(640, 80, 'Le prof', 'black');
Texte(640, 150, 'Go', 'black');
Texte(740, 150, 'Stop', 'black');
var score = Tableau(3);
var scoreserie = Tableau(3);
score[1] = 0;
score[2] = 0;
scoreserie[1] = 0;
scoreserie[2] = 0;
t = 0;
joueur = 1;
var lancer = 0;
var ll = 0;
afficherfleche();

function afficherfleche() {
  RectanglePlein(360, 100, 150, 50, 'white');
  RectanglePlein(400, 120, 60, 20, 'green');
  if (joueur == 1) PolygonePlein(380, 130, 400, 110, 400, 150, 'green');
  else PolygonePlein(490, 130, 460, 110, 460, 150, 'green');


}

function joueruncoup(i) {
  lancer = Hasard(6) + 1;
  if ((joueur == 2) && (lancer == 1)) lancer = Hasard(6) + 1; //la ligne du tricheur
  afficherlancer(joueur, lancer);
  if (lancer == 1) {
    joueur = prochainjoueur(joueur);
    scoreserie[i] = 0;
  } else scoreserie[i]++;
}

function MouseClick(x, y) {
  setCanvasFont('arial', '48pt', 'bold');
  if ((joueur == 1) && (x > 100 && x < 200) && (y > 100 && y < 200)) {
    joueruncoup(1);
    RectanglePlein(220, 10, 100, 70, 'yellow');
    Texte(245, 70, score[1], 'black');
    RectanglePlein(320, 10, 100, 70, 'grey');
    Texte(345, 70, scoreserie[1], 'white');

  }
  if ((joueur == 1) && (x > 200 && x < 300) && (y > 100 && y < 200)) {
    score[joueur] = score[joueur] + scoreserie[joueur];
    joueur = 2;
    RectanglePlein(220, 10, 100, 70, 'grey');
    Texte(245, 70, score[1], 'black');
    scoreserie[1] = 0;
  }
  if ((joueur == 2) && (x > 600 && x < 700) && (y > 100 && y < 200)) {
    joueruncoup(2);
    RectanglePlein(720, 10, 100, 70, 'yellow');
    Texte(745, 70, score[2], 'black');
    RectanglePlein(820, 10, 100, 70, 'grey');
    Texte(845, 70, scoreserie[2], 'white');
  }
  if ((joueur == 2) && (x > 700 && x < 800) && (y > 100 && y < 200)) {
    score[joueur] = score[joueur] + scoreserie[joueur];
    joueur = 1;
    RectanglePlein(720, 10, 100, 70, 'yellow');
    Texte(745, 70, score[2], 'black');
    scoreserie[2] = 0;
  }
  afficherfleche();
  if (score[1] > 20) {
    setCanvasFont('arial', '24pt', 'bold');
    Texte(340, 300, 'L\'amphi a gagné', 'black');
  }
  if (score[2] > 20) {
    setCanvasFont('arial', '24pt', 'bold');
    Texte(340, 300, 'Le prof a gagné', 'black');
  }
}

function prochainjoueur(j) {
  if (j == 1) j = 2;
  else j = 1;
  return (j);
}

function afficherlancer(joueur, lancer) {
  if (joueur == 1) decalage = 0;
  else decalage = 500;
  dh = 70 + decalage;
  dv = 150;
  if (lancer == 1) {
    couleur = 'red';
    RectanglePlein(100 + dh, 100 + dv, 100, 100, couleur);
    CerclePlein(150 + dh, 150 + dv, 15, 'white');
  } else if (lancer == 2) {
    couleur = 'blue';
    RectanglePlein(100 + dh, 100 + dv, 100, 100, couleur);
    CerclePlein(120 + dh, 120 + dv, 15, 'white');
    CerclePlein(180 + dh, 180 + dv, 15, 'white');
  } else if (lancer == 3) {
    couleur = 'violet';
    RectanglePlein(100 + dh, 100 + dv, 100, 100, couleur);
    CerclePlein(120 + dh, 120 + dv, 15, 'white');
    CerclePlein(180 + dh, 180 + dv, 15, 'white');
    CerclePlein(150 + dh, 150 + dv, 15, 'white');
  } else if (lancer == 4) {
    couleur = 'green';
    RectanglePlein(100 + dh, 100 + dv, 100, 100, couleur);
    CerclePlein(120 + dh, 120 + dv, 15, 'white');
    CerclePlein(120 + dh, 180 + dv, 15, 'white');
    CerclePlein(180 + dh, 120 + dv, 15, 'white');
    CerclePlein(180 + dh, 180 + dv, 15, 'white');
  } else if (lancer == 5) {
    couleur = 'pink';
    RectanglePlein(100 + dh, 100 + dv, 100, 100, couleur);
    CerclePlein(120 + dh, 120 + dv, 15, 'white');
    CerclePlein(120 + dh, 180 + dv, 15, 'white');
    CerclePlein(180 + dh, 120 + dv, 15, 'white');
    CerclePlein(180 + dh, 180 + dv, 15, 'white');
    CerclePlein(150 + dh, 150 + dv, 15, 'white');
  } else {
    couleur = 'brown';
    RectanglePlein(100 + dh, 100 + dv, 100, 100, couleur);
    CerclePlein(120 + dh, 120 + dv, 15, 'white');
    CerclePlein(120 + dh, 150 + dv, 15, 'white');
    CerclePlein(120 + dh, 180 + dv, 15, 'white');
    CerclePlein(180 + dh, 120 + dv, 15, 'white');
    CerclePlein(180 + dh, 150 + dv, 15, 'white');
    CerclePlein(180 + dh, 180 + dv, 15, 'white');
  }
  return (lancer);
}

//Cette fonction est supposée donner l'illusion d'un lancer aléatoire. Hum....

function Animation(t, joueur, lancer) {
  if (t < 4) {
    lancer = Hasard(6) + 1;
    afficherlancer(joueur, lancer);
    if (lancer == 1) joueur = prochainjoueur(joueur);
    Ecrire('c' + t + ' ' + lancer + ' ' + ll);
    t = t + 1;
    setTimeout('Animation(' + t + ',' + joueur + ',' + lancer + ')', 100 * t);
  } else {
    lancer = afficherlancer(joueur);
    Ecrire('d' + t + ' ' + lancer + ' ' + ll);
  }
}
--------------
Examples/Demos.js
--------------
// Appuyez sur la touche exécuter [>]
// Indentez votre code avec [Indentation]

// Voici une petite visite guidée en attendant...
// Quelques exemples
// Se placer sur la fenêtre CodeJS
MontreFenetre(0);

// 1] Utiliser la bibliothèque graphique
// Aller directement sur la sortie graphique
MontreFenetre(2);
// Effacer l'écran
Initialiser();

// Lui donner une résolution indépendante de la taille de l'écran
Viewport(0, 0, 600, 400, 1);

// Quelques Rectangles
for (var i = 0; i < 20; i++) {
  var x = Hasard(600);
  var y = Hasard(400);
  RectanglePlein(x, y, Hasard(600 - x), Hasard(400 - y), rgb(Hasard(256), Hasard(256), Hasard(256)));
}
// Quelques Lignes
for (var i = 0; i < 100; i++) {
  Ligne(Hasard(600), Hasard(400), Hasard(600), Hasard(400), rgb(Hasard(256), Hasard(256), Hasard(256)));
}

alert('Quelques dessins\nContinuez la démonstration');

// 2] Utiliser la bibliothèque graphique via la tortue
Initialiser();
Viewport(0, 0, 600, 400, 1);

// Placer la tortue au centre de l'écran
Deplacer(100, 100);
for (var i = 0; i < 5; i++) {
  Avancer(100);
  Droite(720 / 5);
}

alert('Quelques dessins avec la tortue\nContinuez la démonstration');

// 3] Utiliser la bibliothèque graphique pour tracer des courbes
var data1 = new Array();
var data2 = new Array();
for (var i = 0; i < 360; i++) {
  data1[i] = Math.sin(4 * i * Math.PI / 180);
  data2[i] = 1.5 * Math.sin(6 * i * Math.PI / 180);
}
AfficherCourbe(data2);
AfficherCourbe(data1, true, false, '.', 'green', 2);

alert('Deux courbes\nContinuez la démonstration');


// 4] Utiliser la bibliothèque de son (sauf sur smartphones et tablettes)
MontreFenetre(-2);
// Charger un son à partir de son url
var unson = ChargerSon('http://dl.dropbox.com/u/1961350/jazzy.wav');
// Jouer le son
unson.play();

alert('Attendez la fin de la musique et\nContinuez la démonstration');

// Créer un son de toute pièce, par exemple un LA (440Hz), fréquence d'échantillonnage 11025Hz
var data = new Array();
for (var i = 0; i < 11025; i++) data[i] = Math.round(128 + 127 * Math.sin(i * 440 / 11025 * 2 * Math.PI));
var unautreson = CreerSon(data, 11025);
// Jouer ce son
unautreson.play();

alert('Attendez la fin du LA et\nContinuez la démonstration');

// 5] Utiliser la sortie HTML
// Aller automatiquement sur la fenêtre de sortie HTML
MontreFenetre(4);

alert('Continuez la démonstration');
HTMLoutput('<h1>Venez voir ce qui sort sur la sortie HTML</h1>');


alert('Continuez la démonstration');

// Taper maintenant quelques lignes d'HTML dans l'onglet "Entrée Texte", elles seront affichées par la commande
HTMLoutput(texte_a_etudier());

alert('Continuez la démonstration');

MontreFenetre(-3);
Ecrire('Allez voir sur le Memento pour d\'autres démos !');

setTimeout('MontreFenetre(-1);', 1500);
------------------
Library/libTALN.js
------------------
function code(car)
{// renvoie le code du caractère car
 return car.charCodeAt(0);
}

function caractere(c)
 {// renvoie le caractère dont le code est c
  return (String.fromCharCode(c));
 }

function ordre (a, b)
{ // renvoie un indicateur d ordre pour le tri du tableau
   var t1 = a.match(/[0-9]+/);
   var t2 = b.match(/[0-9]+/);
   return (t2[0] - t1[0]);
}

function majuscule(car)
{// écrite pour le français, l allemand (sans ß) et l espagnol
  if ("éèêë".indexOf(car) != -1) {car = "e";}
  else if ("àâäá".indexOf(car) != -1) {car = "a";}
  else if ("îïí".indexOf(car) != -1) {car = "i";}
  else if ("ôöó".indexOf(car) != -1) {car = "o";}
  else if ("ùûüú".indexOf(car) != -1) {car = "u";}
  else if ("ç".indexOf(car) != -1) {car = "c";}
  else if ("ñ".indexOf(car) != -1) {car = "n";}
  return(car.toUpperCase());
}
------------------
Library/libRS.js
------------------
//Ne pas modifier la suite
//Bibliothèque de fonctions pour le TP RS

/*Remplissage de la table*/
var aime_bien=[
[true, true, false, true, false, false, true, false, false, false, false, true, false, true, false],
[true, true, true, true, false, false, true, false, true, true, false, true, false, true, false],
[true, true, true, false, false, false, true, false, true, false, false, true, false, true, false],
[true, true, false, true, false, false, true, false, false, true, true, true, false, true, false],
[true, true, false, true, false, false, true, false, false, true, false, true, true, true, true],
[true, true, false, true, true, false, true, false, false, false, false, true, true, false, false],
[true, false, false, false, true, true, true, true, true, false, true, true, false, true, false],
[true, false, false, true, true, false, false, true, false, false, true, false, false, true, false],
[true, true, false, true, false, true, false, true, true, false, true, true, false, true, false],
[true, false, true, false, false, true, true, true, false, true, false, false, true, true, true],
[true, false, false, false, true, true, true, true, true, false, false, true, true, false, true],
[true, false, false, true, true, false, true, false, true, true, false, true, false, false, true],
[true, false, true, true, true, false, false, false, true, true, false, true, false, false, true],
[true, false, true, false, false, true, true, true, false, true, true, false, false, false, false],
[false, true, false, false, true, false, true, false, true, true, false, false, true, false, true]
];

/*Remplissage de la table des noms*/
var noms=new Array ('alice', 'bob', 'colin', 'denis', 'eudes', 'francoise', 'greg', 'henri', 'irene', 'jean', 'kamel', 'lauriane', 'marc', 'norbert', 'octave') ;

/* Quelques fonctions basiques*/
function a_pour_ami(i,j)/*résultat est un booléen*/
/*retourne un Booléen indiquant si i a j pour ami*/
{ return(aime_bien[i][j]);}

function jolie_phrase(i,j)/*résultat est une chaîne*/
/*retourne un message indiquant si i aime j*/
{ var message;
  if (aime_bien[i][j])
     {message=noms[i]+ ' aime bien '+ noms[j];}
  else {message=noms[i]+" n'aime pas "+ noms[j];}
  return message
}

function prenom(i)/*résultat est une chaîne*/
/*retourne un message avec le prénom numéro i*/
{ return noms[i]}

function tous_les_prenoms()/*résultat est une chaîne*/
/*retourne un message avec tous les prénoms*/
{ var message = '';
  for (var j=0;j<Taille(noms);j++)
      {message=message+' '+noms[j];}
  return message
}

function numero(prenom)/*résultat est une chaine*/
/*retourne le numéro correpondant à prenom*/
{ var le_numero=-1;
  for (var j=0;j<Taille(noms);j++)
      {if (prenom==noms[j])
          {le_numero=j;}
      }
  return le_numero
}

function amis(i)/*résultat est une chaîne*/
/*retourne un message avec tous les prénoms des amis de i*/
{ var message='';
  for (var j=0;j<Taille(noms);j++)
      { test=aime_bien[i][j];
        if( test ){message=message+' '+noms[j];}
	  }
  return message
}

function compte_amis(i)/*résultat est un entier*/
/*retourne le nombre des amis de i*/
{ var accumulateur=0;
  for (var j=0;j<Taille(noms);j++)
      {test=aime_bien[i][j];
       if (test){accumulateur++;}
	  }
  return accumulateur
}
-----------------
Library/libBioInfo.js
-----------------
function ElementTableau2D(T,i,j) {return T[i][j];}
var TabExo30=[10,35,82,60,80,105,100,120,146,122,151,133,146,140,112,87,95,58,41,64,20,15,41,30,44,84,78,82,94,158,140,150,142,171,160,198,159,216,200,196];
var TabExo3=TabExo30;
var TabExo31=[[1,15],[8,3],[21,38],[24,18],[50,94],[55,68],[58,76],[61,68],[63,70],[70,47],[77,65],[80,57],[85,67],[98,53],[108,102],[132,54],[135,60],[153,25]];
var TabExo4=TabExo31;
var TabExo34=[[0,0.04],[0,0.02],[30,0],[40,0.02],[80,0.12],[100,0.08],[120,0.06],[120,0.15],[140,0.16],[150,0.11],[170,0.17],[180,0.12]];
var TabExo7=TabExo34;
var TabExo35=[[7,5.5],[8,9.9],[9,4.2],[10,8.7],[12,10.7],[13,15.1],[14,13.9],[15,7.1],[17,13.7],[18,18.1],[19,11.3],[19,21.4],[20,15.7],[21,19],[23,17.7]];
var TabExo8=TabExo35;

-----------------
Examples/Mandelbrot.js
-----------------
Initialiser();
Viewport(0, 0, 300, 200, 1);
HideTurtle();
AfficheGraphique();
Mandelbrot();
DrawTurtle();

function TranslateX(x) {
  return x * 3 / 300 - 2;
}

function TranslateY(y) {
  return (y - 100) * 3 / 200;
}


function Mandelbrot() {
  var i;
  var j;
  for (i = 0; i < 300; i++) {
    for (j = 0; j < 200; j++) {
      var macouleur = CouleurMandelbrot(TranslateX(i), TranslateY(j));
      var chcouleur = 'rgb(' + ((macouleur * 4) % 256) + ',0,0)';
      RectanglePlein(i, j, 1, 1, chcouleur);
    }
  }
}

function module(x, y) {
  return Math.sqrt(x * x + y * y);
}

function CouleurMandelbrot(a, b) {
  var i = 0;
  var x = a;
  var y = b;
  do {
    var tmp = x;
    x = x * x - y * y + a;
    y = 2 * tmp * y + b;
    i++;
  }
  while ((module(x, y) < 2) && (i < 50));
  return 50 - i;
}
-----------------
Examples/LSYSTEMS_anime.js
-----------------
Initialiser();
Couleur('green');

var ch = Lsystems2('F', [
  ['F', 'FF-[-F+F+F]+[+F-F-F]']
], 3);

var t = 0;

function UnCran(ch, t) {
  Deplacer(0, 0);
  RectanglePlein(10, 10, 500, 350, 'white');
  Deplacer(300, 300);
  interprete(ch, 10, 40 * Math.cos(t * 3.14 / 180));
  HideTurtle();
}

function Animation(ch, t) {
  UnCran(ch, t);
  t = (t + 15) % 360;
  setTimeout('Animation("' + ch + '",' + t + ')', 20);
}

Animation(ch, t);


function Lsystems2(current, regles, n) {
  if (n < 1) return current;
  else {
    var res = '';
    var i;
    for (i = 0; i < Longueur(current); i++) {
      var flag = false;
      for (var j = 0; j < Taille(regles); j++) {
        if (current.charAt(i) == regles[j][0]) {
          res = res + regles[j][1];
          flag = true;
        }
      }
      if (!flag) res = res + current.charAt(i);
    }
    return Lsystems2(res, regles, n - 1);
  }
}


function interprete(ch, l, a) {
  var PositionsHeapX = Tableau(0);
  var PositionsHeapY = Tableau(0);
  var AngleHeap = Tableau(0);
  for (var i = 0; i < Longueur(ch); i++) {
    switch (ch.charAt(i)) {
    case 'F':
      Avancer(l);
      break;
    case '+':
      Droite(a);
      break;
    case '-':
      Gauche(a);
      break;
    case '[':
      PositionsHeapX.push(currentx);
      PositionsHeapY.push(currenty);
      AngleHeap.push(currentangle);
      break;
    case ']':
      Deplacer(PositionsHeapX.pop(), PositionsHeapY.pop());
      currentangle = AngleHeap.pop();
      break;
    }
  }
}
-----------------
Examples/LSYSTEMS_Foret.js
-----------------
Initialiser();
Deplacer(300, 300);
var ch = Lsystems2('F', [
  ['F', 'FF-[-F+F+F]+[+F-F-F]']
], 4);
Couleur('green');
interprete(ch, 5, 22.5);
Deplacer(400, 300);
interprete(ch, 4, -15);
Deplacer(100, 300);
interprete(ch, 3.5, 20);


function Lsystems2(current, regles, n) {
  if (n < 1) return current;
  else {
    var res = '';
    var i;
    for (i = 0; i < Longueur(current); i++) {
      var flag = false;
      for (var j = 0; j < Taille(regles); j++) {
        if (current.charAt(i) == regles[j][0]) {
          res = res + regles[j][1];
          flag = true;
        }
      }
      if (!flag) res = res + current.charAt(i);
    }
    return Lsystems2(res, regles, n - 1);
  }
}


function interprete(ch, l, a) {
  var PositionsHeapX = Tableau(0);
  var PositionsHeapY = Tableau(0);
  var AngleHeap = Tableau(0);
  for (var i = 0; i < Longueur(ch); i++) {
    switch (ch.charAt(i)) {
    case 'F':
      Avancer(l);
      break;
    case '+':
      Droite(a);
      break;
    case '-':
      Gauche(a);
      break;
    case '[':
      PositionsHeapX.push(currentx);
      PositionsHeapY.push(currenty);
      AngleHeap.push(currentangle);
      break;
    case ']':
      Deplacer(PositionsHeapX.pop(), PositionsHeapY.pop());
      currentangle = AngleHeap.pop();
      break;


    }
  }
}
-----------------
Examples/Tours_Hanoi_Animees.js
-----------------
var SequenceDeplacements=Tableau(0);

function Hanoi(n,tige1,tige2,tige3) {
   if (n > 0) {
      Hanoi(n-1, tige1, tige3, tige2);
      DeplacerCyl(tige1,tige3);
      Hanoi(n-1, tige2, tige1, tige3);
   }
}

function DeplacerCyl(T1,T2) {
	SequenceDeplacements.push(new Array(T1,T2));
}

var n=SaisieEntier();

Hanoi(n,0,1,2);

var Tiges=Tableau(0);
Tiges.push(Tableau(0));
Tiges.push(Tableau(0));
Tiges.push(Tableau(0));

for (var i=0; i < n; i++) {Tiges[0].push(n-i);}

function AfficheTiges() {
Ligne(50,90,350,90,'black');
	for(var i=0; i<3; i++) {
		var x=100*(i+1);
		Ligne(x,90,x,250);
		for (var j=0; j < Taille(Tiges[i]); j++) {
			var taillecyl=6*Tiges[i][j];
			RectanglePlein(x-taillecyl,100+j*15,taillecyl*2,12,rgb(255-Tiges[i][j]*30,0,0));
		}
	}
}

function AnimeUnCran(dep1,dep2) {
	Initialiser();
	ShadowOn();
	Viewport(0,0,400,300);
	AfficheTiges();
}

function Animation(i) {
	if (i < Taille(SequenceDeplacements)) {
		AnimeUnCran();
		var depl=SequenceDeplacements[i];
		Tiges[depl[1]].push(Tiges[depl[0]].pop());
		setTimeout(function () {Animation(i+1)},150);
	} else {AnimeUnCran(); Ecrire('fini !');}
}

Animation(0);
-----------------
Examples/EffetPlasma.js
-----------------
var palette = Tableau();
var cosTbl = Tableau();
var p1, p2, p3, p4, t1, t2, t3, t4;

function createPalette() {
  var i;
  for (i = 0; i < 64; i++) {
    palette[i] = rgb(4 * i, 4 * i, 0);
    palette[i + 64] = rgb(255, 255 - 4 * i, 0);
    palette[i + 128] = rgb(255 - 4 * i, 0, 4 * i);
    palette[i + 192] = rgb(0, 4 * i, 255 - 4 * i);
  }
}

function precalcCosinus() {
  var i;
  for (i = 0; i < 256; i++)
  cosTbl[i] = Math.floor(Math.cos(i * Math.PI / 128) * 32) + 32;
}

function dessinePlasma(qualite) {
  var x, y, col, pos;

  pos = 0;
  t1 = p1;
  t2 = p2;
  for (y = 0; y < 200; y += qualite) {
    t3 = p3;
    t4 = p4;
    for (x = 0; x < 320; x += qualite) {
      col = cosTbl[t1] + cosTbl[t2] + cosTbl[t3] + cosTbl[t4];
      RectanglePlein(x, y, qualite, qualite, palette[col]);
      pos++;
      t3 = (t3 + 255 - qualite) % 256;
      t4 = (t4 + 2 * qualite) % 256;
    }
    t1 = (t1 + 255 - 2 * qualite) % 256;
    t2 = (t2 + 2 * qualite) % 256;
  }
  p1 = (p1 + qualite) % 256;
  p2 = (p2 + 2 * qualite) % 256;
  p3 = (p3 + 255 - qualite) % 256;
  p4 = (p4 + 255 - 2 * qualite) % 256;
}

Initialiser();
Viewport(0, 0, 320, 200, 1);
createPalette();
precalcCosinus();
p1 = Hasard(256);
p2 = Hasard(256);
p3 = Hasard(256);
p4 = Hasard(256);

// Animation
function draw() {
  dessinePlasma(4);
}

Loop(10000);


-----------------
Examples/EffetPlasma_fast.js
-----------------

var palette = [];
var cosTbl = [];
var p1, p2, p3, p4, t1, t2, t3, t4;

function createPalette() {
  var i;
  for (i = 0; i < 64; i++) {
    palette[i] = [4 * i, 4 * i, 0];
    palette[i + 64] = [255, 255 - 4 * i, 0];
    palette[i + 128] = [255 - 4 * i, 0, 4 * i];
    palette[i + 192] = [0, 4 * i, 255 - 4 * i];
  }
}

function precalcCosinus() {
  var i;
  for (i = 0; i < 256; i++)
  cosTbl[i] = Math.floor(Math.cos(i * Math.PI / 128) * 32) + 32;
}


function dessinePlasma(qualite) {
  var x, y, col, pos;

  pos = 0;
  t1 = p1;
  t2 = p2;
  for (y = 0; y < 200; y += qualite) {
    t3 = p3;
    t4 = p4;
    for (x = 0; x < 320; x += qualite) {
      col = cosTbl[t1] + cosTbl[t2] + cosTbl[t3] + cosTbl[t4];

      image.data[4*pos]=palette[col][0];
      image.data[4*pos+1]=palette[col][1];
      image.data[4*pos+2]=palette[col][2];
      image.data[4*pos+3]=255;
      //RectanglePlein(x, y, qualite, qualite, palette[col]);
      pos++;
      t3 = (t3 + 255 - qualite) % 256;
      t4 = (t4 + 2 * qualite) % 256;
    }
    t1 = (t1 + 255 - 2 * qualite) % 256;
    t2 = (t2 + 2 * qualite) % 256;
  }
  p1 = (p1 + qualite) % 256;
  p2 = (p2 + 2 * qualite) % 256;
  p3 = (p3 + 255 - qualite) % 256;
  p4 = (p4 + 255 - 2 * qualite) % 256;
}

Initialiser();
Viewport(0, 0, 640, 400, 1);
createPalette();
precalcCosinus();
p1 = Hasard(256);
p2 = Hasard(256);
p3 = Hasard(256);
p4 = Hasard(256);
var image=ctx.createImageData(320,200);

function draw() {
  dessinePlasma(1);
  ctx.putImageData(image,0,0);
}

Loop(10000);

------------------
TP/Sons/exercice_2.js
--------
// LA à la guitare
var data = Tableau();
var note = 440;

// Q2 Tableau au hasard
var Decalage = Math.floor(22050 / note);
for (var i = 0; i < Decalage; i++) {
  data[i] = Hasard(200000) / 100000 - 1;
}

// Q3
var Attenuation = 0.995;

for (var i = Decalage; i < 22050; i++) {
  data[i] = Attenuation * (data[i - Decalage] + data[i - Decalage + 1]) / 2;
}

// Q4 => 8bits non signé
for (var i = 0; i < Taille(data); i++) {
  data[i] = 128 + Math.floor(128 * data[i]);
}

var son = CreerSon(data, 22050);
son.play();
-------------------
Examples/smallpaint.js
-------------------
Initialiser();
// Trace palette
var Couleurs = ['white', 'black', 'blue', 'red', 'yellow', 'green', 'orange', 'purple'];
RectanglePlein(0, 0, 50, size_canvas_y, rgb(200, 200, 200));
for (var i = 0; i < Taille(Couleurs); i = i + 1) {
  RectanglePlein(5, 5 + 50 * i, 40, 40, Couleurs[i]);
}

var CouleurCourante = 1;
MouseClick(5, 55);

function MouseMove(x, y) {
  if (x >= 50) {
    RectanglePlein(x - 5, y - 5, 10, 10, Couleurs[CouleurCourante]);
  }
}

function MouseClick(x, y) {
  if (x < 50) {
    RectanglePlein(0, 50 * CouleurCourante, 50, 50, rgb(200, 200, 200));
    RectanglePlein(5, 5 + 50 * CouleurCourante, 40, 40, Couleurs[CouleurCourante]);
    CouleurCourante = Math.min(Math.floor(y / 50), Taille(Couleurs) - 1);
    RectanglePlein(0, 50 * CouleurCourante, 50, 50, rgb(200, 100, 100));
    RectanglePlein(5, 5 + 50 * CouleurCourante, 40, 40, Couleurs[CouleurCourante]);
  } else {
    RectanglePlein(x - 5, y - 5, 10, 10, Couleurs[CouleurCourante]);
  }
}
--------------------
Play_with_clasp_nqueens.js
--------------------
// Clingo module must be enabled

// How lines generated by the grounding part must be interpreted
window.Interprete_grounding = function(ch) {
  // Do nothing
}

// How lines generated by the solving part must be interpreted
window.Interprete = function(ch) {
  if (PositionDans(ch, 'Answer') >= 0) {
    answerno++;
    Damier(n);
  }
  if (PositionDans(ch, 'occupied') >= 0) {
    var Tinst = ch.split(' ');
    for (var i = 0; i < Taille(Tinst); i++) {
      eval(Tinst[i]);
    }
    Ecrire(ch);
  }
};

function occupied(i, j) {
  DrawQueen(i - 1, j - 1);
}

function column(i) {}

function row(i) {}


// Graphical part
var taille = 20;
var nbanswersperlines = 6;

function Damier(n) {
  var decX = (n + 1) * taille * ((answerno - 1) % nbanswersperlines);
  var decY = (n + 1) * taille * Math.floor((answerno - 1) / nbanswersperlines);
  for (var i = 0; i < n; i++) {
    for (var j = 0; j < n; j++) {
      if ((i + j) % 2 == 0) {
        Rectangle(decX + 50 + i * taille, decY + 50 + j * taille, taille, taille, 'black');
      } else {
        RectanglePlein(decX + 50 + i * taille, decY + 50 + j * taille, taille, taille, 'black');
      }
    }
  }
}

function DrawQueen(i, j) {
  var decX = (n + 1) * taille * ((answerno - 1) % nbanswersperlines);
  var decY = (n + 1) * taille * Math.floor((answerno - 1) / nbanswersperlines);
  setCanvasFont('Helvetica', taille + 'px', '');
  var color = ((i + j) % 2 == 1) ? 'white' : 'black';
  Texte(decX + 50 + 5 + i * taille, decY + 50 + taille - 5 + j * taille, Ascii_vers_Caractere(9819), color);
}

// Main part
var n = SaisieEntier('Size of the chessboard');
var answerno = 0;

solve('nqueens.lp', '-cn=' + n + ' -n 10');// How lines generated by the solving part must be interpreted

--------------------
Play_with_clasp_sudoku.js
--------------------
includeFile('Library/Lparse_clasp.js');

var answerno = 0;

window.Interprete = function(ch) {
  Ecrire(ch);
  if (PositionDans(ch, 'Answer') >= 0) {
    answerno++;
  }
  if (PositionDans(ch, 'x(') >= 0) {
    var Tinst = ch.split(' ');
    for (var i = 0; i < Taille(Tinst); i++) {
      eval(Tinst[i]);
    }
  }
}

window.Interprete_grounder = function(ch) {
}

Initialiser();
setCanvasFont('helvetica', '30px', '');
for (var i = 0; i < 10; i++) {
  Ligne((i + 1) * 50, 0, (i + 1) * 50, 450, (i % 3 == 0) ? 'red' : 'black');
  Ligne(50, i * 50, 500, i * 50, (i % 3 == 0) ? 'red' : 'black');
}

Texte(500, 500, 'Solve', 'black')

var Tpos = [];
for (var i = 1; i <= 9; i++) {
  for (var j = 1; j <= 9; j++) {
    Tpos[i + ',' + j] = 0;
  }
}


function g_x(i, j, k) {

}

function x(i, j, k) {
  if (Tpos[i + ',' + j] ==0) {
    Texte(j * 50 + 10, i * 50 - 10, k, 'blue');
  	Tpos[i + ',' + j] = k;
  }
}

function MouseClick(x, y) {
  var j = Math.floor((x - 10) / 50);
  var i = Math.floor((y - 10) / 50) + 1;

  if (i > 0 && i <= 9 && j > 0 && j <= 9) {
    Tpos[i + ',' + j] = (Tpos[i + ',' + j] + 1) % 10;
    RectanglePlein(j * 50 + 1, i * 50 - 49, 48, 48, 'white');
    Texte(j * 50 + 10, i * 50 - 10, (Tpos[i + ',' + j]==0)?'':Tpos[i + ',' + j], 'black');
  } else if (i == 10 && j == 10) {
    var pb = ''
    for (var ii = 1; ii <= 9; ii++) {
      for (var ji = 1; ji <= 9; ji++) {
        if (Tpos[ii + ',' + ji] != 0) pb += 'x(' + ii + ',' + ji + ',' + Tpos[ii + ',' + ji] + ').\n';
      }
    }
    pb += readFile('sudokuvierge.lp');
    writeFile('tmpsudoku.lp', pb);
    groundandsolve('tmpsudoku.lp', '', '"1"');
  }
}



function val(i) {}

function border(i) {}


--------------------
nqueens.lp
--------------------
% THE N-QUEENS PROBLEM

% DOMAIN PREDICATES
row(1..n).
column(1..n).

% GENERATE
1{occupied(R,C):row(R)}1 :- column(C).

% TEST
:- occupied(R,C), occupied(R,C1),
   row(R), column(C), column(C1), C < C1.

:- occupied(R,C), occupied(R1,C1),
   row(R), column(C), row(R1), column(C1),
   C < C1, abs(R - R1) == abs(C - C1).
--------------------
sudokuvierge.lp
--------------------
%
% domains
%
val(1..9).
border(1;4;7).

% alldifferent boxes
1 { x(X,Y,N) : val(X;Y):
    X1<=X:X<=X1+2:Y1<=Y:Y<=Y1+2 } 1 :- val(N), border(X1;Y1).

% alldifferent rows, columns, values
1 { x(X,Y,N) : val(N) } 1 :- val(X;Y).
1 { x(X,Y,N) : val(X) } 1 :- val(N;Y).
1 { x(X,Y,N) : val(Y) } 1 :- val(N;X).

% alternative:
% :- 2 { x(X,Y,N) : val(N) }, val(X;Y).
% :- 2 { x(X,Y,N) : val(X) }, val(N;Y).
% :- 2 { x(X,Y,N) : val(Y) }, val(N;X).
--------------------
Library/Lparse_clasp.js
--------------------
function solve(_fn, _args) {

  var worker = new Worker("worker.js");

  worker.onmessage = function(event) {
    //Ecrire(event.data);
    switch (event.data.type) {
    case "ready":
      Ecrire("Go solving");
      break;
    case "output":
      //if (PositionDans(event.data.data,'edge')>=0) {
      Interprete(event.data.data);
      //}
      break;
    case "done":
      event.target.terminate();
      break;
    }
  };

  var filename = _fn;
  if (res_for_groundandsolve == '') {
    var filedata = readFile(filename);
  } else {
    var filedata = res_for_groundandsolve; // readFile(filename);
  }
  var args = JSON.parse(_args);

  worker.postMessage({
    'type': 'solve',
    'filename': filename,
    'filedata': filedata,
    'args': args
  });
}

var res_for_groundandsolve = '';

function groundandsolve() {
  //  if(Taille(arguments)<1) {Ecrire('Error: not enough arguments'); return;}
  var _fn = arguments[0];
  var _argsground = '';
  if (Taille(arguments) >= 2) {
    _argsground = arguments[1];
  }
  var _argssolve = '';
  if (Taille(arguments) >= 3 && arguments[2] != '') {
    _argssolve = arguments[2];
  } else {
    _argssolve = '"0"'
  }
  var _args = '[' + ((_argsground != '') ? '' + _argsground + ',' : '') + '"' + _fn + '"]';
  var worker = new Worker("worker_2.js");

  worker.onmessage = function(event) {
    //Ecrire(event.data);
    switch (event.data.type) {
    case "ready":
      Ecrire("Go grounding");
      res_for_groundandsolve = '';
      break;
    case "output":
      //if (PositionDans(event.data.data,'edge')>=0) {
      //Ecrire(event.data.data);
      var ch = event.data.data;
      var tch = ch.split(' ');
      ch = tch[0];
      for (var i = 1; i < Taille(tch); i++) if (tch[i] != '') ch += ' ' + tch[i];
      //Ecrire(ch);
      if (res_for_groundandsolve == '') res_for_groundandsolve = ch;
      else res_for_groundandsolve += '\n' + ch;
      //}
      Interprete_grounder(event.data.data);

      break;
    case "done":
      event.target.terminate();
      //window.localStorage['tmpfileforclasp.sm']=res_for_groundandsolve;
      //alert('Ready to solve ?');
      solve('tmpfileforclasp.sm', '["tmpfileforclasp.sm",' + _argssolve + ']');
      break;
    }
  };

  var filename = _fn;
  var filedata = readFile(filename);
  var args = JSON.parse(_args);

  worker.postMessage({
    'type': 'ground',
    'filename': filename,
    'filedata': filedata,
    'args': args
  });
}

function Interprete(ch) {
  Ecrire(ch);
}

function Interprete_grounder(ch) {}
----------------------------
Cours_1/Demo1.js
--------------------
Ecrire('Bonjour le monde');

--------------------
Cours_1/Demo2.js
--------------------
var message=Saisie('Entrez votre message');
Ecrire(message);

--------------------
Cours_1/Demo3.js
--------------------
Rectangle(10,10,100,200,'red');
RectanglePlein(150,50,200,200,'blue');
Ligne(0,0,500,300,'green');
--------------------
Cours_1/Demo_Guitare.js
--------------------
// Génération des notes (harmoniques sur gammes tempérées)
var data = Tableau(0);

frequence = 440;

var Decalage = Math.floor(22050 / frequence); //En gros, Décalage représente la longueur de la corde
for (var i = 0; i < Decalage; i++) {
  data[i] = Hasard(256); // on pince la corde (i.e., valeurs au hasard)
}
for (var i = Decalage; i < 22050 / 3; i++) {
  // Le principe de l'algorithme (de Karplus-Strong), c'est de faire une sorte de moyenne glissante pour rendre le son de plus en plus harmonieux
  data[i] = 128 + Math.floor(0.995 * ((data[i - Decalage] + data[i - Decalage + 1]) / 2 - 128));
}
// On crée le son à partir du tableau
var note = CreerSon(data, 22050);

// On joue la note....
note.play();
--------------------
Cours_1/Demo_Webcam.js
--------------------
// Bienvenu chez les trolls !!!

function Traitement(T){
  // Affichage de l'image originale
  ctx.putImageData(T,0,0);
  for(var i=0; i<Taille(T.data); i=i+4) {
    var rouge=T.data[i];
    var vert=T.data[i+1];
    var bleu=T.data[i+2];

    T.data[i] = bleu;
    T.data[i+1] = rouge;
    T.data[i+2] = vert;
  }
  // Affichage de l'image modifiée
  ctx.putImageData(T,640,0);
}

// On arrête d'enregistrer dès qu'on clique
function MouseClick(x,y) {
  StopWebcam();
}

// On lance la capture de la webcam
StartWebcam(Traitement);

--------------------
Cours_2/Historique_Execution.js
--------------------
// Historique d'exécution
// Variables position,deplacement à inspecter, ne pas oublier de les ajouter dans le champs correspondant
var position, deplacement;
position = 25;
deplacement = 11;
position = position + deplacement;
Ecrire(position);

---------------------
Cours_3/Accumulateur_Repetition.js
--------------------
/*
Algorithme Répétition de caractères
Variables:
	x: chaîne de caractères
	i: entiers;
Début
	x ← ‘’;
	pour i allant de 1 à 100 faire
		x ← x+ ‘*’;
	fin pour
	Ecrire(x);
Fin
*/

// Algorithme Répétition de caractères

var x,i;
x = '';
for(i = 1; i <= 100; i=i+1) {
  x = x + '*';
}
Ecrire(x);
--------------------
Cours_3/Accumulateur_factorielle.js
--------------------
/*
Algorithme Calcul de n!
Variables:
	x,i,n: entiers;
Début
	x ← 1;
	n ← Saisie();
	pour i allant de 1 à n faire
		x ← i * x;
	fin pour
	Ecrire(x);
Fin

*/

// Algorithme Calcul de n!

var n,x,i;
n = SaisieEntier();
x = 1;
for(i = 1; i <= n; i=i+1) {
  x = i*x;
}
Ecrire(x);
--------------------
Cours_3/Accumulateur_moyenne.js
--------------------
/*
Algorithme Moyenne de 36 notes saisies
Variables:
	note,i: entiers;
	x: réel;
Début
	x ← 0;
	pour i allant de 1 à 36 faire
		note ← Saisie();
		x ← x + note;
	fin pour
	Ecrire(x/36);
Fin
*/

// Algorithme Moyenne de 36 notes saisies

var note,x,i;
x = 0;
for(i = 1; i <= 36; i=i+1) {
  note = SaisieReel();
  x = x + note;
}
Ecrire(x/36);
--------------------
Cours_3/Conditionnelles_imbriquées.js
--------------------
// Algorithme Test de Ph
var ph, statut;

ph = Saisie();
if (ph < 7) {
  statut = 'acide';
} else {
  if (ph > 7) {
    statut = 'basique';
  } else {
    statut = 'neutre';
  }
}
Ecrire(statut);
--------------------
Cours_3/Historique_Boucles.js
--------------------
/*
Algorithme Toto
Variables:
	nb1,nb2: entiers;
Début
	nb1 ← 1;
	nb2 ← 10;
	Tant que (nb1<nb2) faire
		nb1 ← 2*nb1;`
		nb2 ← nb2-1;
	fin tant que
Fin
*/

// Algorithme Toto
// N'oubliez pas d'inspecter nb1, nb2
var nb1,nb2;

nb1 = 1;
nb2=10;
while (nb1<nb2) {
  nb1 = 2*nb1;
  nb2=nb2-1;
}

--------------------
Cours_3/Historique_conditionnelles.js
--------------------
// Algorithme Majorité
// N'oubliez pas d'ajouter les variables à inspecter
var age, statut;

age = Saisie();
if (age < 18) {
  statut = 'mineur';
} else {
  statut = 'majeur';
}
Ecrire(statut);
--------------------
Cours_3/Jeu_plus_moins.js
--------------------
// Algorithme le jeu du plus ou moins

var proposition, cache, nbpropositions;

cache = Hasard(10);
proposition = SaisieEntier('Votre proposition');
nbpropositions = 1;
while (proposition != cache) {
	nbpropositions = nbpropositions + 1;
	if (proposition < cache) {
		Ecrire('C\'est plus !');
	} else {
		Ecrire('C\'est moins !');
	}
	proposition = SaisieEntier('Votre proposition');
}
Ecrire('Gagné ! Vous avez mis '+nbpropositions+' coups');


--------------------
Cours_3/Jolies_Couleurs.js
--------------------
// Algorithme couleurs
var x,y;

Initialiser(); // Pour effacer l'écran
for(x=0; x<800; x=x+1) {
	for(y=0; y<600; y=y+1) {
      Point(x,y,rgb((x+y) % 256,x%256,y%256));
    }
}

--------------------
Cours_3/Pour_Polygone.js
--------------------
// Algorithme polygone
var n,i;

Initialiser(); // Pour effacer la sortie graphique
Deplacer(200,200); // Pour placer la tortue à un endroit où elle est visible
n = SaisieEntier('Combien de côté pour le polygone ?');
for(i=1; i <= n; i=i+1) {
	Avancer(10);
	Droite(360/n);
}

--------------------
Cours_3/Pour_factorielle.js
--------------------
/*
Algorithme Calcul de 20 !
Variables:
	x,i: entiers;
Début
	x ← 1;
	pour i allant de 1 à 20 faire
		x ← i * x;
	fin pour
	Ecrire(x);
Fin

*/

// Algorithme Calcul de n!

var n,x,i;
n = SaisieEntier();
x = 1;
for(i = 1; i <= n; i=i+1) {
  x = i*x;
}
Ecrire(x);
--------------------
Cours_3/TantQue_Mystere.js
--------------------
// Algorithme mystère
var x;

Initialiser(); // Pour effacer la sortie graphique
Deplacer(200, 200); // Pour placer la tortue à un endroit où elle est visible

x=1;
while (x < 720) {
  Avancer(10);
  Droite(x);
  x = x + 1;
}
--------------------
Cours_3/TantQue_log.js
--------------------
/*
Algorithme Calcul de [log3(100)]
Variables:
	x,i: entiers;
Début
	x ← 1;
	i ← 0;
	Tant que (x < 100) faire
		x ← 3 * x;
		i ← i+1;
	fin tant que
	Ecrire(i);
Fin
*/

// Algorithme Calcul de [log3(100)]
var x,i;
x = 1;
i = 0;
while (x<100) {
  x = 3*x;
  i = i + 1;
}
Ecrire(i-1);
Ecrire(Math.log(100)/Math.log(3));
--------------------
Cours_3/VerificationSaisie.js
--------------------
/*
Algorithme Saisie d’un nombre positif
Variables:
	x: entier;
Début
	x ← Saisie();
	Tant que (x < 0) faire
		x ← Saisie();
	fin tant que
	Ecrire(x);
Fin
*/

// Algorithme Saisie d’un nombre positif
var x;

x = SaisieEntier();
while (x < 0) {
  x = SaisieEntier();
}
Ecrire(x);
--------------------
Cours_4/Exemple_Fleche.js
--------------------
/*

Fonction Repeter(nb : entier, symbole: caractère):chaîne de caractères
Variables:
	i : entier;
	res : chaîne de caractères
Début
    res ⟵ ‘’;
    pour i allant de 1 à nb faire
    	 res ⟵ res + symbole;
	fin pour
	retourner(res);
Fin

Algorithme Flèche
Variables:
   i : entier;
Début
   pour i allant de 1 à 5 faire
   Ecrire(Repeter(6-i,’˽‘)+Repeter(2*i-1,’*’));
   fin pour
   pour i allant de 1 à 5 faire
      Ecrire(Repeter(4,’˽‘)+Repeter(3,’*’));
   fin pour
Fin

*/

function Repeter(nb,symbole) {
  var i,res;
  res = '';
  for(i=1; i<= nb; i=i+1) {
    res = res + symbole;
  }
  return res;
}

// Algorithme Flèche
var i;
for(i=1; i<=5; i=i+1) {
  Ecrire(Repeter(6-i,'˽')+Repeter(2*i-1,'*'));
}
for(i=1; i<=5; i=i+1) {
  Ecrire(Repeter(4,'˽')+Repeter(3,'*'));
}

--------------------
Cours_4/Exemple_Hanoi.js
--------------------
// Exemple : Puissance de la récursion: la résolution des tours de Hanoi

function Hanoi(n, tige1, tige2, tige3) {
  if (n > 0) {
    Hanoi(n - 1, tige1, tige3, tige2);
    Ecrire('Deplacer de ' + tige1 + ' à ' + tige3);
    Hanoi(n - 1, tige2, tige1, tige3);
  }
}

// Appel (ici, il s'agit d'une procédure)
Hanoi(5, 'début', 'milieu', 'fin');





--------------------
Cours_4/Exemple_Historique_Execution.js
--------------------
// Un exemple d'historique d'exécution
function double(x) {
  var res;
  res = 2*x;
  return res;
}

// Algorithme
var v;
v = double(3);


--------------------
Cours_4/Exemple_declaration_Calcule_age.js
--------------------
/*

Algorithme Calcule age
Variables:
   année, age : entier;
Début
   année ← Saisie();
   age ← 2020 - année;
   Ecrire(age);
Fin

devient:

Fonction Calcule_age(année : entier) : entier
Variables:
   age : entier;
Début
   age ← 2020 - année;
   Retourner(age);
Fin

*/

function Calcule_age(annee) {
  var age;
  age = 2020 - annee;
  return age;
}

// Utilisation de la fonction qu'on a déclaré
// ça ne sert à rien de définir une fonction si on ne s'en sert pas !!!
Ecrire(Calcule_age(1998));

var x;
x = SaisieEntier();
Ecrire(Calcule_age(x));







--------------------
Cours_4/Exemple_declaration_CtoF.js
--------------------
/*

Fonction C_to_F(temp : réel): réel;
Variables
	res: réel;
Début
	res <- 1.8*temp+32;
	retourner res;
Fin

*/

function C_to_F(temp) {
  var res;
  res=1.8*temp+32;
  return res;
}


// Algorithme pour utiliser la fonction définie

var temperature=SaisieReel('Veuillez entrer une température en Celcius');

Ecrire('Il fait '+C_to_F(temperature)+' degrés Fahrenheit');




--------------------
Cours_4/Exemple_declaration_factorielle.js
--------------------
/*
Version algorithme

Algorithme Factorielle
Variables
   n : entier;
   res: entier;
   i: entier;
Début
   n ← Saisie();
   res ← 1;
   pour i allant de 1 à n faire
      res ← res * i;
   fin pour
   Ecrire(res);
Fin

devient:

fonction factorielle(n : entier) :entier
Variables:
   res: entier;
   i:entier;
Début
   res ← 1;
   pour i allant de 1 à n faire
      res ← res * i;
   fin pour
   retourner res;
Fin

On rend réutilisable les instructions de l'algorithme

fonction binomiale(n,p)
Début
   retourner factorielle(p)/(factorielle(n)*factorielle(n-p));
Fin

*/

function factorielle(n) {
  var res, i;
  res = 1;
  for (i = 1; i <= n; i = i + 1) {
    res = res * i;
  }
  return res;
}

// Utilisation de la fonction qu'on a déclaré
// ça ne sert à rien de définir une fonction si on ne s'en sert pas !!!
Ecrire(factorielle(5));
Ecrire(factorielle(10));

var x;
x = SaisieEntier();
Ecrire(factorielle(x));





--------------------
Cours_4/Exemple_factorielle_recursive.js
--------------------
/*
Fonctions définies récursivement: premier exemple, la fonction factorielle: f(0)=1 et f(n)=n*f(n-1) si n>0.
*/
/*
On a le droit d'appeler une fonction à l'intérieur de sa déclaration

Fonction factorielle_rec(n:entier):entier
Variables:
   res:entier;
Début
   si (n=0)
      Alors res <- 1;
      Sinon res <- n*factorielle_rec(n-1);
   retourner res;
Fin
*/

function factorielle_rec(n) {
  var res;
  if (n == 0) {
    res = 1;
  } else {
    res = n * factorielle_rec(n - 1);
  }
  return res;
}

Ecrire(factorielle_rec(5));
Ecrire(factorielle_rec(10));

var x;
x = SaisieEntier();
Ecrire(factorielle_rec(x));
--------------------
Cours_4/Hanoi_anime.js
--------------------
// Exemple : Démonstration animée de la résolution du problème (nb: on stocke le contenu des tiges dans des tableaux...)
var SequenceDeplacements = Tableau(0);

function Hanoi(n, tige1, tige2, tige3) {
  if (n > 0) {
    Hanoi(n - 1, tige1, tige3, tige2);
    DeplacerCyl(tige1, tige3);
    Hanoi(n - 1, tige2, tige1, tige3);
  }
}

function DeplacerCyl(T1, T2) {
  SequenceDeplacements.push(new Array(T1, T2));
}

var n = SaisieEntier();

Hanoi(n, 0, 1, 2);

var Tiges = Tableau(0);
Tiges.push(Tableau(0));
Tiges.push(Tableau(0));
Tiges.push(Tableau(0));

for (var i = 0; i < n; i++) {
  Tiges[0].push(n - i);
}

function AfficheTiges() {
  Ligne(50, 90, 350, 90, 'black');
  for (var i = 0; i < 3; i++) {
    var x = 100 * (i + 1);
    Ligne(x, 90, x, 250);
    for (var j = 0; j < Taille(Tiges[i]); j++) {
      var taillecyl = 6 * Tiges[i][j];
      RectanglePlein(x - taillecyl, 100 + j * 15, taillecyl * 2, 12, rgb(255 - Tiges[i][j] * 30, 0, 0));
    }
  }
}

function AnimeUnCran(dep1, dep2) {
  Initialiser();
  ShadowOn();
  Viewport(0, 0, 400, 300);
  AfficheTiges();
}

function Animation(i) {
  if (i < Taille(SequenceDeplacements)) {
    AnimeUnCran();
    var depl = SequenceDeplacements[i];
    Tiges[depl[1]].push(Tiges[depl[0]].pop());
    setTimeout(function() {
      Animation(i + 1)
    }, 150);
  } else {
    AnimeUnCran();
    Ecrire('fini !');
  }
}

Animation(0);



--------------------
Cours_4/Motivations.js
--------------------
// Un calcul...
var a, b, c;
var u, v, tmp;

u = 1;
v = 3;
while (Math.abs(u * u - 3) > 0.0001) {
  tmp = u;
  u = (1 / u + 1 / v) / 2;
  v = (tmp / v) / 2;
}
a = u;

u = 1;
v = 5;
while (Math.abs(u * u - 5) > 0.0001) {
  tmp = u;
  u = (1 / u + 1 / v) / 2;
  v = (tmp / v) / 2;
}
b = u;

u = 1;
v = 7;
while (Math.abs(u * u - 7) > 0.0001) {
  tmp = u;
  u = (1 / u + 1 / v) / 2;
  v = (tmp / v) / 2;
}
c = u;

Ecrire(a + b + c);

// Que fait ce programme ???

function Racine_Carree(x) {
  var u, v, tmp;
  u = 1;  v = x;
  while (Math.abs(u * u - x) > 0.0001) {
    tmp = u;
    u = (1 / u + 1 / v) / 2;
    v = (tmp / v) / 2;
  }
  return u
}

Ecrire(Racine_Carree(3) + Racine_Carree(5) + Racine_Carree(7));

// Que fait celui là ?











--------------------
Cours_4/Utilisation_fonctions.js
--------------------
// Quelques utilisations de fonction prédéfinies

Ecrire(Math.floor(3/2));
Ecrire(Math.abs(-5));
Ecrire(Math.log(12));
Ecrire(Longueur('Bonjour'))
Ecrire(typeof('ceci est une chaîne'));

// SaisieReel est une fonction à 0 argument qui renvoie un nombre
var x;
x=SaisieReel();
// Ecrire(ch) est une fonction à 1 argument qui ne renvoie rien (on parle souvent de procédure dans ce cas).
Ecrire(Math.sin(x));

// Une valeur de Pi ? Utilisation du résultat d'une fonction dans une expression...
Ecrire(4*Math.atan(1));


----------------------
Cours_6/CompteARebours_Bon.js
--------------------
function CompteARebours(n) {
  if (n == 0) {
    Ecrire('Boum !!');
  } else {
    Ecrire(n);
    // Pour plus d'information: http://www.w3schools.com/jsref/met_win_settimeout.asp
    setTimeout(function() {CompteARebours(n-1);}, 1000);
  }
}

CompteARebours(4);

--------------------
Cours_6/CompteARebours_Mauvais.js
--------------------
function Attendre(t) {
  var debut, maintenant;
  debut = (new Date()).getTime(); // nb de millisecondes depuis 1/1/70
  maintenant;
  do {
    maintenant=(new Date()).getTime();
  } while (maintenant - debut < t);
}

function CompteARebours(n) {
  if (n == 0) {
    Ecrire('Boum !!');
  } else {
    Attendre(1000);
    Ecrire(n);
    CompteARebours(n-1);
  }
}

CompteARebours(4);

--------------------
Cours_6/Contraintes.js
--------------------
// Les problèmes de résolution de contraintes
// Problème: On cherche A,B,C tels que A*B+C*D = 1500, 2<A<1500, 2<B<1500, 2<C<1500, 2<D<1500.


// un tel problème est décrit par
//      - les domaines des variables
var Domaines = [[2,1500],[2,1500],[2,1500],[2,1500]];

//      - une fonction qui teste si une affectation est valide ou non
function Test(V) {
  var A = V[0];
  var B = V[1];
  var C = V[2];
  var D = V[3];
  return (A * B + C * D == 1500);
}

var MonProbleme=[Domaines,Test];



// on peut ensuite faire appelle à des fonctions de résolution "génériques" comme celle-ci

function Resoudre(P) {
  // méthode de résolution par tirage aléatoire dans l'espace de solution
  // On impose un nombre maximal d'itérations avant de conclure
  var max_iterations = 10000000;
  var parametres=[]; //Une affectation à tester...
  var probleme=P[1]
  do {
    for (var i = 0; i < Taille(P[0]); i++) {
      var domaine=P[0][i];
      parametres[i] = Hasard(domaine[1]-domaine[0]+1) + domaine[0];
    }
    resolu = probleme(parametres);
  } while (!resolu && max_iterations-- > 0);
  if (resolu) {
      return parametres;
  } else {
    return -1;
  }
}

Ecrire(Resoudre(MonProbleme));


--------------------
Cours_6/Contraintes_Fubuki.js
--------------------
// Les problèmes de résolution de contraintes

// un tel problème est décrit par
//      - les domaines des variables
var Domaines = [[6],[2,3,4,5,7,8],[2,3,4,5,7,8],
                [2,3,4,5,7,8],[9],[2,3,4,5,7,8],
                [2,3,4,5,7,8],[2,3,4,5,7,8],[1]
                ];

//      - une liste de contraintes

function TousDifferents(V) {
  var T=[];
  var res=true;
  for(var i=0; i<Taille(V); i++) {
    if (T[V[i]] == 1) res=false;
    T[V[i]] = 1;
  }
  return res;
}

function Test(V) {
  var res=true;
  res=res && (V[0]+V[1]+V[2] == 18);
  res=res && (V[3]+V[4]+V[5] == 21);
  res=res && (V[6]+V[7]+V[8] == 6);
  res=res && (V[0]+V[3]+V[6] == 17);
  res=res && (V[1]+V[4]+V[7] == 16);
  res=res && (V[2]+V[5]+V[8] == 12);
  res=res && TousDifferents(V);
  return res;
}

var MonProbleme=[Domaines,Test];


// on peut ensuite faire appelle à des fonctions de résolution "génériques" comme celle-ci

function Resoudre(P) {
  // méthode de résolution par tirage aléatoire dans l'espace de solution
  // On impose un nombre maximal d'itérations avant de conclure
  var max_iterations = 10000000;
  var parametres=[]; //Une affectation à tester...
  var probleme=P[1]
  do {
    for (var i = 0; i < Taille(P[0]); i++) {
      var domaine=P[0][i];
      parametres[i] = domaine[Hasard(Taille(domaine))];
    }
    resolu = probleme(parametres);
  } while (!resolu && max_iterations-- > 0);
  if (resolu) {
      return parametres;
  } else {
    return -1;
  }
}

Ecrire(Resoudre(MonProbleme));


--------------------
Cours_6/Exemple_POO.js
--------------------
function Personnage(_col) {
  this.couleur = _col;
  this.force = 10;
  this.position = 5; // se déplacent sur un segment 10x10
  this.Bouger = function() {
    // Se déplace d'une case au Hasard sur le damier 10x10
    this.position = this.position + Hasard(3) - 1;
    if (this.position < 0) {
      this.position = 0;
    }
    if (this.position > 9) {
      this.position = 9;
    }
  }
  this.Frapper = function(autrePersonnage) {
    // On essaye de frapper un autre personnage. On le touche s'il est à distance <= 1
    if (Math.abs(autrePersonnage.position - this.position) <= 1) {
      // Quand on touche, ça motive et ça fait mal à l'adversaire
      this.force = this.force + 1;
      autrePersonnage.force = autrePersonnage.force - 1;
    } else {
      // Quand on frappe dans le vide, ça fatigue
      this.force = this.force - 0.5;
    }
  }
}

var Joueur1 = new Personnage('red');
var Joueur2 = new Personnage('blue');

function Affiche(pers) {
  RectanglePlein(pers.position * 50 + 50, 100, 40, 40, pers.couleur);
}

function draw() {
  Initialiser();
  Affiche(Joueur1);
  Affiche(Joueur2);
  if (Hasard(2) == 0) {
    // Un seul personnage fait quelquechose
    if (Hasard(2) == 0) {
      // Joueur 1 Bouge ou frappe
      Joueur1.Bouger();
    } else {
      Joueur1.Frapper(Joueur2);
      Texte(100, 200, 'Boum !!!', 'black');
    }

  } else {
    // Un seul personnage fait quelquechose
    if (Hasard(2) == 0) {
      // Joueur 1 Bouge ou frappe
      Joueur2.Bouger();
    } else {
      Joueur2.Frapper(Joueur1);
      Texte(100, 200, 'Boum !!!', 'black');
    }

  }
}

FrameRate=2;
Loop(-1);
--------------------
Cours_6/Fibo.js
--------------------
function Fibo(n) {
  if (n < 2) return 1;
  else
  return Fibo(n - 1) + Fibo(n - 2);
}

var T = []; // pour mémoriser les valeurs calculées

function Fibo2(n) {
  if (typeof(T[n]) == 'undefined') {
    if (n < 2) {
      T[n] = 1;
    } else {
      T[n] = Fibo2(n - 1) + Fibo2(n - 2);
    }
  }
  return T[n];
}

Ecrire('Temps execution de Fibonacci "standard" = '+chronometre('Fibo(40)')+'ms');
Ecrire('Temps execution de Fibonacci "dynamique" = '+chronometre('Fibo2(40)')+'ms');
Ecrire(T);



--------------------
Cours_6/ProgFonctionnelle.js
--------------------
function carre(x) {
  return x*x;
}

// Un exemple typique de programmation fonctionnelle
Ecrire(Somme(Mapper(carre,[1,2,3,4,5,6,7,8,9,10])));





// Somme et Mapper sont des fonctions "haut niveau"
function Somme(L) {
  var res,i;
  res=0;
  for(i=0; i<Taille(L); i=i+1) {
    res=res+L[i];
  }
  return res;
}

function Mapper(f,L) {
  var i;
  for(i=0; i<Taille(L); i=i+1) {
    L[i]=f(L[i]);
  }
  return L;
}

--------------------
Cours_6/RenduMonnaie.js
--------------------
// Rendu de monnaie
var i,nb;
var PiecesEuros = [1,2,5,10,20,50,100,200];
var retrait=SaisieEntier('Combien voulez-vous retirer ?');
Ecrire('Vous voulez retirer '+retrait+' euros');

for(i=Taille(PiecesEuros)-1; i>=0; i=i-1) {
  // Meilleur choix local
  nb=Math.floor(retrait/PiecesEuros[i]);
  retrait = retrait % PiecesEuros[i];
  if (nb != 0) {
    Ecrire('Voici '+nb+' pièces ou billets de '+PiecesEuros[i]+' euro(s)');
  }
}
// Dans le cas des pièces euros, c'est toujours le meilleur choix global
// Attention, ce n'est pas toujours le cas. Prenons cet exemple de pièces
// issues d'une république tordue

var PiecesTordue = [1,3,4];
var retrait=6;

for(i=Taille(PiecesTordue)-1; i>=0; i=i-1) {
  // Meilleur choix local
  nb=Math.floor(retrait/PiecesTordue[i]);
  retrait = retrait % PiecesTordue[i];
  if (nb != 0) {
    Ecrire('Voici '+nb+' pièces de '+PiecesTordue[i]+' tordux');
  }
}

// Le meilleur choix est 2x3 mais on obtient 1x4+2x1 !


---------------------
Cours_5/Exemple_Complexite_Recherches.js
--------------------
// génération d'un tableau aléatoire TRIE de 100000 cases
var tab=Tableau(100000);
var i;
tab[0]=1;
for (i=1; i<100000; i=i+1) {
   tab[i]=tab[i-1]+Hasard(5);
}

// Le nombre maximum est

var maximum=tab[99999];

// Version 1: On cherche séquentiellement

function Recherche1(tableau,valeur) {
// retourne vrai si l'élément est dans le tableau
	var i,res;
	res=false;
        i=0;
	while ((! res) && (i<Taille(tableau))) {
		if (tableau[i] == valeur) {
			res=true;
		} else {
			i=i+1;
		}
	}
	return res;
}

// Version 2: On cherche "dichotomiquement"

function Recherche2(tableau,valeur) {
// retourne vrai si l'élément est dans le tableau
	var debut, milieu, fin;
	debut=0; fin=Taille(tableau);
	while (fin>debut+1) {
		milieu=Math.floor((debut+fin)/2);
		if (tableau[milieu] < valeur) {
			debut=milieu;
		} else {
			fin= milieu;
		}
	}
	return tableau[debut] == valeur || tableau[fin] == valeur;
}

Ecrire('Temps de 1000 recherches, méthode 1 = '+chronometre('for (var j=1; j<1000; j++) Recherche1(tab,Hasard(maximum))')+'ms');

Ecrire('Temps de 1000 recherches, méthode 2 = '+chronometre('for (var j=1; j<10000; j++) Recherche2(tab,Hasard(maximum))')/10+'ms');



--------------------
Cours_5/Exemple_son.js
--------------------
/*
Comment générer un LA ???

Un son est décrit par une onde (sinusoïdale si le son est cristallin).
En informatique, cette "onde" est "échantillonnée" (calcul d'un sous-ensemble de valeurs)
et stockée dans un tableau. En pratique, on calculera une valeur de cette onde tous les 1/22050 secondes !

Si on veut générer 1 seconde de son, il faut calculer 22050 valeurs et les stocker dans un tableau.

Pour un LA cristallin, la courbe est donnée par la formule sin(t * 440 * 2 * Pi) où t est le temps.
(il faut faire 440 tours d'un cercle de 2*Pi radians).

Dernier petit détail "technique": au lieu d'utiliser des réels (entre -1 et 1) pour représenter les valeurs de la courbe,
en informatique on utilisera des entiers (entre 0 et 255), il faut donc prévoir une mise à l'échelle avant de générer le son.

Algorithme Génération d'un LA
Variables:
    i : entier
    T : Tableau d'entiers
  son : son
Début
  Pour i allant de 0 à 22049 faire
    T[i]=sin((i/22050) * 440 * 2 * Pi);
  fin pour

  // "Normalisation" = détail technique
  Pour i allant de 0 à 22049 faire
    T[i]=128+ Arrondir (127*T[i])
  fin pour
  son=CreerSon(T,22050);
  son.play();
Fin

*/

var i, T, son;

T = []; // T est un Tableau
for (i = 0; i <= 22049; i = i + 1) {
  T[i] = Math.sin((i / 22050) * 440 * 2 * Math.PI);
}

// "Normalisation" = détail technique
for (i = 0; i <= 22049; i = i + 1) {
  T[i] = 128 + Math.floor(127 * T[i])
}

son = CreerSon(T, 22050);
son.play();
--------------------
Cours_5/tempsconstant.js
--------------------
var T=[];
T[0]=1;
T[1000]=1;

Ecrire(chronometre('for(var i=0; i<1000000; i=i+1) T[0]=1;'));
Ecrire(chronometre('for(var i=0; i<1000000; i=i+1) T[1000]=1;'));
Ecrire(chronometre('for(var i=0; i<1000000; i=i+1) T[i]=1;'));


--------------------
Cours_5/Tableaux2D.js
--------------------
// Les tableaux à deux dimensions
// Dans tous les cas, on souhaite mémoriser un tableau de 5 lignes et 8 colonnes

// Version 1 : On crée un tableau de 5*8=40 cases
//             La case (i,j) du tableau 2D est donc stockée dans la case i*8+j du tableau 1D
var i,j;
var T=Tableau(40);
for (i=0; i<5; i=i+1) {
	for (j=0; j<8; j=j+1) {
      T[i*8+j] = 'je stocke la case ('+i+','+j+')';
    }
}

Ecrire(T);

// Version 2 : On crée un tableau de 5 cases dont chaque case contient un tableau de 8 cases
//             La case (i,j) du tableau 2D est donc stockée dans la case [i][j] du tableau
var i,j;
var T2=Tableau(5);
for(i=0; i<5; i=i+1) {T2[i]=Tableau(8);}

for (i=0; i<5; i=i+1) {
	for (j=0; j<8; j=j+1) {
      T2[i][j] = 'je stocke la case ('+i+','+j+')';
    }
}
AfficherTableau(T2);



--------------------
Cours_6/Exemple_DoubleClic.js
--------------------
window.ondblclick=function () {Ecrire('Aie !!!');}

--------------------
Cours_6/GestionClavier_souris.js
--------------------
function MouseMove(x,y) {
	CerclePlein(x,y,10,'red');
}

function Keypressed(c) {
	Ecrire('Vous avez appuyé sur '+c+' = '+Ascii_vers_Caractere(c));
}



--------------------
Cours_6/Ordinateur_je_te_parle .js
--------------------
// Cet exemple ne fonctionne pour le moment que sous Google Chrome

function Interprete(ch) {
  Ecrire('J\'ai compris '+ch);
  ch=ch.toLowerCase().trim();
  if (ch.indexOf("bonjour mon cher ordinateur")>=0) {
    Ecrire("Bonjour mon cher, comment t'appelle-tu ?");
  }
  if (ch.startsWith("je m'appelle")) {
    var nom=ch.substring(13);
    Ecrire("Bonjour "+nom);
    Ecrire("Moi je m'appelle ordinateur, tout simplement");
  }
}

StartSpeechRecognition(Interprete);

--------------------
Cours_6/Test_unitaire.js
--------------------
// Un exemple de test unitaire

function Multiplier(a,b,c) {
  return a*b*c;
}

// Algorithme test unitaire
var a,b,c;
// Arranger
a=2; b=3; c=4;
// Agir
resultat = Multiplier(a,b,c);
// Auditer
if (resultat != 24) {
  Ecrire('Erreur');
}


--------------------
Cours_6/Invariants.js
--------------------
function Puissance(x, n) {
  var i, res;
  Assert(n >= 0, 'Pré-condition de Puissance');
  res = 1
  for (i = 0; i < n; i = i + 1) {
    Assert(res == Math.pow(x, i), 'Invariant de boucle');
    res = res * x;
  }
  Assert(res == Math.pow(x, n), 'Post-condition de Puissance');
  return res;
}

// Allez voir ce qui se passe dans la console javascript (shift+Ctrl+j)
Ecrire(Puissance(2, 5));
Ecrire(Puissance(2, -5));


--------------------
BasicExampleForWebGL.js
--------------------
// Charger les bibliothèques nécessaires
PreloadLib('https://algoscript.info/three_2017.min.js');
PreloadLib('https://algoscript.info/threejs_post.js');

WaitPreloadLibs(main);

var scene, camera, renderer;

function main() {
  /*
  // Doit être décommenté dans le cas où il faut créen une app pour smartphone
  document.getElementById('webglcontainer').style.visibility = 'visible';
  document.getElementById('webglcontainer').style.zIndex = 100;
  */

  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  AssociateWebGlContainer(renderer.domElement);

  // Ajout d'une lumière (pour le matériaux Phong)
  var light = new THREE.DirectionalLight(0xffffff);
  light.position.set(3, 5, 5).normalize();
  scene.add(light);

  camera.position.x = 1;
  camera.position.y = 0;
  camera.position.z = 10;

  var geometry = new THREE.BoxGeometry(1, 1, 1);
  var material = new THREE.MeshPhongMaterial({
    color: 0xffff00
  });
  var cube = new THREE.Mesh(geometry, material);
  cube.name = 'cube1';
  scene.add(cube);


  geometry = new THREE.SphereGeometry(1, 50, 50);
  material = new THREE.MeshPhongMaterial({
    color: rgb(50, 50, 255)
  });
  var sphere = new THREE.Mesh(geometry, material);
  sphere.position.x = 1;
  sphere.name = 'sphere1';

  scene.add(sphere);
  renderer.render(scene, camera);

// Lancement de l'animation (lorsque tout est prêt)
  Loop(-1);

}

function draw() {
  var cube = scene.getChildByName('cube1');

  cube.rotation.x += 0.01;
  cube.rotation.y += 0.01;
  cube.rotation.z += 0.02;

  var sphere = scene.getChildByName('sphere1');

  sphere.position.x = 2 * Math.cos(cube.rotation.x);
  sphere.position.y = 2.5 * Math.sin(cube.rotation.x);

  renderer.render(scene, camera);

}


function MouseClick(x, y) {

  // on change la couleur de la sphère (alternance de rouge et de bleu)
  var sphere = scene.getChildByName('sphere1');

  if (sphere.material.color.r == 1) {
    sphere.material.color.setRGB(0.2, 0.2, 1);
  } else {
    sphere.material.color.setRGB(1, 0.2, 0.2);
  }
}

function Keypressed(c) {
  noLoop();
}


--------------------
Cours_Crypto/Steganographie.js
--------------------
// Une petite animation pour la stéganographie

var message = "RENSEIGNEMENTSARRIVENT";

function bird(x, y, t) {
  // procédure qui dessine un oiseau
  var s = Math.sin(t * 3.14 / 180);
  s = s * s + 0.2;
  Ligne(x - 10 * s, y - 10 * s, x, y, 'black');
  Ligne(x + 10 * s, y - 5 * s, x, y, 'black');
}

var taillex = 900;
var tailley = 400;

function alphabet(y) {
  // procédure qui dessine l'alphabet
  for (var i = 0; i < 26; i++) {
    Ligne(50 + (taillex / 26) * i, 20, 50 + (taillex / 26) * i, y, 'white');
    Texte(50 + (taillex / 26) * i, y, Ascii_vers_Caractere(i + 65), 'white');
  }
}

setCanvasFont('helvetica', '20px', 'bold');

function scene(t) {
  Initialiser();
  RectanglePlein(0, 0, 1500, 1000, rgb(100, 100, 255));
  CerclePlein(200, 200, 100, 'red');

  CerclePlein(0, 700, 1000, 'white');
  CerclePlein(400, 700, 700, 'white');
  CerclePlein(800, 700, 450, 'white');

  CerclePlein(0, 700, 1000, rgba(100, 255, 0, 0.5));
  CerclePlein(400, 700, 700, rgba(100, 255, 0, 0.5));
  CerclePlein(800, 700, 450, rgba(100, 255, 0, 0.5));
  CerclePlein(400, 700, 700, rgba(100, 255, 0, 0.5));
  CerclePlein(800, 700, 450, rgba(100, 255, 0, 0.5));
  CerclePlein(800, 700, 450, rgba(100, 255, 0, 0.5));


  ShadowOn();


  var y = 100;
  for (var i = 0; i < Longueur(message); i++) {
    var numcase = Caractere_vers_Ascii(message[i]) - 65;
    bird(Math.floor(50 + (taillex / 26) * numcase) + 5 * Math.sin((t * ((i + 1) % 5)) * 3.14 / 180), Math.floor(50 + tailley * i / Taille(message)), t + i * 10);
  }
}

var t = 0;

function Min(a, b) {
  return (a < b) ? a : b;
}
var tstart = 0;
var flagstart = false;
var flagfirststart = false;

function MouseClick(x, y) {
  flagfirststart = true;
  flagstart = !flagstart;
}

function anim() {
  scene(t);
  if (flagfirststart) alphabet(Min(tstart + 20, 500));
  if (flagstart) {
    tstart += 2;
  }
  t++;
  if (tstart < 500) {
    setTimeout(function () {anim();}, 10);
  } else {
    Texte(100, 550, message, 'white');
  }
}

anim();


</textarea>
</div>
<div id="GestionFichiers" style="height: 100%; overflow: scroll;">
<span class="bonglet" id="bonglet1" style="background-color: rgb(150,150,150);" onclick="builtin_ong.style.display='none'; builtin_bong.style.backgroundColor='rgb(255,255,255)'; builtin_ong=GEBID('onglet1'); builtin_bong=GEBID('bonglet1'); builtin_ong.style.display='block'; builtin_bong.style.backgroundColor='rgb(150,150,150)';">Internal FS</span><span class="bonglet" id="bonglet2" onclick="builtin_ong.style.display='none'; builtin_bong.style.backgroundColor='rgb(255,255,255)'; builtin_ong=GEBID('onglet2'); builtin_bong=GEBID('bonglet2'); builtin_ong.style.display='block'; builtin_bong.style.backgroundColor='rgb(150,150,150)';">Mail</span><span class="bonglet" id="bonglet3" onclick="builtin_ong.style.display='none'; builtin_bong.style.backgroundColor='rgb(255,255,255)'; builtin_ong=GEBID('onglet3'); builtin_bong=GEBID('bonglet3'); builtin_ong.style.display='block'; builtin_bong.style.backgroundColor='rgb(150,150,150)';">External FS</span><span class="bonglet" id="bonglet4" onclick="builtin_ong.style.display='none'; builtin_bong.style.backgroundColor='rgb(255,255,255)'; builtin_ong=GEBID('onglet4'); builtin_bong=GEBID('bonglet4'); builtin_ong.style.display='block'; builtin_bong.style.backgroundColor='rgb(150,150,150)';">Create App</span>
<div id="onglet1">
<h1>Internal Filesystem</h1>
<div>
<table>
<tr>
<td style="vertical-align: top;">
<select id="internalFS" size="20" style="width: 300px;" ondblclick="if (GEBID('internalFS').value != '') {editor.setValue(readFile(GEBID('internalFS').value)); builtin_oldfilename=GEBID('internalFS').value; GEBID('lecode').value=editor.getValue(); MontreFenetre(-8);}"
onchange="GEBID('filecontent').innerHTML='<pre>'+window.localStorage[GEBID('internalFS').value]+'</pre>'">
</select></td><td style="vertical-align: top;">
<input type="button" value="Load selected" onclick="if (GEBID('internalFS').value != '') {editor.setValue(readFile(GEBID('internalFS').value)); builtin_oldfilename=GEBID('internalFS').value; GEBID('lecode').value=editor.getValue(); MontreFenetre(-8);}" /><br/>
<input type="button" value="Load as Text Entry" onclick="setEntreetexte(readFile(GEBID('internalFS').value));  MontreFenetre(-5);" /><br/>
<input type="button" value="Remove selected" onclick="removeFile(GEBID('internalFS').value); UpdateFS();" /><br/>
<input type="button" value="Rename selected" onclick="renameFile(GEBID('internalFS').value,prompt('Enter your filename with directories',GEBID('internalFS').value)); UpdateFS();" /><br/>
<input type="button" value="Save to" onclick="builtin_oldfilename=prompt('Enter your filename with directories',builtin_oldfilename); writeFile(prompt('Enter your filename with directories',builtin_oldfilename),editor.getValue()); UpdateFS();" /><br/><br/>
<input type="button" value="Export Entire FS to Text Entry" onclick="var flag=false; var res=''; for(p in window.localStorage) {if (flag) res+='--------\n'; flag=true; res+=p+'\n--------\n'+window.localStorage[p]+'\n';} setEntreetexte(res);"/><br/>
<input type="button" value="Export Entire FS to Dropbox" onclick="if (DropboxSync) exportAllFStoDropboxFS();"/>
</td>
<td>
<div id="filecontent" style="background-color: rgb(100,100,100); color: yellow; font-family: fixed; font-size: 0.8em; width:600px; height:300px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;"></div>
</td>
</tr></table>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
</div>
</div>
<div id="onglet2" style="display: none;">
<h1>Send by e-mail</h1>
<div>
<input type="text" value="your mail address" id="sendmail" /><input type="button" value="Send" onclick="if (GEBID('sendmail').value.indexOf('@')) {GEBID('lecode').value = editor.getValue();; window.open('mailto:'+GEBID('sendmail').value+'?subject=[AlgoScript%20project]&body='+window.encodeURIComponent(GEBID('lecode').value));} else alert('Error: Invalid mail address !');"/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
</div>
</div>
<div id="onglet3" style="display: none;">
<h1>Load from an external filesystem</h1>
<div>
<input type="file" id="ExternalFilename" /><input type="button" value="Load" onclick="readExternal(GEBID('ExternalFilename'),1); MontreFenetre(-8);"/><input type="button" value="Load in Text Entry" onclick="readExternal(GEBID('ExternalFilename'),2); MontreFenetre(-5);"/><input type="button" value="Data file to Internal FS" onclick="readDataToIFS(GEBID('ExternalFilename')); UpdateFS();"/><input type="button" value="Import as Library" onclick="readExternal(GEBID('ExternalFilename'),3); setTimeout('UpdateFS()',1000);"/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
</div>
</div>
<div id="onglet4" style="display: none; color:white;">
<h1>Create a standalone application</h1>
<div>
<table>

<tr><td colspan="2">
<input type="button" value="Create App" onclick="var style_standalone=1; if (GEBID('style_standalone2').checked) style_standalone=2; if (GEBID('style_standalone3').checked) style_standalone=3; if (GEBID('style_standalone4').checked) style_standalone=4; var options_standalone=GEBID('internalFS_standalone').options; var allselected=[]; var nbselected=0; for(var i=0; i<options_standalone.length; i++) if (options_standalone[i].selected) allselected[nbselected++]=options_standalone[i].value; var w=window.open('','Standalone Application'); w.document.open('text/html', 'replace'); w.document.write(createStandaloneApp(editor.getValue(),GEBID('name_standalone').value,style_standalone, allselected,(GEBID('encryptioncheck').checked))); w.document.close();"/>
<input type="button" value="Download App" onclick="var style_standalone=1; if (GEBID('style_standalone2').checked) style_standalone=2; if (GEBID('style_standalone3').checked) style_standalone=3; if (GEBID('style_standalone4').checked) style_standalone=4; var options_standalone=GEBID('internalFS_standalone').options; var allselected=[]; var nbselected=0; for(var i=0; i<options_standalone.length; i++) if (options_standalone[i].selected) allselected[nbselected++]=options_standalone[i].value; DownloadHTMLFile('Application.html',createStandaloneApp(editor.getValue(),GEBID('name_standalone').value,style_standalone, allselected,(GEBID('encryptioncheck').checked)),'text/plain');"/>
<input type="button" value="Create only a standalone Library" onclick="var style_standalone=1; var options_standalone=GEBID('internalFS_standalone').options; var allselected=[]; var nbselected=0; for(var i=0; i<options_standalone.length; i++) if (options_standalone[i].selected) allselected[nbselected++]=options_standalone[i].value; var w=window.open('','Standalone Library'); w.document.open('text/plain','replace'); w.document.write(createLibraryApp(editor.getValue(),GEBID('name_standalone').value,style_standalone, allselected)); w.document.close();"/><br /><br /></div>
</td></tr>
<tr><td style="width: 50%; vertical-align: top; text-align: left;">
<h2>Application title</h2><input type="text" id="name_standalone" value="Standalone application"/><br/>
<h2>Application style</h2>
<input type="radio" id="style_standalone1" name="style_standalone" checked>Text only<br/>
<input type="radio" id="style_standalone2" name="style_standalone">Text + Graphics<br/>
<input type="radio" id="style_standalone3" name="style_standalone">Graphics only<br/>
<input type="radio" id="style_standalone4" name="style_standalone">HTML output div only<br/>
<h2>Encryption of the code</h2>
<input type="checkbox" id="encryptioncheck" name="encryptioncheck" checked value="on" autocomplete="off">The app code must be encrypted
</td><td style="width: 50%; vertical-align: top; text-align: left;">
<h2>Files to be included</h2>
<select id="internalFS_standalone" size="10" style="width: 300px;" multiple="multiple"></select>
</td></tr>
</table>
</div>
<br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
</div>

</body></html>
